<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="VendorApproval">

    <!-- 상품 검색 조건 -->
    <sql id="productWhere">
        <if test="searchPrdMstCd != null and searchPrdMstCd !=''">
            AND PM.PRD_MST_CD LIKE '%'||UPPER(#{searchPrdMstCd})||'%'
        </if>
        <if test="searchPrdMstNm != null and searchPrdMstNm != ''">
            AND UPPER(PM.PRD_MST_NM) LIKE '%'||UPPER(#{searchPrdMstNm})||'%'
        </if>
        <if test="searchPrdMstSellState != null and searchPrdMstSellState != ''">
            AND PM.PRD_MST_SEL_STATE = #{searchPrdMstSellState}
        </if>
        <if test="searchPrdMstDplState != null and searchPrdMstDplState != ''">
            AND PM.PRD_MST_DPL_STATE = #{searchPrdMstDplState}
        </if>
        <if test="searchPrdMstApvState != null and searchPrdMstApvState != ''">
            AND PM.PRD_MST_APV_STATE = #{searchPrdMstApvState}
        </if>
        <if test="searchPrdMstMdId != null and searchPrdMstMdId != ''">
            AND UPPER(PM.PRD_MST_MD_ID) LIKE '%'||UPPER(#{searchPrdMstMdId})||'%'
        </if>
        <if test="searchPrdMstBrand != null and searchPrdMstBrand != ''">
            AND PM.PRD_MST_BRD_IDX = #{searchPrdMstBrand}
        </if>
        <if test="searchPrdMstVdrIdx != null and searchPrdMstVdrIdx != ''">
            AND PM.PRD_MST_VDR_IDX = #{searchPrdMstVdrIdx}
        </if>
        <if test="searchCategoryYn != null and searchCategoryYn != ''">
            <if test="searchCategoryYn.equals('Y'.toString())">
                AND PM.PRD_MST_CD IN ( 
                                          SELECT DSP_PRD_MST_CD
                                          FROM T_DSP_CTG, WT1
                                          WHERE
                                            T_DSP_CTG.DSP_PRD_CTG_IDX = WT1.PRD_CTG_IDX
                                     )
            </if>
        </if>
    </sql>
    
    <!-- 상품 카테고리 검색 조건 -->
    <sql id="productCategoryWhere">
        <where>
            <if test="searchPrdCtgEnv != null and searchPrdCtgEnv != ''">
                AND PC.PRD_CTG_ENV = #{searchPrdCtgEnv}
            </if>
        </where>
        <if test="searchPrdCtgIdx != null and searchPrdCtgIdx != ''">
            START WITH PC.PRD_CTG_IDX = #{searchPrdCtgIdx}
            CONNECT BY PRIOR PC.PRD_CTG_IDX = PC.PRD_CTG_UP_IDX
        </if>
    </sql>
       
    <!-- 상품 리스트 갯수 -->
    <select id="selectBasicProductCount" parameterType="hashMap" resultType="integer">
        /* VendorApproval.selectBasicProductCount */
        WITH WT1 AS(
            SELECT PC.PRD_CTG_IDX, PC.PRD_CTG_NM, PC.PRD_CTG_TOP_IDX, PC.PRD_CTG_ENV
            FROM T_PRD_CTG PC
            <include refid="productCategoryWhere"/>
        )
        SELECT
            COUNT(0)
        FROM
             T_PRD_MST PM
        WHERE
            PM.PRD_MST_DEL_YN <![CDATA[ <> ]]> 'Y'
            <if test="searchVdrApvType == null or !searchVdrApvType.equals('Y'.toString())">
                AND EXISTS(
                               SELECT PRD_MST_CD
                               FROM T_PRD_MST PM2
                               WHERE PM.PRD_MST_CD = PM2.PRD_MST_CD
                               AND PM2.PRD_MST_VDR_YN = 'Y'
                               AND PM2.PRD_MST_VDR_IDX > 0
                               AND PM2.PRD_MST_APV_STATE = NVL(#{searchPrdMstApvState},'D')
                               AND PM2.PRD_MST_DEL_YN  <![CDATA[ <> ]]>  'Y'      
                           )
            </if>
            <if test="searchVdrApvType != null and searchVdrApvType.equals('Y'.toString())">
                AND EXISTS(
                              SELECT PRD_MST_CD
                              FROM T_VDR_APV VAV
                              WHERE PM.PRD_MST_CD = VAV.PRD_MST_CD
                              AND VAV.VDR_APV_APV_STATE = 'D'
                          )
            </if>
            <include refid="productWhere"/>           
    </select> 
 
    <!-- 상품 리스트 조회 2015.04.09 jesong -->
    <select id="selectBasicProductList" parameterType="hashMap" resultType="hashMap">
        /* VendorApproval.selectBasicProductList */
        
        WITH WT1 AS (SELECT PC.PRD_CTG_IDX,  
                                   PC.PRD_CTG_NM,
                                   PC.PRD_CTG_TOP_IDX,
                                   PC.PRD_CTG_ENV
                         FROM T_PRD_CTG PC
                     <include refid="productCategoryWhere"/>
                     )
        SELECT  RNUM,
                PRD_MST_CD,
                PRD_MST_NM,
                PRD_MST_CNL_PC_YN,
                PRD_MST_CNL_MB_YN,
                PRD_MST_SEL_CNT,
                PRD_MST_SEL_STATE,
                PRD_MST_DPL_STATE,
                PRD_MST_APV_STATE, 
                PRD_MST_REG_DT,
                PRD_MST_UPD_DT,
                PRD_MST_PRC,
                PRD_MST_SCH_PRC,
                PRD_MST_DLV_FEE,
                DSP_PRD_CTG_IDX,
                (
                    SELECT SUBSTR(SYS_CONNECT_BY_PATH(PRD_CTG_NM, '>'),2)
                    FROM T_PRD_CTG
                    WHERE PRD_CTG_IDX = DSP_PRD_CTG_IDX
                    START WITH PRD_CTG_UP_IDX = -1
                     CONNECT BY PRIOR PRD_CTG_IDX = PRD_CTG_UP_IDX
                ) AS PRD_CTG_LVL_NM
                ,
                PRD_MST_PC_CPN_UNT,
                PRD_MST_PC_CPN_PRC,
                PRD_MST_MB_CPN_UNT,
                PRD_MST_MB_CPN_PRC,
                PRD_MST_VDR_NM,
                PRD_MST_APV_STATE_NM,
                VAV_PRD_MST_PRC,
                VAV_PRD_MST_SCH_PRC,
                VAV_PRD_MST_SEL_CNT,
                VAV_PRD_MST_PC_CPN_UNT,
                VAV_PRD_MST_PC_CPN_PRC,
                VAV_PRD_MST_MB_CPN_UNT,
                VAV_PRD_MST_MB_CPN_PRC,
                PRD_MST_SEL_STATE_NM,
                VDR_APV_IDX,
                PRD_MST_CPN_OWN
      FROM (
                SELECT  ROWNUM RNUM,
                        PRD_MST_CD,
                        PRD_MST_NM,
                        PRD_MST_CNL_PC_YN,
                        PRD_MST_CNL_MB_YN,
                        PRD_MST_SEL_CNT,
                        PRD_MST_SEL_STATE,
                        PRD_MST_DPL_STATE,
                        PRD_MST_APV_STATE, 
                        PRD_MST_REG_DT,
                        PRD_MST_UPD_DT,
                        PRD_MST_PRC,
                        PRD_MST_SCH_PRC,
                        PRD_MST_DLV_FEE,
                        DSP_PRD_CTG_IDX,
                        PRD_MST_PC_CPN_UNT,
                        PRD_MST_PC_CPN_PRC,
                        PRD_MST_MB_CPN_UNT,
                        PRD_MST_MB_CPN_PRC,
                        PRD_MST_VDR_NM,
                        PRD_MST_APV_STATE_NM,
                        VAV_PRD_MST_PRC,
                        VAV_PRD_MST_SCH_PRC,
                        VAV_PRD_MST_SEL_CNT,
                        VAV_PRD_MST_PC_CPN_UNT,
                        VAV_PRD_MST_PC_CPN_PRC,
                        VAV_PRD_MST_MB_CPN_UNT,
                        VAV_PRD_MST_MB_CPN_PRC,
                        PRD_MST_SEL_STATE_NM,
                        VDR_APV_IDX,
                        PRD_MST_CPN_OWN
              FROM (  
                            SELECT  PM.PRD_MST_CD,  /* 온라인 상품코드 */
                                    PM.PRD_MST_NM, /* 상품명 */
                                    PM.PRD_MST_CNL_PC_YN, /* 쇼핑 채널 PC여부 */
                                    PM.PRD_MST_CNL_MB_YN, /* 쇼핑 채널 MOBILE여부 */
                                    PM.PRD_MST_SEL_CNT, /* 판매가능 수량 */
                                    PM.PRD_MST_SEL_STATE, /* 판매상태 */
                                    PM.PRD_MST_DPL_STATE, /* 진열여부 */
                                    PM.PRD_MST_APV_STATE, /* 승인여부 */ 
                                    PM.PRD_MST_REG_DT, /* 최초 등록일 */
                                    PM.PRD_MST_UPD_DT, /* 최종 수정일 */
                                    PM.PRD_MST_PRC, /* 상품가격 */
                                    PM.PRD_MST_SCH_PRC, /* 검색가 */
                                    PM.PRD_MST_DLV_FEE, /* 배송비 */
                                    (SELECT DSP_PRD_CTG_IDX FROM T_DSP_CTG WHERE DSP_PRD_MST_CD = PM.PRD_MST_CD AND ROWNUM = 1) AS DSP_PRD_CTG_IDX, /* 카테고리 IDX */
                                    PM.PRD_MST_PC_CPN_UNT, /* PC즉시쿠폰 정율/정액 */
                                    PM.PRD_MST_PC_CPN_PRC, /* PC즉시쿠폰 정율금액/정액금액 */
                                    PM.PRD_MST_MB_CPN_UNT, /* MOBILE즉시쿠폰 정율/정액 */
                                    PM.PRD_MST_MB_CPN_PRC, /* MOBILE즉시쿠폰 정율금액/정액금액 */
                                    <![CDATA[CASE WHEN PM.PRD_MST_VDR_YN = 'N' AND PM.PRD_MST_VDR_IDX = -1 
                                                THEN '-' 
                                                ELSE (SELECT VDR_MST_NM FROM T_VDR_MST WHERE VDR_MST_IDX = PM.PRD_MST_VDR_IDX) END]]> AS PRD_MST_VDR_NM
                                    , <![CDATA[CASE PM.PRD_MST_APV_STATE
                                            WHEN 'A' THEN '승인'
                                            WHEN 'D' THEN '대기'
                                            WHEN 'C' THEN '거절'
                                        ELSE
                                            '상태값 없음'
                                        END]]> AS PRD_MST_APV_STATE_NM  /* 승인여부_STR */ 
                                    , <![CDATA[
                                        CASE PM.PRD_MST_SEL_STATE 
                                            WHEN 'I' THEN '판매중'
                                            WHEN 'O' THEN '일시품절'
                                            WHEN 'T' THEN '품절상품'
                                        ELSE '미판매' END]]> AS PRD_MST_SEL_STATE_NM
                                    , (SELECT VDR_APV_IDX FROM T_VDR_APV WHERE PRD_MST_CD = PM.PRD_MST_CD AND VDR_APV_APV_STATE = 'D') AS VDR_APV_IDX
                                    , (SELECT PRD_MST_PRC FROM T_VDR_APV WHERE PRD_MST_CD = PM.PRD_MST_CD AND VDR_APV_APV_STATE = 'D') AS VAV_PRD_MST_PRC
                                    , (SELECT PRD_MST_SCH_PRC FROM T_VDR_APV WHERE PRD_MST_CD = PM.PRD_MST_CD AND VDR_APV_APV_STATE = 'D') AS VAV_PRD_MST_SCH_PRC
                                    , (SELECT PRD_MST_SEL_CNT FROM T_VDR_APV WHERE PRD_MST_CD = PM.PRD_MST_CD AND VDR_APV_APV_STATE = 'D') AS VAV_PRD_MST_SEL_CNT
                                    , (SELECT PRD_MST_PC_CPN_UNT FROM T_VDR_APV WHERE PRD_MST_CD = PM.PRD_MST_CD AND VDR_APV_APV_STATE = 'D') AS VAV_PRD_MST_PC_CPN_UNT
                                    , (SELECT NVL(PRD_MST_PC_CPN_PRC,0) FROM T_VDR_APV WHERE PRD_MST_CD = PM.PRD_MST_CD AND VDR_APV_APV_STATE = 'D') AS VAV_PRD_MST_PC_CPN_PRC
                                    , (SELECT PRD_MST_MB_CPN_UNT FROM T_VDR_APV WHERE PRD_MST_CD = PM.PRD_MST_CD AND VDR_APV_APV_STATE = 'D') AS VAV_PRD_MST_MB_CPN_UNT
                                    , (SELECT NVL(PRD_MST_MB_CPN_PRC,0) FROM T_VDR_APV WHERE PRD_MST_CD = PM.PRD_MST_CD AND VDR_APV_APV_STATE = 'D') AS VAV_PRD_MST_MB_CPN_PRC
                                    , PM.PRD_MST_CPN_OWN
                               FROM T_PRD_MST PM
                             WHERE
                                PM.PRD_MST_DEL_YN <![CDATA[ <> ]]> 'Y'
                                <if test="searchVdrApvType == null or !searchVdrApvType.equals('Y'.toString())">
                                    AND EXISTS(
                                                  SELECT PRD_MST_CD
                                                  FROM T_PRD_MST PM2
                                                  WHERE PM.PRD_MST_CD = PM2.PRD_MST_CD
                                                  AND PM2.PRD_MST_VDR_YN = 'Y'
                                                  AND PM2.PRD_MST_VDR_IDX > 0
                                                  AND PM2.PRD_MST_APV_STATE = NVL(#{searchPrdMstApvState},'D')
                                                  AND PM2.PRD_MST_DEL_YN  <![CDATA[ <> ]]>  'Y'      
                                              )
                                </if>
                                <if test="searchVdrApvType != null and searchVdrApvType.equals('Y'.toString())">
                                    AND EXISTS(
                                                   SELECT PRD_MST_CD
                                                   FROM T_VDR_APV VAV
                                                   WHERE PM.PRD_MST_CD = VAV.PRD_MST_CD
                                                   AND VAV.VDR_APV_APV_STATE = 'D'
                                               )
                                </if>
                                 <include refid="productWhere"/>
                           ORDER BY PRD_MST_REG_DT DESC, PM.PRD_MST_CD ASC
                           ) IV1
               ) IV2
            <if test="excelDown == null or !excelDown.equals('Y'.toString())">
                WHERE  RNUM BETWEEN #{startNum} AND #{endNum}       
            </if>
        ORDER BY RNUM
    </select>
    
    <!-- 상품 상세 조회 -->
    <resultMap type="java.util.HashMap" id="resultProduct">
        <result column="PRD_MST_CD"     property="PRD_MST_CD"/>
        <result column="PRD_MST_VDR_YN"     property="PRD_MST_VDR_YN"/>
        <result column="PRD_MST_VDR_IDX"    property="PRD_MST_VDR_IDX"/>
        <result column="PRD_MST_TYPE"       property="PRD_MST_TYPE"/>
        <result column="PRD_MST_BUY_TP"     property="PRD_MST_BUY_TP"/>
        <result column="PRD_MST_NM"     property="PRD_MST_NM"/>
        <result column="PRD_MST_NM_SUB"     property="PRD_MST_NM_SUB"/>
        <result column="PRD_MST_LNG_DIV_YN" property="PRD_MST_LNG_DIV_YN"/>
        <result column="PRD_MST_LNG_DIV_MNT1"   property="PRD_MST_LNG_DIV_MNT1"/>
        <result column="PRD_MST_LNG_DIV_MNT2"   property="PRD_MST_LNG_DIV_MNT2"/>
        <result column="PRD_MST_MD_ID"      property="PRD_MST_MD_ID"/>
        <result column="PRD_MST_DLV_FEE"    property="PRD_MST_DLV_FEE"/>
        <result column="PRD_MST_CPS_YN"     property="PRD_MST_CPS_YN"/>
        <result column="PRD_MST_CPS_MDL"    property="PRD_MST_CPS_MDL"/>
        <result column="PRD_MST_CPN_YN"     property="PRD_MST_CPN_YN"/>
        <result column="PRD_MST_SEL_CNT"    property="PRD_MST_SEL_CNT"/>
        <result column="PRD_MST_PC_CPN_UNT" property="PRD_MST_PC_CPN_UNT"/>
        <result column="PRD_MST_PC_CPN_PRC" property="PRD_MST_PC_CPN_PRC"/>
        <result column="PRD_MST_MB_CPN_UNT" property="PRD_MST_MB_CPN_UNT"/>
        <result column="PRD_MST_MB_CPN_PRC" property="PRD_MST_MB_CPN_PRC"/>
        <result column="PRD_MST_ADD_MIL"    property="PRD_MST_ADD_MIL"/>
        <result column="PRD_MST_SRC_YN"     property="PRD_MST_SRC_YN"/>
        <result column="PRD_MST_O2O_YN"     property="PRD_MST_O2O_YN"/>
        <result column="PRD_MST_DLV_BND"    property="PRD_MST_DLV_BND"/>
        <result column="PRD_MST_IVB_YN"     property="PRD_MST_IVB_YN"/>
        <result column="PRD_MST_DLV_DSN_YN" property="PRD_MST_DLV_DSN_YN"/>
        <result column="PRD_MST_DLV_DT"     property="PRD_MST_DLV_DT"/>
        <result column="PRD_MST_PRC"        property="PRD_MST_PRC"/>
        <result column="PRD_MST_SCH_PRC"    property="PRD_MST_SCH_PRC"/>
        <result column="PRD_MST_CPR_PRC1"   property="PRD_MST_CPR_PRC1"/>
        <result column="PRD_MST_CPR_PRC2"   property="PRD_MST_CPR_PRC2"/>
        <result column="PRD_MST_PKG_PRC"    property="PRD_MST_PKG_PRC"/>
        <result column="PRD_MST_CNL_PC_YN"  property="PRD_MST_CNL_PC_YN"/>
        <result column="PRD_MST_CNL_MB_YN"  property="PRD_MST_CNL_MB_YN"/>
        <result column="PRD_MST_SEL_STATE"  property="PRD_MST_SEL_STATE"/>
        <result column="PRD_MST_DPL_STATE"  property="PRD_MST_DPL_STATE"/>
        <result column="PRD_MST_APV_STATE"  property="PRD_MST_APV_STATE"/>
        <result column="PRD_MST_PC_DTL_DSC" property="PRD_MST_PC_DTL_DSC" jdbcType="CLOB" javaType="java.lang.String"/>
        <result column="PRD_MST_MB_DTL_DSC" property="PRD_MST_MB_DTL_DSC" jdbcType="CLOB" javaType="java.lang.String"/>
        <result column="PRD_MST_NFI_IDX"    property="PRD_MST_NFI_IDX"/>
        <result column="PRD_MST_BRD_IDX"    property="PRD_MST_BRD_IDX"/>
        <result column="PRD_MST_MRK_IDX"    property="PRD_MST_MRK_IDX"/>
        <result column="PRD_MST_NFI_INF1"   property="PRD_MST_NFI_INF1"/>
        <result column="PRD_MST_NFI_INF2"   property="PRD_MST_NFI_INF2"/>
        <result column="PRD_MST_NFI_INF3"   property="PRD_MST_NFI_INF3"/>
        <result column="PRD_MST_NFI_INF4"   property="PRD_MST_NFI_INF4"/>
        <result column="PRD_MST_NFI_INF5"   property="PRD_MST_NFI_INF5"/>
        <result column="PRD_MST_NFI_INF6"   property="PRD_MST_NFI_INF6"/>
        <result column="PRD_MST_NFI_INF7"   property="PRD_MST_NFI_INF7"/>
        <result column="PRD_MST_NFI_INF8"   property="PRD_MST_NFI_INF8"/>
        <result column="PRD_MST_NFI_INF9"   property="PRD_MST_NFI_INF9"/>
        <result column="PRD_MST_NFI_INF10"  property="PRD_MST_NFI_INF10"/>
        <result column="PRD_MST_NFI_INF11"  property="PRD_MST_NFI_INF11"/>
        <result column="PRD_MST_NFI_INF12"  property="PRD_MST_NFI_INF12"/>
        <result column="PRD_MST_NFI_INF13"  property="PRD_MST_NFI_INF13"/>
        <result column="PRD_MST_NFI_INF14"  property="PRD_MST_NFI_INF14"/>
        <result column="PRD_MST_MTA_TAG1"   property="PRD_MST_MTA_TAG1"/>
        <result column="PRD_MST_MTA_TAG2"   property="PRD_MST_MTA_TAG2"/>
        <result column="PRD_MST_MTA_TAG3"   property="PRD_MST_MTA_TAG3"/>
        <result column="PRD_MST_MEMO"       property="PRD_MST_MEMO"/>
        <result column="PRD_MST_RED_CNT"    property="PRD_MST_RED_CNT"/>
        <result column="PRD_MST_ICN_YN1"    property="PRD_MST_ICN_YN1"/>
        <result column="PRD_MST_ICN_ST_DT1" property="PRD_MST_ICN_ST_DT1"/>
        <result column="PRD_MST_ICN_ED_DT1" property="PRD_MST_ICN_ED_DT1"/>
        <result column="PRD_MST_ICN_YN2"    property="PRD_MST_ICN_YN2"/>
        <result column="PRD_MST_ICN_ST_DT2" property="PRD_MST_ICN_ST_DT2"/>
        <result column="PRD_MST_ICN_ED_DT2" property="PRD_MST_ICN_ED_DT2"/>
        <result column="PRD_MST_ICN_YN3"    property="PRD_MST_ICN_YN3"/>
        <result column="PRD_MST_ICN_ST_DT3" property="PRD_MST_ICN_ST_DT3"/>
        <result column="PRD_MST_ICN_ED_DT3" property="PRD_MST_ICN_ED_DT3"/>
        <result column="PRD_MST_ICN_YN4"    property="PRD_MST_ICN_YN4"/>
        <result column="PRD_MST_ICN_ST_DT4" property="PRD_MST_ICN_ST_DT4"/>
        <result column="PRD_MST_ICN_ED_DT4" property="PRD_MST_ICN_ED_DT4"/>
        <result column="PRD_MST_ICN_YN5"    property="PRD_MST_ICN_YN5"/>
        <result column="PRD_MST_ICN_ST_DT5" property="PRD_MST_ICN_ST_DT5"/>
        <result column="PRD_MST_ICN_ED_DT5" property="PRD_MST_ICN_ED_DT5"/>
        <result column="PRD_MST_DEL_YN"     property="PRD_MST_DEL_YN"/>
        <result column="PRD_MST_REG_DT"     property="PRD_MST_REG_DT"/>
        <result column="PRD_MST_REG_IP"     property="PRD_MST_REG_IP"/>
        <result column="PRD_MST_REG_ID"     property="PRD_MST_REG_ID"/>
        <result column="PRD_MST_UPD_DT"     property="PRD_MST_UPD_DT"/>
        <result column="PRD_MST_UPD_IP"     property="PRD_MST_UPD_IP"/>
        <result column="PRD_MST_UPD_ID"     property="PRD_MST_UPD_ID"/>
        <result column="PRD_MST_REG_NM"     property="PRD_MST_REG_NM"/>
        <result column="PRD_MST_UPD_NM"     property="PRD_MST_UPD_NM"/>
        <result column="PRD_MST_SEL_STATE_NM"       property="PRD_MST_SEL_STATE_NM"/>
        <result column="PRD_MST_NFI_NM"     property="PRD_MST_NFI_NM"/>
        <result column="PRD_MST_BRAND_NM"       property="PRD_MST_BRAND_NM"/>
        <result column="PRD_MST_MRK_NM"     property="PRD_MST_MRK_NM"/>
        <result column="PRD_MST_BRD_SERV"       property="PRD_MST_BRD_SERV"/>
           
    </resultMap>
    
    <!-- 상품상세 브랜드 조회 -->
    <select id="selectBasicProductBrandList" parameterType="hashMap" resultType="hashMap">
        /* VendorApproval.selectBasicProductBrandList */
        SELECT      
            BND_MST_IDX,
            BND_MST_BRAND_NM,
            BND_MST_SERV
        FROM T_BND_MST
        WHERE
            BND_MST_USE_YN = 'Y'
    </select>
    
    <!-- 관리자 > 상품관리 > MD회원리스트 -->
    <select id="selectBasicMdList" parameterType="hashMap" resultType="hashMap">
       /* VendorApproval.selectBasicMdList */  
        SELECT
            ADM_MST_ID,
            ADM_MST_NM
        FROM
            T_ADM_MST AM
        WHERE
            AM.AUT_MST_IDX = #{AUT_MST_IDX}
    </select> 
    
    <!-- 입점업체 수정요청 내용 확인  --> 
    <select id="selectVendorProductChangeView" parameterType="HashMap" resultType="HashMap">
        /* VendorApproval.selectVendorProductChangeView */
        SELECT 
            PM.PRD_MST_CD
            , VAV.VDR_APV_IDX
            , PM.PRD_MST_PRC AS PM_PRD_MST_PRC
            , PM.PRD_MST_SCH_PRC AS PM_PRD_MST_SCH_PRC
            , PM.PRD_MST_SEL_STATE AS PM_PRD_MST_SEL_STATE
            , NVL(PM.PRD_MST_SEL_CNT,0) AS PM_PRD_MST_SEL_CNT
            , PM.PRD_MST_PC_CPN_UNT AS PM_PRD_MST_PC_CPN_UNT
            , NVL(PM.PRD_MST_PC_CPN_PRC,0) AS PM_PRD_MST_PC_CPN_PRC
            , PM.PRD_MST_MB_CPN_UNT AS PM_PRD_MST_MB_CPN_UNT
            , NVL(PM.PRD_MST_MB_CPN_PRC,0) AS PM_PRD_MST_MB_CPN_PRC
            , VAV.PRD_MST_PRC AS VAV_PRD_MST_PRC
            , VAV.PRD_MST_SCH_PRC AS VAV_PRD_MST_SCH_PRC
            , VAV.PRD_MST_SEL_STATE AS VAV_PRD_MST_SEL_STATE
            , NVL(VAV.PRD_MST_SEL_CNT,0) AS VAV_PRD_MST_SEL_CNT
            , VAV.PRD_MST_PC_CPN_UNT AS VAV_PRD_MST_PC_CPN_UNT
            , NVL(VAV.PRD_MST_PC_CPN_PRC,0) AS VAV_PRD_MST_PC_CPN_PRC
            , VAV.PRD_MST_MB_CPN_UNT AS VAV_PRD_MST_MB_CPN_UNT
            , NVL(VAV.PRD_MST_MB_CPN_PRC,0) AS VAV_PRD_MST_MB_CPN_PRC
            , <![CDATA[
                CASE PM.PRD_MST_SEL_STATE 
                    WHEN 'I' THEN '판매중'
                    WHEN 'O' THEN '일시품절'
                    WHEN 'T' THEN '품정상품'
                ELSE '미판매' END]]> AS PM_PRD_MST_SEL_STATE_NM
            , <![CDATA[
                CASE VAV.PRD_MST_SEL_STATE 
                    WHEN 'I' THEN '판매중'
                    WHEN 'O' THEN '일시품절'
                    WHEN 'T' THEN '품정상품'
                ELSE '미판매' END]]> AS VAV_PRD_MST_SEL_STATE_NM
            , <![CDATA[
                CASE PM.PRD_MST_PC_CPN_UNT
                    WHEN 'R' THEN '정율(%)'
                ELSE
                    '정액(원)'
                END]]> AS PM_PRD_MST_PC_CPN_UNT_NM
            , <![CDATA[
                CASE VAV.PRD_MST_PC_CPN_UNT
                    WHEN 'R' THEN '정율(%)'
                ELSE
                    '정액(원)'
                END]]> AS VAV_PRD_MST_PC_CPN_UNT_NM
            , <![CDATA[
                CASE PM.PRD_MST_MB_CPN_UNT
                    WHEN 'R' THEN '정율(%)'
                ELSE
                    '정액(원)'
                END]]> AS PM_PRD_MST_MB_CPN_UNT_NM
            , <![CDATA[
                CASE VAV.PRD_MST_MB_CPN_UNT
                    WHEN 'R' THEN '정율(%)'
                ELSE
                    '정액(원)'
                END]]> AS VAV_PRD_MST_MB_CPN_UNT_NM
        FROM T_PRD_MST PM
        INNER JOIN T_VDR_APV VAV ON VAV.PRD_MST_CD = PM.PRD_MST_CD
        WHERE 
            PM.PRD_MST_CD = #{PRD_MST_CD}
        AND
            VAV.VDR_APV_APV_STATE = 'D'
        AND 
            PM.PRD_MST_DEL_YN <![CDATA[<>]]> 'Y'
    </select>
    
    <!-- 입점업체 상품 수정요청 거절  -->
    <update id="deleteVendorProductList" parameterType="hashmap" >
        /* VendorApproval.deleteVendorProductList */
        UPDATE 
            T_VDR_APV
        SET
            VDR_APV_APV_STATE = 'C'
            , VDR_APV_UPD_DT = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
            , VDR_APV_UPD_ID = #{VDR_APV_UPD_ID}
            , VDR_APV_UPD_IP = #{VDR_APV_UPD_IP}
        WHERE
            PRD_MST_CD = #{PRD_MST_CD}
        AND
            VDR_APV_IDX = #{VDR_APV_IDX}
    </update>
    
    <!-- 입점업체 상품 수정요청 승인  -->
    <update id="updateVendorProductChange" parameterType="hashmap" >
        /* VendorApproval.updateVendorProductChange */
        UPDATE 
            T_VDR_APV
        SET
            VDR_APV_APV_STATE = 'A'
            , VDR_APV_UPD_DT = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
            , VDR_APV_UPD_ID = #{VDR_APV_UPD_ID}
            , VDR_APV_UPD_IP = #{VDR_APV_UPD_IP}
        WHERE
            PRD_MST_CD = #{PRD_MST_CD}
        AND
            VDR_APV_IDX = #{VDR_APV_IDX}
    </update>
    
    <!-- 입점업체 상품 수정요청 승인 상품마스터 업데이트  -->
    <update id="updateProductChangeToVendor" parameterType="hashmap" >
        /* VendorApproval.updateProductChangeToVendor */
        
        UPDATE 
            T_PRD_MST
        SET 
            PRD_MST_PRC = #{VAV_PRD_MST_PRC}
            , PRD_MST_SCH_PRC = #{VAV_PRD_MST_SCH_PRC}
            , PRD_MST_SEL_CNT = #{VAV_PRD_MST_SEL_CNT}
            , PRD_MST_PC_CPN_UNT = #{VAV_PRD_MST_PC_CPN_UNT}
            <if test="VAV_PRD_MST_PC_CPN_PRC != '0'">
                , PRD_MST_PC_CPN_PRC = #{VAV_PRD_MST_PC_CPN_PRC}
            </if>
            , PRD_MST_MB_CPN_UNT = #{VAV_PRD_MST_MB_CPN_UNT}
            <if test="VAV_PRD_MST_MB_CPN_PRC != '0'">
                , PRD_MST_MB_CPN_PRC = #{VAV_PRD_MST_MB_CPN_PRC}    
            </if>
            , PRD_MST_UPD_IP = #{PRD_MST_UPD_IP}
            , PRD_MST_UPD_ID = #{PRD_MST_UPD_ID}
            , PRD_MST_UPD_DT = TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
        WHERE
            PRD_MST_CD = #{PRD_MST_CD}
    </update>
    
</mapper>