<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
******************************************************************************
* SELECT : 재고관리
* 작성자 : 윤민우
* 작성 일자 : 2022.03.11
******************************************************************************
-->
<mapper namespace="com.ssp.bo.iv.ivInventory">

    <!-- 공통코드 목록 조회 -->
    <select id="selectComCdList" parameterType="hashMap" resultType="hashMap">
        /* com.ssp.bo.iv.ivInventory.selectComCdList */
        Select  ''                  AS CODE_CD
               ,'전체'                AS CODE_NM
        From    DUAL
        Union All
        Select  COM_DTL_CD          AS CODE_CD
               ,COM_DTL_CD_NM       AS CODE_NM
        From    TB_CO_COM_CD_DTL
        Where   LANG_CD = #{LANG_CD}
        And     COM_CLSF_CD = #{COM_CLSF_CD}
        And     USE_YN = 'Y'
    </select>

    <!-- 재고관리 마스터 목록 카운트 -->
    <select id="selectInventoryListCount" parameterType="HashMap" resultType="Integer">
        /* com.ssp.bo.iv.ivInventory.selectInventoryListCount */
        Select
            COUNT(*)
        From    TB_IV_PRD_INVN_DTLS a
            Join
            TB_PR_PRD_INFO b
                On (b.CO_CD = a.CO_CD
                And b.PRD_ID = a.PRD_ID)
            Left Join
            TB_PR_MRO_PRD_INFO c
                On (c.CO_CD = b.CO_CD
                And c.PRD_ID = b.PRD_ID)
            Left Join
            TB_PR_MNFR_INFO d
                On (d.CO_CD = c.CO_CD
                And d.MNFR_NO = c.MNFR_NO)
            Left Join
            TB_CP_CPRTCP_BASIS e
                On (e.CO_CD = a.CO_CD
                And e.CPRTCP_ID = a.CPRTCP_ID)
            Left Join
            (
                Select
                        f.COM_DTL_CD                    INVN_TP_CD
                        ,f.COM_DTL_CD_NM                INVN_TP_CD_NM
                From    TB_CO_COM_CD_DTL f
                Where   f.LANG_CD = #{LANG_CD}            /*KO*/
                And     f.COM_CLSF_CD = 'INVN_TP_CD'
            ) f
                On (f.INVN_TP_CD = a.INVN_TP_CD)
            Left Join
            (
                Select
                        g.COM_DTL_CD                    INVN_STATS_CD
                        ,g.COM_DTL_CD_NM                INVN_STATS_CD_NM
                From    TB_CO_COM_CD_DTL g
                Where   g.LANG_CD = #{LANG_CD}            /*KO*/
                And     g.COM_CLSF_CD = 'INVN_STATS_CD'
            ) g
                On (g.INVN_STATS_CD = a.INVN_STATS_CD)
            Left Join
            TB_CO_MBR_OPRTR_ORG_INFO h
                On (h.CO_CD = a.CO_CD
                And h.ORG_CD = a.PURG_TEAM_CD)
            Left Join
            TB_CO_MBR_OPRTR_INFO i
                On (i.CO_CD = a.CO_CD
                And i.OPRTR_ID = a.PURG_CHRPSN_ID)
            <if test=" PRD_ID > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS   t1
                ON  t1.SES_ID = #{SES_ID}
                AND t1.INQ_COND_DTLS = #{INQ_COND_DTLS}
                AND t1.COL_ITM = 'PRD_ID'
                AND LPAD(t1.COND_DATA_VAL,18,'0') = b.PRD_ID
            </if>
            CROSS JOIN
            (
            SELECT  COM_USR_DEFN_NM_1  AS SAFT_INVN_RT
            FROM    TB_CO_COM_CD_DTL  T1
            WHERE   T1.LANG_CD = #{LANG_CD}
            AND   T1.COM_CLSF_CD = 'SAFT_INVN_RT'
            AND   T1.COM_DTL_CD = '10'
            )       t2
            <choose>
                <when test=" REPR_PRD_SPR_CD != null and !REPR_PRD_SPR_CD.equals('') ">
                JOIN
                </when>
                <otherwise>
                LEFT JOIN
                </otherwise>
            </choose>
            TB_PR_REPR_PRD_MNG_DTL  t3
            ON  t3.CO_CD = a.CO_CD
            AND t3.PRD_ID = a.PRD_ID
            AND t3.SSP_PRD_YN = 'Y'
            <if test="REPR_PRD_SPR_CD != null and !REPR_PRD_SPR_CD.equals('')">
                <choose>
                    <when test='REPR_PRD_SPR_CD == "UNION"'>
                        AND DECODE(t3.REPR_PRD_SPR_YN, 'N', '3', t3.REPR_PRD_SPR_RSN_CD) IN ('1', '2') --통합_전체 하드코딩
                    </when>
                    <otherwise>
                        AND DECODE(t3.REPR_PRD_SPR_YN, 'N', '3', t3.REPR_PRD_SPR_RSN_CD) = #{REPR_PRD_SPR_CD}  --대표상품구분 3=피통합
                    </otherwise>
                </choose>
            </if>
            <choose>
                <when test=" PUB_ONLY_SPR_CD != null and !PUB_ONLY_SPR_CD.equals('') ">
                JOIN
                </when>
                <otherwise>
                LEFT JOIN
                </otherwise>
            </choose>
            TB_PR_MRO_PRD_INFO t4
            ON  t4.CO_CD = a.CO_CD
            AND t4.PRD_ID = a.PRD_ID
            AND t4.PUB_ONLY_SPR_CD LIKE #{PUB_ONLY_SPR_CD} || '%'
            <choose>
                <when test=" MD_OPRTR_ID != null and !MD_OPRTR_ID.equals('') ">
                JOIN
                </when>
                <otherwise>
                LEFT JOIN
                </otherwise>
            </choose>
            (
            SELECT  B.CO_CD,
                    B.PRD_CLCD,
                    A.OPRTR_ID      MD_OPRTR_ID
            FROM    TB_CO_MBR_OPRTR_INFO A          /* 회원운영자정보 */
                    JOIN
                    TB_PR_PRD_CLSF_CHRPSN_INFO B    /* 상품분류담당자정보, MD담당자 */
                    ON  B.CO_CD = A.CO_CD
                    AND B.PRD_CLSF_CHRPSN_ID = A.OPRTR_ID
            WHERE   B.PRD_CLSF_CHRPSN_SPR_CD = '10'
            AND     B.PRD_CLSF_CHRPSN_TP_CD = '20'
            AND     B.PRD_CLSF_CHRPSN_USEYN = 'Y'
            AND     B.MNFR_NO = '*'
            AND     A.OPRTR_ID LIKE #{MD_OPRTR_ID} || '%'
            ) t5
            ON  t5.CO_CD = b.CO_CD
            AND t5.PRD_CLCD = b.PRD_CLCD

        <include refid="inventoryListWhere"/>

    </select>

    <!-- 재고관리 마스터 목록 -->
    <select id="selectInventoryList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.iv.ivInventory.selectInventoryList */
        Select  T1.*
                , CASE WHEN T1.REPR_PRD_SPR_RSN_CD IS NOT NULL OR t10.COM_DTL_CD_NM IS NOT NULL
                         THEN T1.REPR_PRD_SPR_RSN_CD || ' | ' || t10.COM_DTL_CD_NM END  REPR_PRD_SPR_CD_NM     /* 대표상품구분 */
                , CASE WHEN T1.PUB_ONLY_SPR_CD IS NOT NULL OR t11.COM_DTL_CD_NM IS NOT NULL
                         THEN T1.PUB_ONLY_SPR_CD || ' | ' || t11.COM_DTL_CD_NM END      PUB_ONLY_SPR_CD_NM     /* 공용전용구분 */
                , CASE WHEN T1.MD_OPRTR_ID IS NOT NULL OR t12.OPRTR_NM IS NOT NULL
                         THEN T1.MD_OPRTR_ID || ' | ' || t12.OPRTR_NM END               MD_OPRTR_ID_NM      /* MD담당자 */
        From    (
                Select
                        a.BSS_DT                                                            /* 기준일자 */
                        , a.CO_CD                                                           /* 회사코드 */
                        , a.BZ_DOMN_CD                                                      /* 사업영역코드 */
                        , LTRIM(a.PRD_ID, '0')                  As PRD_ID                   /* 상품ID  */
                        , b.PRD_NM                                                          /* 상품명 */
                        --, c.MRO_REPR_ATTR                                                   /* MRO대표속성(규격) */
                        , FN_PR_ATTR_VAL_LIST(a.CO_CD, a.PRD_ID) MRO_REPR_ATTR
                        , c.MNFR_NO                                                         /* 제조사번호 (제조원ID)*/
                        , d.MRO_MNFR_NM                                                     /* MRO제조사명 (제조원명)*/
                        , Nvl(c.SELL_UNIT_CD,c.BASIS_UNIT_CD)   As SELL_UNIT_CD             /*판매단위코드(주문단위코드)*/
                        , a.INVN_TP_CD                                                      /* 재고유형코드 */
                        , f.INVN_TP_CD_NM                                                   /* 재고유형코드명 */
                        , a.CPRTCP_ID                                                       /* 협력사ID */
                        , e.CPRTCP_KOR_NM                                                   /* 협력사한글명 */
                        , CEIL(NVL(a.SAFT_INVN_QTY,0) * NVL(t2.SAFT_INVN_RT,100) / 100)  AS SSP_SAFT_INVN_QTY   /* SSP 안전재고 수량 */
                        , a.SAFT_INVN_QTY                                                   /* 안전재고수량 */
                        , a.MAX_INVN_QTY                                                    /* 최대재고수량 */
                        , a.GI_DUE_QTY                                                      /* 입고예정수량 */
                        , a.APRV_PRGS_QTY                                                   /* 결재진행수량 */
                        , a.PRD_INVN_QTY                                                    /* 상품재고수량 */
                        , a.TRNS_INVN_QTY                                                   /* 운송재고수량 */
                        , a.SO_PRGS_QTY                                                     /* SO진행수량 */
                        , a.SSP_ODR_QTY                                                     /* SSP주문수량 (SSP진행중주문)*/
                        , a.SSP_AVAIL_INVN_QTY                                              /* SSP가용재고수량 */
                        , a.INVN_STATS_CD                                                   /* 재고상태코드(몰판매여부) */
                        , g.INVN_STATS_CD_NM                                                /* 재고상태코드명(몰판매여부) */
                        , a.PURG_TEAM_CD                                                    /* 구매팀코드 */
                        , h.ORG_NM                              As PURG_TEAM_NM             /* 구매팀명 */
                        , a.PURG_CHRPSN_ID                                                  /* 구매담당자ID */
                        , i.OPRTR_NM                            As PURG_CHRPSN_NM           /* 구매담당자명 */
                        , DECODE(t3.REPR_PRD_SPR_YN, 'N', '3', t3.REPR_PRD_SPR_RSN_CD) REPR_PRD_SPR_RSN_CD      /* 대표상품구분사유코드 */
                        , t4.PUB_ONLY_SPR_CD                                                /* 공용전용구분코드 */
                        , t5.MD_OPRTR_ID                                                    /* MD 담당자 */
                    From    TB_IV_PRD_INVN_DTLS a
                        Join
                        TB_PR_PRD_INFO b
                            On (b.CO_CD = a.CO_CD
                            And b.PRD_ID = a.PRD_ID)
                        Left Join
                        TB_PR_MRO_PRD_INFO c
                            On (c.CO_CD = b.CO_CD
                            And c.PRD_ID = b.PRD_ID)
                        Left Join
                        TB_PR_MNFR_INFO d
                            On (d.CO_CD = c.CO_CD
                            And d.MNFR_NO = c.MNFR_NO)
                        Left Join
                        TB_CP_CPRTCP_BASIS e
                            On (e.CO_CD = a.CO_CD
                            And e.CPRTCP_ID = a.CPRTCP_ID)
                        Left Join
                        (
                            Select
                                    f.COM_DTL_CD                    INVN_TP_CD
                                    ,f.COM_DTL_CD_NM                INVN_TP_CD_NM
                            From    TB_CO_COM_CD_DTL f
                            Where   f.LANG_CD = #{LANG_CD}            /*KO*/
                            And     f.COM_CLSF_CD = 'INVN_TP_CD'
                        ) f
                            On (f.INVN_TP_CD = a.INVN_TP_CD)
                        Left Join
                        (
                            Select
                                    g.COM_DTL_CD                    INVN_STATS_CD
                                    ,g.COM_DTL_CD_NM                INVN_STATS_CD_NM
                            From    TB_CO_COM_CD_DTL g
                            Where   g.LANG_CD = #{LANG_CD}            /*KO*/
                            And     g.COM_CLSF_CD = 'INVN_STATS_CD'
                        ) g
                            On (g.INVN_STATS_CD = a.INVN_STATS_CD)
                        Left Join
                        TB_CO_MBR_OPRTR_ORG_INFO h
                            On (h.CO_CD = a.CO_CD
                            And h.ORG_CD = a.PURG_TEAM_CD)
                        Left Join
                        TB_CO_MBR_OPRTR_INFO i
                            On (i.CO_CD = a.CO_CD
                            And i.OPRTR_ID = a.PURG_CHRPSN_ID)
                        <if test=" PRD_ID > 0 ">
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   t1
                            ON  t1.SES_ID = #{SES_ID}
                            AND t1.INQ_COND_DTLS = #{INQ_COND_DTLS}
                            AND t1.COL_ITM = 'PRD_ID'
                            AND LPAD(t1.COND_DATA_VAL,18,'0') = b.PRD_ID
                        </if>
                        CROSS JOIN
                        (
                        SELECT  COM_USR_DEFN_NM_1  AS SAFT_INVN_RT
                        FROM    TB_CO_COM_CD_DTL  T1
                        WHERE   T1.LANG_CD = #{LANG_CD}
                        AND   T1.COM_CLSF_CD = 'SAFT_INVN_RT'
                        AND   T1.COM_DTL_CD = '10'
                        )       t2
                        <choose>
                            <when test=" REPR_PRD_SPR_CD != null and !REPR_PRD_SPR_CD.equals('') ">
                            JOIN
                            </when>
                            <otherwise>
                            LEFT JOIN
                            </otherwise>
                        </choose>
                        TB_PR_REPR_PRD_MNG_DTL  t3
                        ON  t3.CO_CD = a.CO_CD
                        AND t3.PRD_ID = a.PRD_ID
                        AND t3.SSP_PRD_YN = 'Y'
                        <if test="REPR_PRD_SPR_CD != null and !REPR_PRD_SPR_CD.equals('')">
                            <choose>
                                <when test='REPR_PRD_SPR_CD == "UNION"'>
                                    AND DECODE(t3.REPR_PRD_SPR_YN, 'N', '3', t3.REPR_PRD_SPR_RSN_CD) IN ('1', '2') --통합_전체 하드코딩
                                </when>
                                <otherwise>
                                    AND DECODE(t3.REPR_PRD_SPR_YN, 'N', '3', t3.REPR_PRD_SPR_RSN_CD) = #{REPR_PRD_SPR_CD}  --대표상품구분 3=피통합
                                </otherwise>
                            </choose>
                        </if>
                        <choose>
                            <when test=" PUB_ONLY_SPR_CD != null and !PUB_ONLY_SPR_CD.equals('') ">
                            JOIN
                            </when>
                            <otherwise>
                            LEFT JOIN
                            </otherwise>
                        </choose>
                        TB_PR_MRO_PRD_INFO t4
                        ON  t4.CO_CD = a.CO_CD
                        AND t4.PRD_ID = a.PRD_ID
                        AND t4.PUB_ONLY_SPR_CD LIKE #{PUB_ONLY_SPR_CD} || '%'
                        <choose>
                            <when test=" MD_OPRTR_ID != null and !MD_OPRTR_ID.equals('') ">
                            JOIN
                            </when>
                            <otherwise>
                            LEFT JOIN
                            </otherwise>
                        </choose>
                        (
                        SELECT  B.CO_CD,
                                B.PRD_CLCD,
                                A.OPRTR_ID      MD_OPRTR_ID
                        FROM    TB_CO_MBR_OPRTR_INFO A          /* 회원운영자정보 */
                                JOIN
                                TB_PR_PRD_CLSF_CHRPSN_INFO B    /* 상품분류담당자정보, MD담당자 */
                                ON  B.CO_CD = A.CO_CD
                                AND B.PRD_CLSF_CHRPSN_ID = A.OPRTR_ID
                        WHERE   B.PRD_CLSF_CHRPSN_SPR_CD = '10'
                        AND     B.PRD_CLSF_CHRPSN_TP_CD = '20'
                        AND     B.PRD_CLSF_CHRPSN_USEYN = 'Y'
                        AND     B.MNFR_NO = '*'
                        AND     A.OPRTR_ID LIKE #{MD_OPRTR_ID} || '%'
                        ) t5
                        ON  t5.CO_CD = b.CO_CD
                        AND t5.PRD_CLCD = b.PRD_CLCD

                    <include refid="inventoryListWhere"/>
                    
                    Order By    a.PRD_ID                /* 상품ID */
                               , c.MNFR_NO              /* 제조사번호 (제조원ID)*/
                               , a.CPRTCP_ID            /* 협력사ID */
                ) T1
                LEFT JOIN
                TB_CO_COM_CD_DTL t10
                ON  t10.LANG_CD = #{LANG_CD}
                AND t10.COM_CLSF_CD = 'REPR_PRD_SPR_CD'
                AND t10.COM_DTL_CD = T1.REPR_PRD_SPR_RSN_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL t11
                ON  t11.LANG_CD = #{LANG_CD}
                AND t11.COM_CLSF_CD = 'PUB_ONLY_SPR_CD'
                AND t11.COM_DTL_CD = T1.PUB_ONLY_SPR_CD
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO    t12
                ON  t12.CO_CD   = T1.CO_CD
                AND t12.OPRTR_ID = T1.MD_OPRTR_ID

        OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
    </select>

    <sql id="inventoryListWhere">
        WHERE   a.BSS_DT = #{BSS_DT}
        <if test="CO_CD != null and CO_CD != ''">
           And     a.CO_CD = #{CO_CD}
        </if>
        <if test="CPRTCP_ID != null and CPRTCP_ID != ''">
           And     a.CPRTCP_ID Like '%'||Upper(#{CPRTCP_ID})||'%'
        </if>
        <if test="INVN_TP_CD != null and INVN_TP_CD != ''">
           And     a.INVN_TP_CD = #{INVN_TP_CD}
        </if>
        <if test="INVN_STATS_CD != null and INVN_STATS_CD != ''">
           And     a.INVN_STATS_CD = #{INVN_STATS_CD}
        </if>
        <if test="PURG_TEAM_CD != null and PURG_TEAM_CD != ''">
           And     a.PURG_TEAM_CD = #{PURG_TEAM_CD}
        </if>
        <if test="PURG_CHRPSN_ID != null and PURG_CHRPSN_ID != ''">
           And     a.PURG_CHRPSN_ID = #{PURG_CHRPSN_ID}
        </if>
    </sql>

    <!-- 재고관리 마스터 상세 -->
    <select id="selectInventoryDetail" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.iv.ivInventory.selectInventoryDetail */
        Select
            a.BSS_DT                                                            /* 기준일자 */
            , a.CO_CD                                                           /* 회사코드 */
            , a.BZ_DOMN_CD                                                      /* 사업영역코드 */
            , LTRIM(a.PRD_ID, '0')                  As PRD_ID                   /* 상품ID */
            , b.PRD_NM                                                          /* 상품명 */
            , c.MRO_REPR_ATTR                                                   /* MRO대표속성(규격) */
            , c.MNFR_NO                                                         /* 제조사번호 (제조원ID)*/
            , d.MRO_MNFR_NM                                                     /* MRO제조사명 (제조원명)*/
            , Nvl(c.SELL_UNIT_CD,c.BASIS_UNIT_CD)   As SELL_UNIT_CD             /*판매단위코드(주문단위코드)*/
            , a.INVN_TP_CD                                                      /* 재고유형코드 */
            , f.INVN_TP_CD_NM                                                   /* 재고유형코드명 */
            , a.CPRTCP_ID                                                       /* 협력사ID */
            , e.CPRTCP_KOR_NM                                                   /* 협력사한글명 */
            , a.SAFT_INVN_QTY                                                   /* 안전재고수량 */
            , a.MAX_INVN_QTY                                                    /* 최대재고수량 */
            , a.GI_DUE_QTY                                                      /* 입고예정수량 */
            , a.APRV_PRGS_QTY                                                   /* 결재진행수량 */
            , a.PRD_INVN_QTY                                                    /* 상품재고수량 */
            , a.TRNS_INVN_QTY                                                   /* 운송재고수량 */
            , a.SO_PRGS_QTY                                                     /* SO진행수량 */
            , a.SSP_ODR_QTY                                                     /* SSP주문수량 (SSP진행중주문)*/
            , a.SSP_AVAIL_INVN_QTY                                              /* SSP가용재고수량 */
            , a.INVN_STATS_CD                                                   /* 재고상태코드(몰판매여부) */
            , g.INVN_STATS_CD_NM                                                /* 재고상태코드명(몰판매여부) */
            , a.PURG_TEAM_CD                                                    /* 구매팀코드 */
            , h.ORG_NM                              As PURG_TEAM_NM             /* 구매팀명 */
            , a.PURG_CHRPSN_ID                                                  /* 구매담당자ID */
            , i.OPRTR_NM                            As PURG_CHRPSN_NM           /* 구매담당자명 */
        From    TB_IV_PRD_INVN_DTLS a
            Join
            TB_PR_PRD_INFO b
                On (b.CO_CD = a.CO_CD
                And b.PRD_ID = a.PRD_ID)
            Left Join
            TB_PR_MRO_PRD_INFO c
                On (c.CO_CD = b.CO_CD
                And c.PRD_ID = b.PRD_ID)
            Left Join
            TB_PR_MNFR_INFO d
                On (d.CO_CD = c.CO_CD
                And d.MNFR_NO = c.MNFR_NO)
            Left Join
            TB_CP_CPRTCP_BASIS e
                On (e.CO_CD = a.CO_CD
                And e.CPRTCP_ID = a.CPRTCP_ID)
            Left Join
            (
                Select
                        f.COM_DTL_CD                    INVN_TP_CD
                        ,f.COM_DTL_CD_NM                INVN_TP_CD_NM
                From    TB_CO_COM_CD_DTL f
                Where   f.LANG_CD = #{LANG_CD}            /*KO*/
                And     f.COM_CLSF_CD = 'INVN_TP_CD'
            ) f
                On (f.INVN_TP_CD = a.INVN_TP_CD)
            Left Join
            (
                Select
                        g.COM_DTL_CD                    INVN_STATS_CD
                        ,g.COM_DTL_CD_NM                INVN_STATS_CD_NM
                From    TB_CO_COM_CD_DTL g
                Where   g.LANG_CD = #{LANG_CD}            /*KO*/
                And     g.COM_CLSF_CD = 'INVN_STATS_CD'
            ) g
                On (g.INVN_STATS_CD = a.INVN_STATS_CD)
            Left Join
            TB_CO_MBR_OPRTR_ORG_INFO h
                On (h.CO_CD = a.CO_CD
                And h.ORG_CD = a.PURG_TEAM_CD)
            Left Join
            TB_CO_MBR_OPRTR_INFO i
                On (i.CO_CD = a.CO_CD
                And i.OPRTR_ID = a.PURG_CHRPSN_ID)
        WHERE   a.PRD_ID = LPAD(#{PRD_ID},18,'0')
        AND     a.CO_CD = #{CO_CD}
        AND     a.BSS_DT = #{BSS_DT}
    </select>


    <!-- 재고관리 마스터 목록 엑셀 -->
    <select id="selectInventoryListExcel" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.iv.ivInventory.selectInventoryListExcel */
        Select
            a.BSS_DT                                                            /* 기준일자 */
            , a.CO_CD                                                           /* 회사코드 */
            , a.BZ_DOMN_CD                                                      /* 사업영역코드 */
            , LTRIM(a.PRD_ID, '0')                                              /* 상품ID */
            , b.PRD_NM                                                          /* 상품명 */
            , c.MRO_REPR_ATTR                                                   /* MRO대표속성(규격) */
            , c.MNFR_NO                                                         /* 제조사번호 (제조원ID)*/
            , d.MRO_MNFR_NM                                                     /* MRO제조사명 (제조원명)*/
            , Nvl(c.SELL_UNIT_CD,c.BASIS_UNIT_CD)   As SELL_UNIT_CD             /*판매단위코드(주문단위코드)*/
            , a.INVN_TP_CD                                                      /* 재고유형코드 */
            , f.INVN_TP_CD_NM                                                   /* 재고유형코드명 */
            , a.CPRTCP_ID                                                       /* 협력사ID */
            , e.CPRTCP_KOR_NM                                                   /* 협력사한글명 */
            , a.SAFT_INVN_QTY                                                   /* 안전재고수량 */
            , a.MAX_INVN_QTY                                                    /* 최대재고수량 */
            , a.GI_DUE_QTY                                                      /* 입고예정수량 */
            , a.APRV_PRGS_QTY                                                   /* 결재진행수량 */
            , a.PRD_INVN_QTY                                                    /* 상품재고수량 */
            , a.TRNS_INVN_QTY                                                   /* 운송재고수량 */
            , a.SO_PRGS_QTY                                                     /* SO진행수량 */
            , a.SSP_ODR_QTY                                                     /* SSP주문수량 (SSP진행중주문)*/
            , a.SSP_AVAIL_INVN_QTY                                              /* SSP가용재고수량 */
            , a.INVN_STATS_CD                                                   /* 재고상태코드(몰판매여부) */
            , g.INVN_STATS_CD_NM                                                /* 재고상태코드명(몰판매여부) */
            , a.PURG_TEAM_CD                                                    /* 구매팀코드 */
            , h.ORG_NM                              As PURG_TEAM_NM             /* 구매팀명 */
            , a.PURG_CHRPSN_ID                                                  /* 구매담당자ID */
            , i.OPRTR_NM                            As PURG_CHRPSN_NM           /* 구매담당자명 */
        From    TB_IV_PRD_INVN_DTLS a
            Join
            TB_PR_PRD_INFO b
                On (b.CO_CD = a.CO_CD
                And b.PRD_ID = a.PRD_ID)
            Left Join
            TB_PR_MRO_PRD_INFO c
                On (c.CO_CD = b.CO_CD
                And c.PRD_ID = b.PRD_ID)
            Left Join
            TB_PR_MNFR_INFO d
                On (d.CO_CD = c.CO_CD
                And d.MNFR_NO = c.MNFR_NO)
            Left Join
            TB_CP_CPRTCP_BASIS e
                On (e.CO_CD = a.CO_CD
                And e.CPRTCP_ID = a.CPRTCP_ID)
            Left Join
            (
                Select
                        f.COM_DTL_CD                    INVN_TP_CD
                        ,f.COM_DTL_CD_NM                INVN_TP_CD_NM
                From    TB_CO_COM_CD_DTL f
                Where   f.LANG_CD = #{LANG_CD}            /*KO*/
                And     f.COM_CLSF_CD = 'INVN_TP_CD'
            ) f
                On (f.INVN_TP_CD = a.INVN_TP_CD)
            Left Join
            (
                Select
                        g.COM_DTL_CD                    INVN_STATS_CD
                        ,g.COM_DTL_CD_NM                INVN_STATS_CD_NM
                From    TB_CO_COM_CD_DTL g
                Where   g.LANG_CD = #{LANG_CD}            /*KO*/
                And     g.COM_CLSF_CD = 'INVN_STATS_CD'
            ) g
                On (g.INVN_STATS_CD = a.INVN_STATS_CD)
            Left Join
            TB_CO_MBR_OPRTR_ORG_INFO h
                On (h.CO_CD = a.CO_CD
                And h.ORG_CD = a.PURG_TEAM_CD)
            Left Join
            TB_CO_MBR_OPRTR_INFO i
                On (i.CO_CD = a.CO_CD
                And i.OPRTR_ID = a.PURG_CHRPSN_ID)
            <if test=" PRD_ID > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS   t1
                ON  t1.SES_ID = #{SES_ID}
                AND t1.INQ_COND_DTLS = #{INQ_COND_DTLS}
                AND t1.COL_ITM = 'PRD_ID'
                AND t1.COND_DATA_VAL = b.PRD_ID
            </if>

        <include refid="inventoryListWhere"/>

        Order By
          a.PRD_ID                                                          /* 상품ID */
        , c.MNFR_NO                                                         /* 제조사번호 (제조원ID)*/
        , a.CPRTCP_ID                                                       /* 협력사ID */

    </select>

</mapper>