<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssp.bo.od.orderPopup">

    <!-- 주문번호 -->
    <!-- ******************************************************************************
        * SELECT : 주문번호 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-04
        ****************************************************************************** -->
    <select id="selectOdrNumberList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectOdrNumberList */
        SELECT
               A.CO_CD
             , A.BZPLC_ID
             , A.ODR_NO
             , B.BZPLC_NM
        FROM TB_OD_ODR_MST A
             JOIN TB_CC_BZPLC_BASIS B
             ON A.CO_CD = B.CO_CD
                AND A.BZPLC_ID = B.BZPLC_ID
        <where>
            <if test="BZPLC_ID != null and !BZPLC_ID.equals('') ">
                AND A.BZPLC_ID LIKE '%' || UPPER(#{BZPLC_ID}) || '%'
            </if>
            <if test="ODR_NO != null and !ODR_NO.equals('') ">
                AND A.ODR_NO LIKE '%' || UPPER(#{ODR_NO}) || '%'
            </if>
            <if test="BZPLC_NM != null and !BZPLC_NM.equals('') ">
                AND B.BZPLC_NM LIKE '%' || UPPER(#{BZPLC_NM}) || '%'
            </if>
        </where>
            ORDER BY A.CO_CD        /* 회사코드 */
                   , A.BZPLC_ID     /* 사업장ID */
                   , A.ODR_NO       /* 주문번호 */
                   , B.BZPLC_NM     /* 사업장명 */
            OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문마스터 Count 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-07
        ****************************************************************************** -->
    <select id="selectOdrNumberCount" parameterType="HashMap" resultType="integer">
        /* com.ssp.bo.od.orderPopup.selectOdrNumberCount */
        SELECT COUNT(1)
        FROM TB_OD_ODR_MST A
             JOIN TB_CC_BZPLC_BASIS B
             ON A.CO_CD = B.CO_CD
                AND A.BZPLC_ID = B.BZPLC_ID
        <where>
            <if test="BZPLC_ID != null and !BZPLC_ID.equals('') ">
                AND A.BZPLC_ID LIKE '%' || UPPER(#{BZPLC_ID}) || '%'
            </if>
            <if test="ODR_NO != null and !ODR_NO.equals('') ">
                AND A.ODR_NO LIKE '%' || UPPER(#{ODR_NO}) || '%'
            </if>
            <if test="BZPLC_NM != null and !BZPLC_NM.equals('') ">
                AND B.BZPLC_NM LIKE '%' || UPPER(#{BZPLC_NM}) || '%'
            </if>
        </where>
    </select>

    <!-- 발주번호 -->
    <!-- ******************************************************************************
        * SELECT : 발주번호 Count 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-07
        ****************************************************************************** -->
    <select id="selectOrdNumberCount" parameterType="HashMap" resultType="integer">
        /* com.ssp.bo.od.orderPopup.selectOrdNumberCount */
        SELECT COUNT(1)
        FROM TB_DL_ORD_ITM_DTL A  /* 발주품목상세 */
             JOIN
             TB_OD_ODR_DTL B /* 주문상세일회성코드 */
                 ON (B.CO_CD = A.CO_CD
                     AND B.BZPLC_ID = A.BZPLC_ID
                     AND B.ODR_NO = A.ODR_NO
                     AND B.ODR_ITM_NO = A.ODR_ITM_NO)
             JOIN
             TB_PR_PRD_INFO C      /* 상품정보 */
                 ON (C.CO_CD = B.CO_CD
                     AND C.PRD_ID = B.PRD_ID)
        <where>
            <if test="ORD_NO != null and !ORD_NO.equals('') ">
                AND A.ORD_NO LIKE '%' || UPPER(#{ORD_NO}) || '%'
            </if>
            <if test="PRD_NM != null and !PRD_NM.equals('') ">
                AND C.PRD_NM LIKE '%' || UPPER(#{PRD_NM}) || '%'
            </if>
            <if test="ODR_NO != null and !ODR_NO.equals('') ">
                AND A.ODR_NO LIKE '%' || UPPER(#{ODR_NO}) || '%'
            </if>
            <if test="BZPLC_ID != null and !BZPLC_ID.equals('') ">
                AND A.BZPLC_ID LIKE '%' || UPPER(#{BZPLC_ID}) || '%'
            </if>
            <if test="OPR_UNIT_ID != null and !OPR_UNIT_ID.equals('') ">
                AND A.OPR_UNIT_ID LIKE '%' || UPPER(#{OPR_UNIT_ID}) || '%'
            </if>
        </where>
    </select>

    <!-- ******************************************************************************
        * SELECT : 발주번호 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-04
        ****************************************************************************** -->
    <select id="selectOrdNumberList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectOrdNumberList */
        SELECT
                A.CO_CD             /* 회사코드 */
              , A.ORD_NO          /* 발주번호 */
              , C.PRD_NM          /* 상품명 */
              , A.ODR_NO          /* 주문번호 */
              , A.ODR_ITM_NO      /* 주문항목번호 */
              , A.BZPLC_ID        /* 사업장ID */
              , A.OPR_UNIT_ID     /* 운영단위ID */
        FROM    TB_DL_ORD_ITM_DTL A  /* 발주품목상세 */
                JOIN
                TB_OD_ODR_DTL B /* 주문상세일회성코드 */
                    ON (B.CO_CD = A.CO_CD
                    AND B.BZPLC_ID = A.BZPLC_ID
                    AND B.ODR_NO = A.ODR_NO
                    AND B.ODR_ITM_NO = A.ODR_ITM_NO)
                JOIN
                TB_PR_PRD_INFO C    /* 상품정보 */
                    ON (C.CO_CD = B.CO_CD
                    AND C.PRD_ID = B.PRD_ID)
        <where>
            <if test="ORD_NO != null and !ORD_NO.equals('') ">
                AND A.ORD_NO LIKE '%' || UPPER(#{ORD_NO}) || '%'
            </if>
            <if test="PRD_NM != null and !PRD_NM.equals('') ">
                AND C.PRD_NM LIKE '%' || UPPER(#{PRD_NM}) || '%'
            </if>
            <if test="ODR_NO != null and !ODR_NO.equals('') ">
                AND A.ODR_NO LIKE '%' || UPPER(#{ODR_NO}) || '%'
            </if>
            <if test="BZPLC_ID != null and !BZPLC_ID.equals('') ">
                AND A.BZPLC_ID LIKE '%' || UPPER(#{BZPLC_ID}) || '%'
            </if>
            <if test="OPR_UNIT_ID != null and !OPR_UNIT_ID.equals('') ">
                AND A.OPR_UNIT_ID LIKE '%' || UPPER(#{OPR_UNIT_ID}) || '%'
            </if>
        </where>
            ORDER BY A.CO_CD         /* 회사코드 */
                   , A.BZPLC_ID      /* 사업장ID */
                   , A.OPR_UNIT_ID   /* 운영단위ID */
                   , A.ORD_NO        /* 발주번호 */
            OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
    </select>


    <!-- 주문자 -->
    <!-- ******************************************************************************
        * SELECT : 주문자 Count 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-07
        ****************************************************************************** -->
    <select id="selectOdrPsnCount" parameterType="HashMap" resultType="integer">
        /* com.ssp.bo.od.orderPopup.selectOdrPsnCount */
        SELECT COUNT(1)
        FROM    TB_CC_MBR_BASIS A
                JOIN
                TB_CC_DEPT_BASIS B
                    ON (B.CO_CD = A.CO_CD
                    AND B.DEPT_ID = A.DEPT_ID
                    AND B.BZPLC_ID = A.BZPLC_ID)
                LEFT JOIN
                TB_CC_OPR_UNIT_BASIS C
                    ON (C.CO_CD = B.CO_CD
                    AND C.BZPLC_ID = B.BZPLC_ID
                    AND C.OPR_UNIT_ID = B.OPR_UNIT_ID)
        WHERE   1 = 1
        AND     UPPER(A.MBR_NM) LIKE '%'|| UPPER(#{MBR_NM})||'%'
        <if test="MBR_ID != null and !MBR_ID.equals('') ">
            AND A.MBR_ID LIKE '%'|| UPPER(#{MBR_ID})||'%'
        </if>
        <if test="OPR_UNIT_ID != null and !OPR_UNIT_ID.equals('') ">
            AND C.OPR_UNIT_ID LIKE '%'|| UPPER(#{OPR_UNIT_ID}) ||'%'
        </if>
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문자 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-04
        ****************************************************************************** -->
    <select id="selectOdrPsnList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectOdrPsnList */
        SELECT
                A.CO_CD             /* 회사코드 */
              , A.MBR_ID            /* 회원ID */
              , C.OPR_UNIT_ID       /* 운영단위ID */
              , C.OPR_UNIT_NM       /* 운영단위명 */
              , A.BZPLC_ID          /* 사업장ID */
              , A.DEPT_ID           /* 부서ID */
              , A.MBR_NM            /* 회원명 */
              , A.EMAIL_ADDR        /* 이메일주소 */
              , A.MBR_USE_CD        /* 회원사용코드 */
              , A.DRMC_YN           /* 휴면화여부 */
        FROM    TB_CC_MBR_BASIS A
                JOIN
                TB_CC_DEPT_BASIS B
                    ON (B.CO_CD = A.CO_CD
                    AND B.DEPT_ID = A.DEPT_ID
                    AND B.BZPLC_ID = A.BZPLC_ID)
                LEFT JOIN
                TB_CC_OPR_UNIT_BASIS C
                    ON (C.CO_CD = B.CO_CD
                    AND C.BZPLC_ID = B.BZPLC_ID
                    AND C.OPR_UNIT_ID = B.OPR_UNIT_ID)
        WHERE   1 = 1
        AND     UPPER(A.MBR_NM) LIKE '%'|| UPPER(#{MBR_NM})||'%'
        <if test="MBR_ID != null and !MBR_ID.equals('') ">
            AND Upper(A.MBR_ID) LIKE '%'|| UPPER(#{MBR_ID})||'%'
        </if>
        <if test="OPR_UNIT_ID != null and !OPR_UNIT_ID.equals('') ">
            AND Upper(C.OPR_UNIT_ID) LIKE '%'|| UPPER(#{OPR_UNIT_ID}) ||'%'
        </if>
        ORDER BY C.OPR_UNIT_ID      /* 운영단위ID */
               , A.MBR_NM           /* 회원명 */
        OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
    </select>


    <!-- 플랜트 -->
    <!-- ******************************************************************************
        * SELECT : 플랜트 Count 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-07
        ****************************************************************************** -->
    <select id="selectOdrPlntCount" parameterType="HashMap" resultType="integer">
        /* com.ssp.bo.od.orderPopup.selectOdrPlntCount */
        SELECT COUNT(1)
        FROM  TB_DL_PLNT_BASIS A
        <where>
            <if test="PLNT_ID != null and !PLNT_ID.equals('') ">
                AND Upper(A.PLNT_ID) LIKE '%'|| UPPER(#{PLNT_ID})||'%'
            </if>
            <if test="PLNT_NM != null and !PLNT_NM.equals('') ">
                AND Upper(A.PLNT_NM) LIKE '%'|| Upper(#{PLNT_NM}) ||'%'
            </if>
        </where>
    </select>

    <!-- ******************************************************************************
        * SELECT : 플랜트 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-04
        ****************************************************************************** -->
    <select id="selectOdrPlntList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectOdrPlntList */
        SELECT
                A.CO_CD             /* 회사코드 */
              , A.PLNT_ID           /* 플랜트 코드 */
              , A.BZ_DOMN_CD        /* 사업영역 코드 */
              , A.PLNT_NM           /* 플랜트명 */
              , A.CUST_HUB_YN       /* 고객허브여부 */
              , A.PLNT_TP_CD        /* 플랜트 유형코드 */
        FROM  TB_DL_PLNT_BASIS A
        <where>
            <if test="PLNT_ID != null and !PLNT_ID.equals('') ">
                AND Upper(A.PLNT_ID) LIKE '%'|| UPPER(#{PLNT_ID})||'%'
            </if>
            <if test="PLNT_NM != null and !PLNT_NM.equals('') ">
                AND Upper(A.PLNT_NM) LIKE '%'|| Upper(#{PLNT_NM}) ||'%'
            </if>
        </where>
            ORDER BY A.PLNT_ID      /* 플랜트 코드 */
                   , A.PLNT_NM      /* 플랜트명 */
            OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
    </select>

    <!-- ******************************************************************************
        * SELECT : 변경항목그룹 Count 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-07
        ****************************************************************************** -->
    <select id="selectChgItmGrpCount" parameterType="HashMap" resultType="integer">
        /* com.ssp.bo.od.orderPopup.selectChgItmGrpCount */
        SELECT COUNT(*)
        FROM  TB_DL_CHG_CTL_ITM_GRP_CD A
        WHERE A.USE_YN = 'Y'
        AND  Upper(A.CHG_ITM_GRP_CD) LIKE '%' || UPPER(#{CHG_ITM_GRP_CD}) || '%'
        AND  Upper(A.CHG_ITM_GRP_NM) LIKE '%' || Upper(#{CHG_ITM_GRP_NM}) || '%'
    </select>

    <!-- ******************************************************************************
        * SELECT : 변경항목그룹 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-04
        ****************************************************************************** -->
    <select id="selectChgItmGrpList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectChgItmGrpList */
        SELECT
                0 CHK
              , A.CHG_ITM_GRP_CD
              , A.CHG_ITM_GRP_NM
        FROM  TB_DL_CHG_CTL_ITM_GRP_CD A
        WHERE 1=1
        AND  A.USE_YN = 'Y'
        AND  Upper(A.CHG_ITM_GRP_CD) LIKE '%' || Upper(#{CHG_ITM_GRP_CD}) || '%'
        AND  Upper(A.CHG_ITM_GRP_NM) LIKE '%' || Upper(#{CHG_ITM_GRP_NM}) || '%'
        ORDER BY A.CHG_ITM_GRP_CD
        OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
    </select>

    <!-- ******************************************************************************
        * SELECT : 공통코드 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-04
        ****************************************************************************** -->
    <select id="selectCommonCodeList" parameterType="list" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectCommonCodeList */
        SELECT
                A.COM_CLSF_CD           /* 공통분류코드 */
              , A.COM_DTL_CD            /* 공통상세코드 */
              , A.COM_DTL_CD_NM         /* 공통상세코드명 */
              , A.COM_USR_DEFN_NM_1     /* 공통사용자정의명1 */
              , A.COM_USR_DEFN_NM_2     /* 공통사용자정의명2 */
              , A.COM_USR_DEFN_NM_3     /* 공통사용자정의명3 */
              , A.COM_USR_DEFN_NM_4     /* 공통사용자정의명4 */
              , A.COM_USR_DEFN_NM_5     /* 공통사용자정의명5 */
              , A.SRT_SO                /* 정렬순서 */
        FROM  TB_CO_COM_CD_DTL A
        WHERE A.LANG_CD = 'KO'
          AND A.USE_YN = 'Y'
          AND A.COM_CLSF_CD IN
        <foreach collection="list" item="arr" open="(" close=")" separator=",">
            #{arr}
        </foreach>
        ORDER BY A.COM_CLSF_CD      /* 공통분류코드 */
               , A.COM_DTL_CD       /* 공통상세코드 */
    </select>

    <!-- ******************************************************************************
        * SELECT : 공통코드 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-04
        ****************************************************************************** -->
    <select id="selectCommonCodeMulti" parameterType="String" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectCommonCodeMulti */
       SELECT
                A.COM_CLSF_CD                                                                   /* 공통분류코드 */
              , CASE WHEN B.LVL = 1 THEN A.COM_DTL_CD        ELSE '' END     COM_DTL_CD         /* 공통상세코드 */
              , CASE WHEN B.LVL = 1 THEN A.COM_DTL_CD_NM     ELSE '전체' END  COM_DTL_CD_NM      /* 공통상세코드명 */
              , CASE WHEN B.LVL = 1 THEN A.COM_USR_DEFN_NM_1 ELSE '' END     COM_USR_DEFN_NM_1  /* 공통사용자정의명1 */
              , CASE WHEN B.LVL = 1 THEN A.COM_USR_DEFN_NM_2 ELSE '' END     COM_USR_DEFN_NM_2  /* 공통사용자정의명2 */
              , CASE WHEN B.LVL = 1 THEN A.COM_USR_DEFN_NM_3 ELSE '' END     COM_USR_DEFN_NM_3  /* 공통사용자정의명3 */
              , CASE WHEN B.LVL = 1 THEN A.COM_USR_DEFN_NM_4 ELSE '' END     COM_USR_DEFN_NM_4  /* 공통사용자정의명4 */
              , CASE WHEN B.LVL = 1 THEN A.COM_USR_DEFN_NM_5 ELSE '' END     COM_USR_DEFN_NM_5  /* 공통사용자정의명5 */
              , CASE WHEN B.LVL = 1 THEN A.SRT_SO ELSE 0 END                 SRT_SO             /* 정렬순서 */
        FROM  (
              SELECT    A.COM_CLSF_CD
                      , A.COM_DTL_CD
                      , A.COM_DTL_CD_NM
                      , A.COM_USR_DEFN_NM_1
                      , A.COM_USR_DEFN_NM_2
                      , A.COM_USR_DEFN_NM_3
                      , A.COM_USR_DEFN_NM_4
                      , A.COM_USR_DEFN_NM_5
                      , A.SRT_SO
                      , ROW_NUMBER() OVER(PARTITION BY A.COM_CLSF_CD ORDER BY A.SRT_SO)  RN
                FROM    TB_CO_COM_CD_DTL A
                 WHERE  LANG_CD = 'KO'
                   AND  USE_YN = 'Y'
              )             A
              JOIN
              (
              SELECT  REGEXP_SUBSTR(T1.BB,'[^-]+',1,1)            CD,
                        NVL(REGEXP_SUBSTR(T1.BB,'[^-]+',1,2),'N')    YN,
                        T2.LVL
             FROM    (
                    SELECT   REGEXP_SUBSTR(T1.AA,'[^,]+',1,T2.LVL) BB
                            ,T2.LVL
                    FROM    (SELECT  #{arr} AA FROM DUAL
                            )       T1
                            CROSS JOIN
                            (SELECT LEVEL LVL FROM DUAL CONNECT BY 20 >= LEVEL ) T2
                    )       T1
                    CROSS JOIN
                    (SELECT LEVEL LVL FROM DUAL CONNECT BY 2 >= LEVEL ) T2
             WHERE   T1.BB IS NOT NULL
              )     B
              ON   A.COM_CLSF_CD = B.CD
              AND  A.COM_DTL_CD = (CASE WHEN B.LVL = 1 THEN A.COM_DTL_CD
                                         WHEN B.LVL = 2 AND B.YN = 'Y' AND A.RN = 1 THEN A.COM_DTL_CD END)
        ORDER BY A.COM_CLSF_CD
               , CASE WHEN B.LVL = 1 THEN A.SRT_SO ELSE 0 END
    </select>

    <!-- ******************************************************************************
        * SELECT : 회원배송지 조회 * 작성자 : smpark * 작성 일자 : 2022-03-22
        ****************************************************************************** -->
    <select id="selectDlvplcList" parameterType="list" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectDlvplcList */
        SELECT  T2.CO_CD, /* 회사코드 */
				T2.MBR_ID, /* 회원ID */
				T2.DLVPLC_ID, /* 배송지ID */
				T2.RCVR_NM, /* 수령인명 */
				T2.ZPCD, /* 우편번호 */
				T2.REPR_ADDR, /* 대표주소 */
				T2.DTL_ADDR, /* 상세주소 */
				T2.HP_NO, /* 휴대폰번호 */
				T2.TEL_NO, /* 전화번호 */
				T2.BASIS_DLVPLC_YN, /* 기본배송지여부 */
		        CASE WHEN T2.DLVPLC_ID = #{DLVPLC_ID} THEN 1 ELSE 0 END IS_SELECTED
		FROM   TB_CC_MBR_DLVPLC_BASIS T2 /*회원배송지기본*/
		WHERE  T2.CO_CD = #{CO_CD}
		  AND  T2.MBR_ID = #{MBR_ID}
		  AND  T2.USE_YN = 'Y'
		ORDER BY CASE WHEN T2.DLVPLC_ID = #{DLVPLC_ID} THEN 1 ELSE 0 END DESC, T2.DLVPLC_ID

    </select>

    <!-- ******************************************************************************
        * SELECT : 명함정보 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-29
        ****************************************************************************** -->
    <select id="selectOdrBzcrdPrdInfo" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectOdrBzcrdPrdInfo */
        SELECT  T1.CO_CD,           /* 회사코드 */
                T1.BZPLC_ID,        /* 사업장ID */
                T1.ODR_NO,          /* 주문번호 */
                T1.ODR_ITM_NO,      /* 주문항목번호 */
                T1.CO_NM,           /* 회사명 */
                T1.ENG_CO_NM,       /* 영문회사명 */
                T1.DEPT_NM,         /* 부서명 */
                T1.ENG_DEPT_NM,     /* 영문부서명 */
                T1.MBR_NM,          /* 회원명 */
                T1.ENG_MBR_NM,      /* 영문회원명 */
                T1.JBPOS_NM,        /* 직급명 */
                T1.ENG_JBPOS_NM,    /* 영문직급명 */
                T1.EMAIL_ADDR,      /* 이메일주소 */
                T1.FAX_NO,          /* 팩스번호 */
                T1.TEL_NO,          /* 전화번호 */
                T1.HP_NO,           /* 휴대폰번호 */
                T1.ZPCD,            /* 우편번호 */
                T1.DTL_ADDR,        /* 상세주소 */
                T1.REPR_ADDR,       /* 대표주소 */
                T1.ENG_DTL_ADDR,    /* 영문상세주소 */
                T1.ENG_REPR_ADDR,   /* 영문대표주소 */
                T1.DIV_NM,          /* 사업부명 */
                T1.ENG_DIV_NM,      /* 영문사업부명 */
                T1.DOC_REG_ID,      /* 문서등록ID */
                T1.RMKS_CTS         /* 비고내용 */
        FROM   TB_OD_ODR_BZCRD_PRD_INFO T1  /* 주문명함상품정보 */
        WHERE  T1.CO_CD = #{CO_CD}
          AND  T1.BZPLC_ID = #{BZPLC_ID}
          AND  T1.ODR_NO = #{ODR_NO}
          AND  T1.ODR_ITM_NO = #{ODR_ITM_NO}
    </select>

    <!-- ******************************************************************************
        * SELECT : 비용이체부서 COUNT * 작성자 : neonlee * 작성 일자 : 2022-03-29
        ****************************************************************************** -->
    <select id="selectCostTrnsfDeptCount" parameterType="HashMap" resultType="integer">
        /* com.ssp.bo.od.orderPopup.selectCostTrnsfDeptCount */
        WITH DEPT AS(
        SELECT
                A.CO_CD
                , A.MBR_ID
                , A.BZPLC_ID MBR_BZPLC_ID
                , A.MBR_NM
                , B.DEPT_ID                 /* 부서ID */
                , B.DEPT_NM                 /* 부서명 */
                , B.HRNK_DEPT_ID            /*상위부서ID */
                , B.DEPT_SRT_SEQ            /* 부서정렬순번 */
                , B.CCO_DEPT_CD             /* 고객사부서코드 */
                , B.ZPCD                    /* 우편번호 */
                , B.REPR_ADDR               /* 대표주소 */
                , B.DTL_ADDR                /* 상세주소 */
                , B.USE_YN                  /* 사용여부 */
                , B.BZPLC_ID DEPT_BZPLC_ID  /* 사업장ID */
                , B.OPR_UNIT_ID             /* 운영단위ID */
                , D.OPR_UNIT_NM
        FROM    TB_CC_MBR_BASIS A
                JOIN
                TB_CC_DEPT_BASIS B
                    ON (B.CO_CD = A.CO_CD
                    AND B.BZPLC_ID = A.BZPLC_ID)
                JOIN
                TB_CC_DEPT_CTL_AUTH_INFO C
                    ON (C.CO_CD = B.CO_CD
                    AND C.DEPT_ID = B.DEPT_ID)
                JOIN
                TB_CC_OPR_UNIT_BASIS D
                    ON (D.CO_CD = B.CO_CD
                    And D.BZPLC_ID = B.BZPLC_ID
                    And D.OPR_UNIT_ID = B.OPR_UNIT_ID)
        WHERE   A.CO_CD = #{CO_CD}
        AND     A.MBR_ID = #{MBR_ID}
        AND     C.BGT_TRNSF_AGD_YN = 'Y'
            <if test="OPR_UNIT_ID != null and !OPR_UNIT_ID.equals('') ">
                AND Upper(D.OPR_UNIT_ID) LIKE '%'|| Upper(#{OPR_UNIT_ID}) ||'%'
            </if>
            <if test="OPR_UNIT_NM != null and !OPR_UNIT_NM.equals('') ">
                AND Upper(D.OPR_UNIT_NM) LIKE '%'|| Upper(#{OPR_UNIT_NM}) ||'%'
            </if>
        )
        SELECT
            COUNT(*)
        FROM (
        SELECT
                A.CO_CD             /* */
                , A.MBR_ID          /* */
                , A.MBR_BZPLC_ID    /* */
                , A.MBR_NM
                , A.DEPT_ID         /* 부서ID */
                , A.DEPT_NM         /* 부서명 */
                , A.HRNK_DEPT_ID    /*상위부서ID */
                , A.DEPT_SRT_SEQ    /* 부서정렬순번 */
                , A.CCO_DEPT_CD     /* 고객사부서코드 */
                , A.ZPCD            /* 우편번호 */
                , A.REPR_ADDR       /* 대표주소 */
                , A.DTL_ADDR        /* 상세주소 */
                , A.USE_YN          /* 사용여부 */
                , A.DEPT_BZPLC_ID   /* 사업장ID */
                , A.OPR_UNIT_ID     /*운영단위ID */
                , A.OPR_UNIT_NM
                , B.BGT_OVER_AGD_YN /* 예산초과허용여부 */
        FROM DEPT A
            LEFT JOIN
            VW_CC_OPR_UNIT_CTL_AUTH_INFO B
                ON (B.CO_CD = A.CO_CD
                    AND B.BZPLC_ID = A.DEPT_BZPLC_ID
                    AND B.OPR_UNIT_ID = A.OPR_UNIT_ID)
        WhERE 1=1
            <if test="DEPT_ID != null and !DEPT_ID.equals('') ">
                AND Upper(A.DEPT_ID) LIKE '%'|| Upper(#{DEPT_ID}) ||'%'
            </if>
            <if test="DEPT_NM != null and !DEPT_NM.equals('') ">
                AND Upper(A.DEPT_NM) LIKE '%'|| Upper(#{DEPT_NM}) ||'%'
            </if>
        CONNECT BY
        PRIOR A.DEPT_ID = A.HRNK_DEPT_ID
        START WITH A.HRNK_DEPT_ID IS NULL
        )
    </select>

    <!-- ******************************************************************************
        * SELECT : 비용이체부서 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-29
        ****************************************************************************** -->
    <select id="selectCostTrnsfDeptList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectCostTrnsfDeptList */
        WITH DEPT AS(
        SELECT
                A.CO_CD
                , A.MBR_ID
                , A.BZPLC_ID MBR_BZPLC_ID
                , A.MBR_NM
                , B.DEPT_ID                 /* 부서ID */
                , B.DEPT_NM                 /* 부서명 */
                , B.HRNK_DEPT_ID            /*상위부서ID */
                , B.DEPT_SRT_SEQ            /* 부서정렬순번 */
                , B.CCO_DEPT_CD             /* 고객사부서코드 */
                , B.ZPCD                    /* 우편번호 */
                , B.REPR_ADDR               /* 대표주소 */
                , B.DTL_ADDR                /* 상세주소 */
                , B.USE_YN                  /* 사용여부 */
                , B.BZPLC_ID DEPT_BZPLC_ID  /* 사업장ID */
                , B.OPR_UNIT_ID             /* 운영단위ID */
                , D.OPR_UNIT_NM
        FROM    TB_CC_MBR_BASIS A
                JOIN
                TB_CC_DEPT_BASIS B
                    ON (B.CO_CD = A.CO_CD
                    AND B.BZPLC_ID = A.BZPLC_ID)
                JOIN
                TB_CC_DEPT_CTL_AUTH_INFO C
                    ON (C.CO_CD = B.CO_CD
                    AND C.DEPT_ID = B.DEPT_ID)
                JOIN
                TB_CC_OPR_UNIT_BASIS D
                    ON (D.CO_CD = B.CO_CD
                    And D.BZPLC_ID = B.BZPLC_ID
                    And D.OPR_UNIT_ID = B.OPR_UNIT_ID)
        WHERE   A.CO_CD = #{CO_CD}
        AND     A.MBR_ID = #{MBR_ID}
        AND     C.BGT_TRNSF_AGD_YN = 'Y'
            <if test="OPR_UNIT_ID != null and !OPR_UNIT_ID.equals('') ">
                AND Upper(D.OPR_UNIT_ID) LIKE '%'|| Upper(#{OPR_UNIT_ID}) ||'%'
            </if>
            <if test="OPR_UNIT_NM != null and !OPR_UNIT_NM.equals('') ">
                AND Upper(D.OPR_UNIT_NM) LIKE '%'|| Upper(#{OPR_UNIT_NM}) ||'%'
            </if>
        )
        SELECT
        *
        FROM (
        SELECT
                A.CO_CD             /* */
                , A.MBR_ID          /* */
                , A.MBR_BZPLC_ID    /* */
                , A.MBR_NM
                , A.DEPT_ID         /* 부서ID */
                , A.DEPT_NM         /* 부서명 */
                , A.HRNK_DEPT_ID    /*상위부서ID */
                , A.DEPT_SRT_SEQ    /* 부서정렬순번 */
                , A.CCO_DEPT_CD     /* 고객사부서코드 */
                , A.ZPCD            /* 우편번호 */
                , A.REPR_ADDR       /* 대표주소 */
                , A.DTL_ADDR        /* 상세주소 */
                , A.USE_YN          /* 사용여부 */
                , A.DEPT_BZPLC_ID   /* 사업장ID */
                , A.OPR_UNIT_ID     /*운영단위ID */
                , A.OPR_UNIT_NM
                , B.BGT_OVER_AGD_YN /* 예산초과허용여부 */
        FROM DEPT A
            LEFT JOIN
            VW_CC_OPR_UNIT_CTL_AUTH_INFO B
                ON (B.CO_CD = A.CO_CD
                    AND B.BZPLC_ID = A.DEPT_BZPLC_ID
                    AND B.OPR_UNIT_ID = A.OPR_UNIT_ID)
        WhERE 1=1
            <if test="DEPT_ID != null and !DEPT_ID.equals('') ">
                AND Upper(A.DEPT_ID) LIKE '%'|| Upper(#{DEPT_ID}) ||'%'
            </if>
            <if test="DEPT_NM != null and !DEPT_NM.equals('') ">
                AND Upper(A.DEPT_NM) LIKE '%'|| Upper(#{DEPT_NM}) ||'%'
            </if>
        CONNECT BY
        PRIOR A.DEPT_ID = A.HRNK_DEPT_ID
        START WITH A.HRNK_DEPT_ID IS NULL
        ORDER SIBLINGS BY A.DEPT_SRT_SEQ
        OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
        )
    </select>

    <!-- ******************************************************************************
        * SELECT : 비용이체부서계정 COUNT 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-29
        ****************************************************************************** -->
    <select id="selectCostTrnsfDeptAcctCount" parameterType="HashMap" resultType="integer">
        /* com.ssp.bo.od.orderPopup.selectCostTrnsfDeptAcctCount */
        WITH BASE_MEMBER AS
        ( SELECT
                /* +materialize*/
                A.CO_CD
                ,A.MBR_ID
                ,B.BZPLC_ID
                ,B.OPR_UNIT_ID
                ,A.DEPT_ID
                ,B.DEPT_NM
                ,A.MBR_NM
                ,C.QRT_BGT_USE_YN   /* 분기예산사용여부 */
                ,C.HRNK_BGT_USE_YN  /* 상위예산사용여부 */
                ,C.BGT_CLOS_DD_CD   /*예산마감일코드 */
        FROM    TB_CC_MBR_BASIS A
                JOIN TB_CC_DEPT_BASIS B
                ON      (
                                B.CO_CD   = A.CO_CD
                        AND     B.DEPT_ID = #{DEPT_ID}
                        )
                JOIN VW_CC_OPR_UNIT_CTL_AUTH_INFO C
                ON      (
                                C.CO_CD       = B.CO_CD
                        AND     C.BZPLC_ID    = B.BZPLC_ID
                        AND     C.OPR_UNIT_ID = B.OPR_UNIT_ID
                        )
        WHERE   C.ACCT_USE_YN = 'Y'
        AND     A.CO_CD       = #{CO_CD}
        AND     A.MBR_ID      = #{MBR_ID}
        )
        , ACCT_TREE AS
        ( SELECT           A.CO_CD              /* 회사코드 */
                          ,A.BZPLC_ID           /* 사업장ID */
                          ,A.OPR_UNIT_ID        /* 운영단위ID */
                          ,A.DEPT_ID            /* 부서ID */
                          ,A.ACCT_ID            /* 계정ID */
                          ,A.ACCT_LVL           /* 계정레벨 */
                          ,A.ACCT_NM            /* 계정명 */
                          ,A.ACCT_CD            /* 계정코드 */
                          ,A.USE_YN             /* 사용여부 */
                          ,A.ACCT_TP_CD         /* 계정유형코드 */
                          ,A.ACCT_TP_NM         /* 계정유형명 */
                          ,A.HRNK_ACCT_ID       /* 상위계정ID */
                          ,A.RMKS_CTS           /*비고내용 */
                          ,A.QRT_BGT_USE_YN     /* 분기예산사용여부 */
                          ,A.HRNK_BGT_USE_YN    /*상위예산사용여부 */
                          ,A.BGT_CLOS_DD_CD     /* 예산마감일코드 */
                          ,RowNum RN            /* 출력순서 */
        FROM              ( SELECT  C.CO_CD             /* 회사코드 */
                                  , C.BZPLC_ID          /* 사업장ID */
                                  , A.OPR_UNIT_ID       /*운영단위ID */
                                  , A.DEPT_ID           /* 부서ID */
                                  , C.ACCT_ID           /* 계정ID */
                                  , C.ACCT_LVL          /*계정레벨 */
                                  , C.ACCT_NM           /* 계정명 */
                                  , C.ACCT_CD           /* 계정코드 */
                                  , C.USE_YN            /* 사용여부 */
                                  , C.ACCT_TP_CD        /* 계정유형코드 */
                                  , D.ACCT_TP_NM        /* 계정유형명 */
                                  , C.HRNK_ACCT_ID      /* 상위계정ID */
                                  , C.RMKS_CTS          /* 비고내용 */
                                  , A.QRT_BGT_USE_YN    /* 분기예산사용여부 */
                                  , A.HRNK_BGT_USE_YN   /* 상위예산사용여부 */
                                  , A.BGT_CLOS_DD_CD    /* 예산마감일코드 */
                          FROM    BASE_MEMBER A
                                  JOIN TB_CC_BGT_ACCT_BASIS C
                                  ON      (
                                                  C.CO_CD    = A.CO_CD
                                          AND     C.BZPLC_ID = A.BZPLC_ID
                                          )
                                  LEFT JOIN
                                          ( SELECT D.COM_DTL_CD ACCT_TP_CD ,
                                                  D.COM_DTL_CD_NM ACCT_TP_NM
                                          FROM    TB_CO_COM_CD_DTL D
                                          WHERE   D.LANG_CD = 'KO'
                                          AND     D.COM_CLSF_CD = 'ACCT_TP_CD'
                                          ) D
                                  ON      (
                                                  D.ACCT_TP_CD = C.ACCT_TP_CD
                                          )
                          ) A
        WHERE             A.USE_YN                        = 'Y'
        AND               Connect_By_IsLeaf               = 1
                          CONNECT BY Prior A.CO_CD        = A.CO_CD
        AND               Prior A.BZPLC_ID                = A.BZPLC_ID
        AND               Prior A.ACCT_ID                 = A.HRNK_ACCT_ID
                          START WITH A.HRNK_ACCT_ID IS NULL
        ORDER SIBLINGS BY A.ACCT_ID
        )
        SELECT   COUNT(*)
        FROM     ACCT_TREE A
                 JOIN TB_CC_BGT_ACCT_DEPT_MAPP A1
                 ON       (
                                   A1.CO_CD    = A.CO_CD
                          AND      A1.BZPLC_ID = A.BZPLC_ID
                          AND      A1.ACCT_ID  = A.ACCT_ID
                          AND      A1.DEPT_ID  = A.DEPT_ID
                          )
        WHERE A1.USE_YN = 'Y'
          AND A.USE_YN = 'Y'
        ORDER BY A.RN
    </select>

    <!-- ******************************************************************************
        * SELECT : 비용이체부서계정 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-29
        ****************************************************************************** -->
    <select id="selectCostTrnsfDeptAcctList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectCostTrnsfDeptAcctList */
        WITH BASE_MEMBER AS
        ( SELECT
                /* +materialize*/
                A.CO_CD
                ,A.MBR_ID
                ,B.BZPLC_ID
                ,B.OPR_UNIT_ID
                ,A.DEPT_ID
                ,B.DEPT_NM
                ,A.MBR_NM
                ,C.QRT_BGT_USE_YN   /* 분기예산사용여부 */
                ,C.HRNK_BGT_USE_YN  /* 상위예산사용여부 */
                ,C.BGT_CLOS_DD_CD   /*예산마감일코드 */
        FROM    TB_CC_MBR_BASIS A
                JOIN TB_CC_DEPT_BASIS B
                ON      (
                                B.CO_CD   = A.CO_CD
                        AND     B.DEPT_ID = #{DEPT_ID}
                        )
                JOIN VW_CC_OPR_UNIT_CTL_AUTH_INFO C
                ON      (
                                C.CO_CD       = B.CO_CD
                        AND     C.BZPLC_ID    = B.BZPLC_ID
                        AND     C.OPR_UNIT_ID = B.OPR_UNIT_ID
                        )
        WHERE   C.ACCT_USE_YN = 'Y'
        AND     A.CO_CD       = #{CO_CD}
        AND     A.MBR_ID      = #{MBR_ID}
        )
        , ACCT_TREE AS
        ( SELECT           A.CO_CD              /* 회사코드 */
                          ,A.BZPLC_ID           /* 사업장ID */
                          ,A.OPR_UNIT_ID        /* 운영단위ID */
                          ,A.DEPT_ID            /* 부서ID */
                          ,A.ACCT_ID            /* 계정ID */
                          ,A.ACCT_LVL           /* 계정레벨 */
                          ,A.ACCT_NM            /* 계정명 */
                          ,A.ACCT_CD            /* 계정코드 */
                          ,A.USE_YN             /* 사용여부 */
                          ,A.ACCT_TP_CD         /* 계정유형코드 */
                          ,A.ACCT_TP_NM         /* 계정유형명 */
                          ,A.HRNK_ACCT_ID       /* 상위계정ID */
                          ,A.RMKS_CTS           /*비고내용 */
                          ,A.QRT_BGT_USE_YN     /* 분기예산사용여부 */
                          ,A.HRNK_BGT_USE_YN    /*상위예산사용여부 */
                          ,A.BGT_CLOS_DD_CD     /* 예산마감일코드 */
                          ,RowNum RN            /* 출력순서 */
        FROM              ( SELECT  C.CO_CD             /* 회사코드 */
                                  , C.BZPLC_ID          /* 사업장ID */
                                  , A.OPR_UNIT_ID       /*운영단위ID */
                                  , A.DEPT_ID           /* 부서ID */
                                  , C.ACCT_ID           /* 계정ID */
                                  , C.ACCT_LVL          /*계정레벨 */
                                  , C.ACCT_NM           /* 계정명 */
                                  , C.ACCT_CD           /* 계정코드 */
                                  , C.USE_YN            /* 사용여부 */
                                  , C.ACCT_TP_CD        /* 계정유형코드 */
                                  , D.ACCT_TP_NM        /* 계정유형명 */
                                  , C.HRNK_ACCT_ID      /* 상위계정ID */
                                  , C.RMKS_CTS          /* 비고내용 */
                                  , A.QRT_BGT_USE_YN    /* 분기예산사용여부 */
                                  , A.HRNK_BGT_USE_YN   /* 상위예산사용여부 */
                                  , A.BGT_CLOS_DD_CD    /* 예산마감일코드 */
                          FROM    BASE_MEMBER A
                                  JOIN TB_CC_BGT_ACCT_BASIS C
                                  ON      (
                                                  C.CO_CD    = A.CO_CD
                                          AND     C.BZPLC_ID = A.BZPLC_ID
                                          )
                                  LEFT JOIN
                                          ( SELECT D.COM_DTL_CD ACCT_TP_CD ,
                                                  D.COM_DTL_CD_NM ACCT_TP_NM
                                          FROM    TB_CO_COM_CD_DTL D
                                          WHERE   D.LANG_CD = 'KO'
                                          AND     D.COM_CLSF_CD = 'ACCT_TP_CD'
                                          ) D
                                  ON      (
                                                  D.ACCT_TP_CD = C.ACCT_TP_CD
                                          )
                          ) A
        WHERE             A.USE_YN                        = 'Y'
        AND               Connect_By_IsLeaf               = 1
                          CONNECT BY Prior A.CO_CD        = A.CO_CD
        AND               Prior A.BZPLC_ID                = A.BZPLC_ID
        AND               Prior A.ACCT_ID                 = A.HRNK_ACCT_ID
                          START WITH A.HRNK_ACCT_ID IS NULL
        ORDER SIBLINGS BY A.ACCT_ID
        )
        SELECT     A.CO_CD      /* 회사코드 */
                 , A.BZPLC_ID   /* 사업장ID */
                 , A.ACCT_ID    /* 계정ID*/
                 , A.ACCT_NM    /* 계정명 */
                 , A.ACCT_CD    /* 계정코드 */
        FROM     ACCT_TREE A
                 JOIN TB_CC_BGT_ACCT_DEPT_MAPP A1
                 ON       (
                                   A1.CO_CD    = A.CO_CD
                          AND      A1.BZPLC_ID = A.BZPLC_ID
                          AND      A1.ACCT_ID  = A.ACCT_ID
                          AND      A1.DEPT_ID  = A.DEPT_ID
                          )
        WHERE A1.USE_YN = 'Y'
          AND A.USE_YN = 'Y'
        ORDER BY A.RN
    </select>

    <!-- ******************************************************************************
        * SELECT : 귀속부서 COUNT 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-30
        ****************************************************************************** -->
    <select id="selectBlngDeptCount" parameterType="HashMap" resultType="integer">
        /* com.ssp.bo.od.orderPopup.selectBlngDeptCount */
        WITH DEPT AS(
        SELECT
                A.CO_CD
                , A.MBR_ID
                , A.BZPLC_ID MBR_BZPLC_ID
                , A.MBR_NM
                , B.DEPT_ID                 /* 부서ID */
                , B.DEPT_NM                 /* 부서명 */
                , B.HRNK_DEPT_ID            /* 상위부서ID */
                , B.DEPT_SRT_SEQ            /* 부서정렬순번 */
                , B.CCO_DEPT_CD             /* 고객사부서코드 */
                , B.ZPCD                    /* 우편번호 */
                , B.REPR_ADDR               /* 대표주소 */
                , B.DTL_ADDR                /* 상세주소 */
                , B.USE_YN                  /* 사용여부 */
                , B.BZPLC_ID DEPT_BZPLC_ID  /* 사업장ID */
                , B.OPR_UNIT_ID             /* 운영단위ID */
        FROM TB_CC_MBR_BASIS A
        JOIN
            TB_CC_DEPT_BASIS B
            ON (B.CO_CD = A.CO_CD
            AND B.BZPLC_ID = A.BZPLC_ID)
        WHERE A.CO_CD = #{CO_CD}
          AND A.MBR_ID = #{MBR_ID}
          <if test="DEPT_ID != null and !DEPT_ID.equals('') ">
            AND Upper(B.DEPT_ID) LIKE '%'|| Upper(#{DEPT_ID}) ||'%'
          </if>
          <if test="DEPT_NM != null and !DEPT_NM.equals('') ">
            AND Upper(B.DEPT_NM) LIKE '%'|| Upper(#{DEPT_NM}) ||'%'
          </if>
        OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
        )
        SELECT
        *
        FROM(
        SELECT
                COUNT(*)
        FROM DEPT A
        LEFT JOIN
            VW_CC_OPR_UNIT_CTL_AUTH_INFO B
            ON (B.CO_CD = A.CO_CD
            AND B.BZPLC_ID = A.DEPT_BZPLC_ID
            AND B.OPR_UNIT_ID = A.OPR_UNIT_ID)
        )
    </select>

    <!-- ******************************************************************************
        * SELECT : 귀속부서 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-30
        ****************************************************************************** -->
    <select id="selectBlngDeptList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectBlngDeptList */
        WITH DEPT AS(
        SELECT
                A.CO_CD
                , A.MBR_ID
                , A.BZPLC_ID MBR_BZPLC_ID
                , A.MBR_NM
                , B.DEPT_ID                 /* 부서ID */
                , B.DEPT_NM                 /* 부서명 */
                , B.HRNK_DEPT_ID            /* 상위부서ID */
                , B.DEPT_SRT_SEQ            /* 부서정렬순번 */
                , B.CCO_DEPT_CD             /* 고객사부서코드 */
                , B.ZPCD                    /* 우편번호 */
                , B.REPR_ADDR               /* 대표주소 */
                , B.DTL_ADDR                /* 상세주소 */
                , B.USE_YN                  /* 사용여부 */
                , B.BZPLC_ID DEPT_BZPLC_ID  /* 사업장ID */
                , B.OPR_UNIT_ID             /* 운영단위ID */
        FROM TB_CC_MBR_BASIS A
        JOIN
            TB_CC_DEPT_BASIS B
            ON (B.CO_CD = A.CO_CD
            AND B.BZPLC_ID = A.BZPLC_ID)
        WHERE A.CO_CD = #{CO_CD}
          AND A.MBR_ID = #{MBR_ID}
          <if test="DEPT_ID != null and !DEPT_ID.equals('') ">
            AND Upper(B.DEPT_ID) LIKE '%'|| Upper(#{DEPT_ID}) ||'%'
          </if>
          <if test="DEPT_NM != null and !DEPT_NM.equals('') ">
            AND Upper(B.DEPT_NM) LIKE '%'|| Upper(#{DEPT_NM}) ||'%'
          </if>
        )
        SELECT
        *
        FROM(
        SELECT
                  A.CO_CD           /* */
                , A.MBR_BZPLC_ID    /* */
                , A.DEPT_ID         /* 부서ID */
                , A.DEPT_NM         /* 부서명 */
                , A.CCO_DEPT_CD     /* 고객사부서코드 */
        FROM DEPT A
        LEFT JOIN
            VW_CC_OPR_UNIT_CTL_AUTH_INFO B
            ON (B.CO_CD = A.CO_CD
            AND B.BZPLC_ID = A.DEPT_BZPLC_ID
            AND B.OPR_UNIT_ID = A.OPR_UNIT_ID)
        CONNECT BY
        PRIOR A.DEPT_ID = A.HRNK_DEPT_ID
        START WITH A.HRNK_DEPT_ID IS NULL
        ORDER SIBLINGS BY A.DEPT_SRT_SEQ
        )
        OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
    </select>

    <!-- ******************************************************************************
        * SELECT : Email 발송이력 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-13
        ****************************************************************************** -->
    <select id="selectEmailSentHstList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectEmailSentHstList */
        SELECT  T1.EMAIL_SEQ,
                T1.SSP_EVT_ID,
                T1.SEND_YN,
                T1.SEND_DTM,
                T1.USR_EMAIL_READ_DTM,
                T2.RCV_EMAIL_ADDR,
                T2.RCVR_NM,
                T3.EMAIL_ADDR,             /*발신자이메일주소*/
                T3.MBR_NM,                 /*발신자명*/
                T2.EMAIL_TTL
        FROM    TB_CO_EMAIL_TRANS_LOG          T1
                JOIN
                TB_CO_EMAIL_TRANS_INFO_MST     T2
                ON   T2.EMAIL_SEQ = T1.EMAIL_SEQ
                AND  T2.EVT_ID = T1.EVT_ID
                AND  T2.MST_SEQ = 1
                LEFT JOIN
                TB_CC_MBR_BASIS         T3
                ON   T3.CO_CD  = #{CO_CD}
                AND  T3.MBR_ID = T1.MBR_ID
        WHERE   T1.ODR_NO = #{ODR_NO}
        OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
    </select>

    <!-- ******************************************************************************
        * SELECT : Email 발송이력 Count 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-13
        ****************************************************************************** -->
    <select id="selectEmailSentHstListCount" parameterType="HashMap" resultType="integer">
        /* com.ssp.bo.od.orderPopup.selectEmailSentHstListCount */
        SELECT  COUNT(1)
        FROM    TB_CO_EMAIL_TRANS_LOG          T1
                JOIN
                TB_CO_EMAIL_TRANS_INFO_MST     T2
                ON   T2.EMAIL_SEQ = T1.EMAIL_SEQ
                AND  T2.EVT_ID = T1.EVT_ID
                AND  T2.MST_SEQ = 1
        <where>
            <if test="ODR_NO != null and !ODR_NO.equals('') ">
                AND T1.ODR_NO = #{ODR_NO}
            </if>
        </where>
    </select>

    <!-- ******************************************************************************
        * SELECT : 컬럼 조회 * 작성자 : neonlee * 작성 일자 : 2022-05-10
        ****************************************************************************** -->
    <select id="selectColumnList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectColumnList */
        SELECT
                T1.OWNER,
                T1.TABLE_NAME,
                T1.COLUMN_NAME,
                T1.COMMENTS,
                T1.ORIGIN_CON_ID
        FROM    ALL_COL_COMMENTS    T1
        WHERE   T1.TABLE_NAME = #{TABLE_NAME}
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문일괄등록 이력 조회 * 작성자 : neonlee * 작성 일자 : 2022-05-13
        ****************************************************************************** -->
    <select id="selectExcelUpldDtlsHstList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectExcelUpldDtlsHstList */
        SELECT
                T1.CO_CD,           /* 회사코드 */
                T1.USR_ID,          /* 사용자ID */
                T1.UPLD_PGM_IDT_NM, /* 업로드프로그램식별명 */
                T1.CHG_ITM_GRP_CD,  /* 변경항목그룹코드 */
                T2.CHG_ITM_GRP_NM,
                T1.UPLD_CNT,        /* 업로드건수 */
                T1.UPLD_NRML_CNT,   /* 업로드정상건수 */
                T1.UPLD_ERR_CNT,    /* 업로드오류건수 */
                NVL(T1.UPLD_STOR_YN, 'N') UPLD_STOR_YN,    /* 업로드저장여부 */
                T1.REGPSN_ID,       /* 등록자ID */
                T1.REGPSN_ID||'-'||T3.OPRTR_NM  OPRTR_NM,
                T1.REG_DTM          /* 등록일시 */
        FROM    TB_OD_ODR_EXCEL_UPLD_MST T1
                LEFT JOIN
                TB_DL_CHG_CTL_ITM_GRP_CD T2
                ON T2.CHG_ITM_GRP_CD = T1.CHG_ITM_GRP_CD
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO T3
                ON  T3.CO_CD = T1.CO_CD
                AND T3.OPRTR_ID = T1.REGPSN_ID
                <if test=" REGPSN_IDS > 0 ">
                JOIN
                TB_OD_ODR_INQ_TGT_DTLS   T10
                ON  T10.SES_ID = #{SES_ID}
                AND T10.INQ_COND_DTLS = #{INQ_COND_DTLS}
                AND T10.COL_ITM = 'REGPSN_IDS'
                AND T10.COND_DATA_VAL = T1.REGPSN_ID
                </if>
        WHERE   T1.CO_CD = #{CO_CD}
          AND   Upper(T1.UPLD_PGM_IDT_NM) LIKE Upper(#{UPLD_PGM_IDT_NM})||'%'
          <if test="REGPSN_ID != null and !REGPSN_ID.equals('') ">
            AND   T1.REGPSN_ID = #{REGPSN_ID}
          </if>
          <if test="CHG_ITM_GRP_CD != null and !CHG_ITM_GRP_CD.equals('') ">
            AND   T1.CHG_ITM_GRP_CD = #{CHG_ITM_GRP_CD}
          </if>
          AND   T1.REG_DTM BETWEEN TO_DATE(#{REG_DTM_START}||'000000','YYYYMMDDHH24MISS') AND TO_DATE(#{REG_DTM_END}||'235959','YYYYMMDDHH24MISS')
          AND   T2.USE_YN = 'Y'
        ORDER BY T1.REG_DTM DESC
    </select>

    <!-- ******************************************************************************
        * SELECT : 운영자 멀티 조회 * 작성자 : neonlee * 작성 일자 : 2022-07-05
        ****************************************************************************** -->
    <select id="selectOprtrList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectOprtrList */
        SELECT
                T1.CO_CD
                , T1.OPRTR_ID
                , T1.OPRTR_NM
                , T1.EMP_NO
        FROM    TB_CO_MBR_OPRTR_INFO T1
        WHERE   T1.CO_CD = #{CO_CD}
        <if test="OPRTR_ID != null and !OPRTR_ID.equals('') ">
            AND UPPER(T1.OPRTR_ID) LIKE '%'|| UPPER(#{OPRTR_ID})||'%'
        </if>
        <if test="OPRTR_NM != null and !OPRTR_NM.equals('') ">
            AND UPPER(T1.OPRTR_NM) LIKE '%'|| UPPER(#{OPRTR_NM}) ||'%'
        </if>
        ORDER BY T1.OPRTR_NM
        OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
    </select>

    <!-- ******************************************************************************
        * SELECT : 운영자 멀티 Count 조회 * 작성자 : neonlee * 작성 일자 : 2022-07-05
        ****************************************************************************** -->
    <select id="selectOprtrListCount" parameterType="HashMap" resultType="integer">
        /* com.ssp.bo.od.orderPopup.selectOprtrListCount */
        SELECT  COUNT(*) AS CNT
        FROM    TB_CO_MBR_OPRTR_INFO T1
        WHERE   T1.CO_CD = #{CO_CD}
        <if test="OPRTR_ID != null and !OPRTR_ID.equals('') ">
            AND UPPER(T1.OPRTR_ID) LIKE '%'|| UPPER(#{OPRTR_ID})||'%'
        </if>
        <if test="OPRTR_NM != null and !OPRTR_NM.equals('') ">
            AND UPPER(T1.OPRTR_NM) LIKE '%'|| UPPER(#{OPRTR_NM}) ||'%'
        </if>
    </select>

    <!-- ******************************************************************************
        * SELECT : MD담당자 멀티 조회 * 작성자 : neonlee * 작성 일자 : 2022-07-07
        ****************************************************************************** -->
    <select id="selectMDOprtrList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderPopup.selectMDOprtrList */
        SELECT  *
        FROM    (
                SELECT
                        T1.CO_CD
                        , T1.OPRTR_ID
                        , T1.OPRTR_NM
                        , T1.EMP_NO
                FROM    TB_CO_MBR_OPRTR_INFO T1     /* 회원운영자정보 */
                        JOIN
                        (
                        SELECT  T3.CO_CD
                                , T3.PRD_CLSF_CHRPSN_ID
                        FROM    TB_PR_PRD_CLSF_CHRPSN_INFO T3
                        WHERE   T3.CO_CD = #{CO_CD}
                        AND     T3.PRD_CLSF_CHRPSN_SPR_CD = '10'        -- 상품분류담당자구분코드(10:정, 20:부)
                        AND     T3.PRD_CLSF_CHRPSN_TP_CD = '20'       -- 상품분류담당자유형코드(10:상품담당자, 20:MD담당자, 30:RND 구매담당자)
                        AND     T3.PRD_CLSF_CHRPSN_USEYN = 'Y'
                        <if test='IS_SSP != null and IS_SSP.equals("Y")'>
                        AND     T3.MNFR_NO = '*'
                        </if>
                        GROUP BY T3.CO_CD, T3.PRD_CLSF_CHRPSN_ID
                        ) T2
                        ON  T2.CO_CD = T1.CO_CD
                        AND T2.PRD_CLSF_CHRPSN_ID = T1.OPRTR_ID
                WHERE   T1.CO_CD = #{CO_CD}
                <if test="OPRTR_ID != null and !OPRTR_ID.equals('') ">
                    AND UPPER(T1.OPRTR_ID) LIKE '%'|| UPPER(#{OPRTR_ID})||'%'
                </if>
                <if test="OPRTR_NM != null and !OPRTR_NM.equals('') ">
                    AND UPPER(T1.OPRTR_NM) LIKE '%'|| UPPER(#{OPRTR_NM}) ||'%'
                </if>
                ORDER BY T1.OPRTR_NM
                )
        OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
    </select>

    <!-- ******************************************************************************
        * SELECT : MD담당자 멀티 Count 조회 * 작성자 : neonlee * 작성 일자 : 2022-07-07
        ****************************************************************************** -->
    <select id="selectMDOprtrListCount" parameterType="HashMap" resultType="integer">
        /* com.ssp.bo.od.orderPopup.selectMDOprtrListCount */
        SELECT
                COUNT(*) CNT
        FROM    TB_CO_MBR_OPRTR_INFO T1     /* 회원운영자정보 */
                JOIN
                (
                SELECT  T3.CO_CD
                        , T3.PRD_CLSF_CHRPSN_ID
                FROM    TB_PR_PRD_CLSF_CHRPSN_INFO T3
                WHERE   T3.CO_CD = #{CO_CD}
                AND     T3.PRD_CLSF_CHRPSN_SPR_CD = '10'        -- 상품분류담당자구분코드(10:정, 20:부)
                AND     T3.PRD_CLSF_CHRPSN_TP_CD = '20'       -- 상품분류담당자유형코드(10:상품담당자, 20:MD담당자, 30:RND 구매담당자)
                AND     T3.PRD_CLSF_CHRPSN_USEYN = 'Y'
                <if test='IS_SSP != null and IS_SSP.equals("Y")'>
                AND     T3.MNFR_NO = '*'
                </if>
                GROUP BY T3.CO_CD, T3.PRD_CLSF_CHRPSN_ID
                ) T2
                ON  T2.CO_CD = T1.CO_CD
                AND T2.PRD_CLSF_CHRPSN_ID = T1.OPRTR_ID
        WHERE   T1.CO_CD = #{CO_CD}
        <if test="OPRTR_ID != null and !OPRTR_ID.equals('') ">
            AND UPPER(T1.OPRTR_ID) LIKE '%'|| UPPER(#{OPRTR_ID})||'%'
        </if>
        <if test="OPRTR_NM != null and !OPRTR_NM.equals('') ">
            AND UPPER(T1.OPRTR_NM) LIKE '%'|| UPPER(#{OPRTR_NM}) ||'%'
        </if>
    </select>

</mapper>