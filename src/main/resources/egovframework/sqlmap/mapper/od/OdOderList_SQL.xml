<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssp.bo.od.orderList">
 
    <!-- 주문번호 -->
    <!-- ******************************************************************************
        * SELECT : 주문번호 조회
        * 작성자 : neonlee
        * 작성 일자 : 2022-03-15
        ****************************************************************************** -->
    <select id="selectOrderList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectOrderList */
       WITH BASE_T AS (  /*SSP-2582_성진우_주문조회화면속도개선*/
        SELECT  <choose>
                      <when test=' ODR_NO > 0 '>
                      /*+ LEADING(T22 T2) USE_NL(T22 T2 T1) INDEX(T2 TB_OD_ODR_DTL_IX02)*/
                      </when>
                      <otherwise>
                       /*+ materialize */
                      </otherwise>
                 </choose>    
                T1.CO_CD,
                T1.CHN_SPR_CD,
                T2.CATG_KILR_CD,
                T1.BZPLC_ID,                                /* 사업장ID */
                T2.ODR_STATS_CD,
                T2.ODR_NO,                                  /* 주문번호 */
                T2.ODR_ITM_NO,                              /* 주문항목번호 */
                T2.MNFR_NO,                                 /* 제조사번호 */
                T2.PRD_ID,                                  /* 상품ID */
                T2.REPR_SPEC,                               /* 대표규격 */
                T2.SSP_REPR_ATTR,                           /* SSP대표규격 */
                T2.ODR_QTY,                                 /* 주문수량 */
                T2.SELL_UNIT_CD,                            /* 판매단위코드 */
                T2.VAT_AMT,                                 /* 부가세금액 */
                T2.SALSPRC,                                 /* 판매가 */
                T2.SALE_AMT,                                /* 매출금액 */
                T2.DLV_FORM_SPR_CD,/* 배송형태구분코드 */
                T1.OPR_UNIT_ID,                             /* 운영단위ID */
                T1.DEPT_ID,                                 /* 부서ID */
                T1.ODRPSN_ID,                               /* 주문자ID */
                T1.STL_MEAN_CD,  /* 결제수단코드 */
                T2.RCVR_NM,                                  /* 수령인명 */
                T2.GDOC_NO,
                T2.SALE_CLOS_CD,
                T2.CUST_PURG_ODR_NO,
                T1.CUST_SPR_CD,
                T1.SALS_CHR_CD,
                T1.SALS_TEAM_CD,
                T1.NRML_RTNGDS_SPR_CD,
                T2.GI_PLNT_ID,
                T2.GO_PLNT_ID,
                T2.SALE_ADJ_STATS_CD,
                T2.ODR_TMP_LOCK_CD,
                T2.ACCT_ID,
                T2.COST_TRNSF_DEPT_ID,
                T2.ODR_DCN_DTM,
                T2.CUST_ORD_DTM,
                T1.ODR_CRT_TP_CD,
                T2.TXTN_TP_CD,
                T2.COND_PRC_DECI_CD,
                T2.DLVPLC_ID,
                T2.ORI_ODR_NO,
                T2.ORI_ITM_NO,
                T2.SALS_CHRPSN_ID,
                T2.SVC_CHRPSN_ID,
                T2.PURG_CHRPSN_ID,
                T2.QCK_DLV_YN,
                T2.CPRTCP_ID,
                T1.DLCST_AMT,
                T1.DC_AMT
        FROM    TB_OD_ODR_MST T1                            /* 주문마스터 */
                JOIN
                TB_OD_ODR_DTL T2                        /* 주문상세 */
                ON   T1.CO_CD    = T2.CO_CD         /* 회사코드 */
                AND  T1.BZPLC_ID = T2.BZPLC_ID      /* 사업장ID */
                AND  T1.ODR_NO   = T2.ODR_NO        /* 주문번호 */
               <if test=" OPR_UNIT_ID > 0 ">
               JOIN
               TB_OD_ODR_INQ_TGT_DTLS   T21
               ON  T21.SES_ID = #{SES_ID}
               AND T21.INQ_COND_DTLS = #{INQ_COND_DTLS}
               AND T21.COL_ITM = 'OPR_UNIT_ID'
               AND T21.COND_DATA_VAL = T1.OPR_UNIT_ID
               </if>
               <if test=" ODR_NO > 0 ">
               JOIN
               TB_OD_ODR_INQ_TGT_DTLS   T22
               ON  T22.SES_ID = #{SES_ID}
               AND T22.INQ_COND_DTLS = #{INQ_COND_DTLS}
               AND T22.COL_ITM = 'ODR_NO'
               AND REGEXP_SUBSTR(T22.COND_DATA_VAL,'[^-]+',1,1) = T2.ODR_NO
               AND (CASE WHEN TRIM(REGEXP_SUBSTR(T22.COND_DATA_VAL,'[^-]+',1,2)) IS NULL OR
                             TRIM(REGEXP_SUBSTR(T22.COND_DATA_VAL,'[^-]+',1,2)) = '' THEN
                             T2.ODR_ITM_NO ELSE TO_NUMBER(TRIM(REGEXP_SUBSTR(T22.COND_DATA_VAL,'[^-]+',1,2))) END) = T2.ODR_ITM_NO
               </if>
               <if test=" INQ_PRD == '10' ">
                    AND  T2.ODR_DCN_DTM BETWEEN TO_DATE(#{FROM_DT} || '000000','YYYYMMDDHH24MISS') AND TO_DATE(#{TO_DT} || '235959','YYYYMMDDHH24MISS')
               </if>
        WHERE   1 = 1
          AND  T1.CO_CD = #{CO_CD}
        )
       SELECT   /*+ USE_NL(T1 T11 T12 T13 T14 T51 T52 T53 T54 T55 T61 T62 T63 T64 T65 T66 T67 T68 T69)*/  /*SSP-2582_성진우_주문조회화면속도개선*/
                T1.CHN_SPR_CD||' | '||T52.COM_DTL_CD_NM  CHN_SPR_CD,/* 채널구분코드 */
                T1.MALL_SPR_CD,                             /* 몰구분코드 */
                T1.PUB_ONLY_SPR_CD,                         /* 공용전용구분코드 */
                T1.CATG_KILR_CD||' | '||T55.COM_DTL_CD_NM   CATG_KILR_CD,
                T1.BZPLC_ID,                                /* 사업장ID */
                T1.ODR_STATS_CD||' | '||T51.COM_USR_DEFN_NM_2  ODR_STATS_CD,  /* 주문상태코드 */
                T1.ODR_NO||'-'||T1.ODR_ITM_NO AS JNT_ODR_ITM_NO,    /* 주문품목번호 */
                T1.ODR_NO,                                  /* 주문번호 */
                T1.ODR_ITM_NO,                              /* 주문항목번호 */
                T1.MNFR_NO,                                 /* 제조사번호 */
                T11.MRO_MNFR_NM,                            /* 제조원명 */
                T1.MRO_PRD_CLCD ,                           /* 상품분류코드 */
                T12.MRO_PRD_CLSF_NM,                        /* 상품분류명 */
                LTRIM(T1.PRD_ID, '0') PRD_ID,                      /* 상품ID */
                T1.PRD_NM,                                  /* 상품명 */
                T1.REPR_SPEC,                               /* 대표규격 */
                T1.SSP_REPR_ATTR,                           /* SSP대표규격 */
                T1.ODR_QTY,                                 /* 주문수량 */
                T1.SELL_UNIT_CD,                            /* 판매단위코드 */
                T1.VAT_AMT,                                 /* 부가세금액 */
                T1.SALSPRC,                                 /* 판매가 */
                T1.SALE_AMT,                                /* 매출금액 */
                T1.SALSPRC + ROUND(DECODE(T1.VAT_AMT, 0, 0,T1.VAT_AMT/T1.ODR_QTY), 0) AS VAT_SALSPRC,  /* 판매가(VAT포함) - SSP-3056_20230523_박철희_1.1을 변경함 */
                T1.SALE_AMT + T1.VAT_AMT AS VAT_SALE_AMT,   /* 매출금액(VAT포함) */
                T1.DLCST_AMT,
                T1.DLV_FORM_SPR_CD||' | '||T53.COM_DTL_CD_NM  DLV_FORM_SPR_CD,/* 배송형태구분코드 */
                T1.ODR_REQ_DTM,                             /* 주문신청일시 */
                T1.INTL_ORD_DCN_DTM,                        /* 내부발주확정일시 :고객사발주완료일 */
                T1.SELL_DOC_CRT_DTM,                        /* 판매문서생성일시 :S/O생성일 */
                TO_DATE(T1.DLV_DUE_DT,'YYYYMMDD') DLV_DUE_DT, /* 배송예정일자 */
                T1.DLV_CMPL_DTM,                            /* 배송완료일시 */
                T1.REAL_DLV_CMPL_DTM,                       /* 실제배송완료일시 */
                T1.OPR_UNIT_ID,                             /* 운영단위ID */
                T1.OPR_UNIT_NM,                             /* 운영단위명 */
                T1.DEPT_ID,                                 /* 부서ID */
                T13.DEPT_NM,                                /* 부서명 */
                T1.ODRPSN_ID,                               /* 주문자ID */
                T14.MBR_NM,                                 /* 주문자명 */
                T1.STL_MEAN_CD||' | '||T54.COM_DTL_CD_NM  STL_MEAN_CD,  /* 결제수단코드 */
                T1.RCVR_NM,                                  /* 수령인명 */
                T1.GDOC_NO,
                                /*여기서부터 추가된 컬럼임 */
                T1.ODR_CRT_TP_CD||' | '||T61.COM_DTL_CD_NM          ODR_CRT_TP_CD,  /* 주문생성유형코드(오더유형) */
                T1.NRML_RTNGDS_SPR_CD||' | '||T62.COM_DTL_CD_NM     NRML_RTNGDS_SPR_CD,  /* 정상반품구분코드 */
                T1.TXTN_TP_CD||' | '||T63.COM_DTL_CD_NM             TXTN_TP_CD,  /* 과세유형코드 */
                CASE WHEN T1.COND_PRC_DECI_CD IS NOT NULL OR T64.COM_DTL_CD_NM IS NOT NULL
                         THEN T1.COND_PRC_DECI_CD || ' | ' || T64.COM_DTL_CD_NM END        COND_PRC_DECI_CD,
                T1.DLVPLC_ID,
                T1.ORD_NO||'-'||T1.ORD_ITM_NO       JNT_ORD_ITM_NO,
                CASE WHEN T1.CPRTCP_ID IS NOT NULL OR T65.CPRTCP_KOR_NM IS NOT NULL
                         THEN T1.CPRTCP_ID || ' | ' || T65.CPRTCP_KOR_NM END        CPRTCP_ID,
                CASE WHEN T1.GI_STATS_CD = '01' THEN '입고 완료' ELSE '미 입고' END    GI_STATS_CD_NM,
                CASE WHEN NVL(T1.SALE_ADJ_STATS_CD,'90') = '10' THEN '정산 완료'
                     WHEN NVL(T1.SALE_ADJ_STATS_CD,'90') = '20' THEN '부분 정산'    ELSE '미 정산' END    ADJ_STATS_CD_NM,    -- 정산상태
                T1.TAXINV_UNQ_NO,
                CASE WHEN T1.NRML_RTNGDS_SPR_CD = 'R' THEN T1.ORI_ODR_NO||'-'||T1.ORI_ITM_NO ELSE NULL END  JNT_ORI_ITM_NO,
                CASE WHEN T1.SALS_CHRPSN_ID IS NOT NULL OR T66.OPRTR_NM IS NOT NULL
                         THEN T1.SALS_CHRPSN_ID || ' | ' || T66.OPRTR_NM END     SALS_CHR_CD_NM,     /* 영업담당자 */
                CASE WHEN T1.SVC_CHRPSN_ID IS NOT NULL OR T67.OPRTR_NM IS NOT NULL
                         THEN T1.SVC_CHRPSN_ID || ' | ' || T67.OPRTR_NM END      SVC_CHRPSN_ID_NM,   /* 서비스담당자 */
                CASE WHEN T1.PURG_CHRPSN_ID IS NOT NULL OR T68.OPRTR_NM IS NOT NULL
                         THEN T1.PURG_CHRPSN_ID || ' | ' || T68.OPRTR_NM END     PURG_CHRPSN_ID_NM,  /* 구매담당자 */
                CASE WHEN T1.MD_OPRTR_ID IS NOT NULL OR T69.OPRTR_NM IS NOT NULL
                         THEN T1.MD_OPRTR_ID || ' | ' || T69.OPRTR_NM END     MD_CHRPSN_ID_NM,  /* MD담당자 */
                T1.CATEGORY_CD,
                T1.JNT_SSP_DLV_MTD_CD_NM,  /* 배송방법 */
                CASE WHEN ODR_EXCEPT_KND_CD IS NULL THEN NULL 
                     ELSE ODR_EXCEPT_KND_CD ||' | '|| T70.COM_DTL_CD_NM END AS EXCEPT_KND_NM,
                SSP_APP.FN_PR_GET_SSP_PRD_NM(T1.CO_CD, T1.PRD_ID) SSP_PRD_NM /* SSP상품명 */
        FROM    (
                SELECT  T1.CO_CD,
                        T1.CHN_SPR_CD,
                        T3.MALL_SPR_CD,                             /* 몰구분코드 */
                        T3.PUB_ONLY_SPR_CD,                         /* 공용전용구분코드 */
                        T1.CATG_KILR_CD,
                        T1.BZPLC_ID,                                /* 사업장ID */
                        T1.ODR_STATS_CD,
                        T1.ODR_NO,                                  /* 주문번호 */
                        T1.ODR_ITM_NO,                              /* 주문항목번호 */
                        T1.MNFR_NO,                                 /* 제조사번호 */
                        T3.MRO_PRD_CLCD ,                           /* 상품분류코드 */
                        T1.PRD_ID,                      /* 상품ID */
                        T3.PRD_NM,                                  /* 상품명 */
                        FN_PR_ATTR_VAL_LIST(T1.CO_CD, T1.PRD_ID) REPR_SPEC,     /* 대표규격 */
                        T1.SSP_REPR_ATTR,                           /* SSP대표규격 */
                        T1.ODR_QTY,                                 /* 주문수량 */
                        T1.SELL_UNIT_CD,                            /* 판매단위코드 */
                        T1.VAT_AMT,                                 /* 부가세금액 */
                        T1.SALSPRC,                                 /* 판매가 */
                        T1.SALE_AMT,                                /* 매출금액 */
                        T1.DLV_FORM_SPR_CD,/* 배송형태구분코드 */
                        T1.ODR_DCN_DTM    ODR_REQ_DTM,              /* 주문신청일시 */
                        T1.CUST_ORD_DTM   INTL_ORD_DCN_DTM,         /* 내부발주확정일시 :고객사발주완료일 */
                        T5.SELL_DOC_CRT_DTM,                        /* 판매문서생성일시 :S/O생성일 */
                        T5.DLV_DUE_DT, /* 배송예정일자 */
                        T5.DLV_CMPL_DTM,                            /* 배송완료일시 */
                        T5.REAL_DLV_CMPL_DTM,                       /* 실제배송완료일시 */
                        T1.OPR_UNIT_ID,                             /* 운영단위ID */
                        T7.OPR_UNIT_NM,                             /* 운영단위명 */
                        T1.DEPT_ID,                                 /* 부서ID */
                        T1.ODRPSN_ID,                               /* 주문자ID */
                        T1.STL_MEAN_CD,  /* 결제수단코드 */
                        T1.RCVR_NM,                                  /* 수령인명 */
                        T1.GDOC_NO,
                        T1.NRML_RTNGDS_SPR_CD,
                        T1.ODR_CRT_TP_CD,
                        T1.TXTN_TP_CD,
                        T1.COND_PRC_DECI_CD,
                        T1.DLVPLC_ID,
                        T1.SALE_ADJ_STATS_CD,
                        T1.ORI_ODR_NO,
                        T1.ORI_ITM_NO,
                        T1.SVC_CHRPSN_ID,
                        T1.SALS_CHRPSN_ID,
                        T1.PURG_CHRPSN_ID,
                        T44.MD_OPRTR_ID,
                        T41.ORD_NO,
                        T41.ORD_ITM_NO,
                        T1.CPRTCP_ID,
                        T42.GI_STATS_CD,
                        T43.TAXINV_UNQ_NO,
                        T4.PRD_CLCD||' | '||FN_PR_FULL_CLSF_NM(T4.CO_CD, T4.PRD_CLCD) CATEGORY_CD,
                        CASE WHEN T45.SSP_DLV_MTD_CD IS NOT NULL OR T46.COM_DTL_CD_NM IS NOT NULL
                                  THEN T45.SSP_DLV_MTD_CD || ' | ' || T46.COM_DTL_CD_NM END   JNT_SSP_DLV_MTD_CD_NM,  /* 배송방법 */
                        T50.ODR_EXCEPT_KND_CD,   /* 주문예외종류코드 */
                        CASE WHEN T1.CUST_SPR_CD != '30' THEN 0
                            ELSE  CASE WHEN (ROW_NUMBER() OVER(PARTITION BY T1.CO_CD,T1.BZPLC_ID,T1.ODR_NO ORDER BY CASE WHEN T1.ODR_STATS_CD = 'Z10' THEN 1 ELSE 0 END,T1.ODR_ITM_NO)) = 1 THEN
                                        MAX(NVL(T1.DLCST_AMT,0) + NVL(T1.DC_AMT,0)) OVER(PARTITION BY T1.CO_CD,T1.BZPLC_ID,T1.ODR_NO) ELSE 0 END END AS DLCST_AMT
                FROM    BASE_T      T1
                        LEFT JOIN
                        TB_PR_MRO_PRD_INFO T3               /* MRO상품정보 */
                        ON   T3.CO_CD   = T1.CO_CD          /* 회사코드 */
                        AND  T3.PRD_ID  = T1.PRD_ID         /* 상품ID */
                        LEFT JOIN
                        TB_PR_PRD_INFO T4                   /* 상품정보 */
                        ON   T4.CO_CD   = T1.CO_CD          /* 회사코드 */
                        AND  T4.PRD_ID  = T1.PRD_ID         /* 상품ID */
                        <if test=" INQ_PRD == '00' or INQ_PRD == '10' ">
                        LEFT JOIN
                        </if>
                        <if test=" INQ_PRD != '00' and INQ_PRD != '10' ">
                        JOIN
                        </if>
                        TB_DL_ODR_ACP_DLV_PROC T5           /* 주문접수배송처리 */
                        ON   T5.CO_CD    = T1.CO_CD         /* 회사코드 */
                        AND  T5.BZPLC_ID = T1.BZPLC_ID      /* 사업장ID */
                        AND  T5.ODR_NO   = T1.ODR_NO        /* 주문번호 */
                        AND  T5.ODR_ITM_NO = T1.ODR_ITM_NO  /* 주문항목번호 */
                        <if test=" INQ_PRD == '20' ">
                        AND  T5.SELL_DOC_CRT_DTM BETWEEN TO_DATE(#{FROM_DT} || '000000','YYYYMMDDHH24MISS') AND TO_DATE(#{TO_DT} || '235959','YYYYMMDDHH24MISS')
                        </if>
                        <if test=" INQ_PRD == '30' ">
                        AND  T5.DLV_CMPL_DTM BETWEEN TO_DATE(#{FROM_DT} || '000000','YYYYMMDDHH24MISS') AND TO_DATE(#{TO_DT} || '235959','YYYYMMDDHH24MISS')
                        </if>
                        <if test=" INQ_PRD == '40' ">
                        AND  T5.INTL_ORD_DCN_DTM BETWEEN TO_DATE(#{FROM_DT} || '000000','YYYYMMDDHH24MISS') AND TO_DATE(#{TO_DT} || '235959','YYYYMMDDHH24MISS')
                        </if>
                        <if test="ORD_ERR != null and !ORD_ERR.equals('') ">
                        JOIN
                        TB_DL_SMLN_ORD_INFO T6          /* 시뮬레이션발주정보 */
                        ON   T6.CO_CD    = T1.CO_CD         /* 회사코드 */
                        AND  T6.BZPLC_ID = T1.BZPLC_ID      /* 사업장ID */
                        AND  T6.ODR_NO   = T1.ODR_NO        /* 주문번호 */
                        AND  T6.ODR_ITM_NO = T1.ODR_ITM_NO  /* 주문항목번호 */
                        AND  (CASE WHEN #{ORD_ERR} IS NULL THEN '1'
                                   WHEN #{ORD_ERR} = '20' AND T6.ORD_REQ_STATS_CD = '2' THEN '1'
                                   WHEN #{ORD_ERR} != '20' AND T6.ORD_REQ_STATS_CD = '1' THEN '1'
                                   ELSE '0' END) = '1'
                        </if>
                        JOIN
                        TB_CC_OPR_UNIT_BASIS T7             /* 운영단위기본 */
                        ON   T7.CO_CD    = T1.CO_CD         /* 회사코드 */
                        AND  T7.BZPLC_ID = T1.BZPLC_ID      /* 사업장ID */
                        AND  T7.OPR_UNIT_ID   = T1.OPR_UNIT_ID  /* 운영단위 */
                        <if test="CNSG_CPRTCP_ID != null and !CNSG_CPRTCP_ID.equals('') ">
                        JOIN
                        TB_OD_ODR_DTL   T8
                        ON   T8.CO_CD    = T1.CO_CD         /* 회사코드 */
                        AND  T8.BZPLC_ID = T1.BZPLC_ID      /* 사업장ID */
                        AND  T8.ODR_NO   = T1.ODR_NO        /* 주문번호 */
                        AND  T8.ODR_ITM_NO = T1.ODR_ITM_NO  /* 주문항목번호 */
                        AND  T8.CPRTCP_ID LIKE #{CNSG_CPRTCP_ID} || '%'           /* 23.협력사 ID */
                        </if>
                        <if test=" ODR_STATS_CD > 0 ">
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   T23
                        ON  T23.SES_ID = #{SES_ID}
                        AND T23.INQ_COND_DTLS = #{INQ_COND_DTLS}
                        AND T23.COL_ITM = 'ODR_STATS_CD'
                        AND T23.COND_DATA_VAL = T1.ODR_STATS_CD
                        </if>
                        <if test=" PRD_ID > 0 ">
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   T24
                        ON  T24.SES_ID = #{SES_ID}
                        AND T24.INQ_COND_DTLS = #{INQ_COND_DTLS}
                        AND T24.COL_ITM = 'PRD_ID'
                        AND LPAD(T24.COND_DATA_VAL,18,'0') = T1.PRD_ID
                        </if>
                        <if test=" DEPT_ID > 0 ">
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   T25
                        ON  T25.SES_ID = #{SES_ID}
                        AND T25.INQ_COND_DTLS = #{INQ_COND_DTLS}
                        AND T25.COL_ITM = 'DEPT_ID'
                        AND T25.COND_DATA_VAL = T1.DEPT_ID
                        </if>
                        <if test=" GDOC_NO > 0 ">
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   T26
                        ON  T26.SES_ID = #{SES_ID}
                        AND T26.INQ_COND_DTLS = #{INQ_COND_DTLS}
                        AND T26.COL_ITM = 'GDOC_NO'
                        AND T26.COND_DATA_VAL = T1.GDOC_NO
                        </if>
                        <if test=" ODRPSN_ID > 0 ">
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   T27
                        ON  T27.SES_ID = #{SES_ID}
                        AND T27.INQ_COND_DTLS = #{INQ_COND_DTLS}
                        AND T27.COL_ITM = 'ODRPSN_ID'
                        AND T27.COND_DATA_VAL = T1.ODRPSN_ID
                        </if>
                        <if test=" CUST_PURG_ODR_NO > 0 ">
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   T28
                        ON  T28.SES_ID = #{SES_ID}
                        AND T28.INQ_COND_DTLS = #{INQ_COND_DTLS}
                        AND T28.COL_ITM = 'CUST_PURG_ODR_NO'
                        AND T28.COND_DATA_VAL = T1.CUST_PURG_ODR_NO
                        </if>
                        <if test=" ORD_NO > 0 ">
                        JOIN
                        TB_DL_ORD_ITM_DTL   T29              /* 발주품목상세 */
                        ON   T29.CO_CD    = T1.CO_CD         /* 회사코드 */
                        AND  T29.BZPLC_ID = T1.BZPLC_ID      /* 사업장ID */
                        AND  T29.ODR_NO   = T1.ODR_NO        /* 주문번호 */
                        AND  T29.ODR_ITM_NO = T1.ODR_ITM_NO  /* 주문항목번호 */
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   T30
                        ON  T30.SES_ID = #{SES_ID}
                        AND T30.INQ_COND_DTLS = #{INQ_COND_DTLS}
                        AND T30.COL_ITM = 'ORD_NO'
                        AND T30.COND_DATA_VAL = T29.ORD_NO
                        </if>
                        <if test=" MD_TEAM_CD != null or MD_OPRTR_ID != null">
                        JOIN
                        (
                        SELECT  B.CO_CD,
                                B.PRD_CLCD
                        FROM    TB_CO_MBR_OPRTR_INFO A          /* 회원운영자정보 */
                                JOIN
                                TB_PR_PRD_CLSF_CHRPSN_INFO B    /* 상품분류담당자정보, MD담당자 */
                                ON  B.CO_CD = A.CO_CD
                                AND B.PRD_CLSF_CHRPSN_ID = A.OPRTR_ID
                                JOIN
                                TB_CO_MBR_OPRTR_ORG_INFO  C     /* 회원운영자조직정보 */
                                ON  C.CO_CD = A.CO_CD
                                AND C.ORG_CD = A.ORG_CD
                                AND C.ORG_CD LIKE #{MD_TEAM_CD} || '%'
                        WHERE   B.PRD_CLSF_CHRPSN_SPR_CD = '10'
                        AND     B.PRD_CLSF_CHRPSN_TP_CD = '20'
                        AND     B.PRD_CLSF_CHRPSN_USEYN = 'Y'
                        AND     B.MNFR_NO = '*'
                        AND     A.OPRTR_ID LIKE #{MD_OPRTR_ID} || '%'
                        ) T31
                        ON  T31.CO_CD = T4.CO_CD
                        AND T31.PRD_CLCD = T4.PRD_CLCD
                        </if>
                        LEFT JOIN
                        TB_DL_ORD_ITM_SO_DTL       T41
                        ON   T41.CO_CD    = T1.CO_CD         /* 회사코드 */
                        AND  T41.BZPLC_ID = T1.BZPLC_ID      /* 사업장ID */
                        AND  T41.ODR_NO   = T1.ODR_NO        /* 주문번호 */
                        AND  T41.ODR_ITM_NO = T1.ODR_ITM_NO  /* 주문항목번호 */
                        LEFT JOIN
                        TB_AD_GI_DCN_PROC   T42
                        ON  T42.CO_CD        = T1.CO_CD
                        AND T42.BZPLC_ID     = T1.BZPLC_ID
                        AND T42.ODR_NO       = T1.ODR_NO
                        AND T42.ODR_ITM_NO   = T1.ODR_ITM_NO
						OUTER APPLY
						(
							SELECT	TAXINV_UNQ_NO
							FROM	TB_AD_MRO_TAXINV_DTLS   T43
                        WHERE T43.CO_CD        = T1.CO_CD
                          AND T43.BZPLC_ID     = T1.BZPLC_ID
                          AND T43.ODR_NO       = T1.ODR_NO
                          AND T43.ODR_ITM_NO   = T1.ODR_ITM_NO
						  order by T43.ACCTG_YY DESC,T43.ACCTG_SLP_NO DESC
						  fetch first 1 rows only
                        )	T43
						LEFT JOIN
                        (
                        SELECT  B.CO_CD,
                                B.PRD_CLCD,
                                A.OPRTR_ID      MD_OPRTR_ID
                        FROM    TB_CO_MBR_OPRTR_INFO A          /* 회원운영자정보 */
                                JOIN
                                TB_PR_PRD_CLSF_CHRPSN_INFO B    /* 상품분류담당자정보, MD담당자 */
                                ON  B.CO_CD = A.CO_CD
                                AND B.PRD_CLSF_CHRPSN_ID = A.OPRTR_ID
                        WHERE   B.PRD_CLSF_CHRPSN_SPR_CD = '10'
                        AND     B.PRD_CLSF_CHRPSN_TP_CD = '20'
                        AND     B.PRD_CLSF_CHRPSN_USEYN = 'Y'
                        AND     B.MNFR_NO = '*'
                        ) T44
                        ON  T44.CO_CD = T4.CO_CD
                        AND T44.PRD_CLCD = T4.PRD_CLCD
                        OUTER APPLY
                        (
                            SELECT  *
                            FROM    TB_DL_ODR_DLV_PROC_DTLS T45
                            WHERE   T45.CO_CD = T1.CO_CD
                            AND     T45.BZPLC_ID = T1.BZPLC_ID
                            AND     T45.ODR_NO = T1.ODR_NO
                            AND     T45.ODR_ITM_NO = T1.ODR_ITM_NO
                            --AND     ROWNUM = 1
                            order  by T45.REG_DTM DESC
                            fetch first 1 rows only
                        ) T45
                        LEFT JOIN
                        TB_CO_COM_CD_DTL    T46
                        ON   T46.LANG_CD = #{LANG_CD}
                        AND  T46.COM_CLSF_CD = 'SSP_DLV_MTD_CD'
                        AND  T46.COM_DTL_CD = T45.SSP_DLV_MTD_CD
                        LEFT JOIN 
                        (
                        SELECT /*+LEADING(X) FULL(X) USE_NL(X Y) INDEX(Y TB_OD_ODR_DTL_IX02)*/
                               MAX(X.ODR_EXCEPT_KND_CD) AS ODR_EXCEPT_KND_CD,
                               Y.ORI_ODR_NO,
                               Y.ORI_ITM_NO
                          FROM TB_VO_VOC_EXCEPT_PROC X,
                               TB_OD_ODR_DTL Y
                         WHERE X.EXCEPT_PROC_ODR_NO IS NOT NULL
                           AND X.EXCEPT_PROC_ODR_NO = Y.ODR_NO
                           AND X.EXCEPT_PROC_ODR_ITM_NO = Y.ODR_ITM_NO
                         GROUP BY Y.ORI_ODR_NO,Y.ORI_ITM_NO
                        ) T50
                         ON T50.ORI_ODR_NO = T1.ORI_ODR_NO
                        AND T50.ORI_ITM_NO = T1.ORI_ITM_NO
                WHERE   1 = 1
                    <choose>
                      <when test='CUST_TP_OR_CRT_TP == "CUST_SPR_CD"'>
                      AND T1.CUST_SPR_CD LIKE #{CUST_SPR_CD} || '%'   /* 고객구분코드.고객 유형 */
                      </when>
                      <otherwise>
                      AND T1.ODR_CRT_TP_CD LIKE #{CUST_SPR_CD} || '%'   /* 주문생성유형코드.오더 유형 */
                      </otherwise>
                  </choose>
                  <if test="CAT_KILLER != null and !CAT_KILLER.equals('') ">
                        AND T1.CATG_KILR_CD LIKE #{CAT_KILLER} || '%'
                  </if>
                  <if test="SVC_TEAM_CD != null and !SVC_TEAM_CD.equals('') ">
                        AND  T7.SVC_TEAM_CD = #{SVC_TEAM_CD}                              /* 12.서비스팀 */
                  </if>
                  <if test="SALS_CHR_CD != null and !SALS_CHR_CD.equals('') ">
                        AND  T1.SALS_CHR_CD = #{SALS_CHR_CD}                              /* 13.영업담당 */
                  </if>
                  <if test="SALS_TEAM_CD != null and !SALS_TEAM_CD.equals('') ">
                        AND  T1.SALS_TEAM_CD = #{SALS_TEAM_CD}                           /* 14.영업팀 */
                  </if>
                  <if test="DLV_FORM_SPR_CD != null and !DLV_FORM_SPR_CD.equals('') ">
                        AND  T1.DLV_FORM_SPR_CD = #{DLV_FORM_SPR_CD}            /* 16.배송형태 */
                  </if>
                  <if test="BZPLC_ID != null and !BZPLC_ID.equals('') ">
                        AND  T1.BZPLC_ID = #{BZPLC_ID}                                    /* 17.사업장  */
                  </if>
                  <if test="NRML_RTNGDS_SPR_CD != null and !NRML_RTNGDS_SPR_CD.equals('') ">
                        AND  T1.NRML_RTNGDS_SPR_CD = #{NRML_RTNGDS_SPR_CD}               /* 27.정상반품구분코드 */
                  </if>
                  <if test="GI_PLNT_ID != null and !GI_PLNT_ID.equals('') ">
                        AND  T1.GI_PLNT_ID = #{GI_PLNT_ID}                    /* 20.입고 플랜트 */
                  </if>
                  <if test="GO_PLNT_ID != null and !GO_PLNT_ID.equals('') ">
                        AND  T1.GO_PLNT_ID = #{GO_PLNT_ID}                    /* 21.출고 플랜트 */
                  </if>
                  <if test="SALE_ADJ_STATS_CD != null and !SALE_ADJ_STATS_CD.equals('') ">
                        AND  T1.SALE_ADJ_STATS_CD = #{SALE_ADJ_STATS_CD}        /* 29.정산상태 */
                  </if>
                  <if test="ODR_TMP_LOCK_CD != null and !ODR_TMP_LOCK_CD.equals('') ">
                        AND  T1.ODR_TMP_LOCK_CD = #{ODR_TMP_LOCK_CD}            /* 22.주문 Block */
                  </if>
                  <if test="ACCT_ID != null and !ACCT_ID.equals('') ">
                        AND  T1.ACCT_ID = #{ACCT_ID}                          /* 25.계정ID 조회 */
                  </if>
                  <if test="COST_TRNSF_DEPT_ID != null and !COST_TRNSF_DEPT_ID.equals('') ">
                        AND  T1.COST_TRNSF_DEPT_ID = #{COST_TRNSF_DEPT_ID}    /* 26.비용이체부서 */
                  </if>
                  <if test="SALE_CLOS_CD != null and SALE_CLOS_CD.equals('2') ">
                       NVL(T1.SALE_CLOS_CD,'00') IN ('C1','C2')
                  </if>
                  <if test="SALE_CLOS_CD != null and SALE_CLOS_CD.equals('3') ">
                       NVL(T1.SALE_CLOS_CD,'00') NOT IN ('C1','C2')
                  </if>
                  <if test="QCK_DLV_YN != null and !QCK_DLV_YN.equals('') ">
                        AND  NVL(T1.QCK_DLV_YN,'N') = #{QCK_DLV_YN}                       /* 33.빠른배송여부 */
                  </if>
                  <if test="STL_MEAN_CD != null and !STL_MEAN_CD.equals('') ">
                        AND  T1.STL_MEAN_CD = #{STL_MEAN_CD}                 /* 30.결제수단 */
                  </if>
                  <if test=" DLV_CMPL_YN == '20' ">
                  AND (T1.ODR_STATS_CD = 'Z10' OR T1.ODR_STATS_CD LIKE 'E%')
                  </if>
                  <if test=" DLV_CMPL_YN == '30' ">
                  AND T1.ODR_STATS_CD = 'D31'
                  </if>
                  <if test=" DLV_CMPL_YN == '40' ">
                  AND ('D31' > T1.ODR_STATS_CD OR T1.ODR_STATS_CD IN ('X01','X02'))
                  </if>
                  ORDER BY T1.ODR_NO,T1.ODR_ITM_NO
                  OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
            )       T1
            LEFT JOIN
            TB_PR_MNFR_INFO   T11
            ON   T11.CO_CD   = T1.CO_CD
            AND  T11.MNFR_NO = T1.MNFR_NO
            LEFT JOIN
            TB_PR_MRO_PRD_CLSF_INFO     T12
            ON   T12.CO_CD          = T1.CO_CD
            AND  T12.MRO_PRD_CLCD   = T1.MRO_PRD_CLCD
            LEFT JOIN
            TB_CC_DEPT_BASIS        T13
            ON  T13.CO_CD   = T1.CO_CD
            AND T13.DEPT_ID = T1.DEPT_ID
            LEFT JOIN
            TB_CC_MBR_BASIS         T14
            ON  T14.CO_CD   = T1.CO_CD
            AND T14.MBR_ID = T1.ODRPSN_ID
            LEFT JOIN
            TB_CO_COM_CD_DTL    T51
            ON  T51.LANG_CD = #{LANG_CD}
            AND T51.COM_CLSF_CD = 'ODR_STATS_CD'
            AND T51.COM_DTL_CD = T1.ODR_STATS_CD
            LEFT JOIN
            TB_CO_COM_CD_DTL    T52
            ON  T52.LANG_CD = #{LANG_CD}
            AND T52.COM_CLSF_CD = 'CHN_SPR_CD'
            AND T52.COM_DTL_CD = T1.CHN_SPR_CD
            LEFT JOIN
            TB_CO_COM_CD_DTL    T53
            ON  T53.LANG_CD = #{LANG_CD}
            AND T53.COM_CLSF_CD = 'DLV_FORM_SPR_CD'
            AND T53.COM_DTL_CD = T1.DLV_FORM_SPR_CD
            LEFT JOIN
            TB_CO_COM_CD_DTL    T54
            ON  T54.LANG_CD = #{LANG_CD}
            AND T54.COM_CLSF_CD = 'STL_MEAN_CD'
            AND T54.COM_DTL_CD = T1.STL_MEAN_CD
            LEFT JOIN
            TB_CO_COM_CD_DTL    T55
            ON  T55.LANG_CD = #{LANG_CD}
            AND T55.COM_CLSF_CD = 'CATG_KILR_CD'
            AND T55.COM_DTL_CD = T1.CATG_KILR_CD
            LEFT JOIN
            TB_CO_COM_CD_DTL    T61
            ON  T61.LANG_CD = #{LANG_CD}
            AND T61.COM_CLSF_CD = 'ODR_CRT_TP_CD'
            AND T61.COM_DTL_CD = T1.ODR_CRT_TP_CD
            LEFT JOIN
            TB_CO_COM_CD_DTL    T62
            ON  T62.LANG_CD = #{LANG_CD}
            AND T62.COM_CLSF_CD = 'NRML_RTNGDS_SPR_CD'
            AND T62.COM_DTL_CD = T1.NRML_RTNGDS_SPR_CD
            LEFT JOIN
            TB_CO_COM_CD_DTL    T63
            ON  T63.LANG_CD = #{LANG_CD}
            AND T63.COM_CLSF_CD = 'TXTN_TP_CD'
            AND T63.COM_DTL_CD = T1.TXTN_TP_CD
            LEFT JOIN
            TB_CO_COM_CD_DTL        T64
            ON   T64.LANG_CD = #{LANG_CD}
            AND  T64.COM_CLSF_CD = 'SALSPRC_CAL_BSS_CD'
            AND  T64.COM_DTL_CD = T1.COND_PRC_DECI_CD
            LEFT JOIN
            TB_CP_CPRTCP_BASIS      T65
            ON   T65.CO_CD  = T1.CO_CD
            AND  T65.CPRTCP_ID = T1.CPRTCP_ID
            LEFT JOIN
            TB_CO_MBR_OPRTR_INFO    T66
            ON   T66.CO_CD   = T1.CO_CD
            AND  T66.OPRTR_ID = T1.SALS_CHRPSN_ID
            LEFT JOIN
            TB_CO_MBR_OPRTR_INFO    T67
            ON   T67.CO_CD   = T1.CO_CD
            AND  T67.OPRTR_ID = T1.SVC_CHRPSN_ID
            LEFT JOIN
            TB_CO_MBR_OPRTR_INFO    T68
            ON  T68.CO_CD   = T1.CO_CD
            AND T68.OPRTR_ID = T1.PURG_CHRPSN_ID
            LEFT JOIN
            TB_CO_MBR_OPRTR_INFO    T69
            ON  T69.CO_CD   = T1.CO_CD
            AND T69.OPRTR_ID = T1.MD_OPRTR_ID
            LEFT JOIN
            TB_CO_COM_CD_DTL    T70
            ON  T70.LANG_CD = #{LANG_CD}
            AND T70.COM_CLSF_CD = 'ODR_EXCEPT_KND_CD'
            AND T70.COM_DTL_CD = T1.ODR_EXCEPT_KND_CD

    </select>

    <select id="selectOrderCount" parameterType="HashMap" resultType="int">
        /* com.ssp.bo.od.orderList.selectOrderCount 주문목록 카운트 */
        WITH BASE_T AS ( /*SSP-2582_성진우_주문조회화면속도개선*/
        SELECT <choose>
                      <when test=' ODR_NO > 0 '>
                      /*+ LEADING(T22 T2) USE_NL(T22 T2 T1) INDEX(T2 TB_OD_ODR_DTL_IX02)*/
                      </when>
                      <otherwise>
                       /*+ materialize */
                      </otherwise>
                 </choose>                 
                T1.CO_CD,
                T1.CHN_SPR_CD,
                T2.CATG_KILR_CD,
                T1.BZPLC_ID,                                /* 사업장ID */
                T2.ODR_STATS_CD,
                T2.ODR_NO,                                  /* 주문번호 */
                T2.ODR_ITM_NO,                              /* 주문항목번호 */
                T2.MNFR_NO,                                 /* 제조사번호 */
                T2.PRD_ID,                                  /* 상품ID */
                T2.REPR_SPEC,                               /* 대표규격 */
                T2.SSP_REPR_ATTR,                           /* SSP대표규격 */
                T2.ODR_QTY,                                 /* 주문수량 */
                T2.SELL_UNIT_CD,                            /* 판매단위코드 */
                T2.VAT_AMT,                                 /* 부가세금액 */
                T2.SALSPRC,                                 /* 판매가 */
                T2.SALE_AMT,                                /* 매출금액 */
                T2.DLV_FORM_SPR_CD,/* 배송형태구분코드 */
                T1.OPR_UNIT_ID,                             /* 운영단위ID */
                T1.DEPT_ID,                                 /* 부서ID */
                T1.ODRPSN_ID,                               /* 주문자ID */
                T1.STL_MEAN_CD,  /* 결제수단코드 */
                T2.RCVR_NM,                                  /* 수령인명 */
                T2.GDOC_NO,
                T2.SALE_CLOS_CD,
                T2.CUST_PURG_ODR_NO,
                T1.CUST_SPR_CD,
                T1.SALS_CHR_CD,
                T1.SALS_TEAM_CD,
                T1.NRML_RTNGDS_SPR_CD,
                T2.GI_PLNT_ID,
                T2.GO_PLNT_ID,
                T2.SALE_ADJ_STATS_CD,
                T2.ODR_TMP_LOCK_CD,
                T2.ACCT_ID,
                T2.COST_TRNSF_DEPT_ID,
                T2.ODR_DCN_DTM,
                T2.QCK_DLV_YN,
                T1.ODR_CRT_TP_CD
        FROM    TB_OD_ODR_MST T1                            /* 주문마스터 */
                JOIN
                TB_OD_ODR_DTL T2                        /* 주문상세 */
                ON   T1.CO_CD    = T2.CO_CD         /* 회사코드 */
                AND  T1.BZPLC_ID = T2.BZPLC_ID      /* 사업장ID */
                AND  T1.ODR_NO   = T2.ODR_NO        /* 주문번호 */
               <if test=" OPR_UNIT_ID > 0 ">
               JOIN
               TB_OD_ODR_INQ_TGT_DTLS   T21
               ON  T21.SES_ID = #{SES_ID}
               AND T21.INQ_COND_DTLS = #{INQ_COND_DTLS}
               AND T21.COL_ITM = 'OPR_UNIT_ID'
               AND T21.COND_DATA_VAL = T1.OPR_UNIT_ID
               </if>
               <if test=" ODR_NO > 0 ">
               JOIN
               TB_OD_ODR_INQ_TGT_DTLS   T22
               ON  T22.SES_ID = #{SES_ID}
               AND T22.INQ_COND_DTLS = #{INQ_COND_DTLS}
               AND T22.COL_ITM = 'ODR_NO'
               AND REGEXP_SUBSTR(T22.COND_DATA_VAL,'[^-]+',1,1) = T2.ODR_NO
               AND (CASE WHEN TRIM(REGEXP_SUBSTR(T22.COND_DATA_VAL,'[^-]+',1,2)) IS NULL OR
                             TRIM(REGEXP_SUBSTR(T22.COND_DATA_VAL,'[^-]+',1,2)) = '' THEN
                             T2.ODR_ITM_NO ELSE TO_NUMBER(TRIM(REGEXP_SUBSTR(T22.COND_DATA_VAL,'[^-]+',1,2))) END) = T2.ODR_ITM_NO
               </if>
               <if test=" INQ_PRD == '10' ">
                    AND  T2.ODR_DCN_DTM BETWEEN TO_DATE(#{FROM_DT} || '000000','YYYYMMDDHH24MISS') AND TO_DATE(#{TO_DT} || '235959','YYYYMMDDHH24MISS')
               </if>
        WHERE   1 = 1
          AND  T1.CO_CD = #{CO_CD}
        )
       SELECT  COUNT(*)
        FROM    (
                SELECT  T1.ODR_NO,                                  /* 주문번호 */
                        T1.ODR_ITM_NO                              /* 주문항목번호 */
                FROM    BASE_T      T1
                        LEFT JOIN
                        TB_PR_MRO_PRD_INFO T3               /* MRO상품정보 */
                        ON   T3.CO_CD   = T1.CO_CD          /* 회사코드 */
                        AND  T3.PRD_ID  = T1.PRD_ID         /* 상품ID */
                        LEFT JOIN
                        TB_PR_PRD_INFO T4                   /* 상품정보 */
                        ON   T4.CO_CD   = T1.CO_CD          /* 회사코드 */
                        AND  T4.PRD_ID  = T1.PRD_ID         /* 상품ID */
                        <if test=" INQ_PRD == '00' or INQ_PRD == '10' ">
                        LEFT JOIN
                        </if>
                        <if test=" INQ_PRD != '00' and INQ_PRD != '10' ">
                        JOIN
                        </if>
                        TB_DL_ODR_ACP_DLV_PROC T5           /* 주문접수배송처리 */
                        ON   T5.CO_CD    = T1.CO_CD         /* 회사코드 */
                        AND  T5.BZPLC_ID = T1.BZPLC_ID      /* 사업장ID */
                        AND  T5.ODR_NO   = T1.ODR_NO        /* 주문번호 */
                        AND  T5.ODR_ITM_NO = T1.ODR_ITM_NO  /* 주문항목번호 */
                        <if test=" INQ_PRD == '20' ">
                        AND  T5.SELL_DOC_CRT_DTM BETWEEN TO_DATE(#{FROM_DT} || '000000','YYYYMMDDHH24MISS') AND TO_DATE(#{TO_DT} || '235959','YYYYMMDDHH24MISS')
                        </if>
                        <if test=" INQ_PRD == '30' ">
                        AND  T5.DLV_CMPL_DTM BETWEEN TO_DATE(#{FROM_DT} || '000000','YYYYMMDDHH24MISS') AND TO_DATE(#{TO_DT} || '235959','YYYYMMDDHH24MISS')
                        </if>
                        <if test=" INQ_PRD == '40' ">
                        AND  T5.INTL_ORD_DCN_DTM BETWEEN TO_DATE(#{FROM_DT} || '000000','YYYYMMDDHH24MISS') AND TO_DATE(#{TO_DT} || '235959','YYYYMMDDHH24MISS')
                        </if>
                        <if test="ORD_ERR != null and !ORD_ERR.equals('') ">
                        JOIN
                        TB_DL_SMLN_ORD_INFO T6          /* 시뮬레이션발주정보 */
                        ON   T6.CO_CD    = T1.CO_CD         /* 회사코드 */
                        AND  T6.BZPLC_ID = T1.BZPLC_ID      /* 사업장ID */
                        AND  T6.ODR_NO   = T1.ODR_NO        /* 주문번호 */
                        AND  T6.ODR_ITM_NO = T1.ODR_ITM_NO  /* 주문항목번호 */
                        AND  (CASE WHEN #{ORD_ERR} IS NULL THEN '1'
                                   WHEN #{ORD_ERR} = '20' AND T6.ORD_REQ_STATS_CD = '2' THEN '1'
                                   WHEN #{ORD_ERR} != '20' AND T6.ORD_REQ_STATS_CD = '1' THEN '1'
                                   ELSE '0' END) = '1'
                        </if>
                        JOIN
                        TB_CC_OPR_UNIT_BASIS T7             /* 운영단위기본 */
                        ON   T7.CO_CD    = T1.CO_CD         /* 회사코드 */
                        AND  T7.BZPLC_ID = T1.BZPLC_ID      /* 사업장ID */
                        AND  T7.OPR_UNIT_ID   = T1.OPR_UNIT_ID  /* 운영단위 */
                        <if test="CNSG_CPRTCP_ID != null and !CNSG_CPRTCP_ID.equals('') ">
                        JOIN
                        TB_OD_ODR_DTL   T8
                        ON   T8.CO_CD    = T1.CO_CD         /* 회사코드 */
                        AND  T8.BZPLC_ID = T1.BZPLC_ID      /* 사업장ID */
                        AND  T8.ODR_NO   = T1.ODR_NO        /* 주문번호 */
                        AND  T8.ODR_ITM_NO = T1.ODR_ITM_NO  /* 주문항목번호 */
                        AND  T8.CPRTCP_ID LIKE  #{CNSG_CPRTCP_ID} || '%'        /* 23.협력사 ID */
                        </if>
                        <if test=" ODR_STATS_CD > 0 ">
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   T23
                        ON  T23.SES_ID = #{SES_ID}
                        AND T23.INQ_COND_DTLS = #{INQ_COND_DTLS}
                        AND T23.COL_ITM = 'ODR_STATS_CD'
                        AND T23.COND_DATA_VAL = T1.ODR_STATS_CD
                        </if>
                        <if test=" PRD_ID > 0 ">
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   T24
                        ON  T24.SES_ID = #{SES_ID}
                        AND T24.INQ_COND_DTLS = #{INQ_COND_DTLS}
                        AND T24.COL_ITM = 'PRD_ID'
                        AND LPAD(T24.COND_DATA_VAL,18,'0') = T1.PRD_ID
                        </if>
                        <if test=" DEPT_ID > 0 ">
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   T25
                        ON  T25.SES_ID = #{SES_ID}
                        AND T25.INQ_COND_DTLS = #{INQ_COND_DTLS}
                        AND T25.COL_ITM = 'DEPT_ID'
                        AND T25.COND_DATA_VAL = T1.DEPT_ID
                        </if>
                        <if test=" GDOC_NO > 0 ">
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   T26
                        ON  T26.SES_ID = #{SES_ID}
                        AND T26.INQ_COND_DTLS = #{INQ_COND_DTLS}
                        AND T26.COL_ITM = 'GDOC_NO'
                        AND T26.COND_DATA_VAL = T1.GDOC_NO
                        </if>
                        <if test=" ODRPSN_ID > 0 ">
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   T27
                        ON  T27.SES_ID = #{SES_ID}
                        AND T27.INQ_COND_DTLS = #{INQ_COND_DTLS}
                        AND T27.COL_ITM = 'ODRPSN_ID'
                        AND T27.COND_DATA_VAL = T1.ODRPSN_ID
                        </if>
                        <if test=" CUST_PURG_ODR_NO > 0 ">
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   T28
                        ON  T28.SES_ID = #{SES_ID}
                        AND T28.INQ_COND_DTLS = #{INQ_COND_DTLS}
                        AND T28.COL_ITM = 'CUST_PURG_ODR_NO'
                        AND T28.COND_DATA_VAL = T1.CUST_PURG_ODR_NO
                        </if>
                        <if test=" ORD_NO > 0 ">
                        JOIN
                        TB_DL_ORD_ITM_DTL   T29              /* 발주품목상세 */
                        ON   T29.CO_CD    = T1.CO_CD         /* 회사코드 */
                        AND  T29.BZPLC_ID = T1.BZPLC_ID      /* 사업장ID */
                        AND  T29.ODR_NO   = T1.ODR_NO        /* 주문번호 */
                        AND  T29.ODR_ITM_NO = T1.ODR_ITM_NO  /* 주문항목번호 */
                        JOIN
                        TB_OD_ODR_INQ_TGT_DTLS   T30
                        ON  T30.SES_ID = #{SES_ID}
                        AND T30.INQ_COND_DTLS = #{INQ_COND_DTLS}
                        AND T30.COL_ITM = 'ORD_NO'
                        AND T30.COND_DATA_VAL = T29.ORD_NO
                        </if>
                        <if test=" MD_TEAM_CD != null or MD_OPRTR_ID != null">
                        JOIN
                        (
                        SELECT  B.CO_CD,
                                B.PRD_CLCD
                        FROM    TB_CO_MBR_OPRTR_INFO A          /* 회원운영자정보 */
                                JOIN
                                TB_PR_PRD_CLSF_CHRPSN_INFO B    /* 상품분류담당자정보, MD담당자 */
                                ON  B.CO_CD = A.CO_CD
                                AND B.PRD_CLSF_CHRPSN_ID = A.OPRTR_ID
                                JOIN
                                TB_CO_MBR_OPRTR_ORG_INFO  C     /* 회원운영자조직정보 */
                                ON  C.CO_CD = A.CO_CD
                                AND C.ORG_CD = A.ORG_CD
                                AND C.ORG_CD LIKE #{MD_TEAM_CD} || '%'
                        WHERE   B.PRD_CLSF_CHRPSN_SPR_CD = '10'
                        AND     B.PRD_CLSF_CHRPSN_TP_CD = '20'
                        AND     B.PRD_CLSF_CHRPSN_USEYN = 'Y'
                        AND     B.MNFR_NO = '*'
                        AND     A.OPRTR_ID LIKE #{MD_OPRTR_ID} || '%'
                        ) T31
                        ON  T31.CO_CD = T4.CO_CD
                        AND T31.PRD_CLCD = T4.PRD_CLCD
                        </if>
                        LEFT JOIN
                        TB_DL_ORD_ITM_SO_DTL       T41
                        ON   T41.CO_CD    = T1.CO_CD         /* 회사코드 */
                        AND  T41.BZPLC_ID = T1.BZPLC_ID      /* 사업장ID */
                        AND  T41.ODR_NO   = T1.ODR_NO        /* 주문번호 */
                        AND  T41.ODR_ITM_NO = T1.ODR_ITM_NO  /* 주문항목번호 */
                        LEFT JOIN
                        TB_AD_GI_DCN_PROC   T42
                        ON  T42.CO_CD        = T1.CO_CD
                        AND T42.BZPLC_ID     = T1.BZPLC_ID
                        AND T42.ODR_NO       = T1.ODR_NO
                        AND T42.ODR_ITM_NO   = T1.ODR_ITM_NO
                        LEFT JOIN
                        (
                        SELECT  B.CO_CD,
                                B.PRD_CLCD,
                                A.OPRTR_ID      MD_OPRTR_ID
                        FROM    TB_CO_MBR_OPRTR_INFO A          /* 회원운영자정보 */
                                JOIN
                                TB_PR_PRD_CLSF_CHRPSN_INFO B    /* 상품분류담당자정보, MD담당자 */
                                ON  B.CO_CD = A.CO_CD
                                AND B.PRD_CLSF_CHRPSN_ID = A.OPRTR_ID
                        WHERE   B.PRD_CLSF_CHRPSN_SPR_CD = '10'
                        AND     B.PRD_CLSF_CHRPSN_TP_CD = '20'
                        AND     B.PRD_CLSF_CHRPSN_USEYN = 'Y'
                        AND     B.MNFR_NO = '*'
                        ) T44
                        ON  T44.CO_CD = T4.CO_CD
                        AND T44.PRD_CLCD = T4.PRD_CLCD
                        OUTER APPLY
                        (
                            SELECT  *
                            FROM    TB_DL_ODR_DLV_PROC_DTLS T45
                            WHERE   T45.CO_CD = T1.CO_CD
                            AND     T45.BZPLC_ID = T1.BZPLC_ID
                            AND     T45.ODR_NO = T1.ODR_NO
                            AND     T45.ODR_ITM_NO = T1.ODR_ITM_NO
                            --AND     ROWNUM = 1
                            order  by T45.REG_DTM DESC
                            fetch first 1 rows only
                        ) T45
                        LEFT JOIN
                        TB_CO_COM_CD_DTL    T46
                        ON   T46.LANG_CD = #{LANG_CD}
                        AND  T46.COM_CLSF_CD = 'SSP_DLV_MTD_CD'
                        AND  T46.COM_DTL_CD = T45.SSP_DLV_MTD_CD
                        LEFT JOIN
                        TB_VO_VOC_EXCEPT_PROC   T50
                        ON  T50.CO_CD   = T1.CO_CD
                        AND T50.EXCEPT_PROC_ODR_NO = T1.ODR_NO
                        AND T50.EXCEPT_PROC_ODR_ITM_NO = T1.ODR_ITM_NO
                WHERE   1 = 1
                  <choose>
                      <when test='CUST_TP_OR_CRT_TP == "CUST_SPR_CD"'>
                      AND T1.CUST_SPR_CD LIKE #{CUST_SPR_CD} || '%'   /* 고객구분코드.고객 유형 */
                      </when>
                      <otherwise>
                      AND T1.ODR_CRT_TP_CD LIKE #{CUST_SPR_CD} || '%'   /* 주문생성유형코드.오더 유형 */
                      </otherwise>
                  </choose>
                  <if test="CAT_KILLER != null and !CAT_KILLER.equals('') ">
                        AND T1.CATG_KILR_CD LIKE #{CAT_KILLER} || '%'
                  </if>
                  <if test="SVC_TEAM_CD != null and !SVC_TEAM_CD.equals('') ">
                        AND  T7.SVC_TEAM_CD = #{SVC_TEAM_CD}                              /* 12.서비스팀 */
                  </if>
                  <if test="SALS_CHR_CD != null and !SALS_CHR_CD.equals('') ">
                        AND  T1.SALS_CHR_CD = #{SALS_CHR_CD}                              /* 13.영업담당 */
                  </if>
                  <if test="SALS_TEAM_CD != null and !SALS_TEAM_CD.equals('') ">
                        AND  T1.SALS_TEAM_CD = #{SALS_TEAM_CD}                           /* 14.영업팀 */
                  </if>
                  <if test="DLV_FORM_SPR_CD != null and !DLV_FORM_SPR_CD.equals('') ">
                        AND  T1.DLV_FORM_SPR_CD = #{DLV_FORM_SPR_CD}            /* 16.배송형태 */
                  </if>
                  <if test="BZPLC_ID != null and !BZPLC_ID.equals('') ">
                        AND  T1.BZPLC_ID = #{BZPLC_ID}                                    /* 17.사업장  */
                  </if>
                  <if test="NRML_RTNGDS_SPR_CD != null and !NRML_RTNGDS_SPR_CD.equals('') ">
                        AND  T1.NRML_RTNGDS_SPR_CD = #{NRML_RTNGDS_SPR_CD}               /* 27.정상반품구분코드 */
                  </if>
                  <if test="GI_PLNT_ID != null and !GI_PLNT_ID.equals('') ">
                        AND  T1.GI_PLNT_ID = #{GI_PLNT_ID}                    /* 20.입고 플랜트 */
                  </if>
                  <if test="GO_PLNT_ID != null and !GO_PLNT_ID.equals('') ">
                        AND  T1.GO_PLNT_ID = #{GO_PLNT_ID}                    /* 21.출고 플랜트 */
                  </if>
                  <if test="SALE_ADJ_STATS_CD != null and !SALE_ADJ_STATS_CD.equals('') ">
                        AND  T1.SALE_ADJ_STATS_CD = #{SALE_ADJ_STATS_CD}        /* 29.정산상태 */
                  </if>
                  <if test="ODR_TMP_LOCK_CD != null and !ODR_TMP_LOCK_CD.equals('') ">
                        AND  T1.ODR_TMP_LOCK_CD = #{ODR_TMP_LOCK_CD}            /* 22.주문 Block */
                  </if>
                  <if test="ACCT_ID != null and !ACCT_ID.equals('') ">
                        AND  T1.ACCT_ID = #{ACCT_ID}                          /* 25.계정ID 조회 */
                  </if>
                  <if test="COST_TRNSF_DEPT_ID != null and !COST_TRNSF_DEPT_ID.equals('') ">
                        AND  T1.COST_TRNSF_DEPT_ID = #{COST_TRNSF_DEPT_ID}    /* 26.비용이체부서 */
                  </if>
                 <if test="SALE_CLOS_CD != null and SALE_CLOS_CD.equals('2') ">
                       NVL(T1.SALE_CLOS_CD,'00') IN ('C1','C2')
                  </if>
                  <if test="SALE_CLOS_CD != null and SALE_CLOS_CD.equals('3') ">
                       NVL(T1.SALE_CLOS_CD,'00') NOT IN ('C1','C2')
                  </if>
                  <if test="QCK_DLV_YN != null and !QCK_DLV_YN.equals('') ">
                        AND  NVL(T1.QCK_DLV_YN,'N') = #{QCK_DLV_YN}                       /* 33.빠른배송여부 */
                  </if>
                  <if test="STL_MEAN_CD != null and !STL_MEAN_CD.equals('') ">
                        AND  T1.STL_MEAN_CD = #{STL_MEAN_CD}                 /* 30.결제수단 */
                  </if>
                  <if test=" DLV_CMPL_YN == '20' ">
                  AND (T1.ODR_STATS_CD = 'Z10' OR T1.ODR_STATS_CD LIKE 'E%')
                  </if>
                  <if test=" DLV_CMPL_YN == '30' ">
                  AND T1.ODR_STATS_CD = 'D31'
                  </if>
                  <if test=" DLV_CMPL_YN == '40' ">
                  AND ('D31' > T1.ODR_STATS_CD OR T1.ODR_STATS_CD IN ('X01','X02'))
                  </if>
            )       T1
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문목록 상세(상단)정보 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-17
        ****************************************************************************** -->
    <select id="selectOderDetailList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectOderDetailList */
        SELECT
                CASE WHEN T1.ODR_NO IS NOT NULL OR T1.ODR_ITM_NO IS NOT NULL
                         THEN T1.ODR_NO || '-' || T1.ODR_ITM_NO END     JNT_ODR_ITM_NO,   /* 주문품목번호 */
                T1.ODR_NO, --주문번호
                T1.ODR_ITM_NO, --주문항목번호
                T1.ODR_STATS_CD, --주문상태코드
                CASE WHEN T1.ODR_STATS_CD IS NOT NULL OR T10.COM_DTL_CD_NM IS NOT NULL
                         THEN T1.ODR_STATS_CD || ' | ' || T10.COM_USR_DEFN_NM_2 END     ODR_STATS_CD_NM,    /* 주문상태 */
                T1.CHN_SPR_CD, --채널구분코드
                CASE WHEN T1.CHN_SPR_CD IS NOT NULL OR T11.COM_DTL_CD_NM IS NOT NULL
                         THEN T1.CHN_SPR_CD || ' | ' || T11.COM_DTL_CD_NM END       CHN_SPR_CD_NM,      /* 채널구분 */
                T1.ODR_CRT_TP_CD, --주문생성유형코드
                CASE WHEN T1.ODR_CRT_TP_CD IS NOT NULL OR T12.COM_DTL_CD_NM IS NOT NULL
                         THEN T1.ODR_CRT_TP_CD || ' | ' || T12.COM_DTL_CD_NM END    ODR_CRT_TP_CD_NM,   /* 주문생성유형 */
                T1.DLV_FORM_SPR_CD, --배송형태구분코드
                CASE WHEN T1.DLV_FORM_SPR_CD IS NOT NULL OR T13.COM_DTL_CD_NM IS NOT NULL
                         THEN T1.DLV_FORM_SPR_CD || ' | ' || T13.COM_DTL_CD_NM END  DLV_FORM_SPR_CD_NM, /* 배송형태구분 */
                CASE WHEN T1.ORD_NO IS NOT NULL OR T1.ORD_ITM_NO IS NOT NULL
                         THEN T1.ORD_NO || '-' || T1.ORD_ITM_NO END     JNT_ORD_ITM_NO,             /* 발주품목번호 */
                T1.ORD_NO, --발주번호
                T1.ORD_ITM_NO, --발주품목번호
                T1.SALS_TEAM_CD, --영업팀코드
                T4.ORG_NM,       --영업팀명
                CASE WHEN T1.SALS_TEAM_CD IS NOT NULL OR T4.ORG_NM IS NOT NULL
                         THEN T1.SALS_TEAM_CD || ' | ' || T4.ORG_NM END     SALS_TEAM_CD_NM,        /* 영업팀 */
                T1.SALS_CHR_CD, --영업담당코드
                T6.OPRTR_NM SALS_CHR_NM, --영업담당명
                CASE WHEN T1.SALS_CHR_CD IS NOT NULL OR T6.OPRTR_NM IS NOT NULL
                         THEN T1.SALS_CHR_CD || ' | ' || T6.OPRTR_NM END     SALS_CHR_CD_NM,     /* 영업담당자 */
                T1.SVC_CHRPSN_ID, --서비스담당자ID
                T5.OPRTR_NM,    --서비스담당자명
                CASE WHEN T1.SVC_CHRPSN_ID IS NOT NULL OR T5.OPRTR_NM IS NOT NULL
                         THEN T1.SVC_CHRPSN_ID || ' | ' || T5.OPRTR_NM END      SVC_CHRPSN_ID_NM,   /* 서비스담당자 */
                T1.PURG_CHRPSN_ID, --구매담당자ID
                T7.OPRTR_NM AS OPRTR_NM_01,    --구매담당자명
                CASE WHEN T1.PURG_CHRPSN_ID IS NOT NULL OR T7.OPRTR_NM IS NOT NULL
                         THEN T1.PURG_CHRPSN_ID || ' | ' || T7.OPRTR_NM END     PURG_CHRPSN_ID_NM,  /* 구매담당자 */
                T1.OPR_CHRPSN_ID, --운영담당자ID
                T8.OPRTR_NM AS OPRTR_NM_02,    --구매담당자명
                CASE WHEN T1.OPR_CHRPSN_ID IS NOT NULL OR T8.OPRTR_NM IS NOT NULL
                         THEN T1.OPR_CHRPSN_ID || ' | ' || T8.OPRTR_NM END      OPR_CHRPSN_ID_NM,   /* 운영담당자 */
                T1.MD_OPRTR_ID, --MD담당자ID
                T20.OPRTR_NM AS MD_OPRTR_NM,    --MD담당자명
                CASE WHEN T1.MD_OPRTR_ID IS NOT NULL OR T20.OPRTR_NM IS NOT NULL
                         THEN T1.MD_OPRTR_ID || ' | ' || T20.OPRTR_NM END     MD_CHRPSN_ID_NM,  /* MD담당자 */
                T1.DLGTE_YN, --주문대행여부
                --T14.COM_DTL_CD_NM DLGTE_YN_NM,
                CASE WHEN T1.DLGTE_YN IS NOT NULL THEN T1.DLGTE_YN || ' | ' || T14.COM_DTL_CD_NM END JNT_DLGTE_YN,
                --CASE WHEN T1.ODR_DLGTE_ID IS NOT NULL THEN T1.ODR_DLGTE_ID ELSE T1.SRVON_ODR_DLGTE_ID END ODR_DLGTE_ID, --주문대행자ID
                T1.SRVON_ODR_DLGTE_ID   ODR_DLGTE_ID, --서브원주문대행자ID
                --CASE WHEN T1.ODR_DLGTE_ID IS NOT NULL THEN T2.MBR_NM ELSE T3.OPRTR_NM END ODR_DLGTE_NM, --주문대행자명
                T3.OPRTR_NM     ODR_DLGTE_NM, --서브원주문대행자명
                CASE WHEN T1.DLGTE_YN = 'Y' THEN T1.ODR_DCN_DTM ELSE NULL END    ODR_DCN_DTM --대행일시
        FROM    (
                SELECT  T1.CO_CD,
                        T2.ODR_NO, --주문번호
                        T2.ODR_ITM_NO, --주문항목번호
                        T2.ODR_STATS_CD, --주문상태코드
                        T1.CHN_SPR_CD, --채널구분코드
                        T1.ODR_CRT_TP_CD, --주문생성유형코드
                        T2.DLV_FORM_SPR_CD, --배송형태구분코드
                        T8.ORD_NO, --발주번호
                        T8.ORD_ITM_NO, --발주품목번호
                        T1.SALS_TEAM_CD, --영업팀코드
                        T2.SALS_CHRPSN_ID   SALS_CHR_CD, --영업담당코드
                        T2.SVC_CHRPSN_ID, --서비스담당자ID
                        T2.PURG_CHRPSN_ID, --구매담당자ID
                        T2.OPR_CHRPSN_ID, --운영담당자ID
                        CASE WHEN T1.ODR_DLGTE_ID IS NULL AND T1.SRVON_ODR_DLGTE_ID IS NULL THEN 'N' ELSE 'Y' END DLGTE_YN, --주문대행여부
                        T1.ODR_DLGTE_ID, --주문대행자ID
                        T1.SRVON_ODR_DLGTE_ID, --서브원주문대행자ID
                        T2.ODR_DCN_DTM, --주문확정일시
                        T44.MD_OPRTR_ID
                FROM    TB_OD_ODR_MST T1 --주문마스터
                        JOIN
                        TB_OD_ODR_DTL T2 --주문상세
                        ON   T1.CO_CD    = T2.CO_CD     --회사코드
                        AND  T1.BZPLC_ID = T2.BZPLC_ID  --사업장ID
                        AND  T1.ODR_NO   = T2.ODR_NO    --주문번호
                        LEFT JOIN
                        TB_DL_ORD_ITM_DTL   T8 --발주품목상세
                        ON   T8.CO_CD    = T2.CO_CD     --회사코드
                        AND  T8.BZPLC_ID = T2.BZPLC_ID  --사업장ID
                        AND  T8.ODR_NO   = T2.ODR_NO    --주문번호
                        AND  T8.ODR_ITM_NO = T2.ODR_ITM_NO --주문항목번호
                        LEFT JOIN
                        (
                        SELECT  D.CO_CD,
                                D.PRD_ID,
                                A.OPRTR_ID      MD_OPRTR_ID
                        FROM    TB_CO_MBR_OPRTR_INFO A          /* 회원운영자정보 */
                                JOIN
                                TB_PR_PRD_CLSF_CHRPSN_INFO B    /* 상품분류담당자정보, MD담당자 */
                                ON  B.CO_CD = A.CO_CD
                                AND B.PRD_CLSF_CHRPSN_ID = A.OPRTR_ID
                                JOIN
                                TB_PR_PRD_INFO D
                                ON   B.CO_CD = D.CO_CD
                                AND  B.PRD_CLCD = D.PRD_CLCD
                        WHERE   B.PRD_CLSF_CHRPSN_SPR_CD = '10'
                        AND     B.PRD_CLSF_CHRPSN_TP_CD = '20'
                        AND     B.PRD_CLSF_CHRPSN_USEYN = 'Y'
                        AND     B.MNFR_NO = '*'
                        ) T44
                        ON  T44.CO_CD = T2.CO_CD
                        AND T44.PRD_ID = T2.PRD_ID
                WHERE   T2.CO_CD = #{CO_CD}
                  AND   T2.BZPLC_ID = #{BZPLC_ID}
                  AND   T2.ODR_NO   = #{ODR_NO}
                )       T1
                LEFT JOIN
                TB_CC_MBR_BASIS         T2
                ON  T2.CO_CD   = T1.CO_CD
                AND T2.MBR_ID = T1.ODR_DLGTE_ID
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO    T3
                ON  T3.CO_CD   = T1.CO_CD
                AND T3.OPRTR_ID = T1.SRVON_ODR_DLGTE_ID
                LEFT JOIN
                TB_CO_MBR_OPRTR_ORG_INFO T4
                ON  T4.CO_CD  = T1.CO_CD
                AND T4.SALS_TEAM_CD = T1.SALS_TEAM_CD
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO    T5
                ON  T5.CO_CD   = T1.CO_CD
                AND T5.OPRTR_ID = T1.SVC_CHRPSN_ID
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO    T6
                ON  T6.CO_CD   = T1.CO_CD
                AND T6.OPRTR_ID = T1.SALS_CHR_CD
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO    T7
                ON  T7.CO_CD   = T1.CO_CD
                AND T7.OPRTR_ID = T1.PURG_CHRPSN_ID
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO    T8
                ON  T8.CO_CD   = T1.CO_CD
                AND T8.OPRTR_ID = T1.OPR_CHRPSN_ID
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO    T20
                ON  T20.CO_CD   = T1.CO_CD
                AND T20.OPRTR_ID = T1.MD_OPRTR_ID
                LEFT JOIN
                TB_CO_COM_CD_DTL        T10
                ON   T10.LANG_CD = #{LANG_CD}
                AND  T10.COM_CLSF_CD = 'ODR_STATS_CD'
                AND  T10.COM_DTL_CD = T1.ODR_STATS_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL        T11
                ON   T11.LANG_CD = #{LANG_CD}
                AND  T11.COM_CLSF_CD = 'CHN_SPR_CD'
                AND  T11.COM_DTL_CD = T1.CHN_SPR_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL        T12
                ON   T12.LANG_CD = #{LANG_CD}
                AND  T12.COM_CLSF_CD = 'ODR_CRT_TP_CD'
                AND  T12.COM_DTL_CD = T1.ODR_CRT_TP_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL        T13
                ON   T13.LANG_CD = #{LANG_CD}
                AND  T13.COM_CLSF_CD = 'DLV_FORM_SPR_CD'
                AND  T13.COM_DTL_CD = T1.DLV_FORM_SPR_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL        T14
                ON  T14.LANG_CD = #{LANG_CD}
                AND T14.COM_CLSF_CD = 'MAND_YN'
                AND T14.COM_DTL_CD = T1.DLGTE_YN
                ORDER BY T1.ODR_NO,
                         T1.ODR_ITM_NO
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 고객정보 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-17
        ****************************************************************************** -->
    <select id="selectCustOderInfo" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectCustOderInfo */
        SELECT
                CASE WHEN T2.ODR_NO IS NOT NULL OR T2.ODR_ITM_NO IS NOT NULL
                         THEN T2.ODR_NO || '-' || T2.ODR_ITM_NO END     JNT_ODR_ITM_NO,             /* 주문품목번호 */
                T2.ODR_NO,                                                          /* 주문번호 */
                T2.ODR_ITM_NO,                                                      /* 주문항목번호 */
                T1.BZPLC_ID,                                                        /* 사업장ID */
                T3.BZPLC_NM,                                                        /* 사업장명 */
                CASE WHEN T1.BZPLC_ID IS NOT NULL OR T3.BZPLC_NM IS NOT NULL
                         THEN T1.BZPLC_ID || ' | ' || T3.BZPLC_NM END   BZPLC_CD_NM,                /* 사업장ID | 사업장명 */
                T1.OPR_UNIT_ID,                                                     /* 운영단위ID */
                T7.OPR_UNIT_NM,                                                     /* 운영단위명 */
                CASE WHEN T1.OPR_UNIT_ID IS NOT NULL OR T7.OPR_UNIT_NM IS NOT NULL
                         THEN T1.OPR_UNIT_ID || ' | ' || T7.OPR_UNIT_NM END     OPR_UNIT_ID_NM,     /* 운영단위ID | 운영단위명 */
                T1.DEPT_ID,                                                         /* 부서ID */
                T13.DEPT_NM,                                                        /* 부서명 */
                CASE WHEN T1.DEPT_ID IS NOT NULL OR T13.DEPT_NM IS NOT NULL
                         THEN T1.DEPT_ID || ' | ' || T13.DEPT_NM END        DEPT_ID_NM,             /* 부서ID | 부서명 */
                T1.ODRPSN_ID,                                                       /* 주문자ID */
                T14.MBR_NM,                                                         /* 주문자명 */
                CASE WHEN T1.ODRPSN_ID IS NOT NULL OR T14.MBR_NM IS NOT NULL
                         THEN T1.ODRPSN_ID || ' | ' || T14.MBR_NM END       ODRPSN_ID_NM,           /* 주문자ID | 주문자명 */
                T2.DLVPLC_ID,                                                       /* 배송지ID */
                T2.RCVR_NM,                                                         /* 수령인명 */
                CASE WHEN T2.DLVPLC_ID IS NOT NULL OR T2.RCVR_NM IS NOT NULL
                         THEN T2.DLVPLC_ID || ' | ' || T2.RCVR_NM END       DLVPLC_ID_RCVR_NM,      /* 배송지ID | 수령인명 */
                T2.ZPCD,                                                            /* 우편번호 */
                T2.DTL_ADDR,                                                        /* 상세주소 */
                T2.REPR_ADDR,                                                       /* 대표주소 */
                T2.COST_TRNSF_DEPT_ID,                                              /* 비용이체부서ID */
                T17.DEPT_NM  COST_TRNSF_DEPT_NM,                                    /* 비용이체부서명 */
                CASE WHEN T2.COST_TRNSF_DEPT_ID IS NOT NULL OR T17.DEPT_NM IS NOT NULL
                         THEN T2.COST_TRNSF_DEPT_ID || ' | ' || T17.DEPT_NM END     COST_TRNSF_DEPT_ID_NM, /* 비용이체부서ID | 비용이체부서명 */
                T2.ACCT_ID,                                                         /* 계정ID */
                T18.ACCT_NM,                                                        /* 계정명 */
                CASE WHEN T18.ACCT_CD IS NOT NULL OR T18.ACCT_NM IS NOT NULL
                         THEN T18.ACCT_CD || ' | ' || T18.ACCT_NM END       ACCT_ID_NM,             /* 계정CD | 계정명 */
                T13.CCO_DEPT_CD,                                                    /* 고객사부서코드 */
                T2.BLNG_DEPT_ID,                                                    /* 귀속부서ID */
                T19.DEPT_NM  BLNG_DEPT_NM,                                          /* 귀속부서명 */
                CASE WHEN T2.BLNG_DEPT_ID IS NOT NULL OR T19.DEPT_NM IS NOT NULL
                         THEN T2.BLNG_DEPT_ID || ' | ' || T19.DEPT_NM END   BLNG_DEPT_INFO,         /* 귀속부서ID | 귀속부서명 */
                T15.MEMO_CTS,                                                       /* 구매사유 */
                T16.MEMO_CTS AS ITM_MEMO_CTS,                                       /* 상품별구매사유 */
                --T20.ACCT_USE_YN,                                                    /* 계정사용여부 */
                --T20.COST_DEPT_CHG_PSB_YN                                            /* 비용부서변경가능여부 */
                CASE WHEN ACCT_USE_YN = 'Y' THEN CASE WHEN COST_DEPT_CHG_PSB_YN = 'Y' THEN '1' ELSE '2' END ELSE '3' END AS ACCT_SPR,
                T2.TEL_NO,                                                          /* 전화번호 */
                T2.HP_NO,                                                           /* 휴대폰번호 */
                T2.CUST_PURG_ODR_NO,                                                /* 고객구매주문번호 */
                T2.STOCK_NO,
                CASE WHEN T1.ODR_DLGTE_ID IS NOT NULL THEN T1.ODR_DLGTE_ID || ' | ' || T21.MBR_NM
                     ELSE ''    END JNT_ODR_DLGTE_ID_NM
        FROM    TB_OD_ODR_MST T1                    /* 주문마스터 */
                JOIN
                TB_OD_ODR_DTL T2                        /* 주문상세 */
                ON   T1.CO_CD    = T2.CO_CD             /* 회사코드 */
                AND  T1.BZPLC_ID = T2.BZPLC_ID          /* 사업장ID */
                AND  T1.ODR_NO   = T2.ODR_NO            /* 주문번호 */
                JOIN
                TB_CC_BZPLC_BASIS   T3
                ON   T3.CO_CD    = T1.CO_CD             /* 회사코드 */
                AND  T3.BZPLC_ID = T1.BZPLC_ID          /* 사업장ID */
                JOIN
                TB_CC_OPR_UNIT_BASIS T7                 /* 운영단위기본 */
                ON   T7.CO_CD    = T1.CO_CD             /* 회사코드 */
                AND  T7.BZPLC_ID = T1.BZPLC_ID          /* 사업장ID */
                AND  T7.OPR_UNIT_ID = T1.OPR_UNIT_ID    /* 운영단위 */
                JOIN
                TB_CC_DEPT_BASIS        T13
                ON  T13.CO_CD   = T1.CO_CD
                AND T13.DEPT_ID = T1.DEPT_ID
                JOIN
                TB_CC_MBR_BASIS         T14
                ON  T14.CO_CD   = T1.CO_CD
                AND T14.MBR_ID = T1.ODRPSN_ID
                LEFT JOIN
                TB_OD_ODR_MEMO_INFO     T15
                ON   T15.CO_CD    = T2.CO_CD            /* 회사코드 */
                AND  T15.BZPLC_ID = T2.BZPLC_ID         /* 사업장ID */
                AND  T15.ODR_NO   = T2.ODR_NO           /* 주문번호 */
                AND  T15.MEMO_CD = '01'
                LEFT JOIN
                TB_OD_ODR_MEMO_INFO     T16
                ON   T16.CO_CD    = T2.CO_CD            /* 회사코드 */
                AND  T16.BZPLC_ID = T2.BZPLC_ID         /* 사업장ID */
                AND  T16.ODR_NO   = T2.ODR_NO           /* 주문번호 */
                AND  T16.ODR_ITM_NO = T2.ODR_ITM_NO
                AND  T16.MEMO_CD = '15'
                LEFT JOIN
                TB_CC_DEPT_BASIS        T17
                ON  T17.CO_CD   = T2.CO_CD
                AND T17.DEPT_ID = T2.COST_TRNSF_DEPT_ID
                LEFT JOIN
                TB_CC_BGT_ACCT_BASIS    T18
                ON   T18.CO_CD    = T2.CO_CD            /* 회사코드 */
                AND  T18.BZPLC_ID = T2.BZPLC_ID         /* 사업장ID */
                AND  T18.ACCT_ID  = T2.ACCT_ID
                LEFT JOIN
                TB_CC_DEPT_BASIS        T19
                ON  T19.CO_CD   = T2.CO_CD
                AND T19.DEPT_ID = T2.BLNG_DEPT_ID
                LEFT JOIN
                VW_CC_OPR_UNIT_CTL_AUTH_INFO T20
                ON T20.CO_CD = T2.CO_CD
                AND T20.BZPLC_ID = T2.BZPLC_ID
                AND T20.OPR_UNIT_ID = T1.OPR_UNIT_ID
                LEFT JOIN
                TB_CC_MBR_BASIS         T21
                ON  T21.CO_CD   = T1.CO_CD
                AND T21.MBR_ID = T1.ODR_DLGTE_ID
        WHERE   1 = 1
          AND T2.CO_CD = #{CO_CD}
          AND T2.BZPLC_ID = #{BZPLC_ID}
          AND T2.ODR_NO = #{ODR_NO}
          AND T2.ODR_ITM_NO = #{ODR_ITM_NO}
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 고객정보 - 참조코드 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-17
        ****************************************************************************** -->
    <select id="selectCustOderInfoRefCodeList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectCustOderInfoRefCodeList */
        WITH BASE_ODR AS
        (
        SELECT  T1.CO_CD,
                T1.BZPLC_ID,
                T1.ODR_NO,
                T2.ODR_ITM_NO,
                T1.OPR_UNIT_ID,
                T1.DEPT_ID
        FROM    TB_OD_ODR_MST               T1
                JOIN
                TB_OD_ODR_DTL               T2
                ON   T1.CO_CD    = T2.CO_CD     --회사코드
                AND  T1.BZPLC_ID = T2.BZPLC_ID  --사업장ID
                AND  T1.ODR_NO   = T2.ODR_NO    --주문번호
        WHERE   1 = 1
          AND T2.CO_CD = #{CO_CD}
          AND T2.BZPLC_ID = #{BZPLC_ID}
          AND T2.ODR_NO = #{ODR_NO}
          AND T2.ODR_ITM_NO = #{ODR_ITM_NO}
        ), BASE_T AS
        (
        SELECT  T1.CO_CD,
                T1.BZPLC_ID,
                T1.ODR_NO,
                T1.ODR_ITM_NO,
                T1.OPR_UNIT_ID,
                T1.DEPT_ID,
                T2.REF_CD_SEQ_1,
                T2.REF_CD_SEQ_2,
                T2.REF_CD_SEQ_3,
                T2.REF_CD_SEQ_4,
                T2.REF_CD_SEQ_5
        FROM    TB_OD_ODR_DTL_REF_CD        T2
                JOIN
                BASE_ODR               T1
                ON   T1.CO_CD    = T2.CO_CD     --회사코드
                AND  T1.BZPLC_ID = T2.BZPLC_ID  --사업장ID
                AND  T1.ODR_NO   = T2.ODR_NO    --주문번호
                AND  T1.ODR_ITM_NO = T2.ODR_ITM_NO
        ), BASE_T2 AS
        (
        SELECT  T1.CO_CD,
                T1.BZPLC_ID,
                T1.ODR_NO,
                T1.ODR_ITM_NO,
                T1.OPR_UNIT_ID,
                T1.DEPT_ID,
                T1.REF_CD_SEQ,
                T2.REF_CD_GRP_SEQ,
                T2.REF_CD_NM,
                T2.REF_CD,
                T2.DEPT_OPR_UNIT_SPR_CD,
                T2.DEPT_OPR_UNIT_ID
        FROM    (
                SELECT  T1.CO_CD,
                        T1.BZPLC_ID,
                        T1.ODR_NO,
                        T1.ODR_ITM_NO,
                        T1.OPR_UNIT_ID,
                        T1.DEPT_ID,
                        CASE WHEN LVL = 1 THEN REF_CD_SEQ_1
                             WHEN LVL = 2 THEN REF_CD_SEQ_2
                             WHEN LVL = 3 THEN REF_CD_SEQ_3
                             WHEN LVL = 4 THEN REF_CD_SEQ_4
                             ELSE REF_CD_SEQ_5 END REF_CD_SEQ
                FROM    BASE_T      T1
                        CROSS JOIN
                        (SELECT LEVEL LVL FROM DUAL CONNECT BY 5 >= LEVEL )       T2
                )       T1
                JOIN
                TB_CC_CCO_REF_CD_DTL        T2
                ON   T2.CO_CD    = T1.CO_CD     --회사코드
                AND  T2.BZPLC_ID = T1.BZPLC_ID  --사업장ID
                AND  T2.OPR_UNIT_ID = T1.OPR_UNIT_ID
                AND  T2.REF_CD_SEQ = T1.REF_CD_SEQ
        WHERE   T1.REF_CD_SEQ IS NOT NULL
        )
        SELECT  T0.CO_CD,
                T0.BZPLC_ID,
                T0.ODR_NO,
                T0.ODR_ITM_NO,
                T0.OPR_UNIT_ID,
                T0.DEPT_ID,
                T0.SEQ  REF_CD_GRP_SEQ,
                T2.REF_CD_GRP_NM,
                T2.USE_YN,
                 NVL(CASE WHEN T2.USE_YN = 'Y' THEN CASE WHEN T2.MAND_YN = 'Y' THEN '1' ELSE '2' END ELSE '3' END,'3') MAND_YN,
                T2.REF_CD_CHG_TGT_CD,
                T2.REF_CD_EXPS_MTHD_CD,
                T1.REF_CD_SEQ, --1b
                T1.REF_CD_NM,  --1c
                T1.REF_CD,  --1d
                T1.DEPT_OPR_UNIT_SPR_CD,
                T1.DEPT_OPR_UNIT_ID
        FROM    (
                SELECT  T2.SEQ,
                        T1.CO_CD,
                        T1.BZPLC_ID,
                        T1.ODR_NO,
                        T1.ODR_ITM_NO,
                        T1.OPR_UNIT_ID,
                        T1.DEPT_ID
                FROM    BASE_ODR  T1
                        CROSS JOIN
                        (SELECT LEVEL SEQ FROM DUAL CONNECT BY 5 >= LEVEL)  T2
                )       T0
                LEFT JOIN
                (
                SELECT  T1.CO_CD,
                        T1.BZPLC_ID,
                        T1.ODR_NO,
                        T1.ODR_ITM_NO,
                        T1.OPR_UNIT_ID,
                        T1.DEPT_ID,
                        T2.REF_CD_GRP_SEQ,
                        T2.REF_CD_GRP_NM,
                        T2.USE_YN,
                        T2.MAND_YN,
                        T2.REF_CD_CHG_TGT_CD,
                        T2.REF_CD_EXPS_MTHD_CD
                FROM    TB_CC_CCO_REF_CD_INFO        T2
                        JOIN
                        BASE_ODR                     T1
                        ON   T2.CO_CD    = T1.CO_CD     --회사코드
                        AND  T2.BZPLC_ID = T1.BZPLC_ID  --사업장ID
                        AND  T2.OPR_UNIT_ID = T1.OPR_UNIT_ID
                --WHERE   T2.USE_YN = 'Y'
                )             T2
                ON   T0.CO_CD    = T2.CO_CD     --회사코드
                AND  T0.BZPLC_ID = T2.BZPLC_ID  --사업장ID
                AND  T0.ODR_NO   = T2.ODR_NO    --주문번호
                AND  T0.ODR_ITM_NO = T2.ODR_ITM_NO
                AND  T0.SEQ = T2.REF_CD_GRP_SEQ
                LEFT JOIN
                BASE_T2       T1
                ON   T0.CO_CD    = T1.CO_CD     --회사코드
                AND  T0.BZPLC_ID = T1.BZPLC_ID  --사업장ID
                AND  T0.OPR_UNIT_ID = T1.OPR_UNIT_ID
                AND  T0.SEQ = T1.REF_CD_GRP_SEQ
                ORDER BY T0.SEQ
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 고객정보 - 일회성코드 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-17
        ****************************************************************************** -->
    <select id="selectCustOderInfoInstanceCodeList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectCustOderInfoInstanceCodeList */
        WITH BASE_ODR AS
        (
        SELECT  T1.CO_CD,
                T1.BZPLC_ID,
                T1.ODR_NO,
                T2.ODR_ITM_NO,
                T1.OPR_UNIT_ID,
                T1.DEPT_ID
        FROM    TB_OD_ODR_MST               T1
                JOIN
                TB_OD_ODR_DTL               T2
                ON   T1.CO_CD    = T2.CO_CD     --회사코드
                AND  T1.BZPLC_ID = T2.BZPLC_ID  --사업장ID
                AND  T1.ODR_NO   = T2.ODR_NO    --주문번호
        WHERE   1 = 1
          AND T2.CO_CD = #{CO_CD}
          AND T2.BZPLC_ID = #{BZPLC_ID}
          AND T2.ODR_NO = #{ODR_NO}
          AND T2.ODR_ITM_NO = #{ODR_ITM_NO}
        )
        SELECT  T1.CO_CD,
                T1.BZPLC_ID,
                T1.ODR_NO,
                T1.ODR_ITM_NO,
                T1.OPR_UNIT_ID,
                T1.DEPT_ID,
                T1.LVL  OSHT_CD_SEQ,
                T3.OSHT_CD_NM,
                NVL2(T3.OSHT_CD_NM, CASE WHEN T3.USE_YN = 'Y' THEN CASE WHEN T3.MAND_YN = 'Y' THEN '1' ELSE '2' END
                                         ELSE '3'
                                    END,'3') MAND_YN,
                NVL2(T2.OSHT_CD_NM,T2.MAX_IPT_LEN,NULL)       MAX_IPT_LEN,
                NVL2(T2.OSHT_CD_NM,T2.NO_CHAR_SPR_CD,NULL)    NO_CHAR_SPR_CD,
                NVL2(T2.OSHT_CD_NM,T2.OSHT_CD,NULL)           OSHT_CD
        FROM    (
                SELECT  T1.CO_CD,
                        T1.BZPLC_ID,
                        T1.ODR_NO,
                        T1.ODR_ITM_NO,
                        T1.OPR_UNIT_ID,
                        T1.DEPT_ID,
                        T4.LVL
                FROM    BASE_ODR        T1
                        CROSS JOIN
                        (SELECT LEVEL LVL FROM DUAL CONNECT BY 5 >= LEVEL )       T4
                )   T1
                LEFT JOIN
                TB_CC_CCO_OSHT_CD_INFO      T3
                ON   T3.CO_CD = T1.CO_CD
                AND  T3.BZPLC_ID = T1.BZPLC_ID
                AND  T3.OPR_UNIT_ID = T1.OPR_UNIT_ID
                AND  T3.OSHT_CD_SEQ = T1.LVL
                LEFT JOIN
                (
                SELECT  T2.CO_CD,
                        T2.BZPLC_ID,
                        T2.ODR_NO,
                        T2.ODR_ITM_NO,
                        T2.OPR_UNIT_ID,
                        T2.DEPT_ID,
                        T3.OSHT_CD_NM,
                        T3.MAND_YN,
                        T3.MAX_IPT_LEN,
                        T3.NO_CHAR_SPR_CD,
                        T3.OSHT_CD_SEQ,
                        T2.OSHT_CD
                FROM    (
                        SELECT  T2.CO_CD,
                                T2.BZPLC_ID,
                                T2.ODR_NO,
                                T2.ODR_ITM_NO,
                                T2.OPR_UNIT_ID,
                                T2.DEPT_ID,
                                T4.LVL,
                                CASE WHEN LVL = 1 THEN OSHT_CD_1
                                     WHEN LVL = 2 THEN OSHT_CD_2
                                     WHEN LVL = 3 THEN OSHT_CD_3
                                     WHEN LVL = 4 THEN OSHT_CD_4
                                     ELSE OSHT_CD_5 END OSHT_CD
                        FROM    TB_OD_ODR_DTL_OSHT_CD       T1
                                JOIN
                                BASE_ODR    T2
                                ON   T1.CO_CD    = T2.CO_CD
                                AND  T1.BZPLC_ID = T2.BZPLC_ID
                                AND  T1.ODR_NO   = T2.ODR_NO
                                AND  T1.ODR_ITM_NO = T2.ODR_ITM_NO
                                CROSS JOIN
                                (SELECT LEVEL LVL FROM DUAL CONNECT BY 5 >= LEVEL )       T4
                        )       T2
                        JOIN
                        TB_CC_CCO_OSHT_CD_INFO  T3
                        ON   T2.CO_CD    = T3.CO_CD
                        AND  T2.BZPLC_ID = T3.BZPLC_ID
                        AND  T2.OPR_UNIT_ID = T3.OPR_UNIT_ID
                        AND  T2.LVL = T3.OSHT_CD_SEQ
                )       T2
                ON   T1.CO_CD    = T2.CO_CD
                AND  T1.BZPLC_ID = T2.BZPLC_ID
                AND  T1.ODR_NO   = T2.ODR_NO
                AND  T1.ODR_ITM_NO = T2.ODR_ITM_NO
                AND  T1.LVL = T2.OSHT_CD_SEQ
                ORDER BY T1.LVL
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 결재/발주 결재정보 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-17
        ****************************************************************************** -->
    <select id="selectApprInfo" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectApprInfo */
        SELECT  T1.CO_CD,
                T1.BZPLC_ID,
                T1.ODR_NO,
                T1.ODR_ITM_NO,
                T3.APRV_ITM_NO,                 /* 결재항목번호 */
                T3.APRVR_ID,                    /* 결재자ID */
                T11.MBR_NM  APRVR_NM,           /* 결재자명 */
                T11.JBPOS_NM,
                T3.APRVL_SPR_CD,                /* 결재선구분코드 */
                LPAD(T3.APRV_SEQ, 2, '0') APRV_SEQ,      /* 결재순번 */
                T4.APRV_STATS_CD,               /* 결재상태코드 */
                T13.COM_DTL_CD_NM,              /* 결재상태명 */
                T4.APRV_DTM,  /* 결재일시 */
                T4.APRV_MEMO_CTS,               /* 결재메모내용 */
                T4.DLGR_ID,                     /* 위임자ID */
                T12.MBR_NM  DLGR_NM,             /* 결재자명 */
                T20.APRVR_NM_REF                 /* 참조자 */
        FROM    TB_OD_ODR_DTL               T1
                JOIN
                TB_OD_ODR_APRV_INFO T3          /* 주문결재정보 */
                ON   T1.CO_CD    = T3.CO_CD     /* 회사코드 */
                AND  T1.BZPLC_ID = T3.BZPLC_ID  /* 사업장ID */
                AND  T1.ODR_NO   = T3.ODR_NO    /* 주문번호 */
                AND  T3.APRVR_SPR_CD = 'A'
                LEFT JOIN
                TB_OD_ODR_APRV_HST T4           /* 주문결재이력 */
                ON   T4.CO_CD    = T1.CO_CD     /* 회사코드 */
                AND  T4.BZPLC_ID = T1.BZPLC_ID  /* 사업장ID */
                AND  T4.ODR_NO   = T1.ODR_NO    /* 주문번호 */
                AND  T4.ODR_ITM_NO = T1.ODR_ITM_NO
                AND  T4.APRVR_SPR_CD = 'A'
                AND  T4.APRV_ITM_NO = T3.APRV_ITM_NO
                JOIN
                TB_CC_MBR_BASIS         T11
                ON  T11.CO_CD   = T3.CO_CD
                AND T11.MBR_ID = T3.APRVR_ID
                LEFT JOIN
                TB_CC_MBR_BASIS         T12
                ON  T12.CO_CD   = T4.CO_CD
                AND T12.MBR_ID = T4.DLGR_ID
                LEFT JOIN
                TB_CO_COM_CD_DTL        T13
                ON   T13.LANG_CD = #{LANG_CD}
                AND  T13.COM_CLSF_CD = 'APRV_STATS_CD'
                AND  T13.COM_DTL_CD = T4.APRV_STATS_CD
                LEFT JOIN
                (
                SELECT  MAX(CASE WHEN RN = 1 THEN APRVR_NM END || CASE WHEN CNT >= 2 THEN ', ' END) ||
                        MAX(CASE WHEN RN = 2 THEN APRVR_NM END || CASE WHEN CNT >= 3 THEN ', ' END) ||
                        MAX(CASE WHEN RN = 3 THEN APRVR_NM END || CASE WHEN CNT >= 4 THEN ', ' END) ||
                        MAX(CASE WHEN RN = 4 THEN APRVR_NM END || CASE WHEN CNT >= 5 THEN ', ' END) ||
                        MAX(CASE WHEN RN = 5 THEN APRVR_NM END)     APRVR_NM_REF,
                        #{CO_CD}        CO_CD,
                        #{BZPLC_ID}     BZPLC_ID,
                        #{ODR_NO}       ODR_NO,
                        #{ODR_ITM_NO}   ODR_ITM_NO
                FROM    (
                        SELECT
                                ROW_NUMBER() OVER(ORDER BY T3.APRV_SEQ,T3.APRVR_ID) RN,
                                COUNT(*) OVER()     CNT,
                                T3.APRVR_ID||' | '||T11.MBR_NM  APRVR_NM,
                                T1.CO_CD,
                                T1.BZPLC_ID,
                                T1.ODR_NO,
                                T1.ODR_ITM_NO
                        FROM    TB_OD_ODR_DTL               T1
                                JOIN
                                TB_OD_ODR_APRV_INFO T3          /* 주문결재정보 */
                                ON   T1.CO_CD    = T3.CO_CD     /* 회사코드 */
                                AND  T1.BZPLC_ID = T3.BZPLC_ID  /* 사업장ID */
                                AND  T1.ODR_NO   = T3.ODR_NO    /* 주문번호 */
                                AND  T3.APRVR_SPR_CD = 'R'
                                JOIN
                                TB_CC_MBR_BASIS         T11
                                ON  T11.CO_CD   = T3.CO_CD
                                AND T11.MBR_ID = T3.APRVR_ID
                        WHERE  1 = 1
                          AND T1.CO_CD = #{CO_CD}
                          AND T1.BZPLC_ID = #{BZPLC_ID}
                          AND T1.ODR_NO = #{ODR_NO}
                          AND T1.ODR_ITM_NO = #{ODR_ITM_NO}
                        )
                ) T20
                ON  T20.CO_CD = T1.CO_CD
                AND T20.BZPLC_ID = T1.BZPLC_ID
                AND T20.ODR_NO = T1.ODR_NO
                AND T20.ODR_ITM_NO = T1.ODR_ITM_NO
        WHERE  1 = 1
          AND T1.CO_CD = #{CO_CD}
          AND T1.BZPLC_ID = #{BZPLC_ID}
          AND T1.ODR_NO = #{ODR_NO}
          AND T1.ODR_ITM_NO = #{ODR_ITM_NO}
        ORDER BY T3.APRV_SEQ
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 결재/발주 발주정보 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-17
        ****************************************************************************** -->
    <select id="selectOrdInfo" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectOrdInfo */
        SELECT  T1.CO_CD,
                T1.BZPLC_ID,
                T1.ODR_NO,
                T1.ODR_ITM_NO,
                T3.APRV_ITM_NO,                 /* 결재항목번호 */
                T3.APRVR_ID,                    /* 결재자ID */
                T11.MBR_NM  APRVR_NM,           /* 결재자명 */
                T11.JBPOS_NM,
                T3.APRVL_SPR_CD,                /* 결재선구분코드 */
                LPAD(T3.APRV_SEQ, 2, '0') APRV_SEQ,                    /* 결재순번 */
                T4.APRV_STATS_CD,               /* 결재상태코드 */
                T13.COM_DTL_CD_NM,              /* 결재상태명 */
                T4.APRV_DTM,               /* 결재일시 */
                T4.APRV_MEMO_CTS,               /* 결재메모내용 */
                T4.DLGR_ID,                     /* 위임자ID */
                T12.MBR_NM  DLGR_NM             /* 결재자명 */
        FROM    TB_OD_ODR_DTL               T1
                JOIN
                TB_OD_ODR_APRV_INFO T3          /* 주문결재정보 */
                ON   T1.CO_CD    = T3.CO_CD     /* 회사코드 */
                AND  T1.BZPLC_ID = T3.BZPLC_ID  /* 사업장ID */
                AND  T1.ODR_NO   = T3.ODR_NO    /* 주문번호 */
                AND  T3.APRVR_SPR_CD = 'O'
                LEFT JOIN
                TB_OD_ODR_APRV_HST T4           /* 주문결재이력 */
                ON   T4.CO_CD    = T1.CO_CD     /* 회사코드 */
                AND  T4.BZPLC_ID = T1.BZPLC_ID  /* 사업장ID */
                AND  T4.ODR_NO   = T1.ODR_NO    /* 주문번호 */
                AND  T4.ODR_ITM_NO = T1.ODR_ITM_NO
                AND  T4.APRVR_SPR_CD = 'O'
                AND  T4.APRV_ITM_NO = T3.APRV_ITM_NO
                JOIN
                TB_CC_MBR_BASIS         T11
                ON  T11.CO_CD   = T3.CO_CD
                AND T11.MBR_ID = T3.APRVR_ID
                LEFT JOIN
                TB_CC_MBR_BASIS         T12
                ON  T12.CO_CD   = T4.CO_CD
                AND T12.MBR_ID = T4.DLGR_ID
                LEFT JOIN
                TB_CO_COM_CD_DTL        T13
                ON   T13.LANG_CD = #{LANG_CD}
                AND  T13.COM_CLSF_CD = 'APRV_STATS_CD'
                AND  T13.COM_DTL_CD = T4.APRV_STATS_CD
        WHERE  1 = 1
          AND T1.CO_CD = #{CO_CD}
          AND T1.BZPLC_ID = #{BZPLC_ID}
          AND T1.ODR_NO = #{ODR_NO}
          AND T1.ODR_ITM_NO = #{ODR_ITM_NO}
        ORDER BY T3.APRV_SEQ
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 변경이력 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-17
        ****************************************************************************** -->
    <select id="selectChgHstList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectChgHstList */
        SELECT  --+PARALLEL(T1 4)
                T3.CHN_SPR_CD,                                              /*채널구분코드*/
                T7.COM_DTL_CD_NM  CHN_SPR_NM,                               /*채널구분명*/
                T1.CHG_ITM_GRP_CD,                                          /*변경항목그룹코드*/
                T15.CHG_ITM_GRP_NM,                                         /*변경항목그룹명*/
                T16.CHG_FDS_NM,                                             /*변경필드명*/
                T1.ORI_ODR_CTS,                                             /*원주문내용*/
                T1.CHGRQST_CTS   CHG_DCN_CTS,                               /*변경확정내용*/
                T1.CHG_MEMO_CTS,                                            /*변경사유명*/
                T1.REQR_ID,                                                 /*요청자ID*/
                NVL(T11.OPRTR_NM,T12.MBR_NM)    REQR_NM,                    /*요청자명*/
                T1.REG_DTM  REQDT,                                          /*요청일자*/
                T1.CHG_STATS_CD,                                            /*변경상태코드*/
                T5.COM_DTL_CD_NM  CHG_STATS_NM,                             /*변경상태명*/
                T1.VOC_NO,                                                  /*VOC번호*/
                T1.ODR_CHG_MNG_NO,                                          /*주문변경관리번호*/
                T1.BZPLC_ID,
                T1.ODR_NO,
                T1.ODR_ITM_NO
        FROM    (
                SELECT  T1.CO_CD,
                        T1.BZPLC_ID,
                        T1.ODR_NO,
                        T2.ODR_ITM_NO,
                        T1.ODR_CHG_MNG_NO,
                        T1.CHG_ITM_GRP_CD,
                        T1.CHG_STATS_CD,
                        T1.REQDT,
                        T1.REQR_ID,
                        T1.VOC_NO,
                        T1.CHG_MEMO_CTS,
                        T2.ORI_ODR_CTS,
                        T2.CHGRQST_CTS,
                        T2.CHG_DCN_CTS,
                        T2.REG_DTM,
                        ROW_NUMBER() OVER(PARTITION BY T1.ODR_NO,T2.ODR_ITM_NO ORDER BY T1.ODR_CHG_MNG_NO DESC) RN
                FROM    TB_OD_ODR_CHG_MST_HST   T1
                        JOIN
                        TB_OD_ODR_CHG_DTL_HST   T2
                        ON   T1.CO_CD  = T2.CO_CD
                        AND  T1.BZPLC_ID = T2.BZPLC_ID
                        AND  T1.ODR_NO = T2.ODR_NO
                        AND  T1.ODR_CHG_MNG_NO = T2.ODR_CHG_MNG_NO
                WHERE   T1.CO_CD = #{CO_CD}
                  AND   T1.BZPLC_ID = #{BZPLC_ID}
                  AND   T1.ODR_NO = #{ODR_NO}

                )           T1
                JOIN
                TB_OD_ODR_MST           T3          /* 주문마스터 */
                ON   T3.CO_CD    = T1.CO_CD         /* 회사코드 */
                AND  T3.BZPLC_ID = T1.BZPLC_ID      /* 사업장ID */
                AND  T3.ODR_NO   = T1.ODR_NO        /* 주문번호 */
                LEFT JOIN
                TB_CO_COM_CD_DTL        T4
                ON   T4.LANG_CD = #{LANG_CD}
                AND  T4.COM_CLSF_CD = 'CHG_ITM_GRP_CD'
                AND  T4.COM_DTL_CD = T1.CHG_ITM_GRP_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL        T5
                ON   T5.LANG_CD = #{LANG_CD}
                AND  T5.COM_CLSF_CD = 'CHG_STATS_CD'
                AND  T5.COM_DTL_CD = T1.CHG_STATS_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL        T7
                ON   T7.LANG_CD = #{LANG_CD}
                AND  T7.COM_CLSF_CD = 'CHN_SPR_CD'
                AND  T7.COM_DTL_CD = T3.CHN_SPR_CD
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO    T11
                ON  T11.CO_CD    = T1.CO_CD
                AND T11.OPRTR_ID = T1.REQR_ID
                LEFT JOIN
                TB_CC_MBR_BASIS         T12
                ON  T12.CO_CD    = T1.CO_CD
                AND T12.MBR_ID   = T1.REQR_ID
                LEFT JOIN
                TB_DL_CHG_CTL_ITM_GRP_CD    T15
                ON  T15.CHG_ITM_GRP_CD = T1.CHG_ITM_GRP_CD
                LEFT JOIN
                TB_DL_CHG_CTL_ITM_GRP_DTL   T16
                ON  T16.CHG_ITM_GRP_CD = T1.CHG_ITM_GRP_CD
                AND T16.CHG_SEQ = 1
        WHERE   1=1 /*T1.RN = 1*/
        ORDER BY T1.ODR_ITM_NO, T1.REG_DTM DESC NULLS LAST
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 영업정보01 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-17
        ****************************************************************************** -->
    <select id="selectSalsInfoList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectSalsInfoList */
        WITH BASE_TB AS (
        SELECT  *
        FROM    TB_OD_ODR_DTL       T1
        WHERE   T1.CO_CD = #{CO_CD}
          AND   T1.BZPLC_ID = #{BZPLC_ID}
          AND   T1.ODR_NO = #{ODR_NO}
          AND   T1.ODR_ITM_NO = #{ODR_ITM_NO}
        )
        SELECT  LTRIM(T2.PRD_ID, '0') PRD_ID,              /* 상품ID */
                T3.PRD_NM,              /* 상품명 */
                CASE WHEN T2.PRD_ID IS NOT NULL OR T3.PRD_NM IS NOT NULL
                         THEN LTRIM(T2.PRD_ID, '0') || ' | ' || T3.PRD_NM END   PRD_ID_NM, /* 상품 */
                T2.MNFR_NO,             /* 제조사번호*/
                T11.MRO_MNFR_NM,        /* 제조원명*/
                CASE WHEN T2.MNFR_NO IS NOT NULL OR T11.MRO_MNFR_NM IS NOT NULL
                         THEN T2.MNFR_NO || ' | ' || T11.MRO_MNFR_NM END        MNFR_NO_NM, /* 제조원 */
                T3.ORGPLC_CTRY_CD,      /* 원산지국가코드 */
                T9.CTRY_NM,             /* 원산지국가명 */
                CASE WHEN T3.ORGPLC_CTRY_CD IS NOT NULL OR T9.CTRY_NM IS NOT NULL
                         THEN T3.ORGPLC_CTRY_CD || ' | ' || T9.CTRY_NM END      ORGPLC_CTRY_CD_NM, /* 원산지국가코드 명 */
                FN_PR_ATTR_VAL_LIST(T2.CO_CD, T2.PRD_ID) REPR_SPEC,     /* 대표규격 */
                T2.SSP_REPR_ATTR,       /* SSP대표규격 */
                CASE WHEN FN_PR_ATTR_VAL_LIST(T2.CO_CD, T2.PRD_ID) IS NOT NULL OR T2.SSP_REPR_ATTR IS NOT NULL
                         THEN FN_PR_ATTR_VAL_LIST(T2.CO_CD, T2.PRD_ID) || ';' || T2.SSP_REPR_ATTR END     REPR_SPEC_ATTR, /* 규격 */
                T2.STOCK_NO,            /* STOCK_NO */
                T3.HUB_HNL_PSB_YN,
                T2.QCK_DLV_YN,
                CASE WHEN T3.MRO_PRD_CLCD = '000600050001000002' THEN 'Y' ELSE 'N' END  BZCRD_YN,  /* 명함여부 */
                T2.CATG_KILR_CD,    /* 카테고리킬러코드 */
                CASE WHEN T2.CATG_KILR_CD IS NOT NULL OR T14.COM_DTL_CD_NM IS NOT NULL
                         THEN T2.CATG_KILR_CD || ' | ' || T14.COM_DTL_CD_NM END         CATG_KILR_CD_NM,    /* 카테고리킬러 */
                T2.DSTRB_PATH_CD,   /* 유통경로코드 */
                CASE WHEN T2.DSTRB_PATH_CD IS NOT NULL OR T12.COM_DTL_CD_NM IS NOT NULL
                         THEN T2.DSTRB_PATH_CD || ' | ' || T12.COM_DTL_CD_NM END        DSTRB_PATH_CD_NM,  /* 유통경로코드 명 */
                T2.TXTN_TP_CD,      /* 과세유형코드 ,매출세금코드*/
                CASE WHEN T2.TXTN_TP_CD IS NOT NULL OR T13.COM_DTL_CD_NM IS NOT NULL
                         THEN T2.TXTN_TP_CD || ' | ' || T13.COM_DTL_CD_NM END           TXTN_TP_CD_NM,  /* 과세유형코드 명 */
                T2.PRC_DECI_DTM,    /* 가격결정일시 */
                T2.ODR_QTY,         /* 주문수량 */
                T2.SELL_UNIT_CD,
                CASE WHEN T2.ODR_QTY IS NOT NULL OR T2.SELL_UNIT_CD IS NOT NULL
                         THEN RTRIM(TO_CHAR(NVL(T2.ODR_QTY, 0), 'FM999,999,999.9999'), '.') || ' | ' || T2.SELL_UNIT_CD END  ODR_QTY_UNIT_CD,    /* 주문수량 단위 */
                T2.ORI_ODR_QTY,
                CASE WHEN T2.ORI_ODR_QTY IS NOT NULL OR T2.SELL_UNIT_CD IS NOT NULL
                         THEN RTRIM(TO_CHAR(NVL(T2.ORI_ODR_QTY, 0), 'FM999,999,999.9999'), '.') || ' | ' || T2.SELL_UNIT_CD END        ORI_ODR_QTY_UNIT_CD,    /* 원주문수량 단위 */
                T10.MIN_ODR_QTY,
                T3.MULT_SELL_UNIT_QTY,
                CASE WHEN T10.MIN_ODR_QTY IS NOT NULL OR T3.MULT_SELL_UNIT_QTY IS NOT NULL
                         THEN T10.MIN_ODR_QTY || ' | ' || T3.MULT_SELL_UNIT_QTY END     MIN_ODR_QTY_MULT_SELL_UNIT_QTY, /* 최소/배수 수량 단위 */
                T2.SALSPRC,             /* 판매가 */
                CASE WHEN T2.SALSPRC IS NOT NULL OR T2.CURR_UNIT_CD IS NOT NULL
                         THEN RTRIM(TO_CHAR(NVL(T2.SALSPRC, 0), 'FM999,999,999.9999'), '.') || ' | ' || T2.CURR_UNIT_CD END  SALSPRC_CURR_UNIT_CD,    /* 판매가 통화단위 */
                RTRIM(TO_CHAR(NVL(T2.SALSPRC, 0) + ROUND(DECODE(T2.VAT_AMT, 0, 0, T2.VAT_AMT/T2.ODR_QTY), 0), 'FM999,999,999.9999'), '.') || ' | ' || T2.CURR_UNIT_CD  SALSPRC_VAT_CURR_UNIT_CD,    /* 판매가VAT포함 통화단위 - SSP-3056_20230523_박철희_1.1을 변경함 */
                T2.ODR_PRD_AMT,         /* 판매상품 금액 */
                CASE WHEN T2.ODR_PRD_AMT IS NOT NULL OR T2.CURR_UNIT_CD IS NOT NULL
                         THEN TO_CHAR(NVL(T2.ODR_PRD_AMT, 0), 'FM999,999,999,999') || ' | ' || T2.CURR_UNIT_CD END  ODR_PRD_AMT_CURR_UNIT_CD,   /* 판매상품금액 통화단위 */
                T2.PRD_DLCST_AMT,       /* 상품배송비금액  */
                CASE WHEN T2.PRD_DLCST_AMT IS NOT NULL OR T2.CURR_UNIT_CD IS NOT NULL
                         THEN TO_CHAR(NVL(T2.PRD_DLCST_AMT, 0), 'FM999,999,999') || ' | ' || T2.CURR_UNIT_CD END    PRD_DLCST_AMT_CURR_UNIT_CD, /* 상품배송비금액 통화단위 */
                T2.DC_AMT,              /* 할인금액 */
                CASE WHEN T2.DC_AMT IS NOT NULL OR T2.CURR_UNIT_CD IS NOT NULL
                         THEN TO_CHAR(NVL(T2.DC_AMT, 0), 'FM999,999,999') || ' | ' || T2.CURR_UNIT_CD END   DC_AMT_CURR_UNIT_CD,    /* 할인금액 통화단위 */
                T2.SALE_AMT,            /* 매출금액 */
                CASE WHEN T2.SALE_AMT IS NOT NULL OR T2.CURR_UNIT_CD IS NOT NULL
                         THEN TO_CHAR(NVL(T2.SALE_AMT, 0), 'FM999,999,999,999') || ' | ' || T2.CURR_UNIT_CD END     SALE_AMT_CURR_UNIT_CD,  /* 매출금액 통화단위 */
                T2.VAT_AMT,             /* 부가세금액 */
                CASE WHEN T2.VAT_AMT IS NOT NULL OR T2.CURR_UNIT_CD IS NOT NULL
                         THEN TO_CHAR(NVL(T2.VAT_AMT, 0), 'FM999,999,999') || ' | ' || T2.CURR_UNIT_CD END      VAT_AMT_CURR_UNIT_CD,   /* 부가세금액 통화단위 */
                CASE WHEN T2.SALE_AMT IS NOT NULL OR T2.VAT_AMT IS NOT NULL OR T2.CURR_UNIT_CD IS NOT NULL
                         THEN TO_CHAR(NVL(T2.SALE_AMT + T2.VAT_AMT, 0), 'FM999,999,999,999') || ' | ' || T2.CURR_UNIT_CD END    SALE_AMT_VAT_CURR_UNIT_CD,  /* 매출금액 VAT포함 통화단위 */
                T2.CURR_UNIT_CD,        /* 통화단위코드 */
                T15.MBR_NM,             /* 주문자 */
                CASE WHEN T2.COND_PRC_DECI_CD IS NOT NULL OR T17.COM_DTL_CD_NM IS NOT NULL
                         THEN T2.COND_PRC_DECI_CD || ' | ' || T17.COM_DTL_CD_NM END        COND_PRC_DECI_CD,
                T2.QTY_DC_APLY_YN,      /* 물량할인적용여부 */
                CASE WHEN T21.COND_AMT IS NOT NULL OR T2.CURR_UNIT_CD IS NOT NULL
                         THEN TO_CHAR(NVL(T21.COND_AMT, 0), 'FM999,999,999') || ' | ' || T2.CURR_UNIT_CD END      QTY_DC_AMT,
                T2.CPN_APLY_BSS_AMT,     /* 쿠폰적용기준금액 */
                SSP_APP.FN_PR_GET_SSP_PRD_NM(T2.CO_CD, T2.PRD_ID) SSP_PRD_NM   /* SSP상품명 */
        FROM    TB_OD_ODR_MST T1        /* 주문마스터 */
                JOIN
                BASE_TB T2 /*주문상세*/
                ON   T1.CO_CD    = T2.CO_CD     /* 회사코드 */
                AND  T1.BZPLC_ID = T2.BZPLC_ID  /* 사업장ID */
                AND  T1.ODR_NO   = T2.ODR_NO    /* 주문번호 */
                JOIN
                TB_PR_MRO_PRD_INFO T3           /* MRO상품정보 */
                ON   T3.CO_CD   = T2.CO_CD      /* 회사코드 */
                AND  T3.PRD_ID  = T2.PRD_ID     /* 상품ID */
                JOIN
                TB_PR_PRD_INFO T4               /* 상품정보 */
                ON   T4.CO_CD   = T2.CO_CD      /* 회사코드 */
                AND  T4.PRD_ID  = T2.PRD_ID     /* 상품ID */
                LEFT JOIN
                TB_CO_CTRY_INFO     T9
                ON   T9.CO_CD    = T2.CO_CD
                AND  T9.CTRY_SPR_CD = T3.ORGPLC_CTRY_CD
                LEFT JOIN
                (
                SELECT  T1.PRD_ID, /*상품ID*/
                        NVL(MAX(T1.MIN_ODR_QTY),0)  MIN_ODR_QTY /* 최소주문수량 */
                FROM    TB_PC_CPRTCP_PRD_INFO       T1  /* 협력사상품정보 */
                        JOIN
                        BASE_TB                     T2
                        ON  T2.CO_CD    = T1.CO_CD      /* 회사코드 */
                        AND T2.PRD_ID   = T1.PRD_ID     /* 상품ID */
                GROUP BY T1.PRD_ID
                )                   T10
                ON      T10.PRD_ID = T2.PRD_ID
                LEFT JOIN
                TB_PR_MNFR_INFO   T11
                ON   T11.CO_CD   = T2.CO_CD
                AND  T11.MNFR_NO = T2.MNFR_NO
                LEFT JOIN
                TB_CO_COM_CD_DTL        T12
                ON   T12.LANG_CD = #{LANG_CD}
                AND  T12.COM_CLSF_CD = 'DSTRB_PATH_CD'
                AND  T12.COM_DTL_CD = T2.DSTRB_PATH_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL        T13
                ON   T13.LANG_CD = #{LANG_CD}
                AND  T13.COM_CLSF_CD = 'TXTN_TP_CD'
                AND  T13.COM_DTL_CD = T2.TXTN_TP_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL        T14
                ON   T14.LANG_CD = #{LANG_CD}
                AND  T14.COM_CLSF_CD = 'CATG_KILR_CD'
                AND  T14.COM_DTL_CD = T2.CATG_KILR_CD
                LEFT JOIN
                TB_CC_MBR_BASIS         T15
                ON  T15.CO_CD   = T1.CO_CD
                AND T15.MBR_ID = T1.ODRPSN_ID
                LEFT JOIN
                TB_CO_COM_CD_DTL        T16
                ON   T16.LANG_CD = #{LANG_CD}
                AND  T16.COM_CLSF_CD = 'MAND_YN'
                AND  T16.COM_DTL_CD = T2.QTY_DC_APLY_YN
                LEFT JOIN
                TB_CO_COM_CD_DTL        T17
                ON   T17.LANG_CD = #{LANG_CD}
                AND  T17.COM_CLSF_CD = 'SALSPRC_CAL_BSS_CD'
                AND  T17.COM_DTL_CD = T2.COND_PRC_DECI_CD
                LEFT JOIN
                TB_OD_ODR_PRC_DECI_BSS_INFO     T21
                ON   T21.CO_CD    = T2.CO_CD     /* 회사코드 */
                AND  T21.BZPLC_ID = T2.BZPLC_ID  /* 사업장ID */
                AND  T21.ODR_NO   = T2.ODR_NO    /* 주문번호 */
                AND  T21.ODR_ITM_NO = T2.ODR_ITM_NO
                AND  T21.COND_TP_CD = 'Y805'
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 영업정보02 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-17
        ****************************************************************************** -->
    <select id="selectSalsInfoList02" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectSalsInfoList02 */
        SELECT
                NVL(T1.TOT_ODR_AMT,0)   ORI_TOT_ODR_AMT,
                NVL(T1.TOT_ODR_AMT,0) - NVL(T1.DLCST_AMT,0) - NVL(T1.DC_AMT,0) TOT_ODR_AMT,     /* 총주문금액 */
                NVL(T1.DLCST_AMT,0)     DLCST_AMT,       /* 배송비금액 */
                NVL(T1.DC_AMT,0)        DC_AMT,          /* 할인금액 */
                NVL(T1.TOT_VAT_AMT,0)   TOT_VAT_AMT,     /* 총부가세금액 */
                NVL(T1.TOT_ODR_AMT,0) + NVL(T1.TOT_VAT_AMT,0)  SALE_AMT  /*매출금액*/
        FROM    TB_OD_ODR_MST T1 /* 주문마스터 */
        WHERE   T1.CO_CD = #{CO_CD}
          AND   T1.BZPLC_ID = #{BZPLC_ID}
          AND   T1.ODR_NO = #{ODR_NO}
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 영업정보03 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-17
        ****************************************************************************** -->
    <select id="selectSalsInfoList03" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectSalsInfoList03 */
        WITH BASE_TB AS (
        SELECT  *
        FROM    TB_OD_ODR_MST       T1
        WHERE   T1.CO_CD = #{CO_CD}
          AND   T1.BZPLC_ID = #{BZPLC_ID}
          AND   T1.ODR_NO = #{ODR_NO}
        )
        SELECT  T2.CO_CD,
                T2.BZPLC_ID,
                T2.ODR_NO,
                T2.ODR_ITM_NO,          /* 주문항목번호 */
                LTRIM(T2.PRD_ID, '0') PRD_ID,              /* 상품ID */
                T4.PRD_NM,              /* 상품명 */
                T2.SALSPRC,
                T2.ODR_QTY,
                T2.SALE_AMT,            /* 매출금액 */
                T2.VAT_AMT,             /* 부가세금액 */
                T2.SALE_AMT + T2.VAT_AMT    SALE_AMT_VAT,           /* 매출금액VAT포함 */
                T2.ODR_STATS_CD,                                    /* 주문상태코드 */
                T5.COM_USR_DEFN_NM_2    ODR_STATS_CD_NM,                /* 주문상태코드명 */
                NVL(T3.NRML_RTNGDS_YN,'N')  NRML_RTNGDS_YN,         /* 반품여부 */
                NVL(T3.ADJ_STATS_CD,'00')   ADJ_STATS_CD,           /* 정산상태코드, NULL이면 미정산 으로 표시 */
                NVL(T6.COM_DTL_CD_NM, '미정산')    ADJ_STATS_CD_NM,   /* 정산상태코드 */
                /*아래는 그냥 참고용 */
                T2.ODR_PRD_AMT,         /* 주문상품금액 */
                T2.PRD_DLCST_AMT,       /* 상품배송비금액 */
                T2.DC_AMT,              /* 할인금액 */
                T2.CURR_UNIT_CD         /* 통화단위코드 */
        FROM    BASE_TB T1    /* 주문마스터 */
                JOIN
                TB_OD_ODR_DTL T2    /* 주문상세 */
                ON   T1.CO_CD    = T2.CO_CD     /* 회사코드 */
                AND  T1.BZPLC_ID = T2.BZPLC_ID  /* 사업장ID */
                AND  T1.ODR_NO   = T2.ODR_NO    /* 주문번호 */
                LEFT JOIN
                (
                SELECT  T3.BZPLC_ID,
                        T3.ODR_NO,
                        T3.ODR_ITM_NO,
                        ROW_NUMBER() OVER(PARTITION BY T3.BZPLC_ID,T3.ODR_NO,T3.ODR_ITM_NO
                                ORDER BY T3.ADJ_YM DESC,T3.ADJ_DCN_DTM DESC, T3.ADJ_ITM_SEQ DESC)  RN,
                        T1.CO_CD,
                        T3.ADJ_STATS_CD,
                        T3.NRML_RTNGDS_YN
                FROM    BASE_TB     T1
                        JOIN
                        TB_AD_ADJ_DTLS  T3
                        ON   T1.CO_CD    = T3.CO_CD     /* 회사코드 */
                        AND  T1.BZPLC_ID = T3.BZPLC_ID  /* 사업장ID */
                        AND  T1.ODR_NO   = T3.ODR_NO    /* 주문번호 */
                )       T3
                ON   T3.CO_CD    = T2.CO_CD     /* 회사코드 */
                AND  T3.BZPLC_ID = T2.BZPLC_ID  /* 사업장ID */
                AND  T3.ODR_NO   = T2.ODR_NO    /* 주문번호 */
                AND  T3.ODR_ITM_NO = T2.ODR_ITM_NO
                JOIN
                TB_PR_MRO_PRD_INFO T4           /* MRO상품정보 */
                ON   T4.CO_CD   = T2.CO_CD      /* 회사코드 */
                AND  T4.PRD_ID  = T2.PRD_ID     /* 상품ID */
                LEFT JOIN
                TB_CO_COM_CD_DTL        T5
                ON   T5.LANG_CD = #{LANG_CD}
                AND  T5.COM_CLSF_CD = 'ODR_STATS_CD'
                AND  T5.COM_DTL_CD = T2.ODR_STATS_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL        T6
                ON   T6.LANG_CD = #{LANG_CD}
                AND  T6.COM_CLSF_CD = 'ADJ_STATS_CD'
                AND  T6.COM_DTL_CD = T3.ADJ_STATS_CD
        WHERE   NVL(T3.RN,1) = 1
        ORDER BY    T2.ODR_ITM_NO
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 영업정보04 조회 * 작성자 : neonlee * 작성 일자 : 2022-03-17
        ****************************************************************************** -->
    <select id="selectSalsInfoList04" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectSalsInfoList04 */
        SELECT   T2.COM_DTL_CD      COND_TP_CD,
                 T2.COM_DTL_CD_NM   COND_TP_NM,
                 T1.QTY         QTY,
                 T1.PRC         PRC,
                 T1.AMT         AMT,
                 T2.SRT_SO
        FROM    (
                SELECT  T3.COM_DTL_CD,
                        T3.COM_USR_DEFN_NM_1    COM_DTL_CD_NM,
                        T3.COM_USR_DEFN_NM_2,
                        T3.SRT_SO
                FROM    TB_CO_COM_CD_DTL        T3
                WHERE   T3.LANG_CD = #{LANG_CD}
                AND     T3.COM_CLSF_CD = 'COND_TP_CD'
                )       T2
                LEFT JOIN
                (
                SELECT  COND_TP_CD,MAX(QTY) QTY, MAX(PRC) PRC, SUM(AMT) AMT
                FROM    (
                        SELECT  CASE WHEN T4.LVL = 2 AND T2.COND_TP_CD IN ('Y600','MWST') THEN 'MTOT' ELSE T2.COND_TP_CD    END COND_TP_CD,
                                CASE WHEN T2.COND_TP_CD IN ('Y800','Y804') THEN T2.COND_BSS_VAL||' '||DOC_COND_UNIT_CD END   QTY,
                                CASE WHEN T2.COND_TP_CD IN ('Y800','Y801','Y802','Y803','Y804') THEN T2.BSS_RT END           PRC,
                                CASE WHEN T2.COND_TP_CD IN ('Y804','Y805','Y806','Y807','Y600','MWST','Y808','Y809') THEN T2.COND_AMT END  AMT
                        FROM    TB_OD_ODR_DTL                   T1
                                JOIN
                                TB_OD_ODR_PRC_DECI_BSS_INFO     T2
                                ON   T1.CO_CD    = T2.CO_CD     /*회사코드*/
                                AND  T1.BZPLC_ID = T2.BZPLC_ID  /*사업장ID*/
                                AND  T1.ODR_NO   = T2.ODR_NO    /*주문번호*/
                                AND  T1.ODR_ITM_NO = T2.ODR_ITM_NO
                                CROSS JOIN
                                (SELECT LEVEL LVL FROM DUAL CONNECT BY 2 >= LEVEL)      T4
                        WHERE   T1.CO_CD = #{CO_CD}
                          AND   T1.BZPLC_ID = #{BZPLC_ID}
                          AND   T1.ODR_NO = #{ODR_NO}
                          AND   T1.ODR_ITM_NO = #{ODR_ITM_NO}
                          AND   (  T2.COND_TP_CD IN ('Y600','MWST') OR T4.LVL = 1 )
                          AND   T2.COND_TP_CD NOT IN ('Y100','Y500')
                        )
                GROUP BY COND_TP_CD
                )       T1
                ON   T2.COM_DTL_CD = T1.COND_TP_CD
        WHERE   ( T2.COM_USR_DEFN_NM_2 = 'Y' OR T1.COND_TP_CD IS NOT NULL )
        ORDER BY T2.SRT_SO
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 배송정보 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-11
        ****************************************************************************** -->
    <select id="selectDlvInfo" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectDlvInfo */
        WITH BASE_ODR AS
        (
        SELECT  *
        FROM   TB_OD_ODR_DTL    T1
        WHERE  T1.CO_CD = #{CO_CD}
          AND  T1.BZPLC_ID = #{BZPLC_ID}
          AND  T1.ODR_NO = #{ODR_NO}
          AND  T1.ODR_ITM_NO = #{ODR_ITM_NO}
        )
        SELECT  T1.CO_CD,
                T1.BZPLC_ID,
                T1.ODR_NO,
                T1.ODR_ITM_NO,
                CASE WHEN T1.ODR_NO IS NOT NULL OR T1.ODR_ITM_NO IS NOT NULL
                         THEN T1.ODR_NO || '-' || T1.ODR_ITM_NO END     JNT_ODR_ITM_NO, /*주문품목번호*/
                T1.DLV_FORM_SPR_CD,     /*배송형태구분코드*/
                CASE WHEN T1.DLV_FORM_SPR_CD IS NOT NULL OR T20.COM_DTL_CD_NM IS NOT NULL
                         THEN T1.DLV_FORM_SPR_CD || ' | ' || T20.COM_DTL_CD_NM END  JNT_DLV_FORM_SPR_CD_NM, /* 배송형태 */
                T1.CPRTCP_ID  CNSG_CPRTCP_ID,      /*협력사 ID*/
                T8.CPRTCP_KOR_NM,       /* 협력사명 */
                CASE WHEN T1.CPRTCP_ID IS NOT NULL OR T8.CPRTCP_KOR_NM IS NOT NULL
                         THEN T1.CPRTCP_ID || ' - ' || T8.CPRTCP_KOR_NM END    JNT_CNSG_CPRTCP_ID_NM,  /* 협력사 */
                T1.GDOC_NO,             /* 거래명세서번호  */
                T1.GI_PLNT_ID,          /* 입고플랜트ID */
                T23.PLNT_NM     GI_PLNT_NM,
                CASE WHEN T1.GI_PLNT_ID IS NOT NULL OR T23.PLNT_NM IS NOT NULL
                         THEN T1.GI_PLNT_ID || ' | ' || T23.PLNT_NM END    JNT_GI_PLNT_ID_NM,  /* 입고플랜트 */
                T1.GO_PLNT_ID,          /* 출고플랜트ID */
                T24.PLNT_NM     GO_PLNT_NM,
                CASE WHEN T1.GO_PLNT_ID IS NOT NULL OR T24.PLNT_NM IS NOT NULL
                         THEN T1.GO_PLNT_ID || ' | ' || T24.PLNT_NM END    JNT_GO_PLNT_ID_NM,  /* 출고플랜트 */
                T5.SSP_DLV_MTD_CD,      /* SSP배송방법코드 */
                CASE WHEN T5.SSP_DLV_MTD_CD IS NOT NULL OR T21.COM_DTL_CD_NM IS NOT NULL
                         THEN T5.SSP_DLV_MTD_CD || ' | ' || T21.COM_DTL_CD_NM END   JNT_SSP_DLV_MTD_CD_NM,  /* 배송방법 */
                T5.HDV_INVC_NO,         /* 택배송장번호 */
                T1.DLV_LT,              /*평균배송일*/
                T3.DLV_HPE_DT,          /* 배송희망일자 */
                T3.SPL_PSB_DTM,         /*납품가능일*/
                T3.DLV_DUE_DT,          /*배송예정일자*/
                T3.DLV_CMPL_DTM,        /*배송완료일시*/
                T3.REAL_DLV_CMPL_DTM,   /*고객수령일시*/
                T3.DLV_DELAY_RSN_CD,    /*배송지연사유코드*/
                T3.ODR_REQ_DTM,         /*주문신청일시*/
                T3.INTL_ORD_DCN_DTM,    /*고객사발주완료일*/
                T3.SELL_DOC_CRT_DTM,    /*S/O생성일*/
                T3.HUB_SHMT_IDC_DTM,    /*허브출하지시일시*/
                T3.HUB_PICK_DTM,        /*허브피킹일시*/
                T3.HUB_GO_DTM,          /*허브출고일시*/
                T3.DLV_CMPL_DTM,        /*허브배송완료일시*/
                T1.ODR_STATS_CD,        /*주문상태코드*/
                T1.ODR_TMP_LOCK_CD,     /* 주문임시잠금코드 */
                T1.GDOC_NO,             /* 거래명세서번호  */
                T6.ORD_REQ_STATS_CD,    /* 발주요청상태코드 */
                T6.ERR_MSG_CTS,         /* 오류메시지내용  */
                T1.RCVR_NM,             /* 수령인명 */
                T1.ZPCD,                /* 우편번호 */
                T1.DTL_ADDR,            /* 상세주소 */
                T1.REPR_ADDR,           /* 대표주소 */
                T1.TEL_NO,              /* 전화번호 */
                T1.HP_NO,               /* 휴대폰번호 */
                MEMO_CTS07,             /* 주문메모내용 */
                MEMO_CTS04,             /* 배송메모내용 */
                MEMO_CTS17              /* CS메모내용 */
        FROM    BASE_ODR        T1
                JOIN
                TB_OD_ODR_MST   T2
                ON   T2.CO_CD = T1.CO_CD
                AND  T2.BZPLC_ID = T1.BZPLC_ID
                AND  T2.ODR_NO = T1.ODR_NO
                LEFT JOIN
                TB_DL_ODR_ACP_DLV_PROC  T3  /* 주문접수배송처리 */
                ON   T3.CO_CD = T1.CO_CD
                AND  T3.BZPLC_ID = T1.BZPLC_ID
                AND  T3.ODR_NO = T1.ODR_NO
                AND  T3.ODR_ITM_NO = T1.ODR_ITM_NO
                OUTER APPLY
                (
                    SELECT  *
                    FROM    TB_DL_ODR_DLV_PROC_DTLS T5  /* 주문배송처리내역 */
                    WHERE   T5.CO_CD = T1.CO_CD
                    AND     T5.BZPLC_ID = T1.BZPLC_ID
                    AND     T5.ODR_NO = T1.ODR_NO
                    AND     T5.ODR_ITM_NO = T1.ODR_ITM_NO
                    --AND     ROWNUM = 1
                    order  by T5.REG_DTM DESC
                    fetch first 1 rows only
                ) T5
                LEFT JOIN
                TB_DL_SMLN_ORD_INFO T6 /* 시뮬레이션발주정보 */
                ON   T6.CO_CD  = T1.CO_CD
                AND  T6.BZPLC_ID = T1.BZPLC_ID
                AND  T6.ODR_NO = T1.ODR_NO
                AND  T6.ODR_ITM_NO = T1.ODR_ITM_NO
                LEFT JOIN
                (
                    SELECT  T1.CO_CD,
                            T1.BZPLC_ID,
                            T1.ODR_NO,
                            T1.ODR_ITM_NO,
                            MAX(CASE WHEN T1.MEMO_CD = '07' THEN T1.MEMO_CTS ELSE NULL END)  MEMO_CTS07, /* 주문메모내용 */
                            MAX(CASE WHEN T1.MEMO_CD = '04' THEN T1.MEMO_CTS ELSE NULL END)  MEMO_CTS04, /* 배송메모내용 */
                            MAX(CASE WHEN T1.MEMO_CD = '17' THEN T1.MEMO_CTS ELSE NULL END)  MEMO_CTS17  /* CS메모내용 */
                    FROM    TB_OD_ODR_MEMO_INFO T1
                    WHERE   T1.CO_CD = #{CO_CD}
                            AND  T1.BZPLC_ID = #{BZPLC_ID}
                            AND  T1.ODR_NO = #{ODR_NO}
                            AND  T1.ODR_ITM_NO = #{ODR_ITM_NO}
                    GROUP BY T1.CO_CD, T1.BZPLC_ID, T1.ODR_NO, T1.ODR_ITM_NO
                ) T7    /* 주문메모정보 */
                ON   T7.CO_CD = T1.CO_CD
                AND  T7.BZPLC_ID = T1.BZPLC_ID
                AND  T7.ODR_NO = T1.ODR_NO
                AND  T7.ODR_ITM_NO = T1.ODR_ITM_NO
                LEFT JOIN
                TB_CP_CPRTCP_BASIS  T8
                ON   T8.CO_CD = T1.CO_CD
                AND  T8.CPRTCP_ID = T1.CPRTCP_ID
                LEFT JOIN
                TB_CO_COM_CD_DTL    T20
                ON  T20.LANG_CD = #{LANG_CD}
                AND T20.COM_CLSF_CD = 'DLV_FORM_SPR_CD'
                AND T20.COM_DTL_CD = T1.DLV_FORM_SPR_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL    T21
                ON   T21.LANG_CD = #{LANG_CD}
                AND  T21.COM_CLSF_CD = 'SSP_DLV_MTD_CD'
                AND  T21.COM_DTL_CD = T5.SSP_DLV_MTD_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL    T22
                ON   T22.LANG_CD = #{LANG_CD}
                AND  T22.COM_CLSF_CD = 'DLV_DELAY_RSN_CD'
                AND  T22.COM_DTL_CD = T3.DLV_DELAY_RSN_CD
                LEFT JOIN
                TB_DL_PLNT_BASIS    T23
                ON   T23.CO_CD = T1.CO_CD
                AND  T23.PLNT_ID = T1.GI_PLNT_ID
                LEFT JOIN
                TB_DL_PLNT_BASIS    T24
                ON   T24.CO_CD = T1.CO_CD
                AND  T24.PLNT_ID = T1.GO_PLNT_ID
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 배송정보 배송처리 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-11
        ****************************************************************************** -->
    <select id="selectDlvProcInfo" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectDlvProcInfo */
        WITH BASE_T AS (
            SELECT  T3.LVL,
                    T1.NRML_RTNGDS_SPR_CD,
                    NVL(T2.DLV_FORM_SPR_CD,'01')  DLV_FORM_SPR_CD,
                    T2.ODR_DCN_DTM,
                    T2.CUST_ORD_DTM,
                    T5.*
            FROM    TB_OD_ODR_MST T1
                    JOIN
                    TB_OD_ODR_DTL T2
                    ON   T1.CO_CD    = T2.CO_CD
                    AND  T1.BZPLC_ID = T2.BZPLC_ID
                    AND  T1.ODR_NO   = T2.ODR_NO
                    LEFT JOIN
                    TB_DL_ODR_ACP_DLV_PROC T5
                    ON   T5.CO_CD    = T2.CO_CD
                    AND  T5.BZPLC_ID = T2.BZPLC_ID
                    AND  T5.ODR_NO   = T2.ODR_NO
                    AND  T5.ODR_ITM_NO = T2.ODR_ITM_NO
                    CROSS JOIN
                    (SELECT LEVEL LVL FROM DUAL CONNECT BY 14 >= LEVEL)  T3
            WHERE   T2.CO_CD = #{CO_CD}
              AND   T2.BZPLC_ID = #{BZPLC_ID}
              AND   T2.ODR_NO = #{ODR_NO}
              AND   T2.ODR_ITM_NO = #{ODR_ITM_NO}
          )
        SELECT  LVL,
                OPR_OWNER,
                DT_NAME,
                TO_CHAR(DT, 'YYYY-MM-DD HH24:MI:SS')    DT
        FROM    (
                SELECT  CASE WHEN LVL IN (1,2) THEN '고객사'
                             WHEN LVL IN (3) THEN '영업'
                             WHEN LVL IN (4) THEN '구매'
                             ELSE '협력사' END     OPR_OWNER,
                        CASE WHEN LVL = 1 THEN '주문신청일'
                             WHEN LVL = 2 THEN '발주완료일'
                             WHEN LVL = 3 THEN 'SO생성일'
                             WHEN LVL = 4 THEN '발주확정일'
                             WHEN LVL = 5 THEN '발주접수일'
                             WHEN LVL = 6 THEN '출하지시일'
                             WHEN LVL = 7 THEN '출고확정일'
                             ELSE '배송완료일' END DT_NAME,
                        CASE WHEN LVL = 1 THEN ODR_DCN_DTM
                             WHEN LVL = 2 THEN CUST_ORD_DTM
                             WHEN LVL = 3 THEN SELL_DOC_CRT_DTM
                             WHEN LVL = 4 THEN INTL_ORD_DCN_DTM
                             WHEN LVL = 5 THEN ORD_ACP_DTM
                             WHEN LVL = 6 THEN SHMT_IDC_DTM
                             WHEN LVL = 7 THEN CPRTCP_GO_CMPL_DTM
                             ELSE DLV_CMPL_DTM END DT,
                        LVL
                FROM    BASE_T
                WHERE   NRML_RTNGDS_SPR_CD = 'N'
                  AND   DLV_FORM_SPR_CD = '01'
                  AND   8 >= LVL
                UNION
                SELECT  CASE WHEN LVL IN (1,2) THEN '고객사'
                             WHEN LVL IN (3) THEN '영업'
                             ELSE 'HUB' END     OPR_OWNER,
                        CASE WHEN LVL = 1 THEN '주문신청일'
                             WHEN LVL = 2 THEN '발주완료일'
                             WHEN LVL = 3 THEN 'SO생성일'
                             WHEN LVL = 4 THEN 'HUB출하지시일'
                             WHEN LVL = 5 THEN 'HUB피킹일'
                             WHEN LVL = 6 THEN 'Hub출고완료일'
                             ELSE '배송완료일' END DT_NAME,
                        CASE WHEN LVL = 1 THEN ODR_DCN_DTM
                             WHEN LVL = 2 THEN CUST_ORD_DTM
                             WHEN LVL = 3 THEN SELL_DOC_CRT_DTM
                             WHEN LVL = 4 THEN HUB_SHMT_IDC_DTM
                             WHEN LVL = 5 THEN HUB_PICK_DTM
                             WHEN LVL = 6 THEN HUB_GO_DTM
                             ELSE DLV_CMPL_DTM END DT,
                        LVL
                FROM    BASE_T
                WHERE   NRML_RTNGDS_SPR_CD = 'N'
                  AND   DLV_FORM_SPR_CD IN ('03','04')
                  AND   7 >= LVL
                UNION
                SELECT  CASE WHEN LVL IN (1,2) THEN '고객사'
                             WHEN LVL IN (3) THEN '영업'
                             WHEN LVL IN (4) THEN '구매'
                             WHEN LVL IN (5,6,7) THEN '협력사'
                             ELSE 'HUB' END     OPR_OWNER,
                        CASE WHEN LVL = 1 THEN '주문신청일'
                             WHEN LVL = 2 THEN '발주완료일'
                             WHEN LVL = 3 THEN 'SO생성일'
                             WHEN LVL = 4 THEN '발주확정일'
                             WHEN LVL = 5 THEN '발주접수일'
                             WHEN LVL = 6 THEN '출하지시일'
                             WHEN LVL = 7 THEN '출고확정일'
                             WHEN LVL = 8 THEN 'HUB입고일'
                             WHEN LVL = 9 THEN '간선출고일'
                             WHEN LVL = 10 THEN '간선입고일'
                             WHEN LVL = 11 THEN 'HUB출하지시일'
                             WHEN LVL = 12 THEN 'HUB피킹일'
                             WHEN LVL = 13 THEN 'Hub출고확정일'
                             ELSE '배송완료일' END DT_NAME,
                        CASE WHEN LVL = 1 THEN ODR_DCN_DTM
                             WHEN LVL = 2 THEN CUST_ORD_DTM
                             WHEN LVL = 3 THEN SELL_DOC_CRT_DTM
                             WHEN LVL = 4 THEN INTL_ORD_DCN_DTM
                             WHEN LVL = 5 THEN ORD_ACP_DTM
                             WHEN LVL = 6 THEN SHMT_IDC_DTM
                             WHEN LVL = 7 THEN CPRTCP_GO_CMPL_DTM
                             WHEN LVL = 8 THEN HUB_GI_DTM
                             WHEN LVL = 9 THEN ATR_GO_DTM
                             WHEN LVL = 10 THEN ATR_GI_DTM
                             WHEN LVL = 11 THEN HUB_SHMT_IDC_DTM
                             WHEN LVL = 12 THEN HUB_PICK_DTM
                             WHEN LVL = 13 THEN HUB_GO_DTM
                             ELSE DLV_CMPL_DTM END DT,
                        LVL
                FROM    BASE_T
                WHERE   NRML_RTNGDS_SPR_CD = 'N'
                  AND   DLV_FORM_SPR_CD = '02'
                  AND   ATR_GO_DTM IS NOT NULL
                  AND   14 >= LVL
                UNION
                SELECT  CASE WHEN LVL IN (1,2) THEN '고객사'
                             WHEN LVL IN (3) THEN '영업'
                             WHEN LVL IN (4) THEN '구매'
                             WHEN LVL IN (5,6,7) THEN '협력사'
                             ELSE 'HUB' END     OPR_OWNER,
                        CASE WHEN LVL = 1 THEN '주문신청일'
                             WHEN LVL = 2 THEN '발주완료일'
                             WHEN LVL = 3 THEN 'SO생성일'
                             WHEN LVL = 4 THEN '발주확정일'
                             WHEN LVL = 5 THEN '발주접수일'
                             WHEN LVL = 6 THEN '출하지시일'
                             WHEN LVL = 7 THEN '출고확정일'
                             WHEN LVL = 8 THEN 'HUB입고일'
                             WHEN LVL = 9 THEN 'HUB출하지시일'
                             WHEN LVL = 10 THEN 'HUB피킹일'
                             WHEN LVL = 11 THEN 'Hub출고확정일'
                             ELSE '배송완료일' END DT_NAME,
                        CASE WHEN LVL = 1 THEN ODR_DCN_DTM
                             WHEN LVL = 2 THEN CUST_ORD_DTM
                             WHEN LVL = 3 THEN SELL_DOC_CRT_DTM
                             WHEN LVL = 4 THEN INTL_ORD_DCN_DTM
                             WHEN LVL = 5 THEN ORD_ACP_DTM
                             WHEN LVL = 6 THEN SHMT_IDC_DTM
                             WHEN LVL = 7 THEN CPRTCP_GO_CMPL_DTM
                             WHEN LVL = 8 THEN HUB_GI_DTM
                             WHEN LVL = 9 THEN HUB_SHMT_IDC_DTM
                             WHEN LVL = 10 THEN HUB_PICK_DTM
                             WHEN LVL = 11 THEN HUB_GO_DTM
                             ELSE DLV_CMPL_DTM END DT,
                        LVL
                FROM    BASE_T
                WHERE   NRML_RTNGDS_SPR_CD = 'N'
                  AND   DLV_FORM_SPR_CD = '02'
                  AND   ATR_GO_DTM IS NULL
                  AND   12 >= LVL
                UNION
                SELECT  CASE WHEN LVL IN (1,2,3) THEN '영업'
                             ELSE '협력사' END     OPR_OWNER,
                        CASE WHEN LVL = 1 THEN '반품주문생성일'
                             WHEN LVL = 2 THEN '반품SO생성일'
                             WHEN LVL = 3 THEN '반품발주생성일'
                             WHEN LVL = 4 THEN '반품접수일'
                             WHEN LVL = 5 THEN '협력사반품일'
                             ELSE '반품배송완료일' END DT_NAME,
                        CASE WHEN LVL = 1 THEN ODR_REQ_DTM
                             WHEN LVL = 2 THEN SELL_DOC_CRT_DTM
                             WHEN LVL = 3 THEN INTL_ORD_DCN_DTM
                             WHEN LVL = 4 THEN RTNGDS_ACP_DTM
                             WHEN LVL = 5 THEN DLV_CMPL_DTM
                             ELSE RTNGDS_CMPL_DTM END DT,
                        LVL
                FROM    BASE_T
                WHERE   NRML_RTNGDS_SPR_CD = 'R'
                  AND   DLV_FORM_SPR_CD = '01'
                  AND   6 >= LVL
                UNION
                SELECT  CASE WHEN LVL IN (1,2,3) THEN '영업'
                             ELSE 'HUB' END     OPR_OWNER,
                        CASE WHEN LVL = 1 THEN '반품주문생성일'
                             WHEN LVL = 2 THEN '반품SO생성일'
                             WHEN LVL = 3 THEN '반품발주생성일'
                             WHEN LVL = 4 THEN '반품출하지시일'
                             WHEN LVL = 5 THEN 'HUB반품일'
                             WHEN LVL = 6 THEN '간선출하지시일'
                             WHEN LVL = 7 THEN '간선출고일'
                             WHEN LVL = 8 THEN '간선입고일'
                             ELSE '협력사반출일' END DT_NAME,
                        CASE WHEN LVL = 1 THEN ODR_REQ_DTM
                             WHEN LVL = 2 THEN SELL_DOC_CRT_DTM
                             WHEN LVL = 3 THEN INTL_ORD_DCN_DTM
                             WHEN LVL = 4 THEN HUB_SHMT_IDC_DTM
                             WHEN LVL = 5 THEN DLV_CMPL_DTM
                             WHEN LVL = 6 THEN RTNGDS_ATR_SHMT_DTM
                             WHEN LVL = 7 THEN RTNGDS_ATR_GO_DTM
                             WHEN LVL = 8 THEN RTNGDS_ATR_GI_DTM
                             ELSE CPRTCP_TAKOUT_DTM END DT,
                        LVL
                FROM    BASE_T
                WHERE   NRML_RTNGDS_SPR_CD = 'R'
                  AND   DLV_FORM_SPR_CD IN ('02','03','04')
                  AND   RTNGDS_ATR_GO_DTM IS NOT NULL
                  AND   9 >= LVL
                UNION
                SELECT  CASE WHEN LVL IN (1,2,3) THEN '영업'
                             ELSE 'HUB' END     OPR_OWNER,
                        CASE WHEN LVL = 1 THEN '반품주문생성일'
                             WHEN LVL = 2 THEN '반품SO생성일'
                             WHEN LVL = 3 THEN '반품발주생성일'
                             WHEN LVL = 4 THEN '반품출하지시일'
                             WHEN LVL = 5 THEN 'HUB반품일'
                             ELSE '협력사반출일' END DT_NAME,
                        CASE WHEN LVL = 1 THEN ODR_REQ_DTM
                             WHEN LVL = 2 THEN SELL_DOC_CRT_DTM
                             WHEN LVL = 3 THEN INTL_ORD_DCN_DTM
                             WHEN LVL = 4 THEN HUB_SHMT_IDC_DTM
                             WHEN LVL = 5 THEN DLV_CMPL_DTM
                             ELSE CPRTCP_TAKOUT_DTM END DT,
                        LVL
                FROM    BASE_T
                WHERE   NRML_RTNGDS_SPR_CD = 'R'
                  AND   DLV_FORM_SPR_CD IN ('02','03','04')
                  AND   RTNGDS_ATR_GO_DTM IS NULL
                  AND   6 >= LVL
                )
        ORDER BY LVL
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 배송정보 배송자차 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-11
        ****************************************************************************** -->
    <select id="selectDlvSrvonInfo" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectDlvSrvonInfo */
        SELECT  DPT_DTM,   /* 출발일시 */
                DVPR_NM,   /* 배송자명 */
                CADDR_NO,  /* 연락처번호 */
                CAR_NO     /* 차량번호 */
         FROM   TB_DL_ODR_DLV_DTLS  T1
        WHERE   T1.CO_CD = #{CO_CD}
          AND   T1.BZPLC_ID = #{BZPLC_ID}
          AND   T1.ODR_NO = #{ODR_NO}
          AND   T1.ODR_ITM_NO = #{ODR_ITM_NO}
          AND   T1.DPT_DTM IS NOT NULL
       UNION ALL
        SELECT   T2.ACP_DTM,
                 T2.RTRV_CHRPSN_NM,
                 T2.RTRV_CADDR,
                 T2.RTRV_CAR_INFO_CTS
        FROM    TB_VO_VOC_EXCEPT_PROC   T1
                JOIN
                TB_VO_VOC_EXCEPT_PROC_CPRTCP_INFO   T2
                ON  T2.CO_CD = T1.CO_CD
                AND T2.VOC_NO = T1.VOC_NO
                AND T2.VOC_ITM_NO = T1.VOC_ITM_NO
                AND T2.EXCEPT_PROC_SEQ = T1.EXCEPT_PROC_SEQ
        WHERE   T1.CO_CD = #{CO_CD}
          AND   T1.EXCEPT_PROC_ODR_NO = #{ODR_NO}
          AND   T1.EXCEPT_PROC_ODR_ITM_NO = #{ODR_ITM_NO}
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 배송정보 배송택배 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-11
        ****************************************************************************** -->
    <select id="selectDlvHdvInfo" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectDlvHdvInfo */
        SELECT  T1.SEQ
               ,T1.TRNS_VNDR_ID
               ,T2.TRNS_VNDR_NM
               ,T1.HDV_INVC_NO
               ,T3.GDOC_NO
               ,T2.DLV_TRC_MTD_CD
               ,CASE WHEN T2.DLV_TRC_MTD_CD = '1' THEN T2.GSFLOW_DLV_TRC_URL
                     ELSE T2.DLV_TRC_URL END TRNS_URL
               ,CASE WHEN T2.DLV_TRC_MTD_CD = '1' THEN T2.GSFLOW_HDVCP_CD
                     ELSE T2.INVC_NO_PRM_NM END TRNS_PRM
               ,CASE WHEN T2.DLV_TRC_MTD_CD = '1' THEN
                     T2.GSFLOW_DLV_TRC_URL||T3.GDOC_NO||T2.GSFLOW_HDVCP_CD||HDV_INVC_NO
                     ELSE NULL END TRNS_LINK
        FROM   TB_DL_ODR_DLV_PROC_DTLS   T1
               JOIN
               TB_DL_TRNS_VNDR_MST  T2
               ON  T1.CO_CD = T2.CO_CD
               AND T1.TRNS_VNDR_ID = T2.TRNS_VNDR_ID
               JOIN
               TB_OD_ODR_DTL        T3
               ON   T3.CO_CD      = T1.CO_CD
               AND  T3.BZPLC_ID   = T1.BZPLC_ID
               AND  T3.ODR_NO     = T1.ODR_NO
               AND  T3.ODR_ITM_NO = T1.ODR_ITM_NO
        WHERE   T1.CO_CD = #{CO_CD}
          AND   T1.BZPLC_ID = #{BZPLC_ID}
          AND   T1.ODR_NO = #{ODR_NO}
          AND   T1.ODR_ITM_NO = #{ODR_ITM_NO}
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 주문정보 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-15
        ****************************************************************************** -->
    <select id="selectOdrInfo" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectOdrInfo */
        SELECT  T0.CO_CD,
                T0.BZPLC_ID,
                T0.ODR_NO,
                T0.ODR_ITM_NO,
                T1.ADJ_DELAY_LOCK_YN,
                T1.ADJ_LOCK_CD,
                CASE WHEN T1.ADJ_LOCK_CD IS NOT NULL OR T10.COM_DTL_CD_NM IS NOT NULL
                         THEN T1.ADJ_LOCK_CD || ' | ' || T10.COM_DTL_CD_NM END  ADJ_LOCK_CD_NM,
                T1.ODR_TRMN_YN,
                T1.ODR_TRMN_CD,
                CASE WHEN T1.ODR_TRMN_CD IS NOT NULL OR T11.COM_DTL_CD_NM IS NOT NULL
                         THEN T1.ODR_TRMN_CD || ' | ' || T11.COM_DTL_CD_NM END  ODR_TRMN_CD_NM,
                CASE WHEN T0.ODR_TMP_LOCK_CD IS NOT NULL THEN T0.ODR_TMP_LOCK_CD || ' | ' || T12.COM_DTL_CD_NM END  CHG_HLD_YN
        FROM    TB_OD_ODR_DTL   T0
                LEFT JOIN
                TB_OD_ODR_TRMN_DTLS T1
                ON  T0.CO_CD = T1.CO_CD
                AND T0.BZPLC_ID = T1.BZPLC_ID
                AND T0.ODR_NO = T1.ODR_NO
                AND T0.ODR_ITM_NO = T1.ODR_ITM_NO
                LEFT JOIN
                TB_OD_ODR_CHG_MST_HST T2
                ON  T2.CO_CD = T1.CO_CD
                AND T2.BZPLC_ID = T1.BZPLC_ID
                AND T2.ODR_NO = T1.ODR_NO
                AND T2.ODR_ITM_NO = T1.ODR_ITM_NO
                LEFT JOIN
                TB_CO_COM_CD_DTL T10
                ON  T10.LANG_CD = #{LANG_CD}
                AND T10.COM_CLSF_CD = 'ADJ_LOCK_CD'
                AND T10.COM_DTL_CD = T1.ADJ_LOCK_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL T11
                ON  T11.LANG_CD = #{LANG_CD}
                AND T11.COM_CLSF_CD = 'ODR_TRMN_CD'
                AND T11.COM_DTL_CD = T1.ODR_TRMN_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL T12
                ON  T12.LANG_CD = #{LANG_CD}
                AND T12.COM_CLSF_CD = 'ODR_TMP_LOCK_CD'
                AND T12.COM_DTL_CD = T0.ODR_TMP_LOCK_CD
        WHERE   T0.CO_CD = #{CO_CD}
          AND   T0.BZPLC_ID = #{BZPLC_ID}
          AND   T0.ODR_NO = #{ODR_NO}
          AND   T0.ODR_ITM_NO = #{ODR_ITM_NO}
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 주문정보 첨부파일 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-15
        ****************************************************************************** -->
    <select id="selectOdrInfoAttFile" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectOdrInfoAttFile */
        SELECT  T1.LVL,
                CASE WHEN LVL = 1 THEN '주문 증빙' ELSE '고객등록 첨부파일' END DOC_TYPE,
                T1.DOC_REG_ID,
                T2.DOC_REG_SEQ,
                T2.ATFL_NM,
                T2.ATFL_LEN,
                T2.ATFL_STOR_PATH,
                T2.ORI_ATFL_NM
        FROM    (
                SELECT  LVL,
                        CASE WHEN LVL = 1 THEN T1.DOC_REG_ID
                             ELSE T2.DOC_REG_ID  END DOC_REG_ID
                FROM    TB_OD_ODR_MST   T1
                        JOIN
                        TB_OD_ODR_DTL   T2 /*  */
                        ON  T1.CO_CD        = T2.CO_CD
                        AND T1.BZPLC_ID     = T2.BZPLC_ID
                        AND T1.ODR_NO       = T2.ODR_NO
                        CROSS JOIN
                        (SELECT LEVEL LVL FROM DUAL CONNECT BY 2 >= LEVEL) T3
                WHERE   T2.CO_CD = #{CO_CD}
                  AND   T2.BZPLC_ID = #{BZPLC_ID}
                  AND   T2.ODR_NO = #{ODR_NO}
                  AND   T2.ODR_ITM_NO = #{ODR_ITM_NO}
                )       T1
                LEFT JOIN
                TB_CO_ATFL_DTLS     T2
                ON  T2.DOC_REG_ID = T1.DOC_REG_ID
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 연계정보 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-12
        ****************************************************************************** -->
    <select id="selectSndRcvList" parameterType="HashMap" resultType="HashMap">
      /* com.ssp.bo.od.orderList.selectSndRcvList */
        WITH BASE_T AS (
        SELECT  *
        FROM    (
                SELECT   T1.ROWID  RID
                        ,ROW_NUMBER() OVER(PARTITION BY  T1.CO_CD, T1.BZPLC_ID, T1.ODR_NO, T1.ODR_ITM_NO, T1.IF_PI_ID ,T1.ODR_TRANS_DTL_NM, T1.IF_RSLT_FLD_1
                                           ORDER BY NVL(T1.ORI_IF_MSG_ID, T1.IF_MSG_ID) DESC)     RN
                        ,T2.PRD_ID
                        ,T4.MRO_CRT_YN
                        ,T3.COM_DTL_CD_NM   PI_SPR_CD_NM
                        ,T2.CO_CD
                FROM    TB_OD_ODR_TRANS_MST  T1
                        JOIN
                        TB_OD_ODR_DTL        T2
                        ON  T2.CO_CD = T1.CO_CD
                        AND T2.BZPLC_ID = T1.BZPLC_ID
                        AND T2.ODR_NO = T1.ODR_NO
                        AND T2.ODR_ITM_NO = CASE WHEN T1.ODR_ITM_NO IS NULL THEN T2.ODR_ITM_NO ELSE T1.ODR_ITM_NO END
                        JOIN
                        TB_CO_COM_CD_DTL    T3
                        ON  T3.LANG_CD = #{LANG_CD}
                        AND T3.COM_CLSF_CD = 'PI_SPR_CD'
                        AND T3.COM_DTL_CD = T1.IF_PI_ID
                        AND T3.COM_USR_DEFN_NM_1 = 'Y'
                        LEFT JOIN
                        TB_PR_PRD_INFO T4
                        ON  T4.CO_CD = T2.CO_CD
                        AND T4.PRD_ID = T2.PRD_ID
                WHERE   1 = 1
                AND     T1.CO_CD = #{CO_CD}
                <if test="BZPLC_ID != null and !BZPLC_ID.equals('') ">
                AND     T1.BZPLC_ID = #{BZPLC_ID}
                </if>
                <if test="ODR_NO != null and !ODR_NO.equals('') ">
                AND     T1.ODR_NO = #{ODR_NO}
                </if>
                <if test="IF_PI_ID != null and !IF_PI_ID.equals('')">
                AND     T1.IF_PI_ID = #{IF_PI_ID}
                </if>
                AND   CASE WHEN T1.IF_PI_ID = 'SD01730' THEN 'TB_OD_ODR_DTL'
                           WHEN T1.IF_PI_ID = 'FI00300' THEN 'MAIN'
                       ELSE T1.ODR_TRANS_DTL_NM
                  END = T1.ODR_TRANS_DTL_NM
                )   T1
        WHERE   T1.RN = 1
        )
        SELECT
                T1.CO_CD,               /* 회사코드 */
                T1.BZPLC_ID,            /* 사업장ID */
                T1.ODR_NO,              /* 주문번호 */
                T1.ODR_ITM_NO,          /* 주문항목번호 */
                T1.ODR_NO||'-'||T1.ODR_ITM_NO       JNT_ODR_ITM_NO,
                T1.IF_PI_ID,            /* IFPIID */
                T1.IF_SYSTEM_ID,
                T2.PI_SPR_CD_NM     IF_PI_NM,
                T1.IF_MSG_ID,           /* IF메시지ID */
                T1.IF_PROC_RSLT_CD,     /* IF처리결과코드, S:성공, E : 오류 */
                T10.COM_DTL_CD_NM   IF_PROC_RSLT_CD_NM,
                T1.IF_PI_MSG,           /* IFPI메시지 */
                T1.REG_DTM,             /* 등록일시 */
                T1.IF_PROC_RSLT_DTM,    /* IF처리결과일시 */
                T1.IF_MSG_SEQ,          /* IF메시지순번 */
                T1.RETRY_PROC_RSLT_CD,  /* 재시도처리결과코드 */
                NVL(T1.ORI_IF_MSG_ID, T1.IF_MSG_ID)   ORI_IF_MSG_ID,       /* 원IF메시지ID */
                NVL(T1.ORI_IF_MSG_SEQ, T1.IF_MSG_SEQ)  ORI_IF_MSG_SEQ,       /* 원IF메시지순번 */
                LTRIM(T2.PRD_ID, '0')   PRD_ID,
                T11.PRD_NM,
                T12.COM_DTL_CD_NM   MRO_CRT_YN,
                CASE WHEN T1.IF_PI_ID = 'FI00300' THEN T21.CRECD_TECL_NO  ELSE NULL END   TNO,
                CASE WHEN T1.IF_PI_ID = 'FI00300' THEN T21.CRECD_STL_AMT  ELSE NULL END   AMOUNT,
                T1.IF_RSLT_FLD_1    VOC_NO
        FROM    TB_OD_ODR_TRANS_MST  T1
                JOIN
                BASE_T      T2
                ON  T2.RID = T1.ROWID
                LEFT JOIN
                TB_CO_COM_CD_DTL    T10
                ON  T10.LANG_CD = #{LANG_CD}
                AND T10.COM_CLSF_CD = 'IF_PROC_RSLT_CD'
                AND T10.COM_DTL_CD = T1.IF_PROC_RSLT_CD
                LEFT JOIN
                TB_PR_MRO_PRD_INFO T11
                ON  T11.CO_CD = T2.CO_CD
                AND T11.PRD_ID = T2.PRD_ID
                LEFT JOIN
                TB_CO_COM_CD_DTL T12
                ON  T12.LANG_CD = #{LANG_CD}
                AND T12.COM_CLSF_CD = 'MRO_CRT_YN'
                AND T12.COM_DTL_CD = T2.MRO_CRT_YN
                LEFT JOIN
                TB_OD_ODR_CRD_STL_DTLS  T21
                ON  T21.CO_CD = T1.CO_CD
                AND T21.ODR_NO = T1.ODR_NO
                AND T21.CRD_STL_SPR_CD = '10'
        WHERE   T1.CO_CD = #{CO_CD}
          AND   T1.BZPLC_ID = #{BZPLC_ID}
          AND   T1.ODR_NO = #{ODR_NO}
          AND   CASE WHEN T1.IF_PI_ID = 'FI00300' AND T21.ORI_ODR_NO IS NOT NULL THEN '0'
                     ELSE '1' END = '1'
          AND   CASE WHEN T1.IF_PI_ID = 'SD01730' THEN 'TB_OD_ODR_DTL'
                     WHEN T1.IF_PI_ID = 'FI00300' THEN 'MAIN'
                       ELSE T1.ODR_TRANS_DTL_NM
                  END = T1.ODR_TRANS_DTL_NM
        UNION ALL
        SELECT
                A.CO_CD                                                                 /* 회사코드 */
                ,A.BZPLC_ID                                                             /* 사업장ID */
                ,A.ODR_NO                                                               /* 주문번호 */
                ,A.ODR_ITM_NO                                                           /* 주문항목번호 */
                ,A.ODR_NO||'-'||TO_CHAR(A.ODR_ITM_NO)       AS JNT_ODR_ITM_NO           /* 주문항번 */
                ,'FI00300_01'                               AS IF_PI_ID                 /* 선수금카드취소 카드사 전송 */
                ,'SSP'                                      AS IF_SYSTEM_ID             /* SSP */
                ,B.COM_DTL_CD_NM                            AS IF_PI_NM
                ,NVL2(C.TNO,C.CRD_APPR_REQ_SPR_CD||'-'||TO_CHAR(C.LOG_SEQ)||'-'||C.TNO,'_')
                                                            AS IF_MSG_ID                /*NHN KCP 거래 고유번호*/
                ,CASE WHEN C.RES_CD = '0000' THEN 'S' ELSE 'E' END
                                                            AS IF_PROC_RSLT_CD          /* IF처리결과코드, S:성공, E : 오류 */
                ,D.COM_DTL_CD_NM                            AS IF_PROC_RSLT_CD_NM       /* IF처리결과코드명 S:성공, E : 오류 */
                ,CASE WHEN C.RES_CD IS NULL THEN '[----] 미전송' ELSE '['||C.RES_CD||'] '||C.RES_MSG END
                                                            AS IF_PI_MSG                /* IFPI메시지 */
                ,C.REG_DTM                                                              /* 등록일시 */
                ,TO_DATE(C.CANC_TIME DEFAULT NULL ON CONVERSION ERROR , 'YYYYMMDDHH24MISS')
                                                            AS IF_PROC_RSLT_DTM         /* IF처리결과일시 */
                ,1                                          AS IF_MSG_SEQ               /* IF메시지순번 */
                ,NULL                                       AS RETRY_PROC_RSLT_CD       /* 재시도처리결과코드 */
                ,C.CRD_APPR_REQ_SPR_CD||'-'||TO_CHAR(C.LOG_SEQ)||'-'||C.TNO
                                                            AS ORI_IF_MSG_ID            /* 원IF메시지ID */
                ,1                                          AS ORI_IF_MSG_SEQ           /* 원IF메시지순번 */
                ,LTRIM(A.PRD_ID, '0')                       AS PRD_ID
                ,E.PRD_NM
                ,F.COM_DTL_CD_NM                            AS MRO_CRT_YN
                ,C.TNO
                ,TO_NUMBER(C.AMOUNT)  AMOUNT
                ,''    VOC_NO
        FROM    TB_OD_ODR_DTL A
                LEFT JOIN
                TB_CO_COM_CD_DTL B
                    ON (B.LANG_CD = #{LANG_CD}
                    AND B.COM_CLSF_CD = 'PI_SPR_CD'
                    AND B.COM_DTL_CD = 'FI00300_01')
                OUTER APPLY
                (
                    SELECT  C.LOG_SEQ
                            , C.CRD_APPR_REQ_SPR_CD
                            , C.CRD_APMT_SPR_CD
                            , C.CRD_STL_SPR_CD
                            , C.CO_CD
                            , C.BZPLC_ID
                            , C.ODR_NO
                            , C.ODR_ITM_NO
                            , C.TAXINV_UNQ_NO
                            , C.CRD_CNC_TGT_ODR_SEQ
                            , C.LOG_CTS
                            , C.LOG_DISCD_YN
                            , C.REGPSN_ID
                            , C.REG_DTM
                            , Json_Value(C.LOG_CTS,'$.tno')                                             AS TNO                      /*NHN KCP 거래 고유번호*/
                            , Json_Value(C.LOG_CTS,'$.resCd')                                           AS RES_CD                   /*결과 코드*/
                            , Json_Value(C.LOG_CTS,'$.resMsg')                                          AS RES_MSG                  /*결과 메시지*/
                            , Json_Value(C.LOG_CTS,'$.cancTime')                                        AS CANC_TIME                /*취소 시간*/
                            , Json_Value(C.LOG_CTS,'$.cardModMny')                                          As AMOUNT                   /*결제 금액*/
                    FROM    (
                                SELECT
                                        C.LOG_SEQ
                                        , C.CRD_APPR_REQ_SPR_CD
                                        , C.CRD_APMT_SPR_CD
                                        , C.CRD_STL_SPR_CD
                                        , C.CO_CD
                                        , C.BZPLC_ID
                                        , C.ODR_NO
                                        , C.ODR_ITM_NO
                                        , C.TAXINV_UNQ_NO
                                        , C.CRD_CNC_TGT_ODR_SEQ
                                        , C.LOG_CTS
                                        , C.LOG_DISCD_YN
                                        , ROW_NUMBER() OVER ( ORDER BY C.LOG_SEQ DESC )                 AS RN
                                        , C.REGPSN_ID
                                        , C.REG_DTM
                                FROM    TB_AD_CRD_STL_APPR_LOG C
                                WHERE   C.CRD_CNC_TGT_ODR_SEQ = A.CRD_CNC_TGT_ODR_SEQ
                                AND     C.CRD_APPR_REQ_SPR_CD = '5'                                 /*승인취소*/
                                AND     NVL(C.LOG_DISCD_YN,'N') != 'Y'
                            ) C
                    WHERE   C.RN = 1
                ) C
                LEFT JOIN
                TB_CO_COM_CD_DTL D
                    ON (D.LANG_CD = #{LANG_CD}
                    AND D.COM_CLSF_CD = 'IF_PROC_RSLT_CD'
                    AND D.COM_DTL_CD = CASE WHEN C.RES_CD = '0000' THEN 'S' ELSE 'E' END)
                LEFT JOIN
                TB_PR_PRD_INFO E
                    ON (E.CO_CD = A.CO_CD
                    AND E.PRD_ID = A.PRD_ID)
                LEFT JOIN
                TB_CO_COM_CD_DTL F
                    ON (F.LANG_CD = #{LANG_CD}
                    AND F.COM_CLSF_CD = 'MRO_CRT_YN'
                    AND F.COM_DTL_CD = E.MRO_CRT_YN)
        WHERE   1=1
        AND     A.CO_CD = #{CO_CD}
        AND     A.BZPLC_ID = #{BZPLC_ID}
        AND     A.ODR_NO = #{ODR_NO}
        AND     A.CRD_CNC_TGT_ODR_SEQ IS NOT NULL
        <if test="IF_PI_ID != null and !IF_PI_ID.equals('')">
        AND     'FI00300_01' = #{IF_PI_ID}
        </if>
        UNION ALL
        SELECT
                A.CO_CD                                                                 /* 회사코드 */
                ,A.BZPLC_ID                                                             /* 사업장ID */
                ,A.ODR_NO                                                               /* 주문번호 */
                ,A.ODR_ITM_NO                                                           /* 주문항목번호 */
                ,A.ODR_NO||'-'||TO_CHAR(A.ODR_ITM_NO)       AS JNT_ODR_ITM_NO           /* 주문항번 */
                ,'FI00300_02'                               AS IF_PI_ID                 /* 선수금카드취소 카드사 전송 */
                ,'SSP'                                      AS IF_SYSTEM_ID             /* SSP */
                ,B.COM_DTL_CD_NM                            AS IF_PI_NM
                ,Nvl(C3.IF_MSG_ID,'_')                      AS IF_MSG_ID                /*NHN KCP 거래 고유번호*/
                ,CASE
                    WHEN    C2.IF_PROC_RSLT_CD IS NULL THEN 'E'
                    WHEN    C2.IF_PROC_RSLT_CD  = 'E' THEN 'E'
                    WHEN    C3.IF_PROC_RSLT_CD = 'S' THEN 'S'
                    ELSE 'E'
                END                                         AS IF_PROC_RSLT_CD          /* IF처리결과코드, S:성공, E : 오류 */
                ,D.COM_DTL_CD_NM                            AS IF_PROC_RSLT_CD_NM       /* IF처리결과코드명 S:성공, E : 오류 */
                ,CASE
                    WHEN    C2.IF_PROC_RSLT_CD IS NULL THEN '미전송'
                    WHEN    C2.IF_PROC_RSLT_CD  = 'E' THEN C2.IF_PI_MSG
                    WHEN    C3.IF_PROC_RSLT_CD = 'S' THEN C3.IF_PI_MSG
                    ELSE C3.IF_PI_MSG
                END                                         AS IF_PI_MSG                /* IFPI메시지 */
                ,C3.REG_DTM                                                             /* 등록일시 */
                ,C3.IF_PROC_RSLT_DTM                        AS IF_PROC_RSLT_DTM         /* IF처리결과일시 */
                ,C3.IF_MSG_SEQ                              AS IF_MSG_SEQ               /* IF메시지순번 */
                ,C3.RETRY_PROC_RSLT_CD                      AS RETRY_PROC_RSLT_CD       /* 재시도처리결과코드 */
                ,NVL(C3.ORI_IF_MSG_ID,C3.IF_MSG_ID)         AS ORI_IF_MSG_ID            /* 원IF메시지ID */
                ,NVL(C3.ORI_IF_MSG_SEQ,C3.IF_MSG_SEQ)       AS ORI_IF_MSG_SEQ           /* 원IF메시지순번 */
                ,LTRIM(A.PRD_ID, '0')                       AS PRD_ID
                ,E.PRD_NM
                ,F.COM_DTL_CD_NM                            AS MRO_CRT_YN
                ,C.TNO
                ,TO_NUMBER(C.AMOUNT)  AMOUNT
                ,''    VOC_NO
        FROM    TB_OD_ODR_DTL A
                LEFT JOIN
                TB_CO_COM_CD_DTL B
                    ON (B.LANG_CD = #{LANG_CD}
                    AND B.COM_CLSF_CD = 'PI_SPR_CD'
                    AND B.COM_DTL_CD = 'FI00300_02')
                CROSS APPLY
                (
                    SELECT  C.LOG_SEQ
                            , C.CRD_APPR_REQ_SPR_CD
                            , C.CRD_APMT_SPR_CD
                            , C.CRD_STL_SPR_CD
                            , C.CO_CD
                            , C.BZPLC_ID
                            , C.ODR_NO
                            , C.ODR_ITM_NO
                            , C.TAXINV_UNQ_NO
                            , C.CRD_CNC_TGT_ODR_SEQ
                            , C.LOG_CTS
                            , C.LOG_DISCD_YN
                            , C.REGPSN_ID
                            , C.REG_DTM
                            , Json_Value(C.LOG_CTS,'$.tno')                                             AS TNO                      /*NHN KCP 거래 고유번호*/
                            , Json_Value(C.LOG_CTS,'$.resCd')                                           AS RES_CD                   /*결과 코드*/
                            , Json_Value(C.LOG_CTS,'$.resMsg')                                          AS RES_MSG                  /*결과 메시지*/
                            , Json_Value(C.LOG_CTS,'$.cancTime')                                        AS CANC_TIME                /*취소 시간*/
                            , Json_Value(C.LOG_CTS,'$.cardModMny')                                          As AMOUNT                   /*결제 금액*/
                    FROM    (
                                SELECT
                                        C.LOG_SEQ
                                        , C.CRD_APPR_REQ_SPR_CD
                                        , C.CRD_APMT_SPR_CD
                                        , C.CRD_STL_SPR_CD
                                        , C.CO_CD
                                        , C.BZPLC_ID
                                        , C.ODR_NO
                                        , C.ODR_ITM_NO
                                        , C.TAXINV_UNQ_NO
                                        , C.CRD_CNC_TGT_ODR_SEQ
                                        , C.LOG_CTS
                                        , C.LOG_DISCD_YN
                                        , ROW_NUMBER() OVER ( ORDER BY C.LOG_SEQ DESC )                 AS RN
                                        , C.REGPSN_ID
                                        , C.REG_DTM
                                FROM    TB_AD_CRD_STL_APPR_LOG C
                                WHERE   C.CRD_CNC_TGT_ODR_SEQ = A.CRD_CNC_TGT_ODR_SEQ
                                AND     C.CRD_APPR_REQ_SPR_CD = '5'                                 /*승인취소*/
                                AND     NVL(C.LOG_DISCD_YN,'N') != 'Y'
                            ) C
                    WHERE   C.RN = 1
                    AND     Json_Value(C.LOG_CTS,'$.resCd') = '0000'
                ) C
                LEFT JOIN
                TB_OD_ODR_CRD_STL_DTLS C2
                    ON (C2.LOG_SEQ = C.LOG_SEQ
                    AND C2.CRD_APPR_REQ_SPR_CD = C.CRD_APPR_REQ_SPR_CD)
                OUTER APPLY
                (
                    SELECT
                            C3.IF_SYSTEM_ID
                            , C3.IF_PI_ID
                            , C3.IF_MSG_ID
                            , C3.IF_MSG_SEQ
                            , C3.IF_PROC_TP_CD
                            , C3.ODR_TRANS_DTL_NM
                            , C3.CO_CD
                            , C3.BZPLC_ID
                            , C3.ODR_NO
                            , C3.ODR_ITM_NO
                            , C3.IF_PROC_RSLT_CD
                            , C3.IF_PROC_RSLT_DTM
                            , C3.IF_PI_MSG
                            , C3.IF_RSLT_FLD_1
                            , C3.IF_RSLT_FLD_2
                            , C3.IF_RSLT_FLD_3
                            , C3.RETRY_PROC_RSLT_CD
                            , C3.ORI_IF_MSG_ID
                            , C3.ORI_IF_MSG_SEQ
                            , C3.REG_DTM
                    FROM
                            (
                                SELECT
                                        C3.IF_SYSTEM_ID             /* IF시스템ID */
                                        , C3.IF_PI_ID               /* IFPIID */
                                        , C3.IF_MSG_ID              /* IF메시지ID */
                                        , C3.IF_MSG_SEQ             /* IF메시지순번 */
                                        , C3.IF_PROC_TP_CD          /* IF처리유형코드 */
                                        , C3.ODR_TRANS_DTL_NM       /* 주문전송상세명 */
                                        , C3.CO_CD                  /* 회사코드 */
                                        , C3.BZPLC_ID               /* 사업장ID */
                                        , C3.ODR_NO                 /* 주문번호 */
                                        , C3.ODR_ITM_NO             /* 주문항목번호 */
                                        , C3.IF_PROC_RSLT_CD        /* IF처리결과코드 */
                                        , C3.IF_PROC_RSLT_DTM       /* IF처리결과일시 */
                                        , C3.IF_PI_MSG              /* IFPI메시지 */
                                        , C3.IF_RSLT_FLD_1          /* IF결과필드1 */
                                        , C3.IF_RSLT_FLD_2          /* IF결과필드2 */
                                        , C3.IF_RSLT_FLD_3          /* IF결과필드3 */
                                        , C3.RETRY_PROC_RSLT_CD     /* 재시도처리결과코드 */
                                        , C3.ORI_IF_MSG_ID          /* 원IF메시지ID */
                                        , C3.ORI_IF_MSG_SEQ         /* 원IF메시지순번 */
                                        , C3.REG_DTM                /* 등록일시 */
                                        , ROW_NUMBER() OVER (ORDER BY C3.IF_MSG_ID DESC )               AS RN
                                FROM    TB_OD_ODR_TRANS_MST C3
                                WHERE   C3.CO_CD = A.CO_CD
                                AND     C3.BZPLC_ID = A.BZPLC_ID
                                AND     C3.ODR_NO = A.ODR_NO
                                AND     C3.ODR_ITM_NO = A.ODR_ITM_NO
                                AND     C3.IF_PI_ID = 'FI00300'
                                AND     C3.ODR_TRANS_DTL_NM = 'CANCEL'
                            ) C3
                    WHERE   C3.RN = 1
                ) C3
                LEFT JOIN
                TB_CO_COM_CD_DTL D
                    ON (D.LANG_CD = #{LANG_CD}
                    AND D.COM_CLSF_CD = 'IF_PROC_RSLT_CD'
                    AND D.COM_DTL_CD =
                            CASE
                                WHEN    C2.IF_PROC_RSLT_CD IS NULL THEN 'E'
                                WHEN    C2.IF_PROC_RSLT_CD  = 'E' THEN 'E'
                                WHEN    C3.IF_PROC_RSLT_CD = 'S' THEN 'S'
                                ELSE 'E'
                            END
                    )
                LEFT JOIN
                TB_PR_PRD_INFO E
                    ON (E.CO_CD = A.CO_CD
                    AND E.PRD_ID = A.PRD_ID)
                LEFT JOIN
                TB_CO_COM_CD_DTL F
                    ON (F.LANG_CD = #{LANG_CD}
                    AND F.COM_CLSF_CD = 'MRO_CRT_YN'
                    AND F.COM_DTL_CD = E.MRO_CRT_YN)
        WHERE   1=1
        AND     A.CO_CD = #{CO_CD}
        AND     A.BZPLC_ID = #{BZPLC_ID}
        AND     A.ODR_NO = #{ODR_NO}
        AND     A.CRD_CNC_TGT_ODR_SEQ IS NOT NULL
        <if test="IF_PI_ID != null and !IF_PI_ID.equals('')">
        AND     'FI00300_02' = #{IF_PI_ID}
        </if>
        ORDER BY ODR_NO, ODR_ITM_NO, IF_PI_ID DESC
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 연계정보 조회 * 작성자 : neonlee * 작성 일자 : 2022-06-24
        ****************************************************************************** -->
    <select id="selectSndRcvList2" parameterType="HashMap" resultType="HashMap">
       /* com.ssp.bo.od.orderList.selectSndRcvList2 */
     SELECT
             T1.CO_CD,               /* 회사코드 */
             T1.BZPLC_ID,            /* 사업장ID */
             T1.ODR_NO,              /* 주문번호 */
             T1.ODR_ITM_NO,          /* 주문항목번호 */
             T1.ODR_NO||'-'||T1.ODR_ITM_NO       JNT_ODR_ITM_NO,
             T1.IF_PI_ID,            /* IFPIID */
             CASE WHEN T1.IF_PI_ID = 'SD01740' THEN '영업정보'
                  WHEN T1.IF_PI_ID = 'SD01730' THEN '주문상세' END IF_PI_NM,
             T1.IF_MSG_ID,           /* IF메시지ID */
             T1.IF_PROC_RSLT_CD,     /* IF처리결과코드, S:성공, E : 오류 */
             T10.COM_DTL_CD_NM   IF_PROC_RSLT_CD_NM,
             T1.IF_PI_MSG,           /* IFPI메시지 */
             T1.REG_DTM,             /* 등록일시 */
             T1.IF_PROC_RSLT_DTM,    /* IF처리결과일시 */
             T1.IF_MSG_SEQ,          /* IF메시지순번 */
             T1.RETRY_PROC_RSLT_CD,  /* 재시도처리결과코드 */
             T1.ORI_IF_MSG_ID,       /* 원IF메시지ID */
             T1.ORI_IF_MSG_SEQ,       /* 원IF메시지순번 */
             LTRIM(T2.PRD_ID, '0') PRD_ID,
             T3.PRD_NM,
             T11.COM_DTL_CD_NM      IF_PI_NM
     FROM    TB_OD_ODR_TRANS_MST  T1
             LEFT JOIN
             TB_OD_ODR_DTL T2
             ON  T2.CO_CD = T1.CO_CD
             AND T2.BZPLC_ID = T1.BZPLC_ID
             AND T2.ODR_NO = T1.ODR_NO
             AND T2.ODR_ITM_NO = CASE WHEN T1.ODR_ITM_NO IS NULL THEN T2.ODR_ITM_NO ELSE T1.ODR_ITM_NO END
             LEFT JOIN
             TB_CO_COM_CD_DTL    T10
             ON  T10.LANG_CD = #{LANG_CD}
             AND T10.COM_CLSF_CD = 'IF_PROC_RSLT_CD'
             AND T10.COM_DTL_CD = T1.IF_PROC_RSLT_CD
             LEFT JOIN
             TB_CO_COM_CD_DTL    T11
             ON  T11.LANG_CD = #{LANG_CD}
             AND T11.COM_CLSF_CD = 'PI_SPR_CD'
             AND T11.COM_DTL_CD = T1.IF_PI_ID
             AND T11.COM_USR_DEFN_NM_1 = 'Y'
             LEFT JOIN
             TB_PR_PRD_INFO     T12
             ON  T12.CO_CD = T2.CO_CD
             AND T12.PRD_ID = T2.PRD_ID
     WHERE   T1.CO_CD = #{CO_CD}
       AND   T1.BZPLC_ID = #{BZPLC_ID}
       AND   T1.ODR_NO = #{ODR_NO}
       AND   T1.IF_PI_ID IN ('SD01740','SD01730')
       AND   T1.ODR_TRANS_DTL_NM IN ('MAIN','TB_OD_ODR_DTL')
       AND   #{ORI_IF_MSG_ID} IN (T1.IF_MSG_ID,T1.ORI_IF_MSG_ID)
       AND   #{ORI_IF_MSG_SEQ} IN (T1.IF_MSG_SEQ, T1.ORI_IF_MSG_SEQ)
     ORDER BY T1.ODR_NO,T1.ODR_ITM_NO,T1.IF_PI_ID DESC, T1.IF_MSG_ID, T1.IF_MSG_SEQ
     </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 정산정보 기본 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-12
        ****************************************************************************** -->
    <select id="selectAdjInfo" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectAdjInfo */
        SELECT  T2.CO_CD,           /* 회사코드 */
                T2.BZPLC_ID,        /* 사업장ID */
                T2.ODR_NO,          /* 주문번호 */
                T2.ODR_ITM_NO,      /* 주문항목번호 */
                T4.GI_STATS_CD,     /* 입고상태 */
                CASE WHEN T4.GI_STATS_CD = '01' THEN '입고 완료' ELSE '미 입고' END    GI_STATS_CD_NM,
                CASE WHEN T4.GI_STATS_CD = '01' THEN '검수 완료' ELSE '미 검수' END    VERF_STATS_CD_NM,       -- 검수상태
                T21.COM_DTL_CD_NM   ADJ_STATS_CD_NM,    -- 정산상태
                T5.ADJ_DD,
                T1.STL_MEAN_CD,
                CASE WHEN T1.STL_MEAN_CD IS NOT NULL OR T11.COM_DTL_CD_NM IS NOT NULL
                         THEN T1.STL_MEAN_CD || ' | ' || T11.COM_DTL_CD_NM END      STL_MEAN_CD_NM,
                T5.BILCLT_COND_CD,
                CASE WHEN T5.BILCLT_COND_CD IS NOT NULL OR T12.COM_DTL_CD_NM IS NOT NULL
                         THEN T5.BILCLT_COND_CD || ' | ' || T12.COM_DTL_CD_NM END   BILCLT_COND_CD_NM,
                T3.ELMN_QTY,
                NVL(T2.IRCPS_CMPL_YN, 'N')  IRCPS_CMPL_YN,       /* 선수금완료여부 */
                NVL(T2.IRCPS_CMPL_YN, 'N') || ' | ' || T13.COM_DTL_CD_NM    IRCPS_CMPL_YN_NM
        FROM    TB_OD_ODR_MST   T1
                JOIN
                TB_OD_ODR_DTL   T2 /*  */
                ON  T1.CO_CD        = T2.CO_CD
                AND T1.BZPLC_ID     = T2.BZPLC_ID
                AND T1.ODR_NO       = T2.ODR_NO
                LEFT JOIN
                TB_OD_ODR_TRMN_DTLS T3
                ON  T3.CO_CD        = T2.CO_CD
                AND T3.BZPLC_ID     = T2.BZPLC_ID
                AND T3.ODR_NO       = T2.ODR_NO
                AND T3.ODR_ITM_NO   = T2.ODR_ITM_NO
                LEFT JOIN
                TB_AD_GI_DCN_PROC   T4
                ON  T4.CO_CD        = T2.CO_CD
                AND T4.BZPLC_ID     = T2.BZPLC_ID
                AND T4.ODR_NO       = T2.ODR_NO
                AND T4.ODR_ITM_NO   = T2.ODR_ITM_NO
                JOIN
                TB_CC_OPR_UNIT_BASIS    T5
                ON  T5.CO_CD        = T1.CO_CD
                AND T5.BZPLC_ID     = T1.BZPLC_ID
                AND T5.OPR_UNIT_ID  = T1.OPR_UNIT_ID
                LEFT JOIN
                TB_CO_COM_CD_DTL    T10
                ON  T10.LANG_CD = #{LANG_CD}
                AND T10.COM_CLSF_CD = 'GI_STATS_CD'
                AND T10.COM_DTL_CD = T4.GI_STATS_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL    T11
                ON  T11.LANG_CD = #{LANG_CD}
                AND T11.COM_CLSF_CD = 'STL_MEAN_CD'
                AND T11.COM_DTL_CD = T1.STL_MEAN_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL    T12
                ON  T12.LANG_CD = #{LANG_CD}
                AND T12.COM_CLSF_CD = 'BILCLT_COND_CD'
                AND T12.COM_DTL_CD = T5.BILCLT_COND_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL    T13
                ON  T13.LANG_CD = #{LANG_CD}
                AND T13.COM_CLSF_CD = 'MAND_YN'
                AND T13.COM_DTL_CD = NVL(T2.IRCPS_CMPL_YN, 'N')
                LEFT JOIN
                TB_CO_COM_CD_DTL    T21
                ON  T21.LANG_CD = #{LANG_CD}
                AND T21.COM_CLSF_CD = 'SALE_ADJ_STATS_CD'
                AND T21.COM_DTL_CD = NVL(T2.SALE_ADJ_STATS_CD,'90')
        WHERE   T2.CO_CD = #{CO_CD}
          AND   T2.BZPLC_ID = #{BZPLC_ID}
          AND   T2.ODR_NO = #{ODR_NO}
          AND T2.ODR_ITM_NO = #{ODR_ITM_NO}
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 정산정보 고객 입고/검수 현황 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-12
        ****************************************************************************** -->
    <select id="selectAdjGiVerfInfo" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectAdjGiVerfInfo */
        SELECT  T2.GDPSN_ID,            /* 입고자ID */
                NVL(NVL(T12.MBR_NM,T13.OPRTR_NM),'SYSTEM')  GDPSN_NM,
                T2.GI_QTY,              /* 입고수량 */
                T2.UNIT_CD,             /* 단위코드 */
                T2.GI_DCN_DT,           /* 입고확정일자 */
                T2.GI_REG_DTM,          /* 입고등록일시 */
                T2.GI_MEMO_CTS,         /* 입고메모내용 */
                T2.AUTO_GI_YN           /* 자동입고여부 */
        FROM   TB_AD_GI_DCN_PROC T2     /* 입고확정처리 */
               LEFT JOIN
               TB_CC_MBR_BASIS         T12
               ON  T12.CO_CD   = T2.CO_CD
               AND T12.MBR_ID  = T2.GDPSN_ID
               LEFT JOIN
               TB_CO_MBR_OPRTR_INFO    T13
               ON  T13.CO_CD    = T2.CO_CD
               AND T13.OPRTR_ID = T2.GDPSN_ID
        WHERE  T2.CO_CD = #{CO_CD}
          AND  T2.BZPLC_ID = #{BZPLC_ID}
          AND  T2.ODR_NO = #{ODR_NO}
          AND  T2.ODR_ITM_NO = #{ODR_ITM_NO}
          AND  T2.GI_STATS_CD = '01'        /* 입고상태가 입고(01)만 조회 */
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 정산정보 고객검수현황 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-12
        ****************************************************************************** -->
    <select id="selectAdjCustVerfInfo" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectAdjCustVerfInfo */
        SELECT  T2.CO_CD,               /* 회사코드 */
                T2.BZPLC_ID,            /* 사업장ID */
                T2.ODR_NO,              /* 주문번호 */
                T2.ODR_ITM_NO,          /* 주문항목번호 */
                T2.ADJ_FW_ITM_SEQ,      /* 정산이월항목순번 */
                T2.ADJ_YM,              /* 정산년월 */
                T2.ORI_ADJ_YM,
                T3.ODR_QTY ,
                T2.VERF_QTY,            /* 검수수량 */
                T3.SELL_UNIT_CD,
                T2.ADJ_MM_CHG_RSN_CD,   /* 정산월변경사유코드 */
                T10.COM_DTL_CD_NM   ADJ_MM_CHG_RSN_CD_NM,
                CASE WHEN T2.ADJ_STATS_CD = '20' THEN NVL(T2.ADJ_DCN_DEALR_ID,T2.UPDPSN_ID)||' | '||NVL(T22.MBR_NM,T23.OPRTR_NM)
                     ELSE NULL END ADJ_DCN_DEALR_ID,    /* 정산확정처리자ID */
                T2.ADJ_STATS_CD     SALE_ADJ_STATS_CD,
                NVL(T11.COM_DTL_CD_NM,'미정산')   SALE_ADJ_STATS_CD_NM
        FROM    TB_AD_ADJ_FW_PROC   T2  /* 정산이월처리 */
                JOIN
                TB_OD_ODR_DTL   T3
                ON  T3.CO_CD        = T2.CO_CD
                AND T3.BZPLC_ID     = T2.BZPLC_ID
                AND T3.ODR_NO       = T2.ODR_NO
                AND T3.ODR_ITM_NO   = T2.ODR_ITM_NO
                LEFT JOIN
                TB_CO_COM_CD_DTL    T10
                ON  T10.LANG_CD = #{LANG_CD}
                AND T10.COM_CLSF_CD = 'ADJ_MM_CHG_RSN_CD'
                AND T10.COM_DTL_CD = T2.ADJ_MM_CHG_RSN_CD
                LEFT JOIN
                TB_CO_COM_CD_DTL    T11
                ON  T11.LANG_CD = #{LANG_CD}
                AND T11.COM_CLSF_CD = 'ADJ_STATS_CD'
                AND T11.COM_DTL_CD = T2.ADJ_STATS_CD
                LEFT JOIN
               TB_CC_MBR_BASIS         T22
               ON  T22.CO_CD   = T2.CO_CD
               AND T22.MBR_ID  = NVL(T2.ADJ_DCN_DEALR_ID,T2.UPDPSN_ID)
               LEFT JOIN
               TB_CO_MBR_OPRTR_INFO    T23
               ON  T23.CO_CD    = T2.CO_CD
               AND T23.OPRTR_ID = NVL(T2.ADJ_DCN_DEALR_ID,T2.UPDPSN_ID)
        WHERE   T2.CO_CD = #{CO_CD}
          AND   T2.BZPLC_ID = #{BZPLC_ID}
          AND   T2.ODR_NO = #{ODR_NO}
          AND   T2.ODR_ITM_NO = #{ODR_ITM_NO}
        ORDER BY 1,2,3,4,5
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 물량배분 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-12
        ****************************************************************************** -->
    <select id="selectQtyDstrList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectQtyDstrList */
        SELECT  T1.ORI_ODR_ITM_NO,
                T1.SPLT_REF_ITM_NO,
                T1.NEW_ODR_ITM_NO,
                T1.ODR_ITM_NO,
                T1.ORI_ODR_QTY,
                T1.ORI_SALE_AMT,
                T1.ODR_QTY,
                T1.SALE_AMT,
                T1.REGPSN_ID,
                NVL(T2.MBR_NM,T3.OPRTR_NM)  REGPSN_NM,
                T1.REG_DTM
        FROM    (
                SELECT T1.CO_CD,
                       T1.BZPLC_ID,
                       CASE WHEN T1.ODR_NO IS NOT NULL OR T1.SPLT_REF_ITM_NO IS NOT NULL
                                THEN T1.ODR_NO || '-' || T1.SPLT_REF_ITM_NO END     ORI_ODR_ITM_NO,
                       T1.SPLT_REF_ITM_NO,
                       CASE WHEN T1.ODR_NO IS NOT NULL OR T1.ODR_ITM_NO IS NOT NULL
                                THEN T1.ODR_NO || '-' || T1.ODR_ITM_NO END      NEW_ODR_ITM_NO,
                       T1.ODR_ITM_NO,
                       CASE WHEN T1.SPLT_REF_ITM_NO = T1.ODR_ITM_NO THEN T1.ORI_ODR_QTY ELSE 0 END ORI_ODR_QTY,
                       CASE WHEN T1.SPLT_REF_ITM_NO = T1.ODR_ITM_NO THEN SUM(T1.SALE_AMT) OVER() ELSE 0 END    ORI_SALE_AMT,
                       T1.ODR_QTY,
                       T1.SALE_AMT,
                       CASE WHEN T1.SPLT_REF_ITM_NO = T1.ODR_ITM_NO THEN LEAD(T1.REGPSN_ID) OVER(ORDER BY T1.ODR_ITM_NO)
                            ELSE T1.REGPSN_ID END REGPSN_ID,
                       CASE WHEN T1.SPLT_REF_ITM_NO = T1.ODR_ITM_NO THEN LEAD(T1.REG_DTM) OVER(ORDER BY T1.ODR_ITM_NO)
                            ELSE T1.REG_DTM END REG_DTM
                FROM   (
                        SELECT DISTINCT CO_CD,BZPLC_ID,ODR_NO,SPLT_REF_ITM_NO
                        FROM   TB_OD_ODR_DTL        T1
                        WHERE  T1.CO_CD = #{CO_CD}
                          AND  T1.BZPLC_ID = #{BZPLC_ID}
                          AND  T1.ODR_NO = #{ODR_NO}
                          AND  T1.QTY_DSTR_STATS_CD = '02'
                          AND  ( T1.SPLT_REF_ITM_NO = #{ODR_ITM_NO} OR T1.ODR_ITM_NO = #{ODR_ITM_NO})
                          AND  T1.ODR_QTY != T1.ORI_ODR_QTY
                          )         T0
                        JOIN
                          TB_OD_ODR_DTL     T1
                          ON   T1.CO_CD = T0.CO_CD
                          AND  T1.BZPLC_ID = T0.BZPLC_ID
                          AND  T1.ODR_NO = T0.ODR_NO
                          AND  T1.SPLT_REF_ITM_NO = T0.SPLT_REF_ITM_NO
                )       T1
                 LEFT JOIN
                TB_CC_MBR_BASIS         T2
                ON  T2.CO_CD   = T1.CO_CD
                AND T2.MBR_ID  = T1.REGPSN_ID
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO    T3
                ON  T3.CO_CD    = T1.CO_CD
                AND T3.OPRTR_ID = T1.REGPSN_ID
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 분납정보 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-12
        ****************************************************************************** -->
    <select id="selectDvdpayList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectDvdpayList */
        WITH ROOT_T AS (
        SELECT  T1.CO_CD,T1.BZPLC_ID,T1.ODR_NO,T1.ODR_ITM_NO
        FROM    (
                SELECT
                       T1.CO_CD,T1.BZPLC_ID,T1.ODR_NO,T1.ODR_ITM_NO,T1.DVDPAY_AFTH_ITM_NO,
                       ROW_NUMBER() OVER(ORDER BY T1.ODR_ITM_NO ) RN
                FROM   TB_OD_DVDPAY_DTL     T1
                  START WITH (
                       T1.CO_CD = #{CO_CD}
                  AND  T1.BZPLC_ID = #{BZPLC_ID}
                  AND  T1.ODR_NO = #{ODR_NO}
                  AND  T1.ODR_ITM_NO = #{ODR_ITM_NO}
                  AND  T1.DVDPAY_AFTH_ITM_NO = #{ODR_ITM_NO}
                  )
                  CONNECT BY    NOCYCLE PRIOR T1.CO_CD = T1.CO_CD
                          AND   PRIOR T1.BZPLC_ID = T1.BZPLC_ID
                          AND   PRIOR T1.ODR_NO = T1.ODR_NO
                          AND   PRIOR T1.ODR_ITM_NO = T1.DVDPAY_AFTH_ITM_NO
                )   T1
        WHERE RN = '1'
        ),
        BASE_T AS (
        --CONNECT BY 수행
        SELECT DISTINCT
               T1.CO_CD,T1.BZPLC_ID,T1.ODR_NO,T1.ODR_ITM_NO,T1.DVDPAY_AFTH_ITM_NO
        FROM   TB_OD_DVDPAY_DTL     T1
          START WITH (T1.CO_CD,T1.BZPLC_ID,T1.ODR_NO,T1.ODR_ITM_NO,T1.DVDPAY_AFTH_ITM_NO)
                IN  (SELECT CO_CD,BZPLC_ID,ODR_NO,ODR_ITM_NO,ODR_ITM_NO FROM ROOT_T)
          CONNECT BY    NOCYCLE PRIOR T1.CO_CD = T1.CO_CD
                  AND   PRIOR T1.BZPLC_ID = T1.BZPLC_ID
                  AND   PRIOR T1.ODR_NO = T1.ODR_NO
                  AND   PRIOR T1.DVDPAY_AFTH_ITM_NO = T1.ODR_ITM_NO
          ORDER SIBLINGS BY T1.DVDPAY_AFTH_ITM_NO
        )
        SELECT  T1.ORI_JNT_ODR_ITM_NO,
                T1.NEW_JNT_ODR_ITM_NO,
                T1.ORI_ODR_QTY,
                T1.ORI_SALE_AMT,
                T1.ODR_QTY,
                T1.SALE_AMT,
                T1.REGPSN_ID,
                NVL(T2.MBR_NM,T3.OPRTR_NM)  REGPSN_NM,
                T1.REG_DTM,
                CASE WHEN NEW_ODR_ITM_NO = #{ODR_ITM_NO} THEN '1' ELSE '0' END IS_ORIGINAL
        FROM    (
                SELECT T2.CO_CD,
                       T2.BZPLC_ID,
                       T1.ODR_ITM_NO      ORI_ODR_ITM_NO,
                       CASE WHEN T2.ODR_NO IS NOT NULL OR T1.ODR_ITM_NO IS NOT NULL
                                THEN T2.ODR_NO || '-' || T1.ODR_ITM_NO END      ORI_JNT_ODR_ITM_NO,
                       T2.ODR_ITM_NO       NEW_ODR_ITM_NO,
                       CASE WHEN T2.ODR_NO IS NOT NULL OR T2.ODR_ITM_NO IS NOT NULL
                                THEN T2.ODR_NO || '-' || T2.ODR_ITM_NO END      NEW_JNT_ODR_ITM_NO,
                       T2.ORI_ODR_QTY,
                       T2.ORI_ODR_QTY * (SUM(T2.SALE_AMT) OVER())
                       / (SUM(T2.ODR_QTY) OVER())  ORI_SALE_AMT,
                       T2.ODR_QTY,
                       T2.SALE_AMT,
                       CASE WHEN T1.DVDPAY_AFTH_ITM_NO = T1.ODR_ITM_NO THEN LEAD(T2.REGPSN_ID) OVER(ORDER BY T2.ODR_ITM_NO)
                            ELSE T2.REGPSN_ID END REGPSN_ID,
                       CASE WHEN T1.DVDPAY_AFTH_ITM_NO = T1.ODR_ITM_NO THEN LEAD(T2.REG_DTM) OVER(ORDER BY T2.ODR_ITM_NO)
                            ELSE T2.REG_DTM END REG_DTM
                FROM   BASE_T           T1
                       JOIN
                       TB_OD_ODR_DTL    T2
                       ON  T1.CO_CD        = T2.CO_CD
                       AND T1.BZPLC_ID     = T2.BZPLC_ID
                       AND T1.ODR_NO       = T2.ODR_NO
                       AND T1.DVDPAY_AFTH_ITM_NO   = T2.ODR_ITM_NO
                )       T1
                 LEFT JOIN
                TB_CC_MBR_BASIS         T2
                ON  T2.CO_CD   = T1.CO_CD
                AND T2.MBR_ID  = T1.REGPSN_ID
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO    T3
                ON  T3.CO_CD    = T1.CO_CD
                AND T3.OPRTR_ID = T1.REGPSN_ID
        ORDER BY T1.ORI_ODR_ITM_NO,T1.NEW_ODR_ITM_NO
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 예외처리기본 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-12
        ****************************************************************************** -->
    <select id="selectExcProcList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectExcProcList */
        SELECT  T1.VOC_NO,
                T1.VOC_ITM_NO,
                T1.VOC_SCLS_CD,
                T1.SCLS_NM,
                JNT_VOC_NO,
                T1.VOC_STATS_CD,
                T2.COM_DTL_CD_NM  VOC_STATS_NM,
                T1.ODR_QTY,
                T1.SELL_UNIT_CD,
                T1.PROC_DTM,
                T1.CMPL_DTM,
                CASE WHEN T1.EXCEPT_PROC_ODR_NO IS NOT NULL OR T1.EXCEPT_PROC_ODR_ITM_NO IS NOT NULL
                         THEN T1.EXCEPT_PROC_ODR_NO || '-' || T1.EXCEPT_PROC_ODR_ITM_NO END     JNT_EXCEPT_ODR_NO,
                T1.GCLS_NM
        FROM    (
                SELECT T1.VOC_NO,
                       T1.VOC_ITM_NO,
                       T1.VOC_SCLS_CD,
                       T2.SCLS_NM,
                       CASE WHEN T1.VOC_NO IS NOT NULL OR T1.VOC_ITM_NO IS NOT NULL
                                THEN T1.VOC_NO || '-' || T1.VOC_ITM_NO END  JNT_VOC_NO,
                       T1.VOC_STATS_CD,
                       T1.ODR_QTY,
                       T1.SELL_UNIT_CD,
                       T3.PROC_DTM,
                       T3.DEALR_ID,
                       T3.CMPL_DTM,
                       T3.CMPLPSN_ID,
                       T4.EXCEPT_PROC_ODR_NO,
                       T4.EXCEPT_PROC_ODR_ITM_NO,
                       T1.VOC_GCLS_CD,
                       T5.GCLS_NM
                FROM   TB_VO_VOC_DTL  T1
                       JOIN
                       TB_VO_VOC_SCLS_BASIS     T2
                       ON  T2.VOC_GCLS_CD  = T1.VOC_GCLS_CD
                       AND T2.VOC_MCLAS_CD = T1.VOC_MCLAS_CD
                       AND T2.VOC_SCLS_CD  = T1.VOC_SCLS_CD
                       LEFT JOIN
                       TB_VO_VOC_TRSF_PROC      T3
                       ON  T3.CO_CD   =  T1.CO_CD
                       AND T3.VOC_NO  =  T1.VOC_NO
                       AND T3.VOC_ITM_NO = T1.VOC_ITM_NO
                       LEFT  JOIN
                       TB_VO_VOC_EXCEPT_PROC    T4
                       ON  T4.CO_CD   =  T1.CO_CD
                       AND T4.VOC_NO  =  T1.VOC_NO
                       AND T4.VOC_ITM_NO = T1.VOC_ITM_NO
                       LEFT JOIN
                       TB_VO_VOC_GCLS_BASIS T5
                       ON  T5.VOC_GCLS_CD = T1.VOC_GCLS_CD
                       AND T5.USE_YN = 'Y'
                WHERE  1=1
                  AND  T1.ODR_NO = #{ODR_NO}
                  AND  T1.ODR_ITM_NO = #{ODR_ITM_NO}
                  AND  T1.CO_CD = #{CO_CD}
                )       T1
                LEFT JOIN
                SSP_APP.TB_CO_COM_CD_DTL    T2
                ON  T2.LANG_CD = #{LANG_CD}
                AND T2.COM_CLSF_CD = 'VOC_STATS_CD'
                AND T2.COM_DTL_CD = T1.VOC_STATS_CD
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 예외처리 VOC배송정보1 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-12
        ****************************************************************************** -->
    <select id="selectExcProcVocDlv01Info" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectExcProcVocDlv01Info */
        SELECT  T1.DLV_FORM_SPR_CD,
                T2.COM_DTL_CD_NM  DLV_FORM_NM,
                T1.CPRTCP_ID,
                T3.CPRTCP_KOR_NM,
                CASE WHEN T1.CPRTCP_ID IS NOT NULL OR T3.CPRTCP_KOR_NM IS NOT NULL
                         THEN T1.CPRTCP_ID || ' | ' || T3.CPRTCP_KOR_NM END     CPRTCP_ID_NM,
                T1.SCLS_NM,
                T1.VOC_STATS_CD,
                T1.GI_HUB_CD,
                T4.PLNT_NM,
                T1.PROC_DTM,
                T1.CMPL_DTM,
                TRUNC(T1.CMPL_DTM - T1.PROC_DTM)  LEAD_TIME
        FROM    (
                SELECT T1.CO_CD,
                        T1.VOC_SCLS_CD,
                       T2.SCLS_NM,
                       CASE WHEN T1.VOC_NO IS NOT NULL OR T1.VOC_ITM_NO IS NOT NULL
                                THEN T1.VOC_NO || '-' || T1.VOC_ITM_NO END      JNT_VOC_NO,
                       T1.VOC_STATS_CD,
                       T4.ODR_EXCEPT_KND_CD,
                       T4.EXCEPT_PROC_STATS_CD,
                       T4.DLV_FORM_CD  DLV_FORM_SPR_CD,
                       T4.CPRTCP_ID,
                       T4.GI_HUB_CD,
                       NVL(T4.EXCEPT_PROC_REG_DTM,T3.PROC_DTM)      PROC_DTM,
                       NVL(T4.EXCEPT_PROC_CMPL_DTM,T3.CMPL_DTM)     CMPL_DTM
                FROM   TB_VO_VOC_DTL  T1
                       JOIN
                       TB_VO_VOC_SCLS_BASIS     T2
                       ON  T2.VOC_GCLS_CD  = T1.VOC_GCLS_CD
                       AND T2.VOC_MCLAS_CD = T1.VOC_MCLAS_CD
                       AND T2.VOC_SCLS_CD  = T1.VOC_SCLS_CD
                       LEFT JOIN
                       TB_VO_VOC_TRSF_PROC      T3
                       ON  T3.CO_CD   =  T1.CO_CD
                       AND T3.VOC_NO  =  T1.VOC_NO
                       AND T3.VOC_ITM_NO = T1.VOC_ITM_NO
                       LEFT  JOIN
                       TB_VO_VOC_EXCEPT_PROC    T4
                       ON  T4.CO_CD   =  T1.CO_CD
                       AND T4.VOC_NO  =  T1.VOC_NO
                       AND T4.VOC_ITM_NO = T1.VOC_ITM_NO
                WHERE  1=1
                  AND  T1.CO_CD = #{CO_CD}
                  AND  T1.VOC_NO = #{VOC_NO}
                  AND  T1.VOC_ITM_NO = #{VOC_ITM_NO}
                )       T1
                LEFT JOIN
                SSP_APP.TB_CO_COM_CD_DTL    T2
                ON  T2.LANG_CD = #{LANG_CD}
                AND T2.COM_CLSF_CD = 'DLV_FORM_SPR_CD'
                AND T2.COM_DTL_CD = T1.DLV_FORM_SPR_CD
                LEFT JOIN
                SSP_APP.TB_CP_CPRTCP_BASIS  T3
                ON  T3.CO_CD = T1.CO_CD
                AND T3.CPRTCP_ID = T1.CPRTCP_ID
                LEFT JOIN
                SSP_APP.TB_DL_PLNT_BASIS  T4
                ON  T4.CO_CD = T1.CO_CD
                AND T4.PLNT_ID = T1.GI_HUB_CD
    </select>

    <!-- ******************************************************************************
        * SELECT : 주문상세 예외처리 VOC배송정보2 조회 * 작성자 : neonlee * 작성 일자 : 2022-04-12
        ****************************************************************************** -->
    <select id="selectExcProcVocDlv02Info" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectExcProcVocDlv02Info */
        SELECT  T1.EXCEPT_PROC_STATS_CD,
                T2.COM_DTL_CD_NM  EXCEPT_PROC_STATS_NM,
                T1.PROC_DTM ,
                T1.REGPSN_ID
        FROM    TB_VO_VOC_EXCEPT_PROC_STATS_INFO        T1
                LEFT JOIN
                SSP_APP.TB_CO_COM_CD_DTL    T2
                ON  T2.LANG_CD = #{LANG_CD}
                AND T2.COM_CLSF_CD = 'EXCEPT_PROC_STATS_CD'
                AND T2.COM_DTL_CD = T1.EXCEPT_PROC_STATS_CD
        WHERE  1=1
          AND  T1.CO_CD = #{CO_CD}
          AND  T1.VOC_NO = #{VOC_NO}
          AND  T1.VOC_ITM_NO = #{VOC_ITM_NO}
        ORDER BY T1.PROC_DTM
    </select>


    <!-- ******************************************************************************
        * SELECT : 주문대행고객로그인 조회 * 작성자 : neonlee * 작성 일자 : 2022-05-03
        ****************************************************************************** -->
    <select id="selectMbrList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectMbrList */
        SELECT
                T1.CO_CD                         /* 회사코드 */
                , T1.MBR_ID                      /* 회원ID */
                , T1.MBR_NM                      /* 회원이름 */
                , T1.BZPLC_ID                    /* 사업장ID */
                , T1.DEPT_ID                     /* 부서ID */
                , T1.DRMC_YN                     /* 휴면화여부 */
                , T1.UT_AGRE_YN                  /* 이용동의여부 */
                , T1.CLT_AGRE_YN                 /* 수집동의여부 */
                , T1.BZPLC_NM                    /* 사업장명 */
                , T1.ODR_AGNC_USE_YN             /* 주문대행사용여부 */
                , T1.DEPT_NM                      /* 부서명 */
                , T1.ADJ_SPR_CD                  /* 정산구분코드 */
                , T1.OPR_UNIT_ID                 /* 운영단위ID */
                , T1.OPR_UNIT_NM                 /* 운영단위명 */
                , T1.MONTHLY_ADJ_YN
                , T1.MBR_USE_CD                   /* 회원상태 */
                , T1.MBR_USE_CD_NM
                , T1.COM_DTL_CD                  /* 고객유형ID */
                , T1.CUST_SPR_CD
                , T1.LOGN_ID
                , T1.BASE_APRV_NM
                , T1.BASE_ORDER_NM
                , T1.BASE_DLVPLC_ID  --기본배송지
                , T1.APRV_AUTH_SPR
                , T1.APRV_AUTH_SPR_YN
                , T1.ORD_AUTH_SPR
                , T1.ORD_AUTH_SPR_YN
                , T1.APRV_SPR
                , T1.OPSN_SPR
                , T1.ACCT_SPR
                , T1.BGT_AUTH_SPR
                , T1.BGT_OVER_SPR
                , T1.BLNG_DEPT_SPR
                , T1.REQ_CD_1
                , T1.REQ_CD_2
                , T1.REQ_CD_3
                , T1.REQ_CD_4
                , T1.REQ_CD_5
                , T1.OSHT_CD_SEQ_1
                , T1.OSHT_CD_SEQ_2
                , T1.OSHT_CD_SEQ_3
                , T1.OSHT_CD_SEQ_4
                , T1.OSHT_CD_SEQ_5
                , T1.APRV_AUTH_USE_YN
                , T1.ORD_AUTH_USE_YN
        FROM    (
                Select  /*+use_hash(a c) full(a) full(c) */
                        a.CO_CD                         /* 회사코드 */
                        , a.MBR_ID                      /* 회원ID */
                        , a.MBR_NM                      /* 회원이름 */
                        , a.BZPLC_ID                    /* 사업장ID */
                        , a.DEPT_ID                     /* 부서ID */
                        , a.DRMC_YN                     /* 휴면화여부 */
                        , a.UT_AGRE_YN                  /* 이용동의여부 */
                        , a.CLT_AGRE_YN                 /* 수집동의여부 */
                        , b.BZPLC_NM                    /* 사업장명 */
                        , c.ODR_AGNC_USE_YN             /* 주문대행사용여부 */
                        , d.DEPT_NM                      /* 부서명 */
                        , e.ADJ_SPR_CD                  /* 정산구분코드 */
                        , e.OPR_UNIT_ID                 /* 운영단위ID */
                        , e.OPR_UNIT_NM                 /* 운영단위명 */
                        , Case When T21.OPR_UNIT_ID IS NOT NULL THEN 'Y' Else 'N' End      MONTHLY_ADJ_YN
                        , g.COM_DTL_CD                   /* 회원상태 */  MBR_USE_CD
                        , g.COM_DTL_CD_NM               /* 회원상태명*/              MBR_USE_CD_NM
                        , h.COM_DTL_CD                  /* 고객유형ID */
                        , h.COM_DTL_CD_NM              /* 고객유형 */                CUST_SPR_CD
                        , T10.LOGN_ID
                        , SSP_APP.FN_OD_GET_BASE_APRVR_NM(a.CO_CD,a.MBR_ID,'A')  BASE_APRV_NM
                        , SSP_APP.FN_OD_GET_BASE_APRVR_NM(a.CO_CD,a.MBR_ID,'O')  BASE_ORDER_NM
                        , T11.DLVPLC_ID   BASE_DLVPLC_ID  --기본배송지
                        , CASE WHEN NVL(T9.APRV_AUTH_USE_YN, 'N') = 'Y' THEN '사용' ELSE '미사용' END APRV_AUTH_SPR
                        , NVL(T9.APRV_AUTH_USE_YN, 'N')     APRV_AUTH_SPR_YN
                        , CASE WHEN NVL(T9.ORD_AUTH_USE_YN, 'N') = 'Y' THEN '사용' ELSE '미사용' END ORD_AUTH_SPR
                        , NVL(T9.ORD_AUTH_USE_YN, 'N')      ORD_AUTH_SPR_YN
                        , CASE WHEN NVL(f.APRV_AUTH_USE_YN, 'N') = 'Y' THEN CASE WHEN NVL(f.BASIS_APRV_CHG_PSB_YN, 'N') = 'Y' THEN '변경가능' ELSE '변경불가' END ELSE '미사용' END AS APRV_SPR
                        , CASE WHEN NVL(f.ORD_AUTH_USE_YN, 'N') = 'Y' THEN CASE WHEN NVL(f.BASIS_OPSN_CHG_YN, 'N') = 'Y' THEN '변경가능' ELSE '변경불가' END ELSE '미사용' END AS OPSN_SPR
                        , CASE WHEN NVL(f.ACCT_USE_YN, 'N') = 'Y' THEN '사용' ELSE '미사용' END ACCT_SPR
                        , CASE WHEN NVL(f.BGT_AUTH_USE_YN, 'N') = 'Y' THEN '사용' ELSE '미사용' END BGT_AUTH_SPR
                        , CASE WHEN NVL(f.BGT_OVER_AGD_YN, 'N') = 'Y' THEN '사용' ELSE '미사용' END BGT_OVER_SPR
                        , CASE WHEN NVL(f.BLNG_DEPT_USE_SPR_CD, 'N') = 'Y' THEN '사용' ELSE '미사용' END BLNG_DEPT_SPR
                        , CASE WHEN NVL(T12.REQ_CD_1, 'N') = 'Y' THEN '사용' ELSE '미사용' END REQ_CD_1
                        , CASE WHEN NVL(T12.REQ_CD_2, 'N') = 'Y' THEN '사용' ELSE '미사용' END REQ_CD_2
                        , CASE WHEN NVL(T12.REQ_CD_3, 'N') = 'Y' THEN '사용' ELSE '미사용' END REQ_CD_3
                        , CASE WHEN NVL(T12.REQ_CD_4, 'N') = 'Y' THEN '사용' ELSE '미사용' END REQ_CD_4
                        , CASE WHEN NVL(T12.REQ_CD_5, 'N') = 'Y' THEN '사용' ELSE '미사용' END REQ_CD_5
                        , CASE WHEN NVL(T13.OSHT_CD_SEQ_1, 'N') = 'Y' THEN '사용' ELSE '미사용' END OSHT_CD_SEQ_1
                        , CASE WHEN NVL(T13.OSHT_CD_SEQ_2, 'N') = 'Y' THEN '사용' ELSE '미사용' END OSHT_CD_SEQ_2
                        , CASE WHEN NVL(T13.OSHT_CD_SEQ_3, 'N') = 'Y' THEN '사용' ELSE '미사용' END OSHT_CD_SEQ_3
                        , CASE WHEN NVL(T13.OSHT_CD_SEQ_4, 'N') = 'Y' THEN '사용' ELSE '미사용' END OSHT_CD_SEQ_4
                        , CASE WHEN NVL(T13.OSHT_CD_SEQ_5, 'N') = 'Y' THEN '사용' ELSE '미사용' END OSHT_CD_SEQ_5
                        , NVL(f.APRV_AUTH_USE_YN, 'N')      APRV_AUTH_USE_YN
                        , NVL(f.ORD_AUTH_USE_YN, 'N')       ORD_AUTH_USE_YN
                From    TB_CC_MBR_BASIS a
                        Left Join
                        TB_CC_BZPLC_BASIS b
                            On (b.CO_CD = a.CO_CD
                            And b.BZPLC_ID = a.BZPLC_ID)
                        Left Join
                        TB_CC_BZPLC_CTL_AUTH_INFO c             /*사업장제어권한*/
                            On (c.CO_CD = a.CO_CD
                            And c.BZPLC_ID = a.BZPLC_ID)
                        Left Join
                        TB_CC_DEPT_BASIS d
                            On (d.CO_CD = a.CO_CD
                            And d.DEPT_ID = a.DEPT_ID)
                        Left Join
                        TB_CC_OPR_UNIT_BASIS e
                            On (e.CO_CD = d.CO_CD
                            And e.BZPLC_ID = d.BZPLC_ID
                            And e.OPR_UNIT_ID = d.OPR_UNIT_ID)
                        Left Join
                        VW_CC_OPR_UNIT_CTL_AUTH_INFO f
                            On (f.CO_CD = d.CO_CD
                            And f.BZPLC_ID = d.BZPLC_ID
                            And f.OPR_UNIT_ID = d.OPR_UNIT_ID)
                        Left Join
                        TB_CO_COM_CD_DTL g
                            On (g.COM_DTL_CD = a.MBR_USE_CD
                            And g.COM_CLSF_CD = 'MBR_USE_CD'
                            And g.LANG_CD = #{LANG_CD})
                        Left Join
                        TB_CO_COM_CD_DTL h
                              On (h.COM_DTL_CD = b.CUST_SPR_CD
                              And h.COM_CLSF_CD = 'CUST_SPR_CD'
                              And h.LANG_CD = #{LANG_CD})
                        <if test=" DEPT_ID > 0 ">
                         JOIN
                         TB_OD_ODR_INQ_TGT_DTLS   T1
                         ON  T1.SES_ID = #{SES_ID}
                         AND T1.INQ_COND_DTLS = #{INQ_COND_DTLS}
                         AND T1.COL_ITM = 'DEPT_ID'
                         AND T1.COND_DATA_VAL = a.DEPT_ID
                        </if>
                        <if test=" BZPLC_ID > 0 ">
                          JOIN
                         TB_OD_ODR_INQ_TGT_DTLS   T2
                         ON  T2.SES_ID = #{SES_ID}
                         AND T2.INQ_COND_DTLS = #{INQ_COND_DTLS}
                         AND T2.COL_ITM = 'BZPLC_ID'
                         AND T2.COND_DATA_VAL = a.BZPLC_ID
                        </if>
                        <if test=" MBR_ID_NM > 0 ">
                         JOIN
                         TB_OD_ODR_INQ_TGT_DTLS   T5
                         ON  T5.SES_ID = #{SES_ID}
                         AND T5.INQ_COND_DTLS = #{INQ_COND_DTLS}
                         AND T5.COL_ITM = 'MBR_ID_NM'
                         AND T5.COND_DATA_VAL = a.MBR_NM
                        </if>
                        <if test=" MBR_ID > 0 ">
                          JOIN
                         TB_OD_ODR_INQ_TGT_DTLS   T3
                         ON  T3.SES_ID = #{SES_ID}
                         AND T3.INQ_COND_DTLS = #{INQ_COND_DTLS}
                         AND T3.COL_ITM = 'MBR_ID'
                         AND T3.COND_DATA_VAL = a.MBR_ID
                        </if>
                        <if test=" OPR_UNIT_ID > 0 ">
                          JOIN
                         TB_OD_ODR_INQ_TGT_DTLS   T4
                         ON  T4.SES_ID = #{SES_ID}
                         AND T4.INQ_COND_DTLS = #{INQ_COND_DTLS}
                         AND T4.COL_ITM = 'OPR_UNIT_ID'
                         AND T4.COND_DATA_VAL = e.OPR_UNIT_ID
                        </if>
                        LEFT JOIN
                        TB_CC_MBR_CTL_AUTH_INFO T9
                        ON  T9.CO_CD = a.CO_CD
                        AND T9.MBR_ID = a.MBR_ID
                         LEFT JOIN
                         TB_CO_MBR_LOGN_INFO T10
                         ON  T10.CO_CD = a.CO_CD
                         AND T10.MBR_ID = a.MBR_ID
                         LEFT JOIN
                         TB_CC_MBR_DLVPLC_BASIS T11
                         ON  T11.CO_CD = a.CO_CD
                         AND T11.MBR_ID = a.MBR_ID
                         AND T11.BASIS_DLVPLC_YN = 'Y'
                         AND ROWNUM = 1
                         LEFT JOIN
                         (
                         SELECT T12.CO_CD, T12.BZPLC_ID, T12.OPR_UNIT_ID,
                                MAX(CASE WHEN T12.REF_CD_GRP_SEQ = 1 THEN 'Y' END) REQ_CD_1,
                                MAX(CASE WHEN T12.REF_CD_GRP_SEQ = 2 THEN 'Y' END) REQ_CD_2,
                                MAX(CASE WHEN T12.REF_CD_GRP_SEQ = 3 THEN 'Y' END) REQ_CD_3,
                                MAX(CASE WHEN T12.REF_CD_GRP_SEQ = 4 THEN 'Y' END) REQ_CD_4,
                                MAX(CASE WHEN T12.REF_CD_GRP_SEQ = 5 THEN 'Y' END) REQ_CD_5
                         FROM   TB_CC_CCO_REF_CD_INFO  T12
                         WHERE  T12.USE_YN = 'Y'
                         GROUP BY T12.CO_CD, T12.BZPLC_ID, T12.OPR_UNIT_ID
                         )      T12
                         ON   T12.CO_CD    = e.CO_CD
                         AND  T12.BZPLC_ID = e.BZPLC_ID
                         AND  T12.OPR_UNIT_ID = e.OPR_UNIT_ID
                        LEFT JOIN
                         (
                         SELECT T12.CO_CD, T12.BZPLC_ID, T12.OPR_UNIT_ID,
                                MAX(CASE WHEN T12.OSHT_CD_SEQ = 1 THEN 'Y' END) OSHT_CD_SEQ_1,
                                MAX(CASE WHEN T12.OSHT_CD_SEQ = 2 THEN 'Y' END) OSHT_CD_SEQ_2,
                                MAX(CASE WHEN T12.OSHT_CD_SEQ = 3 THEN 'Y' END) OSHT_CD_SEQ_3,
                                MAX(CASE WHEN T12.OSHT_CD_SEQ = 4 THEN 'Y' END) OSHT_CD_SEQ_4,
                                MAX(CASE WHEN T12.OSHT_CD_SEQ = 5 THEN 'Y' END) OSHT_CD_SEQ_5
                         FROM   TB_CC_CCO_OSHT_CD_INFO  T12
                         WHERE  T12.USE_YN = 'Y'
                         GROUP BY T12.CO_CD, T12.BZPLC_ID, T12.OPR_UNIT_ID
                         )      T13
                         ON   T13.CO_CD    = e.CO_CD
                         AND  T13.BZPLC_ID = e.BZPLC_ID
                         AND  T13.OPR_UNIT_ID = e.OPR_UNIT_ID
                         LEFT JOIN
                         TB_CC_OPR_UNIT_STL_MEAN_INFO   T21
                         ON   T21.CO_CD    = e.CO_CD
                         AND  T21.BZPLC_ID = e.BZPLC_ID
                         AND  T21.OPR_UNIT_ID = e.OPR_UNIT_ID
                         AND  T21.STL_MEAN_CD = 'P012'
                Where  a.UT_AGRE_YN = 'Y'
                   And a.CLT_AGRE_YN = 'Y'
                   And c.ODR_AGNC_USE_YN = 'Y'
                   <if test="MBR_USE_CD != null and !MBR_USE_CD.equals('')">
                   And g.COM_DTL_CD = #{MBR_USE_CD}
                   </if>
                   <if test="CUST_SPR_CD != null and !CUST_SPR_CD.equals('')">
                   And h.COM_DTL_CD = #{CUST_SPR_CD}
                   </if>
                   And b.CUST_SPR_CD = '20'
                   And e.CUST_SPR_CD = '20'
                ORDER BY a.MBR_ID
                ) T1
        OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
    </select>

    <select id="selectMbrListCount" parameterType="HashMap" resultType="Integer">
        /* com.ssp.bo.od.orderList.selectMbrListCount */
        Select /*+use_hash(a c) full(a) full(c) */
               COUNT(0)
        From    TB_CC_MBR_BASIS a
                Left Join
                TB_CC_BZPLC_BASIS b
                    On (b.CO_CD = a.CO_CD
                    And b.BZPLC_ID = a.BZPLC_ID)
                Left Join
                TB_CC_BZPLC_CTL_AUTH_INFO c             /*사업장제어권한*/
                    On (c.CO_CD = a.CO_CD
                    And c.BZPLC_ID = a.BZPLC_ID)
                Left Join
                TB_CC_DEPT_BASIS d
                    On (d.CO_CD = a.CO_CD
                    And d.DEPT_ID = a.DEPT_ID)
                Left Join
                TB_CC_OPR_UNIT_BASIS e
                    On (e.CO_CD = d.CO_CD
                    And e.BZPLC_ID = d.BZPLC_ID
                    And e.OPR_UNIT_ID = d.OPR_UNIT_ID)
                Left Join
                VW_CC_OPR_UNIT_CTL_AUTH_INFO f
                    On (f.CO_CD = d.CO_CD
                    And f.BZPLC_ID = d.BZPLC_ID
                    And f.OPR_UNIT_ID = d.OPR_UNIT_ID)
                Left Join
                TB_CO_COM_CD_DTL g
                    On (g.COM_DTL_CD = a.MBR_USE_CD
                    And g.COM_CLSF_CD = 'MBR_USE_CD')
                Left Join
                TB_CO_COM_CD_DTL h
                      On (h.COM_DTL_CD = b.CUST_SPR_CD
                      And h.COM_CLSF_CD = 'CUST_SPR_CD')
                <if test=" DEPT_ID > 0 ">
                 JOIN
                 TB_OD_ODR_INQ_TGT_DTLS   T1
                 ON  T1.SES_ID = #{SES_ID}
                 AND T1.INQ_COND_DTLS = #{INQ_COND_DTLS}
                 AND T1.COL_ITM = 'DEPT_ID'
                 AND T1.COND_DATA_VAL = a.DEPT_ID
                </if>
                <if test=" BZPLC_ID > 0 ">
                  JOIN
                 TB_OD_ODR_INQ_TGT_DTLS   T2
                 ON  T2.SES_ID = #{SES_ID}
                 AND T2.INQ_COND_DTLS = #{INQ_COND_DTLS}
                 AND T2.COL_ITM = 'BZPLC_ID'
                 AND T2.COND_DATA_VAL = a.BZPLC_ID
                </if>
                <if test=" MBR_ID_NM > 0 ">
                 JOIN
                 TB_OD_ODR_INQ_TGT_DTLS   T5
                 ON  T5.SES_ID = #{SES_ID}
                 AND T5.INQ_COND_DTLS = #{INQ_COND_DTLS}
                 AND T5.COL_ITM = 'MBR_ID_NM'
                 AND T5.COND_DATA_VAL = a.MBR_NM
                </if>
                <if test=" MBR_ID > 0 ">
                  JOIN
                 TB_OD_ODR_INQ_TGT_DTLS   T3
                 ON  T3.SES_ID = #{SES_ID}
                 AND T3.INQ_COND_DTLS = #{INQ_COND_DTLS}
                 AND T3.COL_ITM = 'MBR_ID'
                 AND T3.COND_DATA_VAL = a.MBR_ID
                </if>
                <if test=" OPR_UNIT_ID > 0 ">
                  JOIN
                 TB_OD_ODR_INQ_TGT_DTLS   T4
                 ON  T4.SES_ID = #{SES_ID}
                 AND T4.INQ_COND_DTLS = #{INQ_COND_DTLS}
                 AND T4.COL_ITM = 'OPR_UNIT_ID'
                 AND T4.COND_DATA_VAL = e.OPR_UNIT_ID
                </if>
                LEFT JOIN
                TB_CC_MBR_CTL_AUTH_INFO T9
                ON  T9.CO_CD = a.CO_CD
                AND T9.MBR_ID = a.MBR_ID
                 LEFT JOIN
                 TB_CO_MBR_LOGN_INFO T10
                 ON  T10.CO_CD = a.CO_CD
                 AND T10.MBR_ID = a.MBR_ID
                 LEFT JOIN
                 TB_CC_MBR_DLVPLC_BASIS T11
                 ON  T11.CO_CD = a.CO_CD
                 AND T11.MBR_ID = a.MBR_ID
                 AND T11.BASIS_DLVPLC_YN = 'Y'
                 AND ROWNUM = 1
                 LEFT JOIN
                 (
                 SELECT T12.CO_CD, T12.BZPLC_ID, T12.OPR_UNIT_ID,
                        MAX(CASE WHEN T12.REF_CD_GRP_SEQ = 1 THEN 'Y' END) REQ_CD_1,
                        MAX(CASE WHEN T12.REF_CD_GRP_SEQ = 2 THEN 'Y' END) REQ_CD_2,
                        MAX(CASE WHEN T12.REF_CD_GRP_SEQ = 3 THEN 'Y' END) REQ_CD_3,
                        MAX(CASE WHEN T12.REF_CD_GRP_SEQ = 4 THEN 'Y' END) REQ_CD_4,
                        MAX(CASE WHEN T12.REF_CD_GRP_SEQ = 5 THEN 'Y' END) REQ_CD_5
                 FROM   TB_CC_CCO_REF_CD_INFO  T12
                 WHERE  T12.USE_YN = 'Y'
                 GROUP BY T12.CO_CD, T12.BZPLC_ID, T12.OPR_UNIT_ID
                 )      T12
                 ON   T12.CO_CD    = e.CO_CD
                 AND  T12.BZPLC_ID = e.BZPLC_ID
                 AND  T12.OPR_UNIT_ID = e.OPR_UNIT_ID
                LEFT JOIN
                 (
                 SELECT T12.CO_CD, T12.BZPLC_ID, T12.OPR_UNIT_ID,
                        MAX(CASE WHEN T12.OSHT_CD_SEQ = 1 THEN 'Y' END) OSHT_CD_SEQ_1,
                        MAX(CASE WHEN T12.OSHT_CD_SEQ = 2 THEN 'Y' END) OSHT_CD_SEQ_2,
                        MAX(CASE WHEN T12.OSHT_CD_SEQ = 3 THEN 'Y' END) OSHT_CD_SEQ_3,
                        MAX(CASE WHEN T12.OSHT_CD_SEQ = 4 THEN 'Y' END) OSHT_CD_SEQ_4,
                        MAX(CASE WHEN T12.OSHT_CD_SEQ = 5 THEN 'Y' END) OSHT_CD_SEQ_5
                 FROM   TB_CC_CCO_OSHT_CD_INFO  T12
                 WHERE  T12.USE_YN = 'Y'
                 GROUP BY T12.CO_CD, T12.BZPLC_ID, T12.OPR_UNIT_ID
                 )      T13
                 ON   T13.CO_CD    = e.CO_CD
                 AND  T13.BZPLC_ID = e.BZPLC_ID
                 AND  T13.OPR_UNIT_ID = e.OPR_UNIT_ID
        Where  a.UT_AGRE_YN = 'Y'
           And a.CLT_AGRE_YN = 'Y'
           And c.ODR_AGNC_USE_YN = 'Y'
           <if test="MBR_USE_CD != null and !MBR_USE_CD.equals('')">
           And g.COM_DTL_CD = #{MBR_USE_CD}
           </if>
           <if test="CUST_SPR_CD != null and !CUST_SPR_CD.equals('')">
           And h.COM_DTL_CD = #{CUST_SPR_CD}
           </if>
           And b.CUST_SPR_CD = '20'
           And e.CUST_SPR_CD = '20'
    </select>

    <!-- ******************************************************************************
        * SELECT : 접속이력 Count 조회 * 작성자 : neonlee * 작성 일자 : 2022-05-04
        ****************************************************************************** -->
    <select id="conHstListCount" parameterType="HashMap" resultType="Integer">
        /* com.ssp.bo.od.orderList.conHstListCount */
        WITH BASE_T AS (
        SELECT
                T1.CNCT_LOG_SEQ,                        /* 접속로그순번 */
                T1.IPT_PST_TYPE_CD,                     /* 입력위치타입코드 */
                T7.COM_DTL_CD_NM  OPT_PST_TYPE_CD_NM,   /* 입력위치타입코드명 */
                T1.CO_CD,                               /* 회사코드 */
                T1.BZPLC_ID,                            /* 사업장ID */
                T1.LOGN_ID,                             /* 로그인ID */
                T1.MBR_ID,                              /* 회원ID */
                T3.MBR_NM  MBR_ID_NM,                   /* 회원명 */
                T1.OPRTR_ID,                            /* 운영자ID */
                T4.OPRTR_NM  OPRTR_ID_NM,               /* 운영자명 */
                T1.SRVON_ODR_DLGTE_ID,                  /* 서브원주문대행자ID */
                T5.OPRTR_NM  SRVON_ODR_DLGTE_ID_NM,     /* 서브원주문대행자명 */
                T1.CNSOL_IP_ADDR,                       /* 연결IP주소 */
                T1.SES_ID,                              /* 세션ID */
                T1.BRWR_TYPE,                           /* 브라우저타입 */
                T1.LOGN_DTM,                            /* 로그인일시 */
                T1.LOGN_MTHD_CD,                        /* 로그인방식코드 */
                T6.COM_DTL_CD_NM  LOGN_MTHD_CD_NM,
                T1.REG_DTM,
                T1.REGPSN_ID,
                T1.UPD_DTM,
                T1.UPDPSN_ID,
                T8.ODR_NO,
                T8.TOT_ODR_AMT,
                T9.ATFL_NM                              /* 첨부파일명 */
        FROM    TB_CO_MBR_SYS_CNCT_LOG T1
                LEFT JOIN
                TB_CC_MBR_BASIS T3
                ON (T3.CO_CD = T1.CO_CD
                AND T3.MBR_ID = T1.MBR_ID)
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO T4
                ON (T4.CO_CD = T1.CO_CD
                AND T4.OPRTR_ID = T1.OPRTR_ID)
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO T5
                ON (T5.CO_CD = T1.CO_CD
                AND T5.OPRTR_ID = T1.SRVON_ODR_DLGTE_ID)
                LEFT JOIN
                TB_CO_COM_CD_DTL T6
                ON T6.COM_DTL_CD = T1.LOGN_MTHD_CD
                AND T6.COM_CLSF_CD = 'LOGIN_MTHD_CD'
                AND T6.LANG_CD = #{LANG_CD}
                LEFT JOIN
                TB_CO_COM_CD_DTL T7
                ON T7.COM_DTL_CD = T1.IPT_PST_TYPE_CD
                AND T7.COM_CLSF_CD = 'IPT_PST_TYPE_CD'
                AND T7.LANG_CD = #{LANG_CD}
                LEFT JOIN
                TB_OD_ODR_MST   T8
                ON  T8.CO_CD  =  T1.CO_CD
                AND T8.SES_ID =  T1.SES_ID
                LEFT JOIN
                TB_CO_ATFL_DTLS  T9         /* 첨부파일내역 */
                ON  T9.DOC_REG_ID = T8.DOC_REG_ID
                <if test=" DLGTE_CHRPSN > 0 ">
                 JOIN
                 TB_OD_ODR_INQ_TGT_DTLS   T10
                 ON  T10.SES_ID = #{SES_ID}
                 AND T10.INQ_COND_DTLS = #{INQ_COND_DTLS}
                 AND T10.COL_ITM = 'DLGTE_CHRPSN'
                 AND T10.COND_DATA_VAL = T1.SRVON_ODR_DLGTE_ID
                </if>
        WHERE  T1.LOGN_DTM BETWEEN TO_DATE(#{FROM_DT} || '000000','YYYYMMDDHH24MISS') AND TO_DATE(#{TO_DT} || '235959','YYYYMMDDHH24MISS')
          AND  T1.LOGN_MTHD_CD = #{LOGIN_MTHD_CD}

        )
        SELECT  COUNT(*)    CNT
        FROM    BASE_T  T1
                <if test=" ODR_NO > 0 ">
                 JOIN
                 TB_OD_ODR_INQ_TGT_DTLS   T11
                 ON  T11.SES_ID = #{SES_ID}
                 AND T11.INQ_COND_DTLS = #{INQ_COND_DTLS}
                 AND T11.COL_ITM = 'ODR_NO'
                 AND T11.COND_DATA_VAL = T1.ODR_NO
                </if>
    </select>

    <!-- ******************************************************************************
        * SELECT : 접속이력 조회 * 작성자 : neonlee * 작성 일자 : 2022-05-04
        ****************************************************************************** -->
    <select id="conHstList" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.conHstList */
        WITH BASE_T AS (
        SELECT
                T1.CNCT_LOG_SEQ,                        /* 접속로그순번 */
                T1.IPT_PST_TYPE_CD,                     /* 입력위치타입코드 */
                T7.COM_DTL_CD_NM  OPT_PST_TYPE_CD_NM,   /* 입력위치타입코드명 */
                T1.CO_CD,                               /* 회사코드 */
                T1.BZPLC_ID,                            /* 사업장ID */
                T1.LOGN_ID,                             /* 로그인ID */
                T1.MBR_ID,                              /* 회원ID */
                T3.MBR_NM  MBR_ID_NM,                   /* 회원명 */
                T1.OPRTR_ID,                            /* 운영자ID */
                T4.OPRTR_NM  OPRTR_ID_NM,               /* 운영자명 */
                T1.SRVON_ODR_DLGTE_ID,                  /* 서브원주문대행자ID */
                T5.OPRTR_NM  SRVON_ODR_DLGTE_ID_NM,     /* 서브원주문대행자명 */
                T1.CNSOL_IP_ADDR,                       /* 연결IP주소 */
                T1.SES_ID,                              /* 세션ID */
                T1.BRWR_TYPE,                           /* 브라우저타입 */
                T1.LOGN_DTM,                            /* 로그인일시 */
                T1.LOGN_MTHD_CD,                        /* 로그인방식코드 */
                T6.COM_DTL_CD_NM  LOGN_MTHD_CD_NM,
                T1.REG_DTM,
                T1.REGPSN_ID,
                T1.UPD_DTM,
                T1.UPDPSN_ID,
                T8.ODR_NO,
                T8.TOT_ODR_AMT,
                T9.ATFL_NM                              /* 첨부파일명 */
        FROM    TB_CO_MBR_SYS_CNCT_LOG T1
                LEFT JOIN
                TB_CC_MBR_BASIS T3
                ON (T3.CO_CD = T1.CO_CD
                AND T3.MBR_ID = T1.MBR_ID)
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO T4
                ON (T4.CO_CD = T1.CO_CD
                AND T4.OPRTR_ID = T1.OPRTR_ID)
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO T5
                ON (T5.CO_CD = T1.CO_CD
                AND T5.OPRTR_ID = T1.SRVON_ODR_DLGTE_ID)
                LEFT JOIN
                TB_CO_COM_CD_DTL T6
                ON T6.COM_DTL_CD = T1.LOGN_MTHD_CD
                AND T6.COM_CLSF_CD = 'LOGIN_MTHD_CD'
                AND T6.LANG_CD = #{LANG_CD}
                LEFT JOIN
                TB_CO_COM_CD_DTL T7
                ON T7.COM_DTL_CD = T1.IPT_PST_TYPE_CD
                AND T7.COM_CLSF_CD = 'IPT_PST_TYPE_CD'
                AND T7.LANG_CD = #{LANG_CD}
                LEFT JOIN
                TB_OD_ODR_MST   T8
                ON  T8.CO_CD  =  T1.CO_CD
                AND T8.SES_ID =  T1.SES_ID
                LEFT JOIN
                TB_CO_ATFL_DTLS  T9         /* 첨부파일내역 */
                ON  T9.DOC_REG_ID = T8.DOC_REG_ID
                <if test=" DLGTE_CHRPSN > 0 ">
                 JOIN
                 TB_OD_ODR_INQ_TGT_DTLS   T10
                 ON  T10.SES_ID = #{SES_ID}
                 AND T10.INQ_COND_DTLS = #{INQ_COND_DTLS}
                 AND T10.COL_ITM = 'DLGTE_CHRPSN'
                 AND T10.COND_DATA_VAL = T1.SRVON_ODR_DLGTE_ID
                </if>
        WHERE  T1.LOGN_DTM BETWEEN TO_DATE(#{FROM_DT} || '000000','YYYYMMDDHH24MISS') AND TO_DATE(#{TO_DT} || '235959','YYYYMMDDHH24MISS')
          AND  T1.LOGN_MTHD_CD = #{LOGIN_MTHD_CD}

        )
        SELECT  *
        FROM    (
                SELECT  T1.*
                FROM    BASE_T  T1
                        <if test=" ODR_NO > 0 ">
                         JOIN
                         TB_OD_ODR_INQ_TGT_DTLS   T11
                         ON  T11.SES_ID = #{SES_ID}
                         AND T11.INQ_COND_DTLS = #{INQ_COND_DTLS}
                         AND T11.COL_ITM = 'ODR_NO'
                         AND T11.COND_DATA_VAL = T1.ODR_NO
                        </if>
                ORDER BY T1.MBR_ID, T1.ODR_NO DESC
                )
        OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
    </select>

    <!-- ******************************************************************************
        * SELECT : 연계정보 조회 * 작성자 : neonlee * 작성 일자 : 2022-06-27
        ****************************************************************************** -->
    <select id="selectSndRcvInfoList" parameterType="HashMap" resultType="HashMap">
      /* com.ssp.bo.od.orderList.selectSndRcvInfoList */
    WITH BASE_T AS (
    SELECT  /*+INDEX(T40 TB_PR_PRD_CLSF_CHRPSN_INFO_IX01)*/
            T1.CO_CD,
            T1.BZPLC_ID,
            T1.ODR_NO,
            T1.ODR_ITM_NO,
            T2.CUST_SPR_CD,
            T7.MALL_SPR_CD,
            T1.PRD_ID,
            T7.PRD_NM,
            T8.MRO_CRT_YN,
            T1.SALS_CHRPSN_ID,      /* 영업담당자ID */
            T1.SVC_CHRPSN_ID,       /* 서비스담당자ID */
            T1.OPR_CHRPSN_ID,       /* 운영담당자ID */
            T1.PURG_CHRPSN_ID,      /* 구매담당자ID */
            T40.PRD_CLSF_CHRPSN_ID          MD_OPRTR_ID,         /* MD담당자 */
            T1.CRD_CNC_TGT_ODR_SEQ,
            T2.ODRPSN_ID            /* 주문자ID */
    FROM    TB_OD_ODR_DTL T1
            JOIN
            TB_OD_ODR_MST T2
            ON  T2.CO_CD = T1.CO_CD
            AND T2.ODR_NO = T1.ODR_NO
            AND T2.BZPLC_ID = T1.BZPLC_ID
            <if test="OPR_UNIT_ID > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS T3
            ON  T3.SES_ID = #{SES_ID}
            AND T3.INQ_COND_DTLS = #{INQ_COND_DTLS}
            AND T3.COL_ITM = 'OPR_UNIT_ID'
            AND T3.COND_DATA_VAL = T2.OPR_UNIT_ID
            </if>
            <if test="ODR_NO > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS   T4
            ON  T4.SES_ID = #{SES_ID}
            AND T4.INQ_COND_DTLS = #{INQ_COND_DTLS}
            AND T4.COL_ITM = 'ODR_NO'
            AND REGEXP_SUBSTR(T4.COND_DATA_VAL,'[^-]+',1,1) = T1.ODR_NO
            AND (CASE WHEN TRIM(REGEXP_SUBSTR(T4.COND_DATA_VAL,'[^-]+',1,2)) IS NULL OR
                          TRIM(REGEXP_SUBSTR(T4.COND_DATA_VAL,'[^-]+',1,2)) = '' THEN
                          T1.ODR_ITM_NO ELSE TO_NUMBER(TRIM(REGEXP_SUBSTR(T4.COND_DATA_VAL,'[^-]+',1,2))) END) = T1.ODR_ITM_NO
            </if>
            <if test="ODR_STATS_CD > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS T5
            ON  T5.SES_ID = #{SES_ID}
            AND T5.INQ_COND_DTLS = #{INQ_COND_DTLS}
            AND T5.COL_ITM = 'ODR_STATS_CD'
            AND T5.COND_DATA_VAL = T1.ODR_STATS_CD
            </if>
            <if test="PRD_ID > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS T6
            ON  T6.SES_ID = #{SES_ID}
            AND T6.INQ_COND_DTLS = #{INQ_COND_DTLS}
            AND T6.COL_ITM = 'PRD_ID'
            AND LPAD(T6.COND_DATA_VAL, 18, '0') = T1.PRD_ID
            </if>
            <if test="SALS_CHRPSN > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS T8
            ON  T8.SES_ID = #{SES_ID}
            AND T8.INQ_COND_DTLS = #{INQ_COND_DTLS}
            AND T8.COL_ITM = 'SALS_CHRPSN'
            AND T8.COND_DATA_VAL = T1.SALS_CHRPSN_ID
            </if>
            <if test="PURG_CHRPSN > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS T10
            ON  T10.SES_ID = #{SES_ID}
            AND T10.INQ_COND_DTLS = #{INQ_COND_DTLS}
            AND T10.COL_ITM = 'PURG_CHRPSN'
            AND T10.COND_DATA_VAL = T1.PURG_CHRPSN_ID
            </if>
            <if test="SVC_CHRPSN > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS T11
            ON  T11.SES_ID = #{SES_ID}
            AND T11.INQ_COND_DTLS = #{INQ_COND_DTLS}
            AND T11.COL_ITM = 'SVC_CHRPSN'
            AND T11.COND_DATA_VAL = T1.SVC_CHRPSN_ID
            </if>
            LEFT JOIN
            TB_PR_MRO_PRD_INFO T7
            ON  T7.CO_CD = T1.CO_CD
            AND T7.PRD_ID = T1.PRD_ID
            LEFT JOIN
            TB_PR_PRD_INFO T8
            ON  T8.CO_CD = T1.CO_CD
            AND T8.PRD_ID = T1.PRD_ID
            LEFT JOIN
            TB_PR_PRD_CLSF_CHRPSN_INFO T40
            ON (T40.CO_CD = T8.CO_CD
            AND T40.PRD_CLCD = T8.PRD_CLCD
            AND T40.PRD_CLSF_CHRPSN_TP_CD = '20'
            AND T40.PRD_CLSF_CHRPSN_SPR_CD = '10'
            AND T40.MNFR_NO = '*'
            AND T40.PRD_CLSF_CHRPSN_USEYN = 'Y')
            <if test="MD_CHRPSN > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS T41
                ON  T41.SES_ID = #{SES_ID}
                AND T41.INQ_COND_DTLS = #{INQ_COND_DTLS}
                AND T41.COL_ITM = 'MD_CHRPSN'
                AND T41.COND_DATA_VAL = T40.PRD_CLSF_CHRPSN_ID
            </if>
    WHERE   T1.CO_CD = #{CO_CD}
    AND     T1.ODR_DCN_DTM BETWEEN TO_DATE(#{FROM_DT} || '000000','YYYYMMDDHH24MISS') AND TO_DATE(#{TO_DT} || '235959','YYYYMMDDHH24MISS')
    <if test="CUST_SPR_CD != null and !CUST_SPR_CD.equals('') ">
    AND     T2.CUST_SPR_CD = #{CUST_SPR_CD}   /* 고객구분코드 4.고객 유형 */
    </if>
    <if test="MALL_SPR_CD != null and !MALL_SPR_CD.equals('') ">
    AND     T7.MALL_SPR_CD = #{MALL_SPR_CD}   /* 몰구분코드 */
    </if>
    ), BASE_T2 AS (
    SELECT *
    FROM  (    
	    SELECT  *
	    FROM    (
	            SELECT   T1.ROWID  RID
	                    ,ROW_NUMBER() OVER(PARTITION BY  T1.CO_CD,T1.BZPLC_ID,T1.ODR_NO,T1.ODR_ITM_NO,T1.IF_PI_ID,T1.IF_RSLT_FLD_1
	                                       ORDER BY T1.IF_MSG_ID DESC, NVL(T1.ORI_IF_MSG_ID,T1.IF_MSG_ID) DESC)     RN
	                    ,T3.COM_DTL_CD_NM   PI_SPR_CD_NM
	                    ,CASE WHEN T1.IF_PI_ID = 'FI00300' THEN T21.CRECD_TECL_NO  ELSE NULL END   TNO
	                    ,CASE WHEN T1.IF_PI_ID = 'FI00300' THEN T21.CRECD_STL_AMT  ELSE NULL END   AMOUNT
	                    ,T1.IF_MSG_ID
	                    ,T1.IF_MSG_SEQ
	                    ,T1.IF_PI_ID
	                    ,T1.IF_PI_MSG
	                    ,T1.IF_PROC_RSLT_CD
	                    ,T1.ODR_ITM_NO
	                    ,T1.ODR_NO
	                    ,T1.ODR_TRANS_DTL_NM
	                    ,T1.ORI_IF_MSG_ID
	                    ,T1.ORI_IF_MSG_SEQ
	                    ,T2.CRD_CNC_TGT_ODR_SEQ
	                    ,T2.PRD_ID
	                    ,T2.CO_CD
	                    ,T2.SALS_CHRPSN_ID
	                    ,T2.SVC_CHRPSN_ID
	                    ,T2.OPR_CHRPSN_ID
	                    ,T2.PURG_CHRPSN_ID
	                    ,T2.MD_OPRTR_ID
	                    ,T2.BZPLC_ID
	            FROM    TB_OD_ODR_TRANS_MST  T1
	                    JOIN
	                    BASE_T               T2
	                    ON  T2.CO_CD = T1.CO_CD
	                    AND T2.BZPLC_ID = T1.BZPLC_ID
	                    AND T2.ODR_NO = T1.ODR_NO
	                    AND T2.ODR_ITM_NO = CASE WHEN T1.ODR_ITM_NO IS NULL THEN T2.ODR_ITM_NO ELSE T1.ODR_ITM_NO END
	                    JOIN
	                    TB_CO_COM_CD_DTL    T3
	                    ON  T3.LANG_CD = #{LANG_CD}
	                    AND T3.COM_CLSF_CD = 'PI_SPR_CD'
	                    AND T3.COM_DTL_CD = T1.IF_PI_ID
	                    AND T3.COM_USR_DEFN_NM_1 = 'Y'
	                    LEFT JOIN
	                    TB_OD_ODR_CRD_STL_DTLS  T21
	                    ON  T21.CO_CD = T1.CO_CD
	                    AND T21.ODR_NO = T1.ODR_NO
	                    AND T21.CRD_STL_SPR_CD = '10'
	            WHERE   1 = 1
	            AND     T1.IF_PI_ID LIKE #{IF_PI_ID} ||'%'
	            AND   CASE WHEN T1.IF_PI_ID = 'FI00300' AND T21.ORI_ODR_NO IS NOT NULL THEN '0'
	                       ELSE '1' END = '1'
	            AND   CASE WHEN T1.IF_PI_ID = 'SD01730' THEN 'TB_OD_ODR_DTL'
	                       WHEN T1.IF_PI_ID = 'FI00300' THEN 'MAIN'
	                       ELSE T1.ODR_TRANS_DTL_NM
	                  END = T1.ODR_TRANS_DTL_NM
	            )   T1
	    WHERE   T1.RN = 1
	    ) T2
	WHERE 1=1
    <if test='IF_PROC_RSLT_CD != null and !IF_PROC_RSLT_CD.equals("") and !IF_PROC_RSLT_CD.equals("P") '>
    AND     T2.IF_PROC_RSLT_CD = #{IF_PROC_RSLT_CD}
    </if>
    <if test='IF_PROC_RSLT_CD.equals("P") '>
    AND     T2.IF_PROC_RSLT_CD IS NULL
    </if>
    )
    SELECT  T1.*
            , CASE WHEN T1.SND_USR_ID IS NOT NULL OR T3.OPRTR_NM IS NOT NULL
                       THEN T1.SND_USR_ID || ' | ' || T3.OPRTR_NM END     SND_USR_NM
    FROM    (
            SELECT
                    T1.CO_CD,               /* 회사코드 */
                    T1.BZPLC_ID,            /* 사업장ID */
                    T1.ODR_NO,              /* 주문번호 */
                    T1.ODR_ITM_NO,          /* 주문항목번호 */
                    T1.ODR_NO || '-' || T1.ODR_ITM_NO       JNT_ODR_ITM_NO,
                    T1.IF_PI_ID,            /* IFPIID */
                    T1.IF_SYSTEM_ID,
                    T0.PI_SPR_CD_NM IF_PI_NM,
                    T1.IF_MSG_ID,           /* IF메시지ID */
                    T1.IF_PROC_RSLT_CD,     /* IF처리결과코드, S=성공, E=오류 */
                    T20.COM_DTL_CD_NM   IF_PROC_RSLT_CD_NM,
                    T1.IF_PI_MSG,           /* IFPI메시지 */
                    T1.REG_DTM,             /* 등록일시 */
                    T1.IF_PROC_RSLT_DTM,    /* IF처리결과일시 */
                    T1.IF_MSG_SEQ,          /* IF메시지순번 */
                    T1.RETRY_PROC_RSLT_CD,  /* 재시도처리결과코드 */
                    NVL(T1.ORI_IF_MSG_ID,T1.IF_MSG_ID)   ORI_IF_MSG_ID,       /* 원IF메시지ID */
                    NVL(T1.ORI_IF_MSG_SEQ,T1.IF_MSG_SEQ)  ORI_IF_MSG_SEQ,       /* 원IF메시지순번 */
                    LTRIM(T2.PRD_ID, '0') PRD_ID,
                    T2.PRD_NM,
                    CASE WHEN T2.SALS_CHRPSN_ID IS NOT NULL OR T6.OPRTR_NM IS NOT NULL
                             THEN T2.SALS_CHRPSN_ID || ' | ' || T6.OPRTR_NM END     SALS_CHR_CD_NM,     /* 영업담당자 */
                    T2.SALS_CHRPSN_ID,      /* 영업담당자ID */
                    CASE WHEN T2.SVC_CHRPSN_ID IS NOT NULL OR T5.OPRTR_NM IS NOT NULL
                             THEN T2.SVC_CHRPSN_ID || ' | ' || T5.OPRTR_NM END      SVC_CHRPSN_ID_NM,   /* 서비스담당자 */
                    T2.SVC_CHRPSN_ID,       /* 서비스담당자ID MD담당자인가 확인필요 */
                    CASE WHEN T2.OPR_CHRPSN_ID IS NOT NULL OR T8.OPRTR_NM IS NOT NULL
                             THEN T2.OPR_CHRPSN_ID || ' | ' || T8.OPRTR_NM END      OPR_CHRPSN_ID_NM,   /* 운영담당자 */
                    T2.OPR_CHRPSN_ID,       /* 운영담당자ID */
                    CASE WHEN T2.PURG_CHRPSN_ID IS NOT NULL OR T7.OPRTR_NM IS NOT NULL
                             THEN T2.PURG_CHRPSN_ID || ' | ' || T7.OPRTR_NM END     PURG_CHRPSN_ID_NM,  /* 구매담당자 */
                    T2.PURG_CHRPSN_ID,       /* 구매담당자ID */
                    CASE WHEN T2.MD_OPRTR_ID IS NOT NULL OR T9.OPRTR_NM IS NOT NULL
                             THEN T2.MD_OPRTR_ID || ' | ' || T9.OPRTR_NM END     MD_CHRPSN_ID_NM,  /* MD담당자 */
                    T2.MD_OPRTR_ID  MD_CHRPSN_ID,       /* MD담당자ID */
                    T21.COM_DTL_CD_NM   MRO_CRT_YN,
                    NVL(T1.IF_RSLT_FLD_1, '')   VOC_NO,
                    T1.IF_RSLT_FLD_3        SND_USR_ID,
                    T0.TNO,
                    T0.AMOUNT,
                    T2.ODRPSN_ID
            FROM    BASE_T2     T0
                    JOIN
                    TB_OD_ODR_TRANS_MST  T1
                    ON  T1.ROWID = T0.RID
                    JOIN
                    BASE_T T2
                    ON  T2.CO_CD = T1.CO_CD
                    AND T2.BZPLC_ID = T1.BZPLC_ID
                    AND T2.ODR_NO = T1.ODR_NO
                    AND T2.ODR_ITM_NO = CASE WHEN T1.ODR_ITM_NO IS NULL THEN T2.ODR_ITM_NO ELSE T1.ODR_ITM_NO END
                    LEFT JOIN
                    TB_CO_COM_CD_DTL    T20
                    ON  T20.LANG_CD = #{LANG_CD}
                    AND T20.COM_CLSF_CD = 'IF_PROC_RSLT_CD'
                    AND T20.COM_DTL_CD = T1.IF_PROC_RSLT_CD
                    LEFT JOIN
                    TB_CO_COM_CD_DTL    T21
                    ON  T21.LANG_CD = #{LANG_CD}
                    AND T21.COM_CLSF_CD = 'MRO_CRT_YN'
                    AND T21.COM_DTL_CD = T2.MRO_CRT_YN
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T5
                    ON  T5.CO_CD   = T2.CO_CD
                    AND T5.OPRTR_ID = T2.SVC_CHRPSN_ID
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T6
                    ON  T6.CO_CD   = T2.CO_CD
                    AND T6.OPRTR_ID = T2.SALS_CHRPSN_ID
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T7
                    ON  T7.CO_CD   = T2.CO_CD
                    AND T7.OPRTR_ID = T2.PURG_CHRPSN_ID
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T8
                    ON  T8.CO_CD   = T2.CO_CD
                    AND T8.OPRTR_ID = T2.OPR_CHRPSN_ID
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T9
                    ON  T9.CO_CD   = T2.CO_CD
                    AND T9.OPRTR_ID = T2.MD_OPRTR_ID
            WHERE   1 = 1
            UNION ALL
            SELECT  /*+ INDEX(C TB_AD_CRD_STL_APPR_LOG_IX03) PUSH_PRED(C) */
                    A.CO_CD                                                                 /* 회사코드 */
                    ,A.BZPLC_ID                                                             /* 사업장ID */
                    ,A.ODR_NO                                                               /* 주문번호 */
                    ,A.ODR_ITM_NO                                                           /* 주문항목번호 */
                    ,A.ODR_NO||'-'||TO_CHAR(A.ODR_ITM_NO)       AS JNT_ODR_ITM_NO           /* 주문항번 */
                    ,'FI00300_01'                               AS IF_PI_ID                 /* 선수금카드취소 카드사 전송 */
                    ,'SSP'                                      AS IF_SYSTEM_ID             /* SSP */
                    ,B.COM_DTL_CD_NM                            AS IF_PI_NM
                    ,NVL2(C.TNO,C.CRD_APPR_REQ_SPR_CD||'-'||TO_CHAR(C.LOG_SEQ)||'-'||C.TNO,'_')
                                                                AS IF_MSG_ID                /*NHN KCP 거래 고유번호*/
                    ,CASE WHEN C.RES_CD = '0000' THEN 'S' ELSE 'E' END
                                                                AS IF_PROC_RSLT_CD          /* IF처리결과코드, S=성공, E = 오류 */
                    ,D.COM_DTL_CD_NM                            AS IF_PROC_RSLT_CD_NM       /* IF처리결과코드명 S=성공, E = 오류 */
                    ,CASE WHEN C.RES_CD IS NULL THEN '[----] 미전송' ELSE '['||C.RES_CD||'] '||C.RES_MSG END
                                                                AS IF_PI_MSG                /* IFPI메시지 */
                    ,C.REG_DTM                                                              /* 등록일시 */
                    ,TO_DATE(C.CANC_TIME DEFAULT NULL ON CONVERSION ERROR , 'YYYYMMDDHH24MISS')
                                                                AS IF_PROC_RSLT_DTM         /* IF처리결과일시 */
                    ,1                                          AS IF_MSG_SEQ               /* IF메시지순번 */
                    ,NULL                                       AS RETRY_PROC_RSLT_CD       /* 재시도처리결과코드 */
                    ,C.CRD_APPR_REQ_SPR_CD||'-'||TO_CHAR(C.LOG_SEQ)||'-'||C.TNO
                                                                AS ORI_IF_MSG_ID            /* 원IF메시지ID */
                    ,1                                          AS ORI_IF_MSG_SEQ           /* 원IF메시지순번 */
                    ,LTRIM(A.PRD_ID, '0')                       AS PRD_ID
                    ,E.PRD_NM
                    ,CASE
                        WHEN A.SALS_CHRPSN_ID IS NOT NULL OR T6.OPRTR_NM IS NOT NULL THEN A.SALS_CHRPSN_ID || ' | ' || T6.OPRTR_NM
                    END                                         AS SALS_CHR_CD_NM           /* 영업담당자 */
                    ,A.SALS_CHRPSN_ID                                                       /* 영업담당자ID */
                    ,CASE
                        WHEN A.SVC_CHRPSN_ID IS NOT NULL OR T5.OPRTR_NM IS NOT NULL THEN A.SVC_CHRPSN_ID || ' | ' || T5.OPRTR_NM
                    END                                         AS SVC_CHRPSN_ID_NM         /* 서비스담당자 */
                    ,A.SVC_CHRPSN_ID                                                        /* 서비스담당자ID MD담당자인가 확인필요 */
                    ,CASE
                        WHEN A.OPR_CHRPSN_ID IS NOT NULL OR T8.OPRTR_NM IS NOT NULL THEN A.OPR_CHRPSN_ID || ' | ' || T8.OPRTR_NM
                    END                                         AS OPR_CHRPSN_ID_NM         /* 운영담당자 */
                    ,A.OPR_CHRPSN_ID                                                       /* 운영담당자ID */
                    ,CASE
                        WHEN A.PURG_CHRPSN_ID IS NOT NULL OR T7.OPRTR_NM IS NOT NULL THEN A.PURG_CHRPSN_ID || ' | ' || T7.OPRTR_NM
                    END                                         AS PURG_CHRPSN_ID_NM        /* 구매담당자 */
                    ,A.PURG_CHRPSN_ID                                                      /* 구매담당자ID */
                    ,CASE
                        WHEN A.MD_OPRTR_ID IS NOT NULL OR T9.OPRTR_NM IS NOT NULL THEN A.MD_OPRTR_ID || ' | ' || T9.OPRTR_NM
                    END                                         AS MD_CHRPSN_ID_NM          /* MD담당자 */
                    ,A.MD_OPRTR_ID                              AS MD_CHRPSN_ID             /* MD담당자ID */
                    ,F.COM_DTL_CD_NM                            AS MRO_CRT_YN
                    ,''                                         AS VOC_NO
                    ,''                                         AS SND_USR_ID
                    ,C.TNO
                    ,TO_NUMBER(C.AMOUNT)  AMOUNT
                    ,''                                         AS ODRPSN_ID
            FROM    BASE_T2 A
                    LEFT JOIN
                    TB_CO_COM_CD_DTL B
                        ON (B.LANG_CD = #{LANG_CD}
                        AND B.COM_CLSF_CD = 'PI_SPR_CD'
                        AND B.COM_DTL_CD = 'FI00300_01')
                    OUTER APPLY
                    (
                        SELECT  C.LOG_SEQ
                                , C.CRD_APPR_REQ_SPR_CD
                                , C.CRD_APMT_SPR_CD
                                , C.CRD_STL_SPR_CD
                                , C.CO_CD
                                , C.BZPLC_ID
                                , C.ODR_NO
                                , C.ODR_ITM_NO
                                , C.TAXINV_UNQ_NO
                                , C.CRD_CNC_TGT_ODR_SEQ
                                , C.LOG_CTS
                                , C.LOG_DISCD_YN
                                , C.REGPSN_ID
                                , C.REG_DTM
                                , Json_Value(C.LOG_CTS,'$.tno')                                             AS TNO                      /*NHN KCP 거래 고유번호*/
                                , Json_Value(C.LOG_CTS,'$.resCd')                                           AS RES_CD                   /*결과 코드*/
                                , Json_Value(C.LOG_CTS,'$.resMsg')                                          AS RES_MSG                  /*결과 메시지*/
                                , Json_Value(C.LOG_CTS,'$.cancTime')                                        AS CANC_TIME                /*취소 시간*/
                                , Json_Value(C.LOG_CTS,'$.cardModMny')                                          As AMOUNT                   /*결제 금액*/
                        FROM    (
                                    SELECT
                                            C.LOG_SEQ
                                            , C.CRD_APPR_REQ_SPR_CD
                                            , C.CRD_APMT_SPR_CD
                                            , C.CRD_STL_SPR_CD
                                            , C.CO_CD
                                            , C.BZPLC_ID
                                            , C.ODR_NO
                                            , C.ODR_ITM_NO
                                            , C.TAXINV_UNQ_NO
                                            , C.CRD_CNC_TGT_ODR_SEQ
                                            , C.LOG_CTS
                                            , C.LOG_DISCD_YN
                                            , ROW_NUMBER() OVER ( ORDER BY C.LOG_SEQ DESC )                 AS RN
                                            , C.REGPSN_ID
                                            , C.REG_DTM
                                    FROM    TB_AD_CRD_STL_APPR_LOG C
                                    WHERE   C.CRD_CNC_TGT_ODR_SEQ = A.CRD_CNC_TGT_ODR_SEQ
                                    AND     C.CRD_APPR_REQ_SPR_CD = '5'                                 /*승인취소*/
                                    AND     NVL(C.LOG_DISCD_YN,'N') != 'Y'
                                ) C
                        WHERE   C.RN = 1
                    ) C
                    LEFT JOIN
                    TB_CO_COM_CD_DTL D
                        ON (D.LANG_CD = #{LANG_CD}
                        AND D.COM_CLSF_CD = 'IF_PROC_RSLT_CD'
                        AND D.COM_DTL_CD = CASE WHEN C.RES_CD = '0000' THEN 'S' ELSE 'E' END)
                    LEFT JOIN
                    TB_PR_PRD_INFO E
                        ON (E.CO_CD = A.CO_CD
                        AND E.PRD_ID = A.PRD_ID)
                    LEFT JOIN
                    TB_CO_COM_CD_DTL F
                        ON (F.LANG_CD = #{LANG_CD}
                        AND F.COM_CLSF_CD = 'MRO_CRT_YN'
                        AND F.COM_DTL_CD = E.MRO_CRT_YN)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T5
                        ON (T5.CO_CD   = A.CO_CD
                        AND T5.OPRTR_ID = A.SVC_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T6
                        ON (T6.CO_CD   = A.CO_CD
                        AND T6.OPRTR_ID = A.SALS_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T7
                        ON (T7.CO_CD   = A.CO_CD
                        AND T7.OPRTR_ID = A.PURG_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T8
                        ON (T8.CO_CD   = A.CO_CD
                        AND T8.OPRTR_ID = A.OPR_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T9
                        ON (T9.CO_CD   = A.CO_CD
                        AND T9.OPRTR_ID = A.MD_OPRTR_ID)
            WHERE   1=1
            AND     A.CRD_CNC_TGT_ODR_SEQ IS NOT NULL
            <if test="IF_PI_ID != null and !IF_PI_ID.equals('')">
            AND     'FI00300_01' = #{IF_PI_ID}
            </if>
            UNION ALL
            SELECT
                    A.CO_CD                                                                 /* 회사코드 */
                    ,A.BZPLC_ID                                                             /* 사업장ID */
                    ,A.ODR_NO                                                               /* 주문번호 */
                    ,A.ODR_ITM_NO                                                           /* 주문항목번호 */
                    ,A.ODR_NO||'-'||TO_CHAR(A.ODR_ITM_NO)       AS JNT_ODR_ITM_NO           /* 주문항번 */
                    ,'FI00300_02'                               AS IF_PI_ID                 /* 선수금카드취소 카드사 전송 */
                    ,'SSP'                                      AS IF_SYSTEM_ID             /* SSP */
                    ,B.COM_DTL_CD_NM                            AS IF_PI_NM
                    ,Nvl(C3.IF_MSG_ID,'_')                      AS IF_MSG_ID                /*NHN KCP 거래 고유번호*/
                    ,CASE
                        WHEN    C2.IF_PROC_RSLT_CD IS NULL THEN 'E'
                        WHEN    C2.IF_PROC_RSLT_CD  = 'E' THEN 'E'
                        WHEN    C3.IF_PROC_RSLT_CD = 'S' THEN 'S'
                        ELSE 'E'
                    END                                         AS IF_PROC_RSLT_CD          /* IF처리결과코드, S=성공, E = 오류 */
                    ,D.COM_DTL_CD_NM                            AS IF_PROC_RSLT_CD_NM       /* IF처리결과코드명 S=성공, E = 오류 */
                    ,CASE
                        WHEN    C2.IF_PROC_RSLT_CD IS NULL THEN '미전송'
                        WHEN    C2.IF_PROC_RSLT_CD  = 'E' THEN C2.IF_PI_MSG
                        WHEN    C3.IF_PROC_RSLT_CD = 'S' THEN C3.IF_PI_MSG
                        ELSE C3.IF_PI_MSG
                    END                                         AS IF_PI_MSG                /* IFPI메시지 */
                    ,C3.REG_DTM                                                             /* 등록일시 */
                    ,C3.IF_PROC_RSLT_DTM                        AS IF_PROC_RSLT_DTM         /* IF처리결과일시 */
                    ,C3.IF_MSG_SEQ                              AS IF_MSG_SEQ               /* IF메시지순번 */
                    ,C3.RETRY_PROC_RSLT_CD                      AS RETRY_PROC_RSLT_CD       /* 재시도처리결과코드 */
                    ,NVL(C3.ORI_IF_MSG_ID,C3.IF_MSG_ID)         AS ORI_IF_MSG_ID            /* 원IF메시지ID */
                    ,NVL(C3.ORI_IF_MSG_SEQ,C3.IF_MSG_SEQ)       AS ORI_IF_MSG_SEQ           /* 원IF메시지순번 */
                    ,LTRIM(A.PRD_ID, '0')                       AS PRD_ID
                    ,E.PRD_NM
                    ,CASE
                        WHEN A.SALS_CHRPSN_ID IS NOT NULL OR T6.OPRTR_NM IS NOT NULL THEN A.SALS_CHRPSN_ID || ' | ' || T6.OPRTR_NM
                    END                                         AS SALS_CHR_CD_NM           /* 영업담당자 */
                    ,A.SALS_CHRPSN_ID                                                       /* 영업담당자ID */
                    ,CASE
                        WHEN A.SVC_CHRPSN_ID IS NOT NULL OR T5.OPRTR_NM IS NOT NULL THEN A.SVC_CHRPSN_ID || ' | ' || T5.OPRTR_NM
                    END                                         AS SVC_CHRPSN_ID_NM         /* 서비스담당자 */
                    ,A.SVC_CHRPSN_ID                                                        /* 서비스담당자ID MD담당자인가 확인필요 */
                    ,CASE
                        WHEN A.OPR_CHRPSN_ID IS NOT NULL OR T8.OPRTR_NM IS NOT NULL THEN A.OPR_CHRPSN_ID || ' | ' || T8.OPRTR_NM
                    END                                         AS OPR_CHRPSN_ID_NM         /* 운영담당자 */
                    ,A.OPR_CHRPSN_ID                                                       /* 운영담당자ID */
                    ,CASE
                        WHEN A.PURG_CHRPSN_ID IS NOT NULL OR T7.OPRTR_NM IS NOT NULL THEN A.PURG_CHRPSN_ID || ' | ' || T7.OPRTR_NM
                    END                                         AS PURG_CHRPSN_ID_NM        /* 구매담당자 */
                    ,A.PURG_CHRPSN_ID                                                      /* 구매담당자ID */
                    ,CASE
                        WHEN A.MD_OPRTR_ID IS NOT NULL OR T9.OPRTR_NM IS NOT NULL THEN A.MD_OPRTR_ID || ' | ' || T9.OPRTR_NM
                    END                                         AS MD_CHRPSN_ID_NM          /* MD담당자 */
                    ,A.MD_OPRTR_ID                              AS MD_CHRPSN_ID             /* MD담당자ID */
                    ,F.COM_DTL_CD_NM                            AS MRO_CRT_YN
                    ,''                                         AS VOC_NO
                    ,C3.IF_RSLT_FLD_3                           AS SND_USR_ID
                    ,C.TNO
                    ,TO_NUMBER(C.AMOUNT)  AMOUNT
                    ,''                                         AS ODRPSN_ID
            FROM    BASE_T2 A
                    LEFT JOIN
                    TB_CO_COM_CD_DTL B
                        ON (B.LANG_CD = #{LANG_CD}
                        AND B.COM_CLSF_CD = 'PI_SPR_CD'
                        AND B.COM_DTL_CD = 'FI00300_02')
                    CROSS APPLY
                    (
                        SELECT  C.LOG_SEQ
                                , C.CRD_APPR_REQ_SPR_CD
                                , C.CRD_APMT_SPR_CD
                                , C.CRD_STL_SPR_CD
                                , C.CO_CD
                                , C.BZPLC_ID
                                , C.ODR_NO
                                , C.ODR_ITM_NO
                                , C.TAXINV_UNQ_NO
                                , C.CRD_CNC_TGT_ODR_SEQ
                                , C.LOG_CTS
                                , C.LOG_DISCD_YN
                                , C.REGPSN_ID
                                , C.REG_DTM
                                , Json_Value(C.LOG_CTS,'$.tno')                                             AS TNO                      /*NHN KCP 거래 고유번호*/
                                , Json_Value(C.LOG_CTS,'$.resCd')                                           AS RES_CD                   /*결과 코드*/
                                , Json_Value(C.LOG_CTS,'$.resMsg')                                          AS RES_MSG                  /*결과 메시지*/
                                , Json_Value(C.LOG_CTS,'$.cancTime')                                        AS CANC_TIME                /*취소 시간*/
                                , Json_Value(C.LOG_CTS,'$.cardModMny')                                          As AMOUNT                   /*결제 금액*/
                        FROM    (
                                    SELECT
                                            C.LOG_SEQ
                                            , C.CRD_APPR_REQ_SPR_CD
                                            , C.CRD_APMT_SPR_CD
                                            , C.CRD_STL_SPR_CD
                                            , C.CO_CD
                                            , C.BZPLC_ID
                                            , C.ODR_NO
                                            , C.ODR_ITM_NO
                                            , C.TAXINV_UNQ_NO
                                            , C.CRD_CNC_TGT_ODR_SEQ
                                            , C.LOG_CTS
                                            , C.LOG_DISCD_YN
                                            , ROW_NUMBER() OVER ( ORDER BY C.LOG_SEQ DESC )                 AS RN
                                            , C.REGPSN_ID
                                            , C.REG_DTM
                                    FROM    TB_AD_CRD_STL_APPR_LOG C
                                    WHERE   C.CRD_CNC_TGT_ODR_SEQ = A.CRD_CNC_TGT_ODR_SEQ
                                    AND     C.CRD_APPR_REQ_SPR_CD = '5'                                 /*승인취소*/
                                    AND     NVL(C.LOG_DISCD_YN,'N') != 'Y'
                                ) C
                        WHERE   C.RN = 1
                        AND     Json_Value(C.LOG_CTS,'$.resCd') = '0000'
                    ) C
                    LEFT JOIN
                    TB_OD_ODR_CRD_STL_DTLS C2
                        ON (C2.LOG_SEQ = C.LOG_SEQ
                        AND C2.CRD_APPR_REQ_SPR_CD = C.CRD_APPR_REQ_SPR_CD)
                    OUTER APPLY
                    (
                        SELECT
                                C3.IF_SYSTEM_ID
                                , C3.IF_PI_ID
                                , C3.IF_MSG_ID
                                , C3.IF_MSG_SEQ
                                , C3.IF_PROC_TP_CD
                                , C3.ODR_TRANS_DTL_NM
                                , C3.CO_CD
                                , C3.BZPLC_ID
                                , C3.ODR_NO
                                , C3.ODR_ITM_NO
                                , C3.IF_PROC_RSLT_CD
                                , C3.IF_PROC_RSLT_DTM
                                , C3.IF_PI_MSG
                                , C3.IF_RSLT_FLD_1
                                , C3.IF_RSLT_FLD_2
                                , C3.IF_RSLT_FLD_3
                                , C3.RETRY_PROC_RSLT_CD
                                , C3.ORI_IF_MSG_ID
                                , C3.ORI_IF_MSG_SEQ
                                , C3.REG_DTM
                        FROM
                                (
                                    SELECT
                                            C3.IF_SYSTEM_ID             /* IF시스템ID */
                                            , C3.IF_PI_ID               /* IFPIID */
                                            , C3.IF_MSG_ID              /* IF메시지ID */
                                            , C3.IF_MSG_SEQ             /* IF메시지순번 */
                                            , C3.IF_PROC_TP_CD          /* IF처리유형코드 */
                                            , C3.ODR_TRANS_DTL_NM       /* 주문전송상세명 */
                                            , C3.CO_CD                  /* 회사코드 */
                                            , C3.BZPLC_ID               /* 사업장ID */
                                            , C3.ODR_NO                 /* 주문번호 */
                                            , C3.ODR_ITM_NO             /* 주문항목번호 */
                                            , C3.IF_PROC_RSLT_CD        /* IF처리결과코드 */
                                            , C3.IF_PROC_RSLT_DTM       /* IF처리결과일시 */
                                            , C3.IF_PI_MSG              /* IFPI메시지 */
                                            , C3.IF_RSLT_FLD_1          /* IF결과필드1 */
                                            , C3.IF_RSLT_FLD_2          /* IF결과필드2 */
                                            , C3.IF_RSLT_FLD_3          /* IF결과필드3 */
                                            , C3.RETRY_PROC_RSLT_CD     /* 재시도처리결과코드 */
                                            , C3.ORI_IF_MSG_ID          /* 원IF메시지ID */
                                            , C3.ORI_IF_MSG_SEQ         /* 원IF메시지순번 */
                                            , C3.REG_DTM                /* 등록일시 */
                                            , ROW_NUMBER() OVER (ORDER BY C3.IF_MSG_ID DESC )               AS RN
                                    FROM    TB_OD_ODR_TRANS_MST C3
                                    WHERE   C3.CO_CD = A.CO_CD
                                    AND     C3.BZPLC_ID = A.BZPLC_ID
                                    AND     C3.ODR_NO = A.ODR_NO
                                    AND     C3.ODR_ITM_NO = A.ODR_ITM_NO
                                    AND     C3.IF_PI_ID = 'FI00300'
                                    AND     C3.ODR_TRANS_DTL_NM = 'CANCEL'
                                ) C3
                        WHERE   C3.RN = 1
                    ) C3
                    LEFT JOIN
                    TB_CO_COM_CD_DTL D
                        ON (D.LANG_CD = #{LANG_CD}
                        AND D.COM_CLSF_CD = 'IF_PROC_RSLT_CD'
                        AND D.COM_DTL_CD =
                                CASE
                                    WHEN    C2.IF_PROC_RSLT_CD IS NULL THEN 'E'
                                    WHEN    C2.IF_PROC_RSLT_CD  = 'E' THEN 'E'
                                    WHEN    C3.IF_PROC_RSLT_CD = 'S' THEN 'S'
                                    ELSE 'E'
                                END
                        )
                    LEFT JOIN
                    TB_PR_PRD_INFO E
                        ON (E.CO_CD = A.CO_CD
                        AND E.PRD_ID = A.PRD_ID)
                    LEFT JOIN
                    TB_CO_COM_CD_DTL F
                        ON (F.LANG_CD = #{LANG_CD}
                        AND F.COM_CLSF_CD = 'MRO_CRT_YN'
                        AND F.COM_DTL_CD = E.MRO_CRT_YN)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T5
                        ON (T5.CO_CD   = A.CO_CD
                        AND T5.OPRTR_ID = A.SVC_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T6
                        ON (T6.CO_CD   = A.CO_CD
                        AND T6.OPRTR_ID = A.SALS_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T7
                        ON (T7.CO_CD   = A.CO_CD
                        AND T7.OPRTR_ID = A.PURG_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T8
                        ON (T8.CO_CD   = A.CO_CD
                        AND T8.OPRTR_ID = A.OPR_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T9
                        ON (T9.CO_CD   = A.CO_CD
                        AND T9.OPRTR_ID = A.MD_OPRTR_ID)
            WHERE   1 = 1
            AND     A.CRD_CNC_TGT_ODR_SEQ IS NOT NULL
            <if test="IF_PI_ID != null and !IF_PI_ID.equals('')">
            AND     'FI00300_02' = #{IF_PI_ID}
            </if>
            UNION ALL 
            
            SELECT  S1.CO_CD                                                                 /* 회사코드 */
	             ,  S1.BZPLC_ID                                                              /* 사업장ID */
	             ,  S1.ODR_NO                                                                /* 주문번호 */
	             ,  S1.ODR_ITM_NO                                                            /* 주문항목번호 */
	             ,  S1.JNT_ODR_ITM_NO           /* 주문항번 */
	             ,  S1.IF_PI_ID                 /* 선수금카드취소 카드사 전송 */
	             ,  S1.IF_SYSTEM_ID             /* SSP */
	             ,  S1.IF_PI_NM
	             ,  S1.IF_MSG_ID                /*NHN KCP 거래 고유번호*/
	             ,  S1.IF_PROC_RSLT_CD          /* IF처리결과코드, S=성공, E = 오류 */
	             ,  S1.IF_PROC_RSLT_CD_NM       /* IF처리결과코드명 S=성공, E = 오류 */
	             ,  S1.IF_PI_MSG                /* IFPI메시지 */
	             ,  S1.REG_DTM                  /* 등록일시 */
	             ,  S1.IF_PROC_RSLT_DTM         /* IF처리결과일시 */
	             ,  S1.IF_MSG_SEQ               /* IF메시지순번 */
	             ,  S1.RETRY_PROC_RSLT_CD       /* 재시도처리결과코드 */
	             ,  S1.ORI_IF_MSG_ID            /* 원IF메시지ID */
	             ,  S1.ORI_IF_MSG_SEQ           /* 원IF메시지순번 */
	             ,  S1.PRD_ID
	             ,  S1.PRD_NM
	             ,  S1.SALS_CHR_CD_NM           /* 영업담당자 */
	             ,  S1.SALS_CHRPSN_ID                                                       /* 영업담당자ID */
	             ,  S1.SVC_CHRPSN_ID_NM         /* 서비스담당자 */
	             ,  S1.SVC_CHRPSN_ID                                                        /* 서비스담당자ID MD담당자인가 확인필요 */
	             ,  S1.OPR_CHRPSN_ID_NM         /* 운영담당자 */
	             ,  S1.OPR_CHRPSN_ID                                                       /* 운영담당자ID */
	             ,  S1.PURG_CHRPSN_ID_NM        /* 구매담당자 */
	             ,  S1.PURG_CHRPSN_ID                                                      /* 구매담당자ID */
	             ,  S1.MD_CHRPSN_ID_NM          /* MD담당자 */
	             ,  S1.MD_CHRPSN_ID             /* MD담당자ID */
	             ,  S1.MRO_CRT_YN
	             ,  S1.VOC_NO
	             ,  S1.SND_USR_ID
	             ,  S1.TNO
	             ,  S1.AMOUNT
	             ,  S1.ODRPSN_ID
			  FROM (
					SELECT  A.CO_CD                                                                 /* 회사코드 */
			             ,  A.BZPLC_ID                                                              /* 사업장ID */
			             ,  A.ODR_NO                                                                /* 주문번호 */
			             ,  A.ODR_ITM_NO                                                            /* 주문항목번호 */
			             ,  A.ODR_NO||'-'||TO_CHAR(A.ODR_ITM_NO)        AS JNT_ODR_ITM_NO           /* 주문항번 */
			             ,  'SD01920'                                   AS IF_PI_ID                 /* 선수금카드취소 카드사 전송 */
			             ,  'SSP'                                       AS IF_SYSTEM_ID             /* SSP */
			             ,  C.COM_DTL_CD_NM                             AS IF_PI_NM
			             ,  NULL                                         AS IF_MSG_ID                /*NHN KCP 거래 고유번호*/
			             ,  NULL                                          AS IF_PROC_RSLT_CD          /* IF처리결과코드, S=성공, E = 오류 */
			             ,  NULL                                         AS IF_PROC_RSLT_CD_NM       /* IF처리결과코드명 S=성공, E = 오류 */
			             ,  NULL                                          AS IF_PI_MSG                /* IFPI메시지 */
			             ,  NULL                                        AS REG_DTM                  /* 등록일시 */
			             ,  NULL                                        AS IF_PROC_RSLT_DTM         /* IF처리결과일시 */
			             ,  1                                           AS IF_MSG_SEQ               /* IF메시지순번 */
			             ,  NULL                                        AS RETRY_PROC_RSLT_CD       /* 재시도처리결과코드 */
			             ,  NULL                                          AS ORI_IF_MSG_ID            /* 원IF메시지ID */
			             ,  1                                           AS ORI_IF_MSG_SEQ           /* 원IF메시지순번 */
			             ,  LTRIM(A.PRD_ID, '0')                        AS PRD_ID
			             ,  E.PRD_NM
			             ,  CASE WHEN A.SALS_CHRPSN_ID IS NOT NULL OR T6.OPRTR_NM IS NOT NULL THEN A.SALS_CHRPSN_ID || ' | ' || T6.OPRTR_NM
			                 END                                         AS SALS_CHR_CD_NM           /* 영업담당자 */
			             ,  A.SALS_CHRPSN_ID                                                       /* 영업담당자ID */
			             ,  CASE WHEN A.SVC_CHRPSN_ID IS NOT NULL OR T5.OPRTR_NM IS NOT NULL THEN A.SVC_CHRPSN_ID || ' | ' || T5.OPRTR_NM
			                 END                                         AS SVC_CHRPSN_ID_NM         /* 서비스담당자 */
			             ,  A.SVC_CHRPSN_ID                                                        /* 서비스담당자ID MD담당자인가 확인필요 */
			             ,  CASE WHEN A.OPR_CHRPSN_ID IS NOT NULL OR T8.OPRTR_NM IS NOT NULL THEN A.OPR_CHRPSN_ID || ' | ' || T8.OPRTR_NM
			                 END                                         AS OPR_CHRPSN_ID_NM         /* 운영담당자 */
			             ,  A.OPR_CHRPSN_ID                                                       /* 운영담당자ID */
			             ,  CASE WHEN A.PURG_CHRPSN_ID IS NOT NULL OR T7.OPRTR_NM IS NOT NULL THEN A.PURG_CHRPSN_ID || ' | ' || T7.OPRTR_NM
			                 END                                         AS PURG_CHRPSN_ID_NM        /* 구매담당자 */
			             ,  A.PURG_CHRPSN_ID                                                      /* 구매담당자ID */
			             ,  CASE WHEN A.MD_OPRTR_ID IS NOT NULL OR T9.OPRTR_NM IS NOT NULL THEN A.MD_OPRTR_ID || ' | ' || T9.OPRTR_NM
			                 END                                         AS MD_CHRPSN_ID_NM          /* MD담당자 */
			             ,  A.MD_OPRTR_ID                              AS MD_CHRPSN_ID             /* MD담당자ID */
			             ,  F.COM_DTL_CD_NM                            AS MRO_CRT_YN
			             ,  NULL                                         AS VOC_NO
			             ,  NULL                                         AS SND_USR_ID
			             ,  NULL                                         AS TNO
			             ,  NULL                                       AS  AMOUNT
			             ,  NULL                                         AS ODRPSN_ID
					  FROM  BASE_T A
					        JOIN
					        TB_AD_SSP_ADJ_HST B
					        ON (A.CO_CD = B.CO_CD 
					        AND A.BZPLC_ID = B.BZPLC_ID
					        AND A.ODR_NO = B.ODR_NO 
					        AND A.ODR_ITM_NO = B.ODR_ITM_NO
					        )
					        JOIN
					        TB_AD_SSP_ADJ_DTLS B1
					        ON (A.CO_CD = B1.CO_CD 
					        AND A.BZPLC_ID = B1.BZPLC_ID
					        AND A.ODR_NO = B1.ODR_NO 
					        AND A.ODR_ITM_NO = B1.ODR_ITM_NO
					        )
					        LEFT JOIN 
					        TB_CO_COM_CD_DTL C
				            ON (C.LANG_CD = #{LANG_CD}
				            AND C.COM_CLSF_CD = 'PI_SPR_CD'
				            AND C.COM_DTL_CD = 'SD01920')
				            LEFT JOIN
			                TB_PR_PRD_INFO E
			                ON (E.CO_CD = A.CO_CD
			                AND E.PRD_ID = A.PRD_ID)
			                LEFT JOIN
			                TB_CO_COM_CD_DTL F
			                ON (F.LANG_CD = 'KO'
			                AND F.COM_CLSF_CD = 'MRO_CRT_YN'
			                AND F.COM_DTL_CD = E.MRO_CRT_YN)
			                LEFT JOIN
			                TB_CO_MBR_OPRTR_INFO    T5
			                ON (T5.CO_CD   = A.CO_CD
			                AND T5.OPRTR_ID = A.SVC_CHRPSN_ID)
			                LEFT JOIN
			                TB_CO_MBR_OPRTR_INFO    T6
			                ON (T6.CO_CD   = A.CO_CD
			                AND T6.OPRTR_ID = A.SALS_CHRPSN_ID)
			                LEFT JOIN
			                TB_CO_MBR_OPRTR_INFO    T7
			                ON (T7.CO_CD   = A.CO_CD
			                AND T7.OPRTR_ID = A.PURG_CHRPSN_ID)
			                LEFT JOIN
			                TB_CO_MBR_OPRTR_INFO    T8
			                ON (T8.CO_CD   = A.CO_CD
			                AND T8.OPRTR_ID = A.OPR_CHRPSN_ID)
			                LEFT JOIN
			                TB_CO_MBR_OPRTR_INFO    T9
			                ON (T9.CO_CD   = A.CO_CD
			                AND T9.OPRTR_ID = A.MD_OPRTR_ID)
					 WHERE  1 = 1   
					   AND  NVL(B.ADJ_DCN_YN, 'N') = 'Y' 
					   <if test='IF_PROC_RSLT_CD != null and !IF_PROC_RSLT_CD.equals("") and !IF_PROC_RSLT_CD.equals("P") '>
    						AND  NVL(B1.IF_PROC_RSLT_CD, 'P') = #{IF_PROC_RSLT_CD}
    					</if> 
					) S1
					LEFT JOIN 
					TB_OD_ODR_TRANS_MST D
			        ON (S1.CO_CD = D.CO_CD(+) 
			        AND S1.BZPLC_ID = D.BZPLC_ID(+)
			        AND S1.ODR_NO = D.ODR_NO(+) 
			        AND S1.ODR_ITM_NO = D.ODR_ITM_NO(+)
			        AND D.IF_PI_ID = 'SD01920'
			        )
			WHERE  1 = 1
			  AND  D.IF_PI_ID IS NULL
			  <if test="IF_PI_ID != null and !IF_PI_ID.equals('')">
				AND     'SD01920' = #{IF_PI_ID}
              </if>	
            ORDER BY ODR_NO, ODR_ITM_NO, IF_PI_ID DESC
            ) T1
            LEFT JOIN
            TB_CO_MBR_OPRTR_INFO    T3
            ON   T3.CO_CD   = T1.CO_CD
            AND  T3.OPRTR_ID = T1.SND_USR_ID
    OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
    </select>

    <!-- ******************************************************************************
        * SELECT : 연계정보 Count 조회 * 작성자 : neonlee * 작성 일자 : 2022-06-27
        ****************************************************************************** -->
    <select id="selectSndRcvInfoListCount" parameterType="HashMap" resultType="Integer">
      /* com.ssp.bo.od.orderList.selectSndRcvInfoListCount */
    WITH BASE_T AS (
    SELECT  /*+INDEX(T40 TB_PR_PRD_CLSF_CHRPSN_INFO_IX01)*/
            T1.CO_CD,
            T1.BZPLC_ID,
            T1.ODR_NO,
            T1.ODR_ITM_NO,
            T2.CUST_SPR_CD,
            T7.MALL_SPR_CD,
            T1.PRD_ID,
            T7.PRD_NM,
            T8.MRO_CRT_YN,
            T1.SALS_CHRPSN_ID,      /* 영업담당자ID */
            T1.SVC_CHRPSN_ID,       /* 서비스담당자ID */
            T1.OPR_CHRPSN_ID,       /* 운영담당자ID */
            T1.PURG_CHRPSN_ID,      /* 구매담당자ID */
            T40.PRD_CLSF_CHRPSN_ID          MD_OPRTR_ID,         /* MD담당자 */
            T1.CRD_CNC_TGT_ODR_SEQ
    FROM    TB_OD_ODR_DTL T1
            JOIN
            TB_OD_ODR_MST T2
            ON  T2.CO_CD = T1.CO_CD
            AND T2.ODR_NO = T1.ODR_NO
            AND T2.BZPLC_ID = T1.BZPLC_ID
            <if test="OPR_UNIT_ID > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS T3
            ON  T3.SES_ID = #{SES_ID}
            AND T3.INQ_COND_DTLS = #{INQ_COND_DTLS}
            AND T3.COL_ITM = 'OPR_UNIT_ID'
            AND T3.COND_DATA_VAL = T2.OPR_UNIT_ID
            </if>
            <if test="ODR_NO > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS   T4
            ON  T4.SES_ID = #{SES_ID}
            AND T4.INQ_COND_DTLS = #{INQ_COND_DTLS}
            AND T4.COL_ITM = 'ODR_NO'
            AND REGEXP_SUBSTR(T4.COND_DATA_VAL,'[^-]+',1,1) = T1.ODR_NO
            AND (CASE WHEN TRIM(REGEXP_SUBSTR(T4.COND_DATA_VAL,'[^-]+',1,2)) IS NULL OR
                          TRIM(REGEXP_SUBSTR(T4.COND_DATA_VAL,'[^-]+',1,2)) = '' THEN
                          T1.ODR_ITM_NO ELSE TO_NUMBER(TRIM(REGEXP_SUBSTR(T4.COND_DATA_VAL,'[^-]+',1,2))) END) = T1.ODR_ITM_NO
            </if>
            <if test="ODR_STATS_CD > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS T5
            ON  T5.SES_ID = #{SES_ID}
            AND T5.INQ_COND_DTLS = #{INQ_COND_DTLS}
            AND T5.COL_ITM = 'ODR_STATS_CD'
            AND T5.COND_DATA_VAL = T1.ODR_STATS_CD
            </if>
            <if test="PRD_ID > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS T6
            ON  T6.SES_ID = #{SES_ID}
            AND T6.INQ_COND_DTLS = #{INQ_COND_DTLS}
            AND T6.COL_ITM = 'PRD_ID'
            AND LPAD(T6.COND_DATA_VAL, 18, '0') = T1.PRD_ID
            </if>
            <if test="SALS_CHRPSN > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS T8
            ON  T8.SES_ID = #{SES_ID}
            AND T8.INQ_COND_DTLS = #{INQ_COND_DTLS}
            AND T8.COL_ITM = 'SALS_CHRPSN'
            AND T8.COND_DATA_VAL = T1.SALS_CHRPSN_ID
            </if>
            <if test="PURG_CHRPSN > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS T10
            ON  T10.SES_ID = #{SES_ID}
            AND T10.INQ_COND_DTLS = #{INQ_COND_DTLS}
            AND T10.COL_ITM = 'PURG_CHRPSN'
            AND T10.COND_DATA_VAL = T1.PURG_CHRPSN_ID
            </if>
            <if test="SVC_CHRPSN > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS T11
            ON  T11.SES_ID = #{SES_ID}
            AND T11.INQ_COND_DTLS = #{INQ_COND_DTLS}
            AND T11.COL_ITM = 'SVC_CHRPSN'
            AND T11.COND_DATA_VAL = T1.SVC_CHRPSN_ID
            </if>
            LEFT JOIN
            TB_PR_MRO_PRD_INFO T7
            ON  T7.CO_CD = T1.CO_CD
            AND T7.PRD_ID = T1.PRD_ID
            LEFT JOIN
            TB_PR_PRD_INFO T8
            ON  T8.CO_CD = T1.CO_CD
            AND T8.PRD_ID = T1.PRD_ID
            LEFT JOIN
            TB_PR_PRD_CLSF_CHRPSN_INFO T40
                ON (T40.CO_CD = T8.CO_CD
                AND T40.PRD_CLCD = T8.PRD_CLCD
                AND T40.PRD_CLSF_CHRPSN_TP_CD = '20'
                AND T40.PRD_CLSF_CHRPSN_SPR_CD = '10'
                AND T40.MNFR_NO = '*'
                AND T40.PRD_CLSF_CHRPSN_USEYN = 'Y')
            <if test="MD_CHRPSN > 0 ">
            JOIN
            TB_OD_ODR_INQ_TGT_DTLS T41
                ON  T41.SES_ID = #{SES_ID}
                AND T41.INQ_COND_DTLS = #{INQ_COND_DTLS}
                AND T41.COL_ITM = 'MD_CHRPSN'
                AND T41.COND_DATA_VAL = T40.PRD_CLSF_CHRPSN_ID
            </if>
    WHERE   T1.CO_CD = #{CO_CD}
    AND     T1.ODR_DCN_DTM BETWEEN TO_DATE(#{FROM_DT} || '000000','YYYYMMDDHH24MISS') AND TO_DATE(#{TO_DT} || '235959','YYYYMMDDHH24MISS')
    <if test="CUST_SPR_CD != null and !CUST_SPR_CD.equals('') ">
    AND     T2.CUST_SPR_CD = #{CUST_SPR_CD}   /* 고객구분코드 4.고객 유형 */
    </if>
    <if test="MALL_SPR_CD != null and !MALL_SPR_CD.equals('') ">
    AND     T7.MALL_SPR_CD = #{MALL_SPR_CD}   /* 몰구분코드 */
    </if>
    ), BASE_T2 AS (
    SELECT *
    FROM (
	    SELECT  *
	    FROM    (
	            SELECT   T1.ROWID  RID
	                    ,ROW_NUMBER() OVER(PARTITION BY  T1.CO_CD,T1.BZPLC_ID,T1.ODR_NO,T1.ODR_ITM_NO,T1.IF_PI_ID,T1.IF_RSLT_FLD_1
	                                       ORDER BY T1.IF_MSG_ID DESC, NVL(T1.ORI_IF_MSG_ID,T1.IF_MSG_ID) DESC)     RN
	                    ,T3.COM_DTL_CD_NM   PI_SPR_CD_NM
	                    ,CASE WHEN T1.IF_PI_ID = 'FI00300' THEN T21.CRECD_TECL_NO  ELSE NULL END   TNO
	                    ,CASE WHEN T1.IF_PI_ID = 'FI00300' THEN T21.CRECD_STL_AMT  ELSE NULL END   AMOUNT
	                    ,T1.IF_MSG_ID
	                    ,T1.IF_MSG_SEQ
	                    ,T1.IF_PI_ID
	                    ,T1.IF_PI_MSG
	                    ,T1.IF_PROC_RSLT_CD
	                    ,T1.ODR_ITM_NO
	                    ,T1.ODR_NO
	                    ,T1.ODR_TRANS_DTL_NM
	                    ,T1.ORI_IF_MSG_ID
	                    ,T1.ORI_IF_MSG_SEQ
	                    ,T2.CRD_CNC_TGT_ODR_SEQ
	                    ,T2.PRD_ID
	                    ,T2.CO_CD
	                    ,T2.SALS_CHRPSN_ID
	                    ,T2.SVC_CHRPSN_ID
	                    ,T2.OPR_CHRPSN_ID
	                    ,T2.PURG_CHRPSN_ID
	                    ,T2.MD_OPRTR_ID
	                    ,T2.BZPLC_ID
	            FROM    TB_OD_ODR_TRANS_MST  T1
	                    JOIN
	                    BASE_T               T2
	                    ON  T2.CO_CD = T1.CO_CD
	                    AND T2.BZPLC_ID = T1.BZPLC_ID
	                    AND T2.ODR_NO = T1.ODR_NO
	                    AND T2.ODR_ITM_NO = CASE WHEN T1.ODR_ITM_NO IS NULL THEN T2.ODR_ITM_NO ELSE T1.ODR_ITM_NO END
	                    JOIN
	                    TB_CO_COM_CD_DTL    T3
	                    ON  T3.LANG_CD = #{LANG_CD}
	                    AND T3.COM_CLSF_CD = 'PI_SPR_CD'
	                    AND T3.COM_DTL_CD = T1.IF_PI_ID
	                    AND T3.COM_USR_DEFN_NM_1 = 'Y'
	                    LEFT JOIN
	                    TB_OD_ODR_CRD_STL_DTLS  T21
	                    ON  T21.CO_CD = T1.CO_CD
	                    AND T21.ODR_NO = T1.ODR_NO
	                    AND T21.CRD_STL_SPR_CD = '10'
	            WHERE   1 = 1
	            AND     T1.IF_PI_ID LIKE #{IF_PI_ID} ||'%'
	            AND   CASE WHEN T1.IF_PI_ID = 'FI00300' AND T21.ORI_ODR_NO IS NOT NULL THEN '0'
	                       ELSE '1' END = '1'
	            AND   CASE WHEN T1.IF_PI_ID = 'SD01730' THEN 'TB_OD_ODR_DTL'
	                       WHEN T1.IF_PI_ID = 'FI00300' THEN 'MAIN'
	                       ELSE T1.ODR_TRANS_DTL_NM
	                  END = T1.ODR_TRANS_DTL_NM
	            )   T1
	    WHERE   T1.RN = 1
	    ) T2
	WHERE 1=1 
    <if test='IF_PROC_RSLT_CD != null and !IF_PROC_RSLT_CD.equals("") and !IF_PROC_RSLT_CD.equals("P") '>
    AND     T2.IF_PROC_RSLT_CD = #{IF_PROC_RSLT_CD}
    </if>
    <if test='IF_PROC_RSLT_CD.equals("P") '>
    AND     T2.IF_PROC_RSLT_CD IS NULL
    </if>
    )
    SELECT  count(*)    CNT
    FROM    (
            SELECT
                    T1.CO_CD,               /* 회사코드 */
                    T1.BZPLC_ID,            /* 사업장ID */
                    T1.ODR_NO,              /* 주문번호 */
                    T1.ODR_ITM_NO,          /* 주문항목번호 */
                    T1.ODR_NO || '-' || T1.ODR_ITM_NO       JNT_ODR_ITM_NO,
                    T1.IF_PI_ID,            /* IFPIID */
                    T1.IF_SYSTEM_ID,
                    T0.PI_SPR_CD_NM IF_PI_NM,
                    T1.IF_MSG_ID,           /* IF메시지ID */
                    T1.IF_PROC_RSLT_CD,     /* IF처리결과코드, S=성공, E=오류 */
                    T20.COM_DTL_CD_NM   IF_PROC_RSLT_CD_NM,
                    T1.IF_PI_MSG,           /* IFPI메시지 */
                    T1.REG_DTM,             /* 등록일시 */
                    T1.IF_PROC_RSLT_DTM,    /* IF처리결과일시 */
                    T1.IF_MSG_SEQ,          /* IF메시지순번 */
                    T1.RETRY_PROC_RSLT_CD,  /* 재시도처리결과코드 */
                    NVL(T1.ORI_IF_MSG_ID,T1.IF_MSG_ID)   ORI_IF_MSG_ID,       /* 원IF메시지ID */
                    NVL(T1.ORI_IF_MSG_SEQ,T1.IF_MSG_SEQ)  ORI_IF_MSG_SEQ,       /* 원IF메시지순번 */
                    LTRIM(T2.PRD_ID, '0') PRD_ID,
                    T2.PRD_NM,
                    CASE WHEN T2.SALS_CHRPSN_ID IS NOT NULL OR T6.OPRTR_NM IS NOT NULL
                             THEN T2.SALS_CHRPSN_ID || ' | ' || T6.OPRTR_NM END     SALS_CHR_CD_NM,     /* 영업담당자 */
                    T2.SALS_CHRPSN_ID,      /* 영업담당자ID */
                    CASE WHEN T2.SVC_CHRPSN_ID IS NOT NULL OR T5.OPRTR_NM IS NOT NULL
                             THEN T2.SVC_CHRPSN_ID || ' | ' || T5.OPRTR_NM END      SVC_CHRPSN_ID_NM,   /* 서비스담당자 */
                    T2.SVC_CHRPSN_ID,       /* 서비스담당자ID MD담당자인가 확인필요 */
                    CASE WHEN T2.OPR_CHRPSN_ID IS NOT NULL OR T8.OPRTR_NM IS NOT NULL
                             THEN T2.OPR_CHRPSN_ID || ' | ' || T8.OPRTR_NM END      OPR_CHRPSN_ID_NM,   /* 운영담당자 */
                    T2.OPR_CHRPSN_ID,       /* 운영담당자ID */
                    CASE WHEN T2.PURG_CHRPSN_ID IS NOT NULL OR T7.OPRTR_NM IS NOT NULL
                             THEN T2.PURG_CHRPSN_ID || ' | ' || T7.OPRTR_NM END     PURG_CHRPSN_ID_NM,  /* 구매담당자 */
                    T2.PURG_CHRPSN_ID,       /* 구매담당자ID */
                    CASE WHEN T2.MD_OPRTR_ID IS NOT NULL OR T9.OPRTR_NM IS NOT NULL
                             THEN T2.MD_OPRTR_ID || ' | ' || T9.OPRTR_NM END     MD_CHRPSN_ID_NM,  /* MD담당자 */
                    T2.MD_OPRTR_ID  MD_CHRPSN_ID,       /* MD담당자ID */
                    T21.COM_DTL_CD_NM   MRO_CRT_YN,
                    NVL(T1.IF_RSLT_FLD_1, '')   VOC_NO,
                    T1.IF_RSLT_FLD_3        SND_USR_ID,
                    T0.TNO,
                    T0.AMOUNT
            FROM    BASE_T2     T0
                    JOIN
                    TB_OD_ODR_TRANS_MST  T1
                    ON  T1.ROWID = T0.RID
                    JOIN
                    BASE_T T2
                    ON  T2.CO_CD = T1.CO_CD
                    AND T2.BZPLC_ID = T1.BZPLC_ID
                    AND T2.ODR_NO = T1.ODR_NO
                    AND T2.ODR_ITM_NO = CASE WHEN T1.ODR_ITM_NO IS NULL THEN T2.ODR_ITM_NO ELSE T1.ODR_ITM_NO END
                    LEFT JOIN
                    TB_CO_COM_CD_DTL    T20
                    ON  T20.LANG_CD = #{LANG_CD}
                    AND T20.COM_CLSF_CD = 'IF_PROC_RSLT_CD'
                    AND T20.COM_DTL_CD = T1.IF_PROC_RSLT_CD
                    LEFT JOIN
                    TB_CO_COM_CD_DTL    T21
                    ON  T21.LANG_CD = #{LANG_CD}
                    AND T21.COM_CLSF_CD = 'MRO_CRT_YN'
                    AND T21.COM_DTL_CD = T2.MRO_CRT_YN
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T5
                    ON  T5.CO_CD   = T2.CO_CD
                    AND T5.OPRTR_ID = T2.SVC_CHRPSN_ID
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T6
                    ON  T6.CO_CD   = T2.CO_CD
                    AND T6.OPRTR_ID = T2.SALS_CHRPSN_ID
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T7
                    ON  T7.CO_CD   = T2.CO_CD
                    AND T7.OPRTR_ID = T2.PURG_CHRPSN_ID
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T8
                    ON  T8.CO_CD   = T2.CO_CD
                    AND T8.OPRTR_ID = T2.OPR_CHRPSN_ID
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T9
                    ON  T9.CO_CD   = T2.CO_CD
                    AND T9.OPRTR_ID = T2.MD_OPRTR_ID
            WHERE   1 = 1
            UNION ALL
            SELECT  /*+ INDEX(C TB_AD_CRD_STL_APPR_LOG_IX03) PUSH_PRED(C) */
                    A.CO_CD                                                                 /* 회사코드 */
                    ,A.BZPLC_ID                                                             /* 사업장ID */
                    ,A.ODR_NO                                                               /* 주문번호 */
                    ,A.ODR_ITM_NO                                                           /* 주문항목번호 */
                    ,A.ODR_NO||'-'||TO_CHAR(A.ODR_ITM_NO)       AS JNT_ODR_ITM_NO           /* 주문항번 */
                    ,'FI00300_01'                               AS IF_PI_ID                 /* 선수금카드취소 카드사 전송 */
                    ,'SSP'                                      AS IF_SYSTEM_ID             /* SSP */
                    ,B.COM_DTL_CD_NM                            AS IF_PI_NM
                    ,NVL2(C.TNO,C.CRD_APPR_REQ_SPR_CD||'-'||TO_CHAR(C.LOG_SEQ)||'-'||C.TNO,'_')
                                                                AS IF_MSG_ID                /*NHN KCP 거래 고유번호*/
                    ,CASE WHEN C.RES_CD = '0000' THEN 'S' ELSE 'E' END
                                                                AS IF_PROC_RSLT_CD          /* IF처리결과코드, S=성공, E = 오류 */
                    ,D.COM_DTL_CD_NM                            AS IF_PROC_RSLT_CD_NM       /* IF처리결과코드명 S=성공, E = 오류 */
                    ,CASE WHEN C.RES_CD IS NULL THEN '[----] 미전송' ELSE '['||C.RES_CD||'] '||C.RES_MSG END
                                                                AS IF_PI_MSG                /* IFPI메시지 */
                    ,C.REG_DTM                                                              /* 등록일시 */
                    ,TO_DATE(C.CANC_TIME DEFAULT NULL ON CONVERSION ERROR , 'YYYYMMDDHH24MISS')
                                                                AS IF_PROC_RSLT_DTM         /* IF처리결과일시 */
                    ,1                                          AS IF_MSG_SEQ               /* IF메시지순번 */
                    ,NULL                                       AS RETRY_PROC_RSLT_CD       /* 재시도처리결과코드 */
                    ,C.CRD_APPR_REQ_SPR_CD||'-'||TO_CHAR(C.LOG_SEQ)||'-'||C.TNO
                                                                AS ORI_IF_MSG_ID            /* 원IF메시지ID */
                    ,1                                          AS ORI_IF_MSG_SEQ           /* 원IF메시지순번 */
                    ,LTRIM(A.PRD_ID, '0')                       AS PRD_ID
                    ,E.PRD_NM
                    ,CASE
                        WHEN A.SALS_CHRPSN_ID IS NOT NULL OR T6.OPRTR_NM IS NOT NULL THEN A.SALS_CHRPSN_ID || ' | ' || T6.OPRTR_NM
                    END                                         AS SALS_CHR_CD_NM           /* 영업담당자 */
                    ,A.SALS_CHRPSN_ID                                                       /* 영업담당자ID */
                    ,CASE
                        WHEN A.SVC_CHRPSN_ID IS NOT NULL OR T5.OPRTR_NM IS NOT NULL THEN A.SVC_CHRPSN_ID || ' | ' || T5.OPRTR_NM
                    END                                         AS SVC_CHRPSN_ID_NM         /* 서비스담당자 */
                    ,A.SVC_CHRPSN_ID                                                        /* 서비스담당자ID MD담당자인가 확인필요 */
                    ,CASE
                        WHEN A.OPR_CHRPSN_ID IS NOT NULL OR T8.OPRTR_NM IS NOT NULL THEN A.OPR_CHRPSN_ID || ' | ' || T8.OPRTR_NM
                    END                                         AS OPR_CHRPSN_ID_NM         /* 운영담당자 */
                    ,A.OPR_CHRPSN_ID                                                       /* 운영담당자ID */
                    ,CASE
                        WHEN A.PURG_CHRPSN_ID IS NOT NULL OR T7.OPRTR_NM IS NOT NULL THEN A.PURG_CHRPSN_ID || ' | ' || T7.OPRTR_NM
                    END                                         AS PURG_CHRPSN_ID_NM        /* 구매담당자 */
                    ,A.PURG_CHRPSN_ID                                                      /* 구매담당자ID */
                    ,CASE
                        WHEN A.MD_OPRTR_ID IS NOT NULL OR T9.OPRTR_NM IS NOT NULL THEN A.MD_OPRTR_ID || ' | ' || T9.OPRTR_NM
                    END                                         AS MD_CHRPSN_ID_NM          /* MD담당자 */
                    ,A.MD_OPRTR_ID                              AS MD_CHRPSN_ID             /* MD담당자ID */
                    ,F.COM_DTL_CD_NM                            AS MRO_CRT_YN
                    ,''                                         AS VOC_NO
                    ,''                                         AS SND_USR_ID
                    ,C.TNO
                    ,TO_NUMBER(C.AMOUNT)  AMOUNT
            FROM    BASE_T2 A
                    LEFT JOIN
                    TB_CO_COM_CD_DTL B
                        ON (B.LANG_CD = #{LANG_CD}
                        AND B.COM_CLSF_CD = 'PI_SPR_CD'
                        AND B.COM_DTL_CD = 'FI00300_01')
                    OUTER APPLY
                    (
                        SELECT  C.LOG_SEQ
                                , C.CRD_APPR_REQ_SPR_CD
                                , C.CRD_APMT_SPR_CD
                                , C.CRD_STL_SPR_CD
                                , C.CO_CD
                                , C.BZPLC_ID
                                , C.ODR_NO
                                , C.ODR_ITM_NO
                                , C.TAXINV_UNQ_NO
                                , C.CRD_CNC_TGT_ODR_SEQ
                                , C.LOG_CTS
                                , C.LOG_DISCD_YN
                                , C.REGPSN_ID
                                , C.REG_DTM
                                , Json_Value(C.LOG_CTS,'$.tno')                                             AS TNO                      /*NHN KCP 거래 고유번호*/
                                , Json_Value(C.LOG_CTS,'$.resCd')                                           AS RES_CD                   /*결과 코드*/
                                , Json_Value(C.LOG_CTS,'$.resMsg')                                          AS RES_MSG                  /*결과 메시지*/
                                , Json_Value(C.LOG_CTS,'$.cancTime')                                        AS CANC_TIME                /*취소 시간*/
                                , Json_Value(C.LOG_CTS,'$.cardModMny')                                          As AMOUNT                   /*결제 금액*/
                        FROM    (
                                    SELECT
                                            C.LOG_SEQ
                                            , C.CRD_APPR_REQ_SPR_CD
                                            , C.CRD_APMT_SPR_CD
                                            , C.CRD_STL_SPR_CD
                                            , C.CO_CD
                                            , C.BZPLC_ID
                                            , C.ODR_NO
                                            , C.ODR_ITM_NO
                                            , C.TAXINV_UNQ_NO
                                            , C.CRD_CNC_TGT_ODR_SEQ
                                            , C.LOG_CTS
                                            , C.LOG_DISCD_YN
                                            , ROW_NUMBER() OVER ( ORDER BY C.LOG_SEQ DESC )                 AS RN
                                            , C.REGPSN_ID
                                            , C.REG_DTM
                                    FROM    TB_AD_CRD_STL_APPR_LOG C
                                    WHERE   C.CRD_CNC_TGT_ODR_SEQ = A.CRD_CNC_TGT_ODR_SEQ
                                    AND     C.CRD_APPR_REQ_SPR_CD = '5'                                 /*승인취소*/
                                    AND     NVL(C.LOG_DISCD_YN,'N') != 'Y'
                                ) C
                        WHERE   C.RN = 1
                    ) C
                    LEFT JOIN
                    TB_CO_COM_CD_DTL D
                        ON (D.LANG_CD = #{LANG_CD}
                        AND D.COM_CLSF_CD = 'IF_PROC_RSLT_CD'
                        AND D.COM_DTL_CD = CASE WHEN C.RES_CD = '0000' THEN 'S' ELSE 'E' END)
                    LEFT JOIN
                    TB_PR_PRD_INFO E
                        ON (E.CO_CD = A.CO_CD
                        AND E.PRD_ID = A.PRD_ID)
                    LEFT JOIN
                    TB_CO_COM_CD_DTL F
                        ON (F.LANG_CD = #{LANG_CD}
                        AND F.COM_CLSF_CD = 'MRO_CRT_YN'
                        AND F.COM_DTL_CD = E.MRO_CRT_YN)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T5
                        ON (T5.CO_CD   = A.CO_CD
                        AND T5.OPRTR_ID = A.SVC_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T6
                        ON (T6.CO_CD   = A.CO_CD
                        AND T6.OPRTR_ID = A.SALS_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T7
                        ON (T7.CO_CD   = A.CO_CD
                        AND T7.OPRTR_ID = A.PURG_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T8
                        ON (T8.CO_CD   = A.CO_CD
                        AND T8.OPRTR_ID = A.OPR_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T9
                        ON (T9.CO_CD   = A.CO_CD
                        AND T9.OPRTR_ID = A.MD_OPRTR_ID)
            WHERE   1=1
            AND     A.CRD_CNC_TGT_ODR_SEQ IS NOT NULL
            <if test="IF_PI_ID != null and !IF_PI_ID.equals('')">
            AND     'FI00300_01' = #{IF_PI_ID}
            </if>
            UNION ALL
            SELECT
                    A.CO_CD                                                                 /* 회사코드 */
                    ,A.BZPLC_ID                                                             /* 사업장ID */
                    ,A.ODR_NO                                                               /* 주문번호 */
                    ,A.ODR_ITM_NO                                                           /* 주문항목번호 */
                    ,A.ODR_NO||'-'||TO_CHAR(A.ODR_ITM_NO)       AS JNT_ODR_ITM_NO           /* 주문항번 */
                    ,'FI00300_02'                               AS IF_PI_ID                 /* 선수금카드취소 카드사 전송 */
                    ,'SSP'                                      AS IF_SYSTEM_ID             /* SSP */
                    ,B.COM_DTL_CD_NM                            AS IF_PI_NM
                    ,Nvl(C3.IF_MSG_ID,'_')                      AS IF_MSG_ID                /*NHN KCP 거래 고유번호*/
                    ,CASE
                        WHEN    C2.IF_PROC_RSLT_CD IS NULL THEN 'E'
                        WHEN    C2.IF_PROC_RSLT_CD  = 'E' THEN 'E'
                        WHEN    C3.IF_PROC_RSLT_CD = 'S' THEN 'S'
                        ELSE 'E'
                    END                                         AS IF_PROC_RSLT_CD          /* IF처리결과코드, S=성공, E = 오류 */
                    ,D.COM_DTL_CD_NM                            AS IF_PROC_RSLT_CD_NM       /* IF처리결과코드명 S=성공, E = 오류 */
                    ,CASE
                        WHEN    C2.IF_PROC_RSLT_CD IS NULL THEN '미전송'
                        WHEN    C2.IF_PROC_RSLT_CD  = 'E' THEN C2.IF_PI_MSG
                        WHEN    C3.IF_PROC_RSLT_CD = 'S' THEN C3.IF_PI_MSG
                        ELSE C3.IF_PI_MSG
                    END                                         AS IF_PI_MSG                /* IFPI메시지 */
                    ,C3.REG_DTM                                                             /* 등록일시 */
                    ,C3.IF_PROC_RSLT_DTM                        AS IF_PROC_RSLT_DTM         /* IF처리결과일시 */
                    ,C3.IF_MSG_SEQ                              AS IF_MSG_SEQ               /* IF메시지순번 */
                    ,C3.RETRY_PROC_RSLT_CD                      AS RETRY_PROC_RSLT_CD       /* 재시도처리결과코드 */
                    ,NVL(C3.ORI_IF_MSG_ID,C3.IF_MSG_ID)         AS ORI_IF_MSG_ID            /* 원IF메시지ID */
                    ,NVL(C3.ORI_IF_MSG_SEQ,C3.IF_MSG_SEQ)       AS ORI_IF_MSG_SEQ           /* 원IF메시지순번 */
                    ,LTRIM(A.PRD_ID, '0')                       AS PRD_ID
                    ,E.PRD_NM
                    ,CASE
                        WHEN A.SALS_CHRPSN_ID IS NOT NULL OR T6.OPRTR_NM IS NOT NULL THEN A.SALS_CHRPSN_ID || ' | ' || T6.OPRTR_NM
                    END                                         AS SALS_CHR_CD_NM           /* 영업담당자 */
                    ,A.SALS_CHRPSN_ID                                                       /* 영업담당자ID */
                    ,CASE
                        WHEN A.SVC_CHRPSN_ID IS NOT NULL OR T5.OPRTR_NM IS NOT NULL THEN A.SVC_CHRPSN_ID || ' | ' || T5.OPRTR_NM
                    END                                         AS SVC_CHRPSN_ID_NM         /* 서비스담당자 */
                    ,A.SVC_CHRPSN_ID                                                        /* 서비스담당자ID MD담당자인가 확인필요 */
                    ,CASE
                        WHEN A.OPR_CHRPSN_ID IS NOT NULL OR T8.OPRTR_NM IS NOT NULL THEN A.OPR_CHRPSN_ID || ' | ' || T8.OPRTR_NM
                    END                                         AS OPR_CHRPSN_ID_NM         /* 운영담당자 */
                    ,A.OPR_CHRPSN_ID                                                       /* 운영담당자ID */
                    ,CASE
                        WHEN A.PURG_CHRPSN_ID IS NOT NULL OR T7.OPRTR_NM IS NOT NULL THEN A.PURG_CHRPSN_ID || ' | ' || T7.OPRTR_NM
                    END                                         AS PURG_CHRPSN_ID_NM        /* 구매담당자 */
                    ,A.PURG_CHRPSN_ID                                                      /* 구매담당자ID */
                    ,CASE
                        WHEN A.MD_OPRTR_ID IS NOT NULL OR T9.OPRTR_NM IS NOT NULL THEN A.MD_OPRTR_ID || ' | ' || T9.OPRTR_NM
                    END                                         AS MD_CHRPSN_ID_NM          /* MD담당자 */
                    ,A.MD_OPRTR_ID                              AS MD_CHRPSN_ID             /* MD담당자ID */
                    ,F.COM_DTL_CD_NM                            AS MRO_CRT_YN
                    ,''                                         AS VOC_NO
                    ,C3.IF_RSLT_FLD_3                           AS SND_USR_ID
                    ,C.TNO
                    ,TO_NUMBER(C.AMOUNT)  AMOUNT
            FROM    BASE_T2 A
                    LEFT JOIN
                    TB_CO_COM_CD_DTL B
                        ON (B.LANG_CD = #{LANG_CD}
                        AND B.COM_CLSF_CD = 'PI_SPR_CD'
                        AND B.COM_DTL_CD = 'FI00300_02')
                    CROSS APPLY
                    (
                        SELECT  C.LOG_SEQ
                                , C.CRD_APPR_REQ_SPR_CD
                                , C.CRD_APMT_SPR_CD
                                , C.CRD_STL_SPR_CD
                                , C.CO_CD
                                , C.BZPLC_ID
                                , C.ODR_NO
                                , C.ODR_ITM_NO
                                , C.TAXINV_UNQ_NO
                                , C.CRD_CNC_TGT_ODR_SEQ
                                , C.LOG_CTS
                                , C.LOG_DISCD_YN
                                , C.REGPSN_ID
                                , C.REG_DTM
                                , Json_Value(C.LOG_CTS,'$.tno')                                             AS TNO                      /*NHN KCP 거래 고유번호*/
                                , Json_Value(C.LOG_CTS,'$.resCd')                                           AS RES_CD                   /*결과 코드*/
                                , Json_Value(C.LOG_CTS,'$.resMsg')                                          AS RES_MSG                  /*결과 메시지*/
                                , Json_Value(C.LOG_CTS,'$.cancTime')                                        AS CANC_TIME                /*취소 시간*/
                                , Json_Value(C.LOG_CTS,'$.cardModMny')                                          As AMOUNT                   /*결제 금액*/
                        FROM    (
                                    SELECT
                                            C.LOG_SEQ
                                            , C.CRD_APPR_REQ_SPR_CD
                                            , C.CRD_APMT_SPR_CD
                                            , C.CRD_STL_SPR_CD
                                            , C.CO_CD
                                            , C.BZPLC_ID
                                            , C.ODR_NO
                                            , C.ODR_ITM_NO
                                            , C.TAXINV_UNQ_NO
                                            , C.CRD_CNC_TGT_ODR_SEQ
                                            , C.LOG_CTS
                                            , C.LOG_DISCD_YN
                                            , ROW_NUMBER() OVER ( ORDER BY C.LOG_SEQ DESC )                 AS RN
                                            , C.REGPSN_ID
                                            , C.REG_DTM
                                    FROM    TB_AD_CRD_STL_APPR_LOG C
                                    WHERE   C.CRD_CNC_TGT_ODR_SEQ = A.CRD_CNC_TGT_ODR_SEQ
                                    AND     C.CRD_APPR_REQ_SPR_CD = '5'                                 /*승인취소*/
                                    AND     NVL(C.LOG_DISCD_YN,'N') != 'Y'
                                ) C
                        WHERE   C.RN = 1
                        AND     Json_Value(C.LOG_CTS,'$.resCd') = '0000'
                    ) C
                    LEFT JOIN
                    TB_OD_ODR_CRD_STL_DTLS C2
                        ON (C2.LOG_SEQ = C.LOG_SEQ
                        AND C2.CRD_APPR_REQ_SPR_CD = C.CRD_APPR_REQ_SPR_CD)
                    OUTER APPLY
                    (
                        SELECT
                                C3.IF_SYSTEM_ID
                                , C3.IF_PI_ID
                                , C3.IF_MSG_ID
                                , C3.IF_MSG_SEQ
                                , C3.IF_PROC_TP_CD
                                , C3.ODR_TRANS_DTL_NM
                                , C3.CO_CD
                                , C3.BZPLC_ID
                                , C3.ODR_NO
                                , C3.ODR_ITM_NO
                                , C3.IF_PROC_RSLT_CD
                                , C3.IF_PROC_RSLT_DTM
                                , C3.IF_PI_MSG
                                , C3.IF_RSLT_FLD_1
                                , C3.IF_RSLT_FLD_2
                                , C3.IF_RSLT_FLD_3
                                , C3.RETRY_PROC_RSLT_CD
                                , C3.ORI_IF_MSG_ID
                                , C3.ORI_IF_MSG_SEQ
                                , C3.REG_DTM
                        FROM
                                (
                                    SELECT
                                            C3.IF_SYSTEM_ID             /* IF시스템ID */
                                            , C3.IF_PI_ID               /* IFPIID */
                                            , C3.IF_MSG_ID              /* IF메시지ID */
                                            , C3.IF_MSG_SEQ             /* IF메시지순번 */
                                            , C3.IF_PROC_TP_CD          /* IF처리유형코드 */
                                            , C3.ODR_TRANS_DTL_NM       /* 주문전송상세명 */
                                            , C3.CO_CD                  /* 회사코드 */
                                            , C3.BZPLC_ID               /* 사업장ID */
                                            , C3.ODR_NO                 /* 주문번호 */
                                            , C3.ODR_ITM_NO             /* 주문항목번호 */
                                            , C3.IF_PROC_RSLT_CD        /* IF처리결과코드 */
                                            , C3.IF_PROC_RSLT_DTM       /* IF처리결과일시 */
                                            , C3.IF_PI_MSG              /* IFPI메시지 */
                                            , C3.IF_RSLT_FLD_1          /* IF결과필드1 */
                                            , C3.IF_RSLT_FLD_2          /* IF결과필드2 */
                                            , C3.IF_RSLT_FLD_3          /* IF결과필드3 */
                                            , C3.RETRY_PROC_RSLT_CD     /* 재시도처리결과코드 */
                                            , C3.ORI_IF_MSG_ID          /* 원IF메시지ID */
                                            , C3.ORI_IF_MSG_SEQ         /* 원IF메시지순번 */
                                            , C3.REG_DTM                /* 등록일시 */
                                            , ROW_NUMBER() OVER (ORDER BY C3.IF_MSG_ID DESC )               AS RN
                                    FROM    TB_OD_ODR_TRANS_MST C3
                                    WHERE   C3.CO_CD = A.CO_CD
                                    AND     C3.BZPLC_ID = A.BZPLC_ID
                                    AND     C3.ODR_NO = A.ODR_NO
                                    AND     C3.ODR_ITM_NO = A.ODR_ITM_NO
                                    AND     C3.IF_PI_ID = 'FI00300'
                                    AND     C3.ODR_TRANS_DTL_NM = 'CANCEL'
                                ) C3
                        WHERE   C3.RN = 1
                    ) C3
                    LEFT JOIN
                    TB_CO_COM_CD_DTL D
                        ON (D.LANG_CD = #{LANG_CD}
                        AND D.COM_CLSF_CD = 'IF_PROC_RSLT_CD'
                        AND D.COM_DTL_CD =
                                CASE
                                    WHEN    C2.IF_PROC_RSLT_CD IS NULL THEN 'E'
                                    WHEN    C2.IF_PROC_RSLT_CD  = 'E' THEN 'E'
                                    WHEN    C3.IF_PROC_RSLT_CD = 'S' THEN 'S'
                                    ELSE 'E'
                                END
                        )
                    LEFT JOIN
                    TB_PR_PRD_INFO E
                        ON (E.CO_CD = A.CO_CD
                        AND E.PRD_ID = A.PRD_ID)
                    LEFT JOIN
                    TB_CO_COM_CD_DTL F
                        ON (F.LANG_CD = #{LANG_CD}
                        AND F.COM_CLSF_CD = 'MRO_CRT_YN'
                        AND F.COM_DTL_CD = E.MRO_CRT_YN)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T5
                        ON (T5.CO_CD   = A.CO_CD
                        AND T5.OPRTR_ID = A.SVC_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T6
                        ON (T6.CO_CD   = A.CO_CD
                        AND T6.OPRTR_ID = A.SALS_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T7
                        ON (T7.CO_CD   = A.CO_CD
                        AND T7.OPRTR_ID = A.PURG_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T8
                        ON (T8.CO_CD   = A.CO_CD
                        AND T8.OPRTR_ID = A.OPR_CHRPSN_ID)
                    LEFT JOIN
                    TB_CO_MBR_OPRTR_INFO    T9
                        ON (T9.CO_CD   = A.CO_CD
                        AND T9.OPRTR_ID = A.MD_OPRTR_ID)
            WHERE   1 = 1
            AND     A.CRD_CNC_TGT_ODR_SEQ IS NOT NULL
            <if test="IF_PI_ID != null and !IF_PI_ID.equals('')">
            AND     'FI00300_02' = #{IF_PI_ID}
            </if>
            UNION ALL 
            
            SELECT  S1.CO_CD                                                                 /* 회사코드 */
	             ,  S1.BZPLC_ID                                                              /* 사업장ID */
	             ,  S1.ODR_NO                                                                /* 주문번호 */
	             ,  S1.ODR_ITM_NO                                                            /* 주문항목번호 */
	             ,  S1.JNT_ODR_ITM_NO           /* 주문항번 */
	             ,  S1.IF_PI_ID                 /* 선수금카드취소 카드사 전송 */
	             ,  S1.IF_SYSTEM_ID             /* SSP */
	             ,  S1.IF_PI_NM
	             ,  S1.IF_MSG_ID                /*NHN KCP 거래 고유번호*/
	             ,  S1.IF_PROC_RSLT_CD          /* IF처리결과코드, S=성공, E = 오류 */
	             ,  S1.IF_PROC_RSLT_CD_NM       /* IF처리결과코드명 S=성공, E = 오류 */
	             ,  S1.IF_PI_MSG                /* IFPI메시지 */
	             ,  S1.REG_DTM                  /* 등록일시 */
	             ,  S1.IF_PROC_RSLT_DTM         /* IF처리결과일시 */
	             ,  S1.IF_MSG_SEQ               /* IF메시지순번 */
	             ,  S1.RETRY_PROC_RSLT_CD       /* 재시도처리결과코드 */
	             ,  S1.ORI_IF_MSG_ID            /* 원IF메시지ID */
	             ,  S1.ORI_IF_MSG_SEQ           /* 원IF메시지순번 */
	             ,  S1.PRD_ID
	             ,  S1.PRD_NM
	             ,  S1.SALS_CHR_CD_NM           /* 영업담당자 */
	             ,  S1.SALS_CHRPSN_ID                                                       /* 영업담당자ID */
	             ,  S1.SVC_CHRPSN_ID_NM         /* 서비스담당자 */
	             ,  S1.SVC_CHRPSN_ID                                                        /* 서비스담당자ID MD담당자인가 확인필요 */
	             ,  S1.OPR_CHRPSN_ID_NM         /* 운영담당자 */
	             ,  S1.OPR_CHRPSN_ID                                                       /* 운영담당자ID */
	             ,  S1.PURG_CHRPSN_ID_NM        /* 구매담당자 */
	             ,  S1.PURG_CHRPSN_ID                                                      /* 구매담당자ID */
	             ,  S1.MD_CHRPSN_ID_NM          /* MD담당자 */
	             ,  S1.MD_CHRPSN_ID             /* MD담당자ID */
	             ,  S1.MRO_CRT_YN
	             ,  S1.VOC_NO
	             ,  S1.SND_USR_ID
	             ,  S1.TNO
	             ,  S1.AMOUNT
			  FROM (
					SELECT  A.CO_CD                                                                 /* 회사코드 */
			             ,  A.BZPLC_ID                                                              /* 사업장ID */
			             ,  A.ODR_NO                                                                /* 주문번호 */
			             ,  A.ODR_ITM_NO                                                            /* 주문항목번호 */
			             ,  A.ODR_NO||'-'||TO_CHAR(A.ODR_ITM_NO)        AS JNT_ODR_ITM_NO           /* 주문항번 */
			             ,  'SD01920'                                   AS IF_PI_ID                 /* 선수금카드취소 카드사 전송 */
			             ,  'SSP'                                       AS IF_SYSTEM_ID             /* SSP */
			             ,  C.COM_DTL_CD_NM                             AS IF_PI_NM
			             ,  NULL                                         AS IF_MSG_ID                /*NHN KCP 거래 고유번호*/
			             ,  NULL                                          AS IF_PROC_RSLT_CD          /* IF처리결과코드, S=성공, E = 오류 */
			             ,  NULL                                         AS IF_PROC_RSLT_CD_NM       /* IF처리결과코드명 S=성공, E = 오류 */
			             ,  NULL                                          AS IF_PI_MSG                /* IFPI메시지 */
			             ,  NULL                                        AS REG_DTM                  /* 등록일시 */
			             ,  NULL                                        AS IF_PROC_RSLT_DTM         /* IF처리결과일시 */
			             ,  1                                           AS IF_MSG_SEQ               /* IF메시지순번 */
			             ,  NULL                                        AS RETRY_PROC_RSLT_CD       /* 재시도처리결과코드 */
			             ,  NULL                                          AS ORI_IF_MSG_ID            /* 원IF메시지ID */
			             ,  1                                           AS ORI_IF_MSG_SEQ           /* 원IF메시지순번 */
			             ,  LTRIM(A.PRD_ID, '0')                        AS PRD_ID
			             ,  E.PRD_NM
			             ,  CASE WHEN A.SALS_CHRPSN_ID IS NOT NULL OR T6.OPRTR_NM IS NOT NULL THEN A.SALS_CHRPSN_ID || ' | ' || T6.OPRTR_NM
			                 END                                         AS SALS_CHR_CD_NM           /* 영업담당자 */
			             ,  A.SALS_CHRPSN_ID                                                       /* 영업담당자ID */
			             ,  CASE WHEN A.SVC_CHRPSN_ID IS NOT NULL OR T5.OPRTR_NM IS NOT NULL THEN A.SVC_CHRPSN_ID || ' | ' || T5.OPRTR_NM
			                 END                                         AS SVC_CHRPSN_ID_NM         /* 서비스담당자 */
			             ,  A.SVC_CHRPSN_ID                                                        /* 서비스담당자ID MD담당자인가 확인필요 */
			             ,  CASE WHEN A.OPR_CHRPSN_ID IS NOT NULL OR T8.OPRTR_NM IS NOT NULL THEN A.OPR_CHRPSN_ID || ' | ' || T8.OPRTR_NM
			                 END                                         AS OPR_CHRPSN_ID_NM         /* 운영담당자 */
			             ,  A.OPR_CHRPSN_ID                                                       /* 운영담당자ID */
			             ,  CASE WHEN A.PURG_CHRPSN_ID IS NOT NULL OR T7.OPRTR_NM IS NOT NULL THEN A.PURG_CHRPSN_ID || ' | ' || T7.OPRTR_NM
			                 END                                         AS PURG_CHRPSN_ID_NM        /* 구매담당자 */
			             ,  A.PURG_CHRPSN_ID                                                      /* 구매담당자ID */
			             ,  CASE WHEN A.MD_OPRTR_ID IS NOT NULL OR T9.OPRTR_NM IS NOT NULL THEN A.MD_OPRTR_ID || ' | ' || T9.OPRTR_NM
			                 END                                         AS MD_CHRPSN_ID_NM          /* MD담당자 */
			             ,  A.MD_OPRTR_ID                              AS MD_CHRPSN_ID             /* MD담당자ID */
			             ,  F.COM_DTL_CD_NM                            AS MRO_CRT_YN
			             ,  NULL                                         AS VOC_NO
			             ,  NULL                                         AS SND_USR_ID
			             ,  NULL                                         AS TNO
			             ,  NULL                                       AS  AMOUNT
			             ,  NULL                                         AS ODRPSN_ID
					  FROM  BASE_T A
					        JOIN
					        TB_AD_SSP_ADJ_HST B
					        ON (A.CO_CD = B.CO_CD 
					        AND A.BZPLC_ID = B.BZPLC_ID
					        AND A.ODR_NO = B.ODR_NO 
					        AND A.ODR_ITM_NO = B.ODR_ITM_NO
					        )
					        JOIN
					        TB_AD_SSP_ADJ_DTLS B1
					        ON (A.CO_CD = B1.CO_CD 
					        AND A.BZPLC_ID = B1.BZPLC_ID
					        AND A.ODR_NO = B1.ODR_NO 
					        AND A.ODR_ITM_NO = B1.ODR_ITM_NO
					        )
					        LEFT JOIN 
					        TB_CO_COM_CD_DTL C
				            ON (C.LANG_CD = #{LANG_CD}
				            AND C.COM_CLSF_CD = 'PI_SPR_CD'
				            AND C.COM_DTL_CD = 'SD01920')
				            LEFT JOIN
			                TB_PR_PRD_INFO E
			                ON (E.CO_CD = A.CO_CD
			                AND E.PRD_ID = A.PRD_ID)
			                LEFT JOIN
			                TB_CO_COM_CD_DTL F
			                ON (F.LANG_CD = 'KO'
			                AND F.COM_CLSF_CD = 'MRO_CRT_YN'
			                AND F.COM_DTL_CD = E.MRO_CRT_YN)
			                LEFT JOIN
			                TB_CO_MBR_OPRTR_INFO    T5
			                ON (T5.CO_CD   = A.CO_CD
			                AND T5.OPRTR_ID = A.SVC_CHRPSN_ID)
			                LEFT JOIN
			                TB_CO_MBR_OPRTR_INFO    T6
			                ON (T6.CO_CD   = A.CO_CD
			                AND T6.OPRTR_ID = A.SALS_CHRPSN_ID)
			                LEFT JOIN
			                TB_CO_MBR_OPRTR_INFO    T7
			                ON (T7.CO_CD   = A.CO_CD
			                AND T7.OPRTR_ID = A.PURG_CHRPSN_ID)
			                LEFT JOIN
			                TB_CO_MBR_OPRTR_INFO    T8
			                ON (T8.CO_CD   = A.CO_CD
			                AND T8.OPRTR_ID = A.OPR_CHRPSN_ID)
			                LEFT JOIN
			                TB_CO_MBR_OPRTR_INFO    T9
			                ON (T9.CO_CD   = A.CO_CD
			                AND T9.OPRTR_ID = A.MD_OPRTR_ID)
					 WHERE  1 = 1   
					   AND  NVL(B.ADJ_DCN_YN, 'N') = 'Y'  
					   <if test='IF_PROC_RSLT_CD != null and !IF_PROC_RSLT_CD.equals("") and !IF_PROC_RSLT_CD.equals("P") '>
    						AND  NVL(B1.IF_PROC_RSLT_CD, 'P') = #{IF_PROC_RSLT_CD}
    					</if>
					) S1
					LEFT JOIN 
					TB_OD_ODR_TRANS_MST D
			        ON (S1.CO_CD = D.CO_CD(+) 
			        AND S1.BZPLC_ID = D.BZPLC_ID(+)
			        AND S1.ODR_NO = D.ODR_NO(+) 
			        AND S1.ODR_ITM_NO = D.ODR_ITM_NO(+)
			        AND D.IF_PI_ID = 'SD01920'
			        )
			WHERE  1 = 1
			  AND  D.IF_PI_ID IS NULL
			  <if test="IF_PI_ID != null and !IF_PI_ID.equals('')">
				AND     'SD01920' = #{IF_PI_ID}
              </if>	
            ORDER BY ODR_NO, ODR_ITM_NO, IF_PI_ID DESC
            ) T1
    </select>

    <!-- ******************************************************************************
        * SELECT : 연계정보 이력조회 * 작성자 : neonlee * 작성 일자 : 2022-06-28
        ****************************************************************************** -->
    <select id="selectSndRcvInfoList2" parameterType="HashMap" resultType="HashMap">
        /* com.ssp.bo.od.orderList.selectSndRcvInfoList2 */
        SELECT
                T1.*
                , T2.COM_DTL_CD_NM  MRO_CRT_YN_NM
                , CASE WHEN T1.SND_USR_ID IS NOT NULL OR T3.OPRTR_NM IS NOT NULL
                  THEN T1.SND_USR_ID || ' | ' || T3.OPRTR_NM END     SND_USR_NM
        FROM    (
                SELECT
                        T1.CO_CD,               /* 회사코드 */
                        T1.BZPLC_ID,            /* 사업장ID */
                        T2.ODR_NO,              /* 주문번호 */
                        T2.ODR_ITM_NO,          /* 주문항목번호 */
                        T2.ODR_NO||'-'||T2.ODR_ITM_NO       JNT_ODR_ITM_NO,
                        T1.IF_PI_ID,            /* IFPIID */
                        T1.IF_SYSTEM_ID,
                        T1.IF_MSG_ID,           /* IF메시지ID */
                        T1.IF_PROC_RSLT_CD,     /* IF처리결과코드, S:성공, E : 오류 */
                        T10.COM_DTL_CD_NM   IF_PROC_RSLT_CD_NM,
                        T1.IF_PI_MSG,           /* IFPI메시지 */
                        T1.REG_DTM,             /* 등록일시 */
                        T1.IF_PROC_RSLT_DTM,    /* IF처리결과일시 */
                        T1.IF_MSG_SEQ,          /* IF메시지순번 */
                        T1.RETRY_PROC_RSLT_CD,  /* 재시도처리결과코드 */
                        T1.ORI_IF_MSG_ID,       /* 원IF메시지ID */
                        T1.ORI_IF_MSG_SEQ,       /* 원IF메시지순번 */
                        LTRIM(T2.PRD_ID, '0') PRD_ID,
                        T3.PRD_NM,
                        T11.COM_DTL_CD_NM      IF_PI_NM,
                        T12.MRO_CRT_YN,
                        NVL(T1.IF_RSLT_FLD_1, '')   VOC_NO,
                        T1.IF_RSLT_FLD_3        SND_USR_ID
                FROM    TB_OD_ODR_TRANS_MST  T1
                        LEFT JOIN
                        TB_OD_ODR_DTL T2
                        ON  T2.CO_CD = T1.CO_CD
                        AND T2.BZPLC_ID = T1.BZPLC_ID
                        AND T2.ODR_NO = T1.ODR_NO
                        AND T2.ODR_ITM_NO = CASE WHEN T1.ODR_ITM_NO IS NULL THEN T2.ODR_ITM_NO ELSE T1.ODR_ITM_NO END
                        LEFT JOIN
                        TB_PR_MRO_PRD_INFO T3
                        ON  T3.CO_CD = T2.CO_CD
                        AND T3.PRD_ID = T2.PRD_ID
                        LEFT JOIN
                        TB_CO_COM_CD_DTL    T10
                        ON  T10.LANG_CD = #{LANG_CD}
                        AND T10.COM_CLSF_CD = 'IF_PROC_RSLT_CD'
                        AND T10.COM_DTL_CD = T1.IF_PROC_RSLT_CD
                        LEFT JOIN
                        TB_CO_COM_CD_DTL    T11
                        ON  T11.LANG_CD = #{LANG_CD}
                        AND T11.COM_CLSF_CD = 'PI_SPR_CD'
                        AND T11.COM_DTL_CD = T1.IF_PI_ID
                        AND T11.COM_USR_DEFN_NM_1 = 'Y'
                        LEFT JOIN
                        TB_PR_PRD_INFO     T12
                        ON  T12.CO_CD = T2.CO_CD
                        AND T12.PRD_ID = T2.PRD_ID
                WHERE   T2.CO_CD = #{CO_CD}
                  AND   T2.BZPLC_ID = #{BZPLC_ID}
                  AND   T2.ODR_NO = #{ODR_NO}
                  <if test='ODR_ITM_NO != null '>
                  AND T2.ODR_ITM_NO = #{ODR_ITM_NO}
                  </if>
                  <if test="VOC_NO != null and !VOC_NO.equals('')">
                  AND T1.IF_RSLT_FLD_1 = #{VOC_NO}
                  </if>
                  AND   T1.IF_PI_ID LIKE #{IF_PI_ID} ||'%'
                  AND   CASE WHEN T1.IF_PI_ID = 'SD01730' THEN 'TB_OD_ODR_DTL'
                             WHEN T1.IF_PI_ID = 'FI00300' THEN 'MAIN'
                             ELSE T1.ODR_TRANS_DTL_NM
                        END = T1.ODR_TRANS_DTL_NM
                  <!-- SSP-1010                         
                  AND   #{ORI_IF_MSG_ID}  IN (T1.IF_MSG_ID,T1.ORI_IF_MSG_ID)
                  AND   #{ORI_IF_MSG_SEQ} IN (T1.IF_MSG_SEQ,T1.ORI_IF_MSG_SEQ)
                  -->
                ORDER BY T2.ODR_NO,T2.ODR_ITM_NO,T1.IF_MSG_ID DESC
                )   T1
                LEFT JOIN
                TB_CO_COM_CD_DTL    T2
                ON  T2.LANG_CD = #{LANG_CD}
                AND T2.COM_CLSF_CD = 'MRO_CRT_YN'
                AND T2.COM_DTL_CD = T1.MRO_CRT_YN
                LEFT JOIN
                TB_CO_MBR_OPRTR_INFO    T3
                ON   T3.CO_CD   = T1.CO_CD
                AND  T3.OPRTR_ID = T1.SND_USR_ID
     </select>

</mapper>