<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="OnlyPrdPrcMng">

    <select id="selectOnlyPrdPrcMng" parameterType="HashMap" resultType="HashMap">
        /* OnlyPrdPrcMngDao.selectOnlyPrdPrcMng 전용상품가격관리 조회 */
        <![CDATA[
        SELECT A.CHK                                                     /*CHK*/
			       ,A.CO_CD                                                  /*회사코드*/
			       ,A.PRD_ID_VIEW                                            /*상품ID_VIEW*/
			       ,A.PRD_ID                                                 /*상품ID*/
			       ,A.PURG_SPL_YN                                            /*구매공급여부*/
			       ,A.BZPLC_ID
                   ,A.BZPLC_NM
                   ,A.OPR_UNIT_ID
                   ,A.OPR_UNIT_NM
				   ,A.PRD_CLCD                                               /*카테고리*/
	               ,A.PRD_CLCD_NM                                            /*카테고리명*/
	               ,A.PUB_ONLY_SPR_NM                                        /*공용전용구분*/
	               ,A.PRC_APLY_SPR_NM                                        /*예외관리상품*/
                   ,A.MRO_PRD_STATS_CD                                       /*상품상태코드*/
	               ,A.MRO_PRD_STATS_NM                                       /*상품상태*/
	               ,A.PRD_STATS_CD                                           /*SSP상품상태*/
	               ,A.DISP_STATS_NM                                          /*진열상태*/
	               ,A.DISP_STATS_CD                                          /*진열상태코드*/
	               ,A.PRD_NM                                                 /*상품명*/
	               ,A.ATTR_VAL                                               /*대표규격*/
	               ,A.MNFR_NO                                                /*제조원NO*/
	               ,A.MNFR_NM                                                /*제조원명*/
	               ,A.SELL_UNIT_CD                                           /*주문단위*/
	               ,A.ORGPLC_CTRY_CD                                         /*원산지코드*/
	               ,A.ORGPLC_CTRY_NM                                         /*원산지*/
	               ,A.STPRC                                                  /*기준가*/
                   ,A.LIST_PRICE                                             /*LIST PRICE*/
	               ,A.SSP_BSS_SALSPRC                                        /*기준판매가*/
	               ,A.BSS_SALSPRC_STR_DTM                                    /*기준판매가 시작일시*/
	               ,A.BSS_SALSPRC_END_DTM                                    /*기준판매가 마감일시*/
	               ,A.PURG_CHRPSN_ID                                         /*구매담당자 사번*/
	               ,A.PURG_CHRPSN_NM                                         /*구매담당자명*/
                   ,A.LWST_BUY_PRC                                           /*최저매입가*/
                   ,A.CPRTCP_ID                                              /*최저매입협력사*/
                   ,A.CPRTCP_NM                                              /*최저매입협력사명*/
                   ,A.MIN_ODR_QTY                                            /*최소주문수량*/
                   ,A.SPL_PSB_YN                                             /*공급가능여부*/
                   ,A.DLV_LT                                                 /*평균배송일*/
                   ,A.REG_DTM                                                /*등록일자*/
                   ,A.UPD_DTM                                                /*수정일자*/
                   ,A.PURG_VLD_PERD_YN                                       /*구매유효기간여부*/
                   ,A.PUB_ONLY_SPR_CD                                        /*공용전용구분코드*/
                   ,A.MALL_SPR_CD                                            /*몰구분코드*/
                   ,A.SPL_PSB_YN2                                            /*공급가능상태*/
                   ,A.VLD_STR_DT                                             /*가격유효기간*/
                   ,A.VLD_END_DT                                             /*가격유효기간*/
                   ,A.BSS_SALSPRC_USEYN                                      /*기준매입가적용여부*/
                   ,A.SALS_DSGN_SALSPRC                                      /*영업지정판매가*/
                   ,A.EXPS_SALSPRC                                           /*일반고객할인율*/
                   ,A.EXPS_SALSPRC2                                          /*계약고객할인율*/
                   ,A.EXPS_SALSPRC3                                          /*고객노출가*/
                   ,A.INVN_STATS_CD                                          /*재고여부코드*/
                   ,A.INVN_STATS_NM                                          /*재고여부*/
                   ,A.ORG_CD                                                 /*영업팀*/
                   ,A.ORG_NM                                                 /*영업팀명*/
                   ,DECODE(A.EXPS_SALSPRC3, 0, NULL,
		           			CASE WHEN A.BSS_SALSPRC_USEYN = 'N' THEN '영업지정'
		                             WHEN A.EXPS_SALSPRC3 = A.SSP_BSS_SALSPRC AND ( A.EXPS_SALSPRC3 < A.CUST_PRICE OR A.CUST_PRICE IS NULL ) THEN '기준판매가'
		                    	     WHEN A.EXPS_SALSPRC3 <> A.SSP_BSS_SALSPRC AND ( A.EXPS_SALSPRC3 < A.CUST_PRICE OR A.CUST_PRICE IS NULL ) THEN '할인율'
		               	      		 WHEN A.EXPS_SALSPRC3 >= NVL(A.CUST_PRICE,0) THEN '기간할인'
		             		  END
             		) AS CAL_BASIS                                          /*산출근거*/
             	   ,SSP_APP.FN_PR_GET_SSP_PRD_NM(A.CO_CD, A.PRD_ID) SSP_PRD_NM    /*SSP상품명*/
          FROM (
	            SELECT A.CHK                                                     /*CHK*/
				       ,A.CO_CD                                                  /*회사코드*/
				       ,A.PRD_ID_VIEW                                            /*상품ID_VIEW*/
				       ,A.PRD_ID                                                 /*상품ID*/
				       ,A.PURG_SPL_YN                                            /*구매공급여부*/
				       ,A.BZPLC_ID
	                   ,A.BZPLC_NM
	                   ,A.OPR_UNIT_ID
	                   ,A.OPR_UNIT_NM
					   ,A.PRD_CLCD                                               /*카테고리*/
		               ,A.PRD_CLCD_NM                                            /*카테고리명*/
		               ,A.PUB_ONLY_SPR_NM                                        /*공용전용구분*/
		               ,A.PRC_APLY_SPR_NM                                        /*예외관리상품*/
	                   ,A.MRO_PRD_STATS_CD                                       /*상품상태코드*/
		               ,A.MRO_PRD_STATS_NM                                       /*상품상태*/
		               ,A.PRD_STATS_CD                                           /*SSP상품상태*/
		               ,A.DISP_STATS_NM                                          /*진열상태*/
		               ,A.DISP_STATS_CD                                          /*진열상태코드*/
		               ,A.PRD_NM                                                 /*상품명*/
		               ,A.ATTR_VAL                                               /*대표규격*/
		               ,A.MNFR_NO                                                /*제조원NO*/
		               ,A.MNFR_NM                                                /*제조원명*/
		               ,A.SELL_UNIT_CD                                           /*주문단위*/
		               ,A.ORGPLC_CTRY_CD                                         /*원산지코드*/
		               ,A.ORGPLC_CTRY_NM                                         /*원산지*/
		               ,A.STPRC                                                  /*기준가*/
	                   ,A.LIST_PRICE                                             /*LIST PRICE*/
		               ,A.SSP_BSS_SALSPRC                                        /*기준판매가*/
		               ,A.BSS_SALSPRC_STR_DTM                                    /*기준판매가 시작일시*/
		               ,A.BSS_SALSPRC_END_DTM                                    /*기준판매가 마감일시*/
		               ,A.PURG_CHRPSN_ID                                         /*구매담당자 사번*/
		               ,A.PURG_CHRPSN_NM                                         /*구매담당자명*/
	                   ,A.LWST_BUY_PRC                                           /*최저매입가*/
	                   ,A.CPRTCP_ID                                              /*최저매입협력사*/
	                   ,A.CPRTCP_NM                                              /*최저매입협력사명*/
	                   ,A.MIN_ODR_QTY                                            /*최소주문수량*/
	                   ,A.SPL_PSB_YN                                             /*공급가능여부*/
	                   ,A.DLV_LT                                                 /*평균배송일*/
	                   ,A.REG_DTM                                                /*등록일자*/
	                   ,A.UPD_DTM                                                /*수정일자*/
	                   ,A.PURG_VLD_PERD_YN                                       /*구매유효기간여부*/
	                   ,A.PUB_ONLY_SPR_CD                                        /*공용전용구분코드*/
	                   ,A.MALL_SPR_CD                                            /*몰구분코드*/
	                   ,A.SPL_PSB_YN2
	                   ,A.VLD_STR_DT
	                   ,A.VLD_END_DT
	                   ,A.BSS_SALSPRC_USEYN
	                   ,A.SALS_DSGN_SALSPRC
	                   ,A.EXPS_SALSPRC
	                   ,A.EXPS_SALSPRC2
	                   ,CASE WHEN A.EXPS_SALSPRC2 <> A.SSP_BSS_SALSPRC THEN A.EXPS_SALSPRC2
                             ELSE A.EXPS_SALSPRC
                        END EXPS_SALSPRC3
	                   ,A.INVN_STATS_CD
	                   ,A.INVN_STATS_NM
	                   ,A.ORG_CD
	                   ,A.ORG_NM
	                   ,A.CUST_PRICE
				 FROM (
						SELECT 0 AS CHK
						       ,A.CO_CD 
				               ,TO_NUMBER(A.PRD_ID) AS PRD_ID_VIEW
				               ,A.PRD_ID --상품ID
	                           ,C.PURG_SPL_YN -- 구매공급여부 ( P.SPL_PSB_YN          -- 공급가능여부 )
	                           ,C.BZPLC_ID
	                           ,Q.BZPLC_NM
	                           ,C.OPR_UNIT_ID 
	                           ,R.OPR_UNIT_NM
				               ,D.PRD_CLCD -- SSP카테고리
				               ,FN_PR_FULL_CLSF_NM(#{CO_CD},D.PRD_CLCD) AS PRD_CLCD_NM -- SSP카테고리 명
				               ,FN_COM_DTL_CDNM('KO','PUB_ONLY_SPR_CD',A.PUB_ONLY_SPR_CD) AS PUB_ONLY_SPR_NM --공용전용구분 명
				               ,FN_COM_DTL_CDNM('KO','PRC_APLY_SPR_CD',D.PRC_APLY_SPR_CD) AS PRC_APLY_SPR_NM -- 예외관리상품
	                           ,A.MRO_PRD_STATS_CD
				               ,DECODE(A.MRO_PRD_STATS_CD,'00','사용','10','미사용','종결') AS MRO_PRD_STATS_NM  -- S-MRO상품상태
				               ,FN_COM_DTL_CDNM('KO','USE_YN', D.PRD_USE_YN) PRD_STATS_CD -- SSP상품상태
				               ,FN_COM_DTL_CDNM('KO','DISP_STATS_CD',C.DISP_STATS_CD) AS DISP_STATS_NM -- SSP진열상태
				               ,C.DISP_STATS_CD
				               ,D.PRD_NM --상품명
				               ,SSP_APP.FN_PR_ATTR_VAL_LIST(#{CO_CD},A.PRD_ID) ATTR_VAL -- 대표규격
				               ,A.MNFR_NO -- 제조원ID
				               ,( SELECT MNFR_NM FROM SSP_APP.TB_PR_MNFR_INFO WHERE CO_CD = A.CO_CD AND MNFR_NO = A.MNFR_NO ) AS MNFR_NM
				               ,TRIM(TO_CHAR(A.BASIS_UNIT_QTY,'999,999,999,999,999'))
	                               ||' '
	                               ||A.BASIS_UNIT_CD
	                               ||CASE WHEN A.SELL_UNIT_QTY > 1
	                                       AND A.SELL_UNIT_CD IS NOT NULL
	                                       AND A.BASIS_UNIT_CD != A.SELL_UNIT_CD
	                                      THEN '/'||A.SELL_UNIT_CD
	                               END                                          AS SELL_UNIT_CD-- 주문단위
	                           ,A.ORGPLC_CTRY_CD          
				               ,( SELECT CTRY_NM FROM SSP_APP.TB_CO_CTRY_INFO WHERE CO_CD = A.CO_CD AND CTRY_SPR_CD = A.ORGPLC_CTRY_CD ) AS ORGPLC_CTRY_NM --원산지
				               ,H.STPRC -- SSP기준가
	                           ,H.DSTRB_STD_PRC LIST_PRICE          -- LIST PRICE
				               ,H.SSP_BSS_SALSPRC --SSP기준판매가
				               ,TO_CHAR(TO_DATE(H.BSS_SALSPRC_STR_DTM,'YYYYMMDDHH24MISS'),'YYYY-MM-DD') AS BSS_SALSPRC_STR_DTM --기준판매가 시작일시 
				               ,TO_CHAR(TO_DATE(H.BSS_SALSPRC_END_DTM,'YYYYMMDDHH24MISS'),'YYYY-MM-DD') AS BSS_SALSPRC_END_DTM --기준판매가 마감일시 
				               ,SSP_APP.FN_RD_CHRPSN_ID(A.CO_CD,A.MNFR_NO,D.PRD_CLCD,'30')  AS PURG_CHRPSN_ID -- 구매담당자 사번
				               ,(SELECT OPRTR_NM FROM SSP_APP.TB_CO_MBR_OPRTR_INFO WHERE OPRTR_ID = SSP_APP.FN_RD_CHRPSN_ID(A.CO_CD,A.MNFR_NO,D.PRD_CLCD,'30')) AS PURG_CHRPSN_NM --구매담당자명
	                           ,H.BSS_PCPRC   AS LWST_BUY_PRC        -- 최저매입가
	                           ,H.LWST_BUY_CPRTCP_ID  AS CPRTCP_ID           -- 최저매입협력사
	                           ,O.CPRTCP_KOR_NM AS CPRTCP_NM          -- 최저매입협력사명
	                           ,P.MIN_ODR_QTY         -- 최소주문수량
	                           ,P.SPL_PSB_YN          -- 공급가능여부
	                           , CASE WHEN P.SPL_PSB_YN = 'Y' AND TO_CHAR(SYSDATE,'YYYYMMDD') >= Z.VLD_STR_DT AND TO_CHAR(SYSDATE,'YYYYMMDD') <= Z.VLD_END_DT
	                                   THEN 'Y'
	                                   ELSE 'N'
	                              END AS SPL_PSB_YN2
	                           ,Z.VLD_STR_DT
	                           ,Z.VLD_END_DT
	                           ,A.DLV_LT              -- 평균배송일
	                           ,TO_CHAR(C.REG_DTM,'YYYY-MM-DD HH24:MI:SS') AS REG_DTM 
	                           ,CASE WHEN H.UPD_DTM IS NOT NULL THEN TO_CHAR(H.UPD_DTM,'YYYY-MM-DD HH24:MI:SS') 
	                                 ELSE TO_CHAR(C.REG_DTM,'YYYY-MM-DD HH24:MI:SS')
	                            END AS UPD_DTM
	                           ,NVL(C.PURG_VLD_PERD_YN,'N') AS PURG_VLD_PERD_YN -- 구매유효기간여부
	                           ,A.PUB_ONLY_SPR_CD
	                           ,D.MALL_SPR_CD
	                           ,NVL(I.BSS_SALSPRC_USEYN,'Y') AS BSS_SALSPRC_USEYN
	                           ,I.SALS_DSGN_SALSPRC
	                           ,SSP_APP.FN_PC_EXPS_SALSPRC(A.CO_CD,A.PRD_ID,C.BZPLC_ID,C.OPR_UNIT_ID,'30',SYSDATE,'BO') AS EXPS_SALSPRC -- 일반고객
	                           ,SSP_APP.FN_PC_EXPS_SALSPRC(A.CO_CD,A.PRD_ID,C.BZPLC_ID,C.OPR_UNIT_ID,'20',SYSDATE,'BO') AS EXPS_SALSPRC2 -- 계약고객
	                           ,J.INVN_STATS_CD
	                           ,NVL2(J.INVN_STATS_CD,'재고','미재고') AS INVN_STATS_NM
	                           ,N.ORG_CD
	                           ,N.ORG_NM
	                           ,CASE WHEN Q.RND_DC_SPR_CD = '10' THEN H.SSP_BSS_SALSPRC - Q.RND_DC_QTY
		                                  WHEN Q.RND_DC_SPR_CD = '20' THEN SSP_APP.FN_PC_DETR_INFO(H.SSP_BSS_SALSPRC * NVL((1 - (NVL(Q.RND_DC_QTY,0) / 100)),1))
		                             END AS CUST_PRICE
				        FROM SSP_APP.TB_PR_MRO_PRD_INFO A --MRO상품정보
	                    JOIN SSP_APP.TB_PR_PRD_INFO D --SSP상품정보
				            ON D.CO_CD = A.CO_CD AND D.PRD_ID = A.PRD_ID
				        JOIN SSP_APP.TB_DP_PRD_DISP_STATS_INFO C --진열정보
				            ON C.CO_CD = A.CO_CD AND C.PRD_ID = A.PRD_ID AND C.BZPLC_ID <> '*'
				        LEFT OUTER JOIN SSP_APP.TB_PC_PRD_PRC_HST  H --가격정보
				            ON H.CO_CD = A.CO_CD AND H.PRD_ID = A.PRD_ID AND H.BZPLC_ID = '*' AND TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') BETWEEN H.BSS_SALSPRC_STR_DTM AND H.BSS_SALSPRC_END_DTM
				        LEFT OUTER JOIN SSP_APP.TB_PC_SALS_DSGN_SALSPRC_HST I
	                        ON I.CO_CD = C.CO_CD AND I.BZPLC_ID = C.BZPLC_ID AND I.PRD_ID = C.PRD_ID AND TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') >= SALS_DSGN_SALSPRC_STR_DTM AND TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') <= SALS_DSGN_SALSPRC_END_DTM
	                    LEFT OUTER JOIN SSP_APP.TB_CP_CPRTCP_BASIS O
	                        ON O.CO_CD = H.CO_CD AND O.CPRTCP_ID = LPAD(H.LWST_BUY_CPRTCP_ID,10,'0')
	                    LEFT OUTER JOIN SSP_APP.TB_PC_CPRTCP_PRD_INFO P
	                        ON P.CO_CD = O.CO_CD AND P.CPRTCP_ID = O.CPRTCP_ID AND P.PRD_ID = A.PRD_ID
	                    LEFT JOIN SSP_APP.TB_CC_BZPLC_BASIS Q
	                        ON Q.CO_CD = C.CO_CD AND Q.BZPLC_ID = C.BZPLC_ID
	                    LEFT JOIN SSP_APP.TB_CC_OPR_UNIT_BASIS R
	                        ON R.CO_CD       = C.CO_CD
	                       AND R.OPR_UNIT_ID = C.OPR_UNIT_ID
	                    LEFT OUTER JOIN SSP_APP.TB_CO_MBR_OPRTR_INFO M -- 회원운영자정보
	                        ON M.OPRTR_ID = Q.SALS_CHRPSN_ID1
	                    LEFT OUTER JOIN SSP_APP.TB_CO_MBR_OPRTR_ORG_INFO N -- 회원운영자조직정보
	                        ON N.CO_CD = M.CO_CD AND N.ORG_CD = M.ORG_CD      
	        			LEFT OUTER JOIN
	                    (
	                      SELECT
	                            A.CO_CD,
	                            A.CPRTCP_ID,
	                            C.CPRTCP_KOR_NM AS CPRTCP_NM,
	                            A.CURR_UNIT_CD,
	                            A.PRD_ID,
	                            A.PRD_PRC,
	                            FN_PC_MIN_ODR_QTY(A.CO_CD,A.PRD_ID)  MIN_ODR_QTY,
	                            A.PCPRC_INC_YN,
	                            A.VLD_STR_DT,
	                            A.VLD_END_DT
	                        FROM SSP_APP.TB_PC_CPRTCP_LWST_PRC_INFO  A
	                            INNER JOIN
	                            TB_CP_CPRTCP_BASIS C
	                            ON  C.CO_CD = A.CO_CD
	                            AND C.CPRTCP_ID = A.CPRTCP_ID
	                    )    Z
	                    ON Z.CO_CD = A.CO_CD  
	                   AND Z.PRD_ID = A.PRD_ID
	                  LEFT OUTER JOIN SSP_APP.VW_IV_PRD_INVN_DTLS J -- 재고마스터
	                    ON A.CO_CD = J.CO_CD
	                   AND A.PRD_ID = J.PRD_ID  
	                  LEFT OUTER JOIN TB_RD_PERD_DC_DTLS Q
		                ON A.CO_CD = Q.CO_CD AND A.PRD_ID = Q.PRD_ID
		               AND TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') >= Q.RND_DC_VLD_STR_DTM
		               AND TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') <= Q.RND_DC_VLD_END_DTM
	                 WHERE 1=1
	                    ) A
	           ) A
        ]]>	            
        	<if test="BZPLC_ID_CNT > 0">
              INNER JOIN SSP_APP.TB_OD_ODR_INQ_TGT_DTLS S1
                 ON 0=0
	            AND S1.SES_ID        = #{SES_ID}
	            AND S1.INQ_COND_DTLS = #{INQ_COND_DTLS}
	            AND S1.COL_ITM       = 'BZPLC_ID'
	            AND S1.COND_DATA_VAL = A.BZPLC_ID
        	</if>
        	<if test="OPR_UNIT_CD_CNT > 0">
              INNER JOIN SSP_APP.TB_OD_ODR_INQ_TGT_DTLS S2
                 ON 0=0
	            AND S2.SES_ID        = #{SES_ID}
	            AND S2.INQ_COND_DTLS = #{INQ_COND_DTLS}
	            AND S2.COL_ITM       = 'OPR_UNIT_CD'
	            AND S2.COND_DATA_VAL = A.OPR_UNIT_ID
        	</if>
        	<if test="PRD_ID_CNT > 0">
              INNER JOIN SSP_APP.TB_OD_ODR_INQ_TGT_DTLS S3
                 ON 0=0
	            AND S3.SES_ID        = #{SES_ID}
	            AND S3.INQ_COND_DTLS = #{INQ_COND_DTLS}
	            AND S3.COL_ITM       = 'PRD_ID'
	            AND LPAD(S3.COND_DATA_VAL,18,'0') = A.PRD_ID 
        	</if>
        	<if test="MNFR_NO_CNT > 0">
        	  INNER JOIN SSP_APP.TB_OD_ODR_INQ_TGT_DTLS S4
                 ON 0=0
	            AND S4.SES_ID        = #{SES_ID}
	            AND S4.INQ_COND_DTLS = #{INQ_COND_DTLS}
	            AND S4.COL_ITM       = 'MNFR_NO'
	            AND S4.COND_DATA_VAL = A.MNFR_NO
        	</if>
        	<if test="CHRPSN_ID_CNT > 0">
        	  INNER JOIN SSP_APP.TB_OD_ODR_INQ_TGT_DTLS S5
                 ON 0=0
	            AND S5.SES_ID        = #{SES_ID}
	            AND S5.INQ_COND_DTLS = #{INQ_COND_DTLS}
	            AND S5.COL_ITM       = 'CHRPSN_ID'
	            AND S5.COND_DATA_VAL = A.PURG_CHRPSN_ID
        	</if>
        	<if test="SALS_TEAM_CD_CNT > 0">
        	  INNER JOIN SSP_APP.TB_OD_ODR_INQ_TGT_DTLS S6
                 ON 0=0
	            AND S6.SES_ID        = #{SES_ID}
	            AND S6.INQ_COND_DTLS = #{INQ_COND_DTLS}
	            AND S6.COL_ITM       = 'SALS_TEAM_CD'
	            AND S6.COND_DATA_VAL = A.ORG_CD
        	</if>
              WHERE A.CO_CD = #{CO_CD}
			    AND A.MALL_SPR_CD = '20'
			    AND A.PUB_ONLY_SPR_CD = 'E'
			<if test='PRD_CLCD != null and PRD_CLCD != ""'>
			    AND A.PRD_CLCD = #{PRD_CLCD}
			</if>    
			<if test='MRO_PRD_STATS_CD != null and MRO_PRD_STATS_CD != ""'>
				AND A.MRO_PRD_STATS_CD = #{MRO_PRD_STATS_CD}
			</if>
			<if test='DISP_STATS_CD != null and DISP_STATS_CD != ""'>
				AND A.DISP_STATS_CD = #{DISP_STATS_CD}
			</if>
			<if test="PRD_NM != null and PRD_NM != ''">
	            <choose>
		        	<when test="FULL_PRD_NM_YN != null and FULL_PRD_NM_YN == 'true'">
		            AND A.PRD_NM = #{PRD_NM}
		            </when>
		            <otherwise>
		            AND A.PRD_NM LIKE '%' || #{PRD_NM} || '%'
		            </otherwise>
	            </choose>
        	</if>
			<if test="PRVL_LIST != null and PRVL_LIST != '' ">
	          AND ( EXISTS ( SELECT 'X' FROM SSP_APP.TB_PR_MRO_PRD_INFO_ATTR_MAPP WHERE CO_CD = A.CO_CD AND PRD_ID = A.PRD_ID AND PRVL LIKE '%'||#{PRVL_LIST}||'%' )
                     OR EXISTS ( SELECT 'X' FROM SSP_APP.TB_PR_PRD_INFO_ATTR_MAPP WHERE CO_CD = A.CO_CD AND PRD_ID = A.PRD_ID AND PRVL LIKE '%'||#{PRVL_LIST}||'%' ) )
	        </if>
	        <if test='BSS_SELL_APLY_YN != null and BSS_SELL_APLY_YN!= ""'>
	          AND A.BSS_SALSPRC_USEYN = #{BSS_SELL_APLY_YN} 
	        </if>
	        <if test='DISP_ABNO != null and DISP_ABNO!= ""'>
	            <choose>
	                <when test='"10" eq DISP_ABNO'>
	                    AND A.SPL_PSB_YN2 = 'Y'
	                </when>
	                <when test='"20" eq DISP_ABNO'>
	                    AND A.SPL_PSB_YN2 = 'N'
	                </when>
	            </choose>
	        </if>
	        <if test="REQ_DT_FNL_PROC_DT_SPR != null and REQ_DT_FNL_PROC_DT_SPR != ''">
				<if test="REQ_DT_FNL_PROC_DT_SPR == 'REG_DTM'">
				   AND A.REG_DTM BETWEEN TO_CHAR(TO_DATE(#{DATE_FR_DT},'YYYYMMDD'),'YYYY-MM-DD') || ' 00:00:00' AND TO_CHAR(TO_DATE(#{DATE_TO_DT},'YYYYMMDD'),'YYYY-MM-DD') || ' 23:59:59'
				</if>
				<if test="REQ_DT_FNL_PROC_DT_SPR == 'UPD_DTM'">
				   AND A.UPD_DTM BETWEEN TO_CHAR(TO_DATE(#{DATE_FR_DT},'YYYYMMDD'),'YYYY-MM-DD') || ' 00:00:00' AND TO_CHAR(TO_DATE(#{DATE_TO_DT},'YYYYMMDD'),'YYYY-MM-DD') || ' 23:59:59'
				</if>
	         </if>
	         <choose>
	            <when test='(SORT_COLUMN != null and SORT_COLUMN != "") and (SORT_TYPE != null and SORT_TYPE != "")'>
	             ORDER BY A.${SORT_COLUMN} ${SORT_TYPE}
	            </when>
	            <otherwise>
	             ORDER BY A.BZPLC_ID ASC,A.PRD_ID ASC
	            </otherwise>
	        </choose>
            OFFSET #{START_NUM} ROWS FETCH FIRST #{ROW_COUNT} ROWS ONLY
    </select>

    <select id="selectOnlyPrdPrcMngCount" parameterType="HashMap" resultType="Integer">
        /* OnlyPrdPrcMngDao.selectOnlyPrdPrcMngCount 전용상품가격관리 카운트 조회 */
        <![CDATA[
            SELECT COUNT(1) AS CNT
			 FROM (
					SELECT 0 AS CHK
					       ,A.CO_CD 
			               ,TO_NUMBER(A.PRD_ID) AS PRD_ID_VIEW
			               ,A.PRD_ID --상품ID
                           ,C.PURG_SPL_YN -- 구매공급여부 ( P.SPL_PSB_YN          -- 공급가능여부 )
                           ,C.BZPLC_ID
                           ,Q.BZPLC_NM
                           ,C.OPR_UNIT_ID 
                           ,R.OPR_UNIT_NM
			               ,D.PRD_CLCD -- SSP카테고리
			               ,FN_PR_FULL_CLSF_NM(#{CO_CD},D.PRD_CLCD) AS PRD_CLCD_NM -- SSP카테고리 명
			               ,FN_COM_DTL_CDNM('KO','PUB_ONLY_SPR_CD',A.PUB_ONLY_SPR_CD) AS PUB_ONLY_SPR_NM --공용전용구분 명
			               ,FN_COM_DTL_CDNM('KO','PRC_APLY_SPR_CD',D.PRC_APLY_SPR_CD) AS PRC_APLY_SPR_NM -- 예외관리상품
                           ,A.MRO_PRD_STATS_CD
			               ,DECODE(A.MRO_PRD_STATS_CD,'00','사용','10','미사용','종결') AS MRO_PRD_STATS_NM  -- S-MRO상품상태
			               ,FN_COM_DTL_CDNM('KO','USE_YN', D.PRD_USE_YN) PRD_STATS_CD -- SSP상품상태
			               ,FN_COM_DTL_CDNM('KO','DISP_STATS_CD',C.DISP_STATS_CD) AS DISP_STATS_NM -- SSP진열상태
			               ,C.DISP_STATS_CD
			               ,D.PRD_NM --상품명
			               ,SSP_APP.FN_PR_ATTR_VAL_LIST(#{CO_CD},A.PRD_ID) ATTR_VAL -- 대표규격
			               ,A.MNFR_NO -- 제조원ID
			               ,( SELECT MNFR_NM FROM SSP_APP.TB_PR_MNFR_INFO WHERE CO_CD = A.CO_CD AND MNFR_NO = A.MNFR_NO ) AS MNFR_NM
			               ,TRIM(TO_CHAR(A.BASIS_UNIT_QTY,'999,999,999,999,999'))
                               ||' '
                               ||A.BASIS_UNIT_CD
                               ||CASE WHEN A.SELL_UNIT_QTY > 1
                                       AND A.SELL_UNIT_CD IS NOT NULL
                                       AND A.BASIS_UNIT_CD != A.SELL_UNIT_CD
                                      THEN '/'||A.SELL_UNIT_CD
                               END                                          AS SELL_UNIT_CD-- 주문단위
                           ,A.ORGPLC_CTRY_CD          
			               ,( SELECT CTRY_NM FROM SSP_APP.TB_CO_CTRY_INFO WHERE CO_CD = A.CO_CD AND CTRY_SPR_CD = A.ORGPLC_CTRY_CD ) AS ORGPLC_CTRY_NM --원산지
			               ,H.STPRC -- SSP기준가
                           ,H.DSTRB_STD_PRC LIST_PRICE          -- LIST PRICE
			               ,H.SSP_BSS_SALSPRC --SSP기준판매가
			               ,TO_CHAR(TO_DATE(H.BSS_SALSPRC_STR_DTM,'YYYYMMDDHH24MISS'),'YYYY-MM-DD') AS BSS_SALSPRC_STR_DTM --기준판매가 시작일시 
			               ,TO_CHAR(TO_DATE(H.BSS_SALSPRC_END_DTM,'YYYYMMDDHH24MISS'),'YYYY-MM-DD') AS BSS_SALSPRC_END_DTM --기준판매가 마감일시 
			               ,SSP_APP.FN_RD_CHRPSN_ID(A.CO_CD,A.MNFR_NO,D.PRD_CLCD,'30')  AS PURG_CHRPSN_ID -- 구매담당자 사번
				               ,(SELECT OPRTR_NM FROM SSP_APP.TB_CO_MBR_OPRTR_INFO WHERE OPRTR_ID = SSP_APP.FN_RD_CHRPSN_ID(A.CO_CD,A.MNFR_NO,D.PRD_CLCD,'30')) AS PURG_CHRPSN_NM --구매담당자명
                           ,H.BSS_PCPRC   AS LWST_BUY_PRC        -- 최저매입가
                           ,H.LWST_BUY_CPRTCP_ID  AS CPRTCP_ID           -- 최저매입협력사
                           ,O.CPRTCP_KOR_NM AS CPRTCP_NM          -- 최저매입협력사명
                           ,P.MIN_ODR_QTY         -- 최소주문수량 
                           ,P.SPL_PSB_YN          -- 공급가능여부
                           , CASE WHEN P.SPL_PSB_YN = 'Y' AND TO_CHAR(SYSDATE,'YYYYMMDD') >= Z.VLD_STR_DT AND TO_CHAR(SYSDATE,'YYYYMMDD') <= Z.VLD_END_DT
                                   THEN 'Y'
                                   ELSE 'N'
                              END AS SPL_PSB_YN2
                           ,Z.VLD_STR_DT
                           ,Z.VLD_END_DT
                           ,A.DLV_LT              -- 평균배송일
                           ,TO_CHAR(C.REG_DTM,'YYYY-MM-DD HH24:MI:SS') AS REG_DTM 
                           ,CASE WHEN H.UPD_DTM IS NOT NULL THEN TO_CHAR(H.UPD_DTM,'YYYY-MM-DD HH24:MI:SS') 
                                 ELSE TO_CHAR(C.REG_DTM,'YYYY-MM-DD HH24:MI:SS')
                            END AS UPD_DTM
                           ,NVL(C.PURG_VLD_PERD_YN,'N') AS PURG_VLD_PERD_YN -- 구매유효기간여부
                           ,A.PUB_ONLY_SPR_CD
                           ,D.MALL_SPR_CD
                           ,NVL(I.BSS_SALSPRC_USEYN,'N') AS BSS_SALSPRC_USEYN
                           ,SSP_APP.FN_PC_EXPS_SALSPRC(A.CO_CD,A.PRD_ID,C.BZPLC_ID,C.OPR_UNIT_ID,'30',SYSDATE,'BO') AS EXPS_SALSPRC
                           ,J.INVN_STATS_CD
                           ,NVL2(J.INVN_STATS_CD,'재고','미재고') AS INVN_STATS_NM
                           ,N.ORG_CD
                           ,N.ORG_NM
			        FROM SSP_APP.TB_PR_MRO_PRD_INFO A --MRO상품정보
                    JOIN SSP_APP.TB_PR_PRD_INFO D --SSP상품정보
			            ON D.CO_CD = A.CO_CD AND D.PRD_ID = A.PRD_ID
			        JOIN SSP_APP.TB_DP_PRD_DISP_STATS_INFO C --진열정보
			            ON C.CO_CD = A.CO_CD AND C.PRD_ID = A.PRD_ID AND C.BZPLC_ID <> '*'
			        LEFT OUTER JOIN SSP_APP.TB_PC_PRD_PRC_HST  H --가격정보
			            ON H.CO_CD = A.CO_CD AND H.PRD_ID = A.PRD_ID AND H.BZPLC_ID = '*' AND TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') BETWEEN H.BSS_SALSPRC_STR_DTM AND H.BSS_SALSPRC_END_DTM
			        LEFT OUTER JOIN SSP_APP.TB_PC_SALS_DSGN_SALSPRC_HST I
                        ON I.CO_CD = C.CO_CD AND I.BZPLC_ID = C.BZPLC_ID AND I.PRD_ID = C.PRD_ID AND TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') >= SALS_DSGN_SALSPRC_STR_DTM AND TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') <= SALS_DSGN_SALSPRC_END_DTM
                    LEFT OUTER JOIN SSP_APP.TB_CP_CPRTCP_BASIS O
                        ON O.CO_CD = H.CO_CD AND O.CPRTCP_ID = LPAD(H.LWST_BUY_CPRTCP_ID,10,'0')
                    LEFT OUTER JOIN SSP_APP.TB_PC_CPRTCP_PRD_INFO P
                        ON P.CO_CD = O.CO_CD AND P.CPRTCP_ID = O.CPRTCP_ID AND P.PRD_ID = A.PRD_ID
                    LEFT JOIN SSP_APP.TB_CC_BZPLC_BASIS Q
                        ON Q.CO_CD = C.CO_CD AND Q.BZPLC_ID = C.BZPLC_ID
                    LEFT JOIN SSP_APP.TB_CC_OPR_UNIT_BASIS R
                        ON R.CO_CD       = C.CO_CD
                       AND R.OPR_UNIT_ID = C.OPR_UNIT_ID
                    LEFT OUTER JOIN SSP_APP.TB_CO_MBR_OPRTR_INFO M -- 회원운영자정보
                        ON M.OPRTR_ID = Q.SALS_CHRPSN_ID1
                    LEFT OUTER JOIN SSP_APP.TB_CO_MBR_OPRTR_ORG_INFO N -- 회원운영자조직정보
                        ON N.CO_CD = M.CO_CD AND N.ORG_CD = M.ORG_CD      
        			LEFT OUTER JOIN
                    (
                      SELECT
                            A.CO_CD,
                            A.CPRTCP_ID,
                            C.CPRTCP_KOR_NM AS CPRTCP_NM,
                            A.CURR_UNIT_CD,
                            A.PRD_ID,
                            A.PRD_PRC,
                            FN_PC_MIN_ODR_QTY(A.CO_CD,A.PRD_ID)  MIN_ODR_QTY,
                            A.PCPRC_INC_YN,
                            A.VLD_STR_DT,
                            A.VLD_END_DT
                        FROM SSP_APP.TB_PC_CPRTCP_LWST_PRC_INFO  A
                            INNER JOIN
                            TB_CP_CPRTCP_BASIS C
                            ON  C.CO_CD = A.CO_CD
                            AND C.CPRTCP_ID = A.CPRTCP_ID
                    )    Z
                    ON Z.CO_CD = A.CO_CD  
                   AND Z.PRD_ID = A.PRD_ID
                  LEFT OUTER JOIN SSP_APP.VW_IV_PRD_INVN_DTLS J -- 재고마스터
                    ON A.CO_CD = J.CO_CD
                   AND A.PRD_ID = J.PRD_ID  
                  LEFT OUTER JOIN TB_RD_PERD_DC_DTLS Q
		            ON A.CO_CD = Q.CO_CD AND A.PRD_ID = Q.PRD_ID
		           AND TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') >= Q.RND_DC_VLD_STR_DTM
		           AND TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') <= Q.RND_DC_VLD_END_DTM
                 WHERE 1=1
                    ) A
        ]]>	            
        	<if test="BZPLC_ID_CNT > 0">
              INNER JOIN SSP_APP.TB_OD_ODR_INQ_TGT_DTLS S1
                 ON 0=0
	            AND S1.SES_ID        = #{SES_ID}
	            AND S1.INQ_COND_DTLS = #{INQ_COND_DTLS}
	            AND S1.COL_ITM       = 'BZPLC_ID'
	            AND S1.COND_DATA_VAL = A.BZPLC_ID
        	</if>
        	<if test="OPR_UNIT_CD_CNT > 0">
              INNER JOIN SSP_APP.TB_OD_ODR_INQ_TGT_DTLS S2
                 ON 0=0
	            AND S2.SES_ID        = #{SES_ID}
	            AND S2.INQ_COND_DTLS = #{INQ_COND_DTLS}
	            AND S2.COL_ITM       = 'OPR_UNIT_CD'
	            AND S2.COND_DATA_VAL = A.OPR_UNIT_ID
        	</if>
        	<if test="PRD_ID_CNT > 0">
              INNER JOIN SSP_APP.TB_OD_ODR_INQ_TGT_DTLS S3
                 ON 0=0
	            AND S3.SES_ID        = #{SES_ID}
	            AND S3.INQ_COND_DTLS = #{INQ_COND_DTLS}
	            AND S3.COL_ITM       = 'PRD_ID'
	            AND LPAD(S3.COND_DATA_VAL,18,'0') = A.PRD_ID 
        	</if>
        	<if test="MNFR_NO_CNT > 0">
        	  INNER JOIN SSP_APP.TB_OD_ODR_INQ_TGT_DTLS S4
                 ON 0=0
	            AND S4.SES_ID        = #{SES_ID}
	            AND S4.INQ_COND_DTLS = #{INQ_COND_DTLS}
	            AND S4.COL_ITM       = 'MNFR_NO'
	            AND S4.COND_DATA_VAL = A.MNFR_NO
        	</if>
        	<if test="CHRPSN_ID_CNT > 0">
        	  INNER JOIN SSP_APP.TB_OD_ODR_INQ_TGT_DTLS S5
                 ON 0=0
	            AND S5.SES_ID        = #{SES_ID}
	            AND S5.INQ_COND_DTLS = #{INQ_COND_DTLS}
	            AND S5.COL_ITM       = 'CHRPSN_ID'
	            AND S5.COND_DATA_VAL = A.PURG_CHRPSN_ID
        	</if>
        	<if test="SALS_TEAM_CD_CNT > 0">
        	  INNER JOIN SSP_APP.TB_OD_ODR_INQ_TGT_DTLS S6
                 ON 0=0
	            AND S6.SES_ID        = #{SES_ID}
	            AND S6.INQ_COND_DTLS = #{INQ_COND_DTLS}
	            AND S6.COL_ITM       = 'SALS_TEAM_CD'
	            AND S6.COND_DATA_VAL = A.ORG_CD
        	</if>
              WHERE A.CO_CD = #{CO_CD}
			    AND A.MALL_SPR_CD = '20'
			    AND A.PUB_ONLY_SPR_CD = 'E'
			<if test='PRD_CLCD != null and PRD_CLCD != ""'>
			    AND A.PRD_CLCD = #{PRD_CLCD}
			</if>    
			<if test='MRO_PRD_STATS_CD != null and MRO_PRD_STATS_CD != ""'>
				AND A.MRO_PRD_STATS_CD = #{MRO_PRD_STATS_CD}
			</if>
			<if test='DISP_STATS_CD != null and DISP_STATS_CD != ""'>
				AND A.DISP_STATS_CD = #{DISP_STATS_CD}
			</if>
			<if test="PRD_NM != null and PRD_NM != ''">
	            <choose>
		        	<when test="FULL_PRD_NM_YN != null and FULL_PRD_NM_YN == 'true'">
		            AND A.PRD_NM = #{PRD_NM}
		            </when>
		            <otherwise>
		            AND A.PRD_NM LIKE '%' || #{PRD_NM} || '%'
		            </otherwise>
	            </choose>
        	</if>
			<if test="PRVL_LIST != null and PRVL_LIST != '' ">
	          AND ( EXISTS ( SELECT 'X' FROM TB_PR_MRO_PRD_INFO_ATTR_MAPP WHERE CO_CD = A.CO_CD AND PRD_ID = A.PRD_ID AND PRVL LIKE '%'||#{PRVL_LIST}||'%' )
                     OR EXISTS ( SELECT 'X' FROM TB_PR_PRD_INFO_ATTR_MAPP WHERE CO_CD = A.CO_CD AND PRD_ID = A.PRD_ID AND PRVL LIKE '%'||#{PRVL_LIST}||'%' ) )
	        </if>
	        <if test='BSS_SELL_APLY_YN != null and BSS_SELL_APLY_YN!= ""'>
	          AND A.BSS_SALSPRC_USEYN = #{BSS_SELL_APLY_YN} 
	        </if>
	        <if test='DISP_ABNO != null and DISP_ABNO!= ""'>
	            <choose>
	                <when test='"10" eq DISP_ABNO'>
	                    AND A.SPL_PSB_YN2 = 'Y'
	                </when>
	                <when test='"20" eq DISP_ABNO'>
	                    AND A.SPL_PSB_YN2 = 'N'
	                </when>
	            </choose>
	        </if>
	        <if test="REQ_DT_FNL_PROC_DT_SPR != null and REQ_DT_FNL_PROC_DT_SPR != ''">
				<if test="REQ_DT_FNL_PROC_DT_SPR == 'REG_DTM'">
				   AND A.REG_DTM BETWEEN TO_CHAR(TO_DATE(#{DATE_FR_DT},'YYYYMMDD'),'YYYY-MM-DD') || ' 00:00:00' AND TO_CHAR(TO_DATE(#{DATE_TO_DT},'YYYYMMDD'),'YYYY-MM-DD') || ' 23:59:59'
				</if>
				<if test="REQ_DT_FNL_PROC_DT_SPR == 'UPD_DTM'">
				   AND A.UPD_DTM BETWEEN TO_CHAR(TO_DATE(#{DATE_FR_DT},'YYYYMMDD'),'YYYY-MM-DD') || ' 00:00:00' AND TO_CHAR(TO_DATE(#{DATE_TO_DT},'YYYYMMDD'),'YYYY-MM-DD') || ' 23:59:59'
				</if>
	         </if>
    </select>

	<select id="selectOprUnitInfo" parameterType="HashMap" resultType="HashMap">
		/* OnlyPrdPrcMngDao.selectOprUnitInfo 전용상품가격관리 운영단위조회 */
		 SELECT A.CO_CD   
		        ,A.BZPLC_ID
		        ,A.OPR_UNIT_ID
		        ,A.OPR_UNIT_NM
		        ,A.SALS_CHR_CD
		        ,A.SALS_TEAM_CD
		        ,A.SALS_CHRPSN_ID
                ,B.DISP_STATS_CD
                ,CASE WHEN B.DISP_STATS_CD = '10' THEN '1' ELSE '0' END DISP_STATS_CD1
                ,CASE WHEN B.DISP_STATS_CD = '20' THEN '1' ELSE '0' END DISP_STATS_CD2
                ,CASE WHEN B.DISP_STATS_CD = '30' THEN '1' ELSE '0' END DISP_STATS_CD3
                ,CASE WHEN B.DISP_STATS_CD = '40' THEN '1' ELSE '0' END DISP_STATS_CD4
                ,B.DISP_STATS_CD AS OLD_DISP_STATS_CD
		  FROM SSP_APP.TB_CC_OPR_UNIT_BASIS A
          LEFT JOIN SSP_APP.TB_DP_PRD_DISP_STATS_INFO B
            ON A.CO_CD = B.CO_CD
           AND A.BZPLC_ID = B.BZPLC_ID
           AND A.OPR_UNIT_ID = B.OPR_UNIT_ID
           AND B.PRD_ID = #{PRD_ID}
		 WHERE A.CO_CD = #{CO_CD}
		   AND A.BZPLC_ID = #{BZPLC_ID}
		   AND A.USE_YN = 'Y'
	</select>
	
	<select id="selectOnlyPrdPrcInfo" parameterType="HashMap" resultType="HashMap">
		/* OnlyPrdPrcMngDao.selectOnlyPrdPrcInfo 전용상품가격관리 기준가정보조회 */
		<![CDATA[
		 SELECT
            T1.CO_CD,
            T1.PRD_ID,
            T1.BZPLC_ID,
            T1.SEQ,
            T1.BSS_PCPRC,
            T1.PLN_PRFRT,
            T1.STPRC,
            T1.DSTRB_STD_PRC,
            T1.MRK_LWST_SALSPRC,
            T1.INTL_LWST_SALSPRC,
            T1.PURG_DSGN_SALSPRC,
            T1.SSP_CURR_BSS_SALSPRC,
            T1.BSS_SALSPRC_CURR_UNIT_CD,
            T1.EXCHRT_APLY_YM,
            T1.SSP_BSS_SALSPRC,
            T1.BSS_SALSPRC_STR_DTM,
            T1.BSS_SALSPRC_END_DTM,
            T1.SALSPRC_CAL_BSS_CD,
            T2.COM_DTL_CD_NM    SALSPRC_CAL_BSS_NM,
            T1.IS_NEW,
            T1.UPD_DTM,
            ( SELECT  /*+ INDEX_DESC(T1 TB_PC_GEN_CUST_PREMRT_INFO_PK)*/
                        CASE WHEN NVL(MAX(S.GEN_CUST_DCRT),0) = 0 
                             THEN T1.SSP_BSS_SALSPRC
                             ELSE SSP_APP.FN_PC_DETR_INFO(T1.SSP_BSS_SALSPRC * NVL((1 - (NVL(MAX(S.GEN_CUST_DCRT),0) / 100)),1)) 
                        END AS CUST_PRICE
				/*일반고객 : */
				FROM (
				SELECT  
				ROW_NUMBER() OVER (ORDER BY A.MNFR_NO DESC, A.PRD_CLCD DESC) AS RM
				, A.GEN_CUST_DCRT 
				FROM TB_RD_CUST_DC_INFO A
				WHERE A.CO_CD = #{CO_CD}  
				AND (A.MNFR_NO = #{MNFR_NO}  OR A.MNFR_NO = '*')
				AND (A.PRD_CLCD = #{PRD_CLCD} OR A.PRD_CLCD = '*')
                AND A.USE_YN = 'Y'
				AND sysdate BETWEEN TO_DATE(A.VLD_STR_DTM, 'YYYYMMDDHH24MISS') AND TO_DATE(A.VLD_END_DTM, 'YYYYMMDDHH24MISS')
				AND GEN_CUST_DCRT IS NOT NULL 
			 ) S WHERE RM = 1 ) AS EXPS_SALSPRC,
			 (SELECT CASE WHEN NVL(MAX(S.CONT_CUST_DCRT),0) = 0 
			              THEN T1.SSP_BSS_SALSPRC
			              ELSE SSP_APP.FN_PC_DETR_INFO(LEAST(T1.SSP_BSS_SALSPRC *(1 - (NVL(MAX(S.CONT_CUST_DCRT),0) / 100)), T1.SSP_BSS_SALSPRC)) 
                	 END AS CUST_PRICE
                	FROM (
                		SELECT  
						ROW_NUMBER() OVER (ORDER BY A.MNFR_NO DESC, A.PRD_CLCD DESC) AS RM
						, A.CONT_CUST_DCRT 
						FROM TB_RD_CUST_DC_INFO A
						WHERE A.CO_CD = #{CO_CD}  
						AND (A.MNFR_NO = #{MNFR_NO}  OR A.MNFR_NO = '*')
						AND (A.PRD_CLCD = #{PRD_CLCD} OR A.PRD_CLCD = '*')
						AND A.BZPLC_ID = #{BZPLC_ID}
                        AND A.USE_YN = 'Y'
						AND sysdate BETWEEN TO_DATE(A.VLD_STR_DTM, 'YYYYMMDDHH24MISS') AND TO_DATE(A.VLD_END_DTM, 'YYYYMMDDHH24MISS')
						AND CONT_CUST_DCRT IS NOT NULL 
                	) S WHERE RM = 1) AS EXPS_SALSPRC2
        FROM    (
                SELECT
                       T1.CO_CD                                        CO_CD
	                   ,T1.PRD_ID                                       PRD_ID
	                   ,T1.BZPLC_ID                                     BZPLC_ID
	                   ,T1.SEQ                                          SEQ
	                   ,T1.BSS_PCPRC                                    BSS_PCPRC
	                   ,T1.PLN_PRFRT                                    PLN_PRFRT
	                   ,T1.STPRC                                        STPRC
	                   ,T1.DSTRB_STD_PRC                                DSTRB_STD_PRC
	                   ,T1.MRK_LWST_SALSPRC                             MRK_LWST_SALSPRC
	                   ,T1.INTL_LWST_SALSPRC                            INTL_LWST_SALSPRC
	                   ,T1.PURG_DSGN_SALSPRC                            PURG_DSGN_SALSPRC
	                   ,T1.SSP_CURR_BSS_SALSPRC                         SSP_CURR_BSS_SALSPRC
	                   ,T1.BSS_SALSPRC_CURR_UNIT_CD                     BSS_SALSPRC_CURR_UNIT_CD
	                   ,T1.EXCHRT_APLY_YM                               EXCHRT_APLY_YM
	                   ,T1.SSP_BSS_SALSPRC                              SSP_BSS_SALSPRC
	                   ,T1.BSS_SALSPRC_STR_DTM                          BSS_SALSPRC_STR_DTM
	                   ,T1.BSS_SALSPRC_END_DTM                          BSS_SALSPRC_END_DTM
	                   ,T1.SALSPRC_CAL_BSS_CD                           SALSPRC_CAL_BSS_CD
	                   ,T1.FST_HST_YN                                   IS_NEW
	                   ,TO_CHAR(T1.UPD_DTM,'YYYY-MM-DD HH24:MI:SS')     UPD_DTM
                   ,( SELECT MIN(OPR_UNIT_ID) FROM TB_CC_OPR_UNIT_BASIS WHERE BZPLC_ID = #{BZPLC_ID} AND USE_YN = 'Y' ) AS OPR_UNIT_ID
                FROM (
                     SELECT *
                     FROM  TB_PC_PRD_PRC_HST T1
                    WHERE 0=0
                      AND T1.CO_CD = #{CO_CD}
                      AND T1.PRD_ID = #{PRD_ID}
                      AND T1.BZPLC_ID = '*'
                      AND TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') BETWEEN T1.BSS_SALSPRC_STR_DTM AND T1.BSS_SALSPRC_END_DTM
                     )    T1
                )       T1
                 LEFT JOIN
                 TB_CO_COM_CD_DTL T2
                 ON  T2.LANG_CD = 'KO'
                 AND T2.COM_CLSF_CD = 'SALSPRC_CAL_BSS_CD'
                 AND T2.COM_DTL_CD = T1.SALSPRC_CAL_BSS_CD
		   ]]>
	</select>
	
	<insert id="insertOnlyPrdSalsDsgnSalsprcMng" parameterType="HashMap">
		<selectKey keyProperty="PRD_SALS_SEQ" resultType="Integer" order="BEFORE">
			SELECT COUNT(1)+1
			FROM SSP_APP.TB_PC_SALS_DSGN_SALSPRC_HST
			WHERE CO_CD = #{CO_CD}
			AND BZPLC_ID = #{BZPLC_ID}
			AND PRD_ID = #{PRD_ID}
		</selectKey>

        /* OnlyPrdPrcMngDao.insertOnlyPrdSalsDsgnSalsprcMng 전용상품 영업지정판매가 등록 */
    	INSERT INTO SSP_APP.TB_PC_SALS_DSGN_SALSPRC_HST
					(CO_CD
					,BZPLC_ID
					,PRD_ID
					,SEQ
					<if test='BSS_SALSPRC_USEYN == "N"' >
					,SALS_DSGN_SALSPRC
					</if>
					,SALS_DSGN_SALSPRC_STR_DTM
					,SALS_DSGN_SALSPRC_END_DTM
					,BSS_SALSPRC_USEYN
					,FST_HST_YN
					,REGPSN_ID
					,REG_DTM)
		     VALUES 
					(#{CO_CD}
					,#{BZPLC_ID}
					,#{PRD_ID}
					,FN_PC_HIST_SEQ_CRT('SALS_DSGN_SALSPRC_HST')
					<if test='BSS_SALSPRC_USEYN == "N"' >
					,#{SALS_DSGN_SALSPRC}
					</if>
					,#{SALS_DSGN_SALSPRC_STR_DTM}
					,#{SALS_DSGN_SALSPRC_END_DTM}
					,#{BSS_SALSPRC_USEYN}
					<if test='PRD_SALS_SEQ == 1'>
					,'Y'
					</if>
					<if test='PRD_SALS_SEQ != 1'>
					,'N'
					</if>
					,#{SESSION_OPRTR_ID}
					,SYSDATE)
    </insert>
    
    <insert id="insertOnlyPrdDispStatsInfo" parameterType="HashMap">
    /* OnlyPrdPrcMngDao.insertOnlyPrdDispStatsInfo 전용상품 진열상태 등록 */
    	INSERT INTO SSP_APP.TB_DP_PRD_DISP_STATS_INFO
		            (CO_CD
		            ,PRD_ID
		            ,BZPLC_ID
		            ,OPR_UNIT_ID
		            ,DISP_STATS_CD
		            <if test='DISP_STATS_CHGRSN!= null and DISP_STATS_CHGRSN!=""'>
		            ,DISP_STATS_CHGRSN
		            </if>
		            <if test='DISP_STATS_CD=="40"'>
		            ,RND_USCUST_DISP_STATS_CHGRSN
		            </if>
		            ,PUB_ONLY_SPR_CD
		            ,MRO_PRD_STATS_CD
		            ,PRD_USE_YN
		            ,REGPSN_ID
		            ,REG_DTM
		            ,UPDPSN_ID
		            ,UPD_DTM)
		     VALUES (#{CO_CD}
		            ,#{PRD_ID}
		            ,#{BZPLC_ID}
		            ,#{OPR_UNIT_ID}
		            ,#{DISP_STATS_CD}
		            <if test='DISP_STATS_CHGRSN!= null and DISP_STATS_CHGRSN!=""'>
		            ,#{DISP_STATS_CHGRSN}
		            </if>
		            <if test='DISP_STATS_CD=="40"'>
		            ,#{RND_USCUST_DISP_STATS_CHGRSN}
		            </if>
		            ,'E'
		            ,( SELECT MRO_PRD_STATS_CD FROM TB_PR_MRO_PRD_INFO WHERE CO_CD = #{CO_CD} AND PRD_ID = #{PRD_ID} )
		            ,( SELECT PRD_USE_YN FROM TB_PR_PRD_INFO WHERE CO_CD = #{CO_CD} AND PRD_ID = #{PRD_ID} )
		            ,#{SESSION_OPRTR_ID}
		            ,SYSDATE
		            ,#{SESSION_OPRTR_ID}
		            ,SYSDATE
		            )
    </insert>
    
    <insert id="insertOnlyPrdDispRegHst" parameterType ="HashMap">
    	<selectKey keyProperty="STR_DATE" resultType="String" order="BEFORE">
            SELECT TO_CHAR(SYSDATE,'YYYYMMDDHH24MISS') AS STR_DATE
			  FROM DUAL
        </selectKey>

        /* OnlyPrdPrcMngDao.insertOnlyPrdDispRegHst 전용상품 진열상태 이력등록 */	
         INSERT INTO TB_DP_PRD_DISP_REG_HST
					(CO_CD
					,BZPLC_ID
					,PRD_ID
					,OPR_UNIT_ID
					,SEQ
					,DISP_STATS_CD
					,AUTO_LOGIC_EM_YN
					,DISP_STATS_CHGRSN
					,DISP_REG_STR_DTM
					,DISP_REG_END_DTM
					,REGPSN_ID
					,REG_DTM
					,UPDPSN_ID
					,UPD_DTM)
					 SELECT CO_CD
							,BZPLC_ID
							,PRD_ID
							,OPR_UNIT_ID
							,FN_PC_HIST_SEQ_CRT('PRD_DISP_REG_HST')
							,DISP_STATS_CD
							,AUTO_LOGIC_EM_YN
							,DISP_STATS_CHGRSN
							,#{STR_DATE} AS DISP_REG_STR_DTM
							,'99991231235959' AS DISP_REG_END_DTM
							,REGPSN_ID
							,REG_DTM
							,UPDPSN_ID
							,UPD_DTM
					  FROM SSP_APP.TB_DP_PRD_DISP_STATS_INFO
					 WHERE CO_CD    = #{CO_CD}
	                   AND BZPLC_ID = #{BZPLC_ID}
	                   AND PRD_ID   = #{PRD_ID}
	                   AND OPR_UNIT_ID = #{OPR_UNIT_ID}
    </insert>
    
    <insert id="insertOnlyPrdDispStatsInfoHst" parameterType ="HashMap">
        /* OnlyPrdPrcMngDao.insertOnlyPrdDispStatsInfoHst 전용상품 진열상태 상태변경 이력등록 */
    		INSERT INTO TB_DP_PRD_DISP_STATS_INFO_HST
						(CO_CD
						,BZPLC_ID
						,PRD_ID
						,OPR_UNIT_ID
						,SEQ
						,DISP_STATS_CD
						,PURG_INFO_PSB_YN
						,SAFT_INVN_YN
						,RND_USCUST_DISP_STATS_CHGRSN
						,PUB_ONLY_SPR_CD
						,REPR_PRD_SPR_YN
						,MRO_PRD_STATS_CD
						,PRD_USE_YN
						,DISP_RSLT_STR_DTM
						,DISP_RSLT_END_DTM
						,REGPSN_ID
						,REG_DTM
						,UPDPSN_ID
						,UPD_DTM
						,SSP_BSS_SALSPRC_VLD_PERD_YN)
						 SELECT CO_CD
								,BZPLC_ID
								,PRD_ID
								,OPR_UNIT_ID
								,FN_PC_HIST_SEQ_CRT('PRD_DISP_STATS_INFO_HST')
								,DISP_STATS_CD
								,PURG_INFO_PSB_YN
								,SAFT_INVN_YN
								,DISP_STATS_CHGRSN AS RND_USCUST_DISP_STATS_CHGRSN    /*RND는 임시품절,단종사유는 이력관리 하지 않음.*/
								,PUB_ONLY_SPR_CD
								,REPR_PRD_SPR_YN
								,MRO_PRD_STATS_CD
								,PRD_USE_YN
								,#{STR_DATE} AS DISP_RSLT_STR_DTM
							    ,'99991231235959' AS DISP_RSLT_END_DTM
								,REGPSN_ID
								,REG_DTM
								,UPDPSN_ID
								,UPD_DTM
								,SSP_BSS_SALSPRC_VLD_PERD_YN
						   FROM SSP_APP.TB_DP_PRD_DISP_STATS_INFO
						  WHERE CO_CD = #{CO_CD}
						    AND BZPLC_ID = #{BZPLC_ID}
						    AND PRD_ID = #{PRD_ID}
					 	    AND OPR_UNIT_ID = #{OPR_UNIT_ID}
        </insert>
    
    <select id="selectOnlyPrdBasisInfo" parameterType="HashMap" resultType="HashMap">
    /* OnlyPrdPrcMngDao.selectOnlyPrdBasisInfo 전용상품 기본정보 조회 */
    		SELECT TB.CO_CD                                                        /*회사코드 PK*/
                 , TB.PRD_ID                                                       /*상품ID PK*/
                 , TO_NUMBER(TB.PRD_ID) AS PRD_ID_VIEW                             /*상품ID_VIEW*/
                 , TB.MRO_PRD_STATS_CD                                             /*RND상품상태코드*/
                 , TB.MRO_PRD_STATS_CD_NM                                          /*RND상품상태명*/
                 , TB.ORGPLC_CTRY_CD                                               /*원산지코드*/
                 , TB.ORGPLC_CTRY_CD_NM                                            /*원산지명*/
                 , TB.ORGPLC_CTRY_CD || ' | ' ||  TB.ORGPLC_CTRY_CD_NM AS CTRY_NM    /*원산지_VIEW*/
                 , TB.ATTR_VAL                                                     /*대표규격*/
                 , TB.BASIS_UNIT_QTY                                               /*기본단위수량*/
                 , TB.BASIS_UNIT_CD                                                /*기본단위코드*/
                 , CASE WHEN TB.SELL_UNIT_QTY > 1
                         AND TB.SELL_UNIT_CD IS NOT NULL 
                           AND TB.BASIS_UNIT_CD != TB.SELL_UNIT_CD
                           THEN TB.SELL_UNIT_CD END AS SELL_UNIT_CD                                               /*판매단위코드*/
                 , TRIM(TO_CHAR(TB.BASIS_UNIT_QTY,'999,999,999,999,999'))
                               ||' '
                               ||TB.BASIS_UNIT_CD
                               ||CASE WHEN TB.SELL_UNIT_QTY > 1
                                       AND TB.SELL_UNIT_CD IS NOT NULL
                                       AND TB.BASIS_UNIT_CD != TB.SELL_UNIT_CD
                                      THEN '/'||TB.SELL_UNIT_CD
                               END                                          AS BASIS_NM  /*주문단위*/
                 , TB.HUB_HNL_DIS_TP_CD                                            /*허브취급가능여부*/
                 , TB.HUB_HNL_DIS_TP_NM                                            /*허브취급가능여부명*/
                 , TB.CHM_MTL_PRD_YN                                               /*화학물질여부*/
                 , TB.INVN_STATS_NM                                                /*재고여부*/
                 , TB.TX_CLCD                                                      /*세금분류코드*/
                 , TB.TX_CLCD_NM                                                   /*세금분류코드명*/
                 , TB.PUB_ONLY_SPR_CD                                              /*공용전용구분코드*/
                 , TB.PUB_ONLY_SPR_NM                                              /*공용전용구분명*/
                 , TB.REGPSN_ID                                                    /*등록자ID*/
                 , CASE WHEN TB.REGPSN_ID IS NOT NULL
                        THEN '(' || TB.REGPSN_ID || ') ' || TB.REGPSN_NM
                        ELSE ''
                   END                                       AS REGPSN_NM          /*등록자명*/
                 , TB.SSP_REG_DTM                                                  /*등록일*/
                 , TB.UPDPSN_ID                                                    /*최종수정자ID*/
                 , CASE WHEN TB.UPDPSN_ID IS NOT NULL
                        THEN '(' || TB.UPDPSN_ID || ') ' || TB.UPDPSN_NM
                        ELSE ''
                   END                                       AS UPDPSN_NM          /*최종수정자명*/
                 , TB.SSP_UPD_DTM                                                  /*최종수정일*/
                 , TB.PRD_CLCD                                                     /*RD카테고리*/
                 , TB.PRD_CLCD                               AS OLD_PRD_CLCD       /*기존RD카테고리*/
                 , FN_PR_FULL_CLSF_NM(TB.CO_CD,TB.PRD_CLCD)  AS PRD_CLCD_NM        /*RD카테고리명*/
                 , FN_PR_ATTR_VAL_LIST(TB.CO_CD,TB.PRD_ID)   AS ATTR_LIST          /*대표규격*/
                 , FN_PR_ATTR_VAL_LIST(TB.CO_CD,TB.PRD_ID)   AS OLD_ATTR_LIST      /*기존대표규격*/
                 , TB.BRND_NM                                                      /*브랜드명*/
                 , TB.HASH_TAG                                                     /*해시태그*/
                 , TB.BG_SEQ                                                       /*배지순번*/
                 , TB.BG_APLY_STR_DTM                                              /*배지유효시작일시*/
                 , TB.BG_APLY_END_DTM                                              /*배지유효종료일시*/
                 , TB.BG_NM                                                        /*배지명*/
                 , TB.DISP_PRD_SPR_CD                                              /*전시상품구분코드*/
                 , TB.DISP_PRD_SPR_NM                                              /*전시상품구분명*/
                 , TB.PURG_OPRTR_ID                                                /*구매담당자ID*/
                 , CASE WHEN TB.PURG_OPRTR_ID IS NOT NULL
                        THEN '(' || TB.PURG_OPRTR_ID || ') ' ||
                              (
                               SELECT OPR.OPRTR_NM
                                 FROM SSP_APP.TB_CO_MBR_OPRTR_INFO OPR
                                WHERE OPR.CO_CD    = TB.CO_CD
                                  AND OPR.OPRTR_ID = TB.PURG_OPRTR_ID
                              )
                        ELSE ''
                   END                                       AS PURG_OPRTR_NM      /*구매담당자명*/
                 , TB.PRD_OPRTR_ID                                                 /*상품담당자ID*/
                 , CASE WHEN TB.PRD_OPRTR_ID IS NOT NULL
                        THEN '(' || TB.PRD_OPRTR_ID || ') ' ||
                              (
                               SELECT OPR.OPRTR_NM
                                 FROM SSP_APP.TB_CO_MBR_OPRTR_INFO OPR
                                WHERE OPR.CO_CD    = TB.CO_CD
                                  AND OPR.OPRTR_ID = TB.PRD_OPRTR_ID
                              )
                        ELSE ''
                   END                                       AS PRD_OPRTR_NM       /*상품담당자명*/
                 , TB.DOC_REG_ID                             AS PRD_DOC_REG_ID     /*상품첨부파일*/
                 , TB.PRD_NM                                                       /*상품명*/
                 , TB.MNFR_NO                                                      /*제조원번호*/
                 , TB.MNFR_NO || ' | ' || TB.MNFR_NM  AS MNFR_NM                     /*제조원명*/
                 , TB.NOTI_ITM_ID                                                  /*고시상품ID*/
                 , CASE WHEN TB.NOTI_ITM_ID IS NOT NULL
                        THEN '(' || TB.NOTI_ITM_ID || ') ' ||
                              (
                               SELECT NOTI_ITM_NM
                                 FROM SSP_APP.TB_PR_NOTI_ITM_BASIS B
                                WHERE B.CO_CD       = TB.CO_CD
                                  AND B.NOTI_ITM_ID = TB.NOTI_ITM_ID
                               )
                        ELSE ''
                   END                                        AS NOTI_ITM_NM       /*고시ITEM NM*/
                 , TB.MALL_SPR_CD                                                  /*몰구분코드*/
                 , TB.MALL_SPR_NM                                                  /*몰구분명*/
                 , TB.DSTRB_STD_PRC                                                /*유통판매가격*/
                 , TB.STPRC                                                        /*기준가*/
                 , TB.MULT_SELL_UNIT_QTY
                 , TB.REPR_REG_DTM
                 , TB.QCK_DLV_YN
                 , TB.PRD_DTL_DESC
                 , TB.MRO_PRD_CLCD
                 , TB.MD_OPRTR_ID
                 , TB.MD_OPRTR_NM
                 , TB.PRD_USE_YN
                 , TB.PRD_NUSE_RSN_CD
                 , TO_CHAR(TO_NUMBER(PRD_ID))                AS PRD_ID_VIEW
                 , TB.MTL_GRAVITY	                                               /*물질비중*/
                 , TB.PHASE_SPR_CD	                                               /*성상구분코드*/
                 , NULL                                      AS UPD_RSN            /*수정사유 저장시 컬럼필요함*/
                 , SSP_APP.FN_PR_GET_SSP_PRD_NM(TB.CO_CD, TB.PRD_ID) SSP_PRD_NM    /*SSP상품명*/
              FROM (
                    SELECT MROPRD.CO_CD                                                                                                      /*회사코드*/
                         , MROPRD.PRD_ID                                                                                                     /*상품ID*/
                         , 'N' AS REPR_PRD_GRP_USEYN                                                                                          /*대표상품그룹사용여부*/
                         , MROPRD.PRD_NM                                                                                                     /*상품명*/
                         , MROPRD.MRO_PRD_STATS_CD                                                                                           /*MRO상품상태코드*/
                         , DECODE(MROPRD.MRO_PRD_STATS_CD,'00','사용','10','미사용','20','종결')            AS MRO_PRD_STATS_CD_NM           /*MRO상품상태코드*/
                         , SSP_APP.FN_PR_ATTR_VAL_LIST(MROPRD.CO_CD, MROPRD.PRD_ID)                         AS ATTR_VAL                      /*속성명(대표규격)*/
                         , MROPRD.PUB_ONLY_SPR_CD
                         , SSP_APP.FN_COM_DTL_CDNM('KO','PUB_ONLY_SPR_CD',MROPRD.PUB_ONLY_SPR_CD)     AS PUB_ONLY_SPR_NM               /*공용전용구분코드*/
                         , MROPRD.SELL_UNIT_QTY
                         , MROPRD.SELL_UNIT_CD                                                                                               /*판매단위코드*/
                         , MROPRD.BASIS_UNIT_QTY                                                                                             /*기본단위수량*/
                         , MROPRD.BASIS_UNIT_CD                                                                                              /*기본단위코드*/
                         , MROPRD.HUB_HNL_DIS_TP_CD                                                                                          /*허브취급가능여부*/
                         , SSP_APP.FN_COM_DTL_CDNM('KO','HUB_HNL_DIS_TP_CD',MROPRD.HUB_HNL_DIS_TP_CD) AS HUB_HNL_DIS_TP_NM             /*허브취급가능여부명*/
                         , MROPRD.CHM_MTL_PRD_YN                                                                                             /*화학물질여부*/
                         , MROPRD.TX_CLCD                                                                                                    /*세금분류코드*/
                         , SSP_APP.FN_COM_DTL_CDNM('KO','TX_CLCD',MROPRD.TX_CLCD)                     AS TX_CLCD_NM                    /*세금분류코드명*/
                         , PRD.BRND_NM
                         , PRD.HASH_TAG
                         , PRD.BG_SEQ
                         , TO_CHAR(PRD.BG_APLY_STR_DTM,'YYYYMMDD')                                          AS BG_APLY_STR_DTM
                         , TO_CHAR(PRD.BG_APLY_END_DTM,'YYYYMMDD')                                          AS BG_APLY_END_DTM
                         , BI.BG_NM
                         , DB.DISP_PRD_SPR_CD                                                                                                /*전시상품구분코드*/
                         , SSP_APP.FN_COM_DTL_CDNM('KO','DISP_PRD_SPR_CD',DB.DISP_PRD_SPR_CD)         AS DISP_PRD_SPR_NM               /*전시상품구분명*/
                         , FN_RD_CHRPSN_ID(MROPRD.CO_CD,MROPRD.MNFR_NO,PRD.PRD_CLCD,'30')                   AS PURG_OPRTR_ID                 /*구매담당자*/
                         , FN_RD_CHRPSN_ID(MROPRD.CO_CD,MROPRD.MNFR_NO,PRD.PRD_CLCD,'10')                   AS PRD_OPRTR_ID                  /*상품담당자*/
                         , PRD.DOC_REG_ID                                                                   AS PRD_DOC_REG_ID
                         , MNFR.MNFR_NO                                                                                                      /*제조사번호*/
                         , MNFR.MNFR_NM                                                                                                      /*제조사명*/
                         , MROPRD.ORGPLC_CTRY_CD                                                            AS ORGPLC_CTRY_CD
				         , FN_COM_DTL_CDNM('KO','INVN_STATS_CD',PID.INVN_STATS_CD)                    AS INVN_STATS_NM
                         , (
                            SELECT CTRY_NM
                              FROM SSP_APP.TB_CO_CTRY_INFO CTRY
                             WHERE CTRY.CO_CD       = MROPRD.CO_CD
                               AND CTRY.CTRY_SPR_CD = MROPRD.ORGPLC_CTRY_CD
                           )                                                                                AS ORGPLC_CTRY_CD_NM             /*원산지*/
                         , MROPRD.MULT_SELL_UNIT_QTY                                                                                         /*배수주문수량*/
                         , MROPRD.MALL_SPR_CD                                                                                                /*몰구분코드*/
                         , SSP_APP.FN_COM_DTL_CDNM('KO','MALL_SPR_CD',MROPRD.MALL_SPR_CD)             AS MALL_SPR_NM                   /*몰구분코드명*/
                         , NULL AS REPR_REG_DTM                  /*대표상품등록일*/
                         , TO_CHAR(PRD.REG_DTM,'YYYY-MM-DD HH24:MI:SS')                                     AS SSP_REG_DTM                   /*SSP등록일*/
                         , TO_CHAR(PRD.UPD_DTM,'YYYY-MM-DD HH24:MI:SS')                                     AS SSP_UPD_DTM                   /*SSP수정일*/
                         , PRD.PRD_CLCD                                                                                                      /*SSP카테고리*/
                         , MROPRD.QCK_DLV_YN                                                                                                 /*빠른배송여부*/
                         , PRD.PRD_DTL_DESC                                                                                                  /*상품상세설명*/
                         , MROPRD.MRO_PRD_CLCD
                         , MDPSN.PRD_CLSF_CHRPSN_ID                                                         AS MD_OPRTR_ID                   /*MD담당자*/
                         , (
                            SELECT OPR.OPRTR_NM
                              FROM SSP_APP.TB_CO_MBR_OPRTR_INFO OPR
                             WHERE OPR.CO_CD    = MROPRD.CO_CD
                               AND OPR.OPRTR_ID = MDPSN.PRD_CLSF_CHRPSN_ID
                           )                                                                                AS MD_OPRTR_NM
                         , PRD_USE_YN
                         , PRD.PRD_NUSE_RSN_CD
                         , PRD.DOC_REG_ID
                         , PRD.NOTI_ITM_ID
                         , MROPRD.REGPSN_ID                                                                                                  /*등록자ID*/
                         , (
                            SELECT OPR.OPRTR_NM
                              FROM SSP_APP.TB_CO_MBR_OPRTR_INFO OPR
                             WHERE OPR.CO_CD    = MROPRD.CO_CD
                               AND OPR.OPRTR_ID = MROPRD.REGPSN_ID
                           )                                                                                AS REGPSN_NM                     /*등록자명*/
                         , MROPRD.UPDPSN_ID                                                                                                  /*최종수정자ID*/
                         , (
                            SELECT OPR.OPRTR_NM
                              FROM SSP_APP.TB_CO_MBR_OPRTR_INFO OPR
                             WHERE OPR.CO_CD    = MROPRD.CO_CD
                               AND OPR.OPRTR_ID = MROPRD.UPDPSN_ID
                           )                                                                                AS UPDPSN_NM                     /*최종수정자명*/
                         , (
                            SELECT PPD.DSTRB_STD_PRC
                              FROM SSP_APP.TB_PC_PRD_PRC_HST PPD
                             WHERE PPD.CO_CD  = MROPRD.CO_CD
                               AND PPD.PRD_ID = MROPRD.PRD_ID
                               AND #{STR_DTM} BETWEEN PPD.BSS_SALSPRC_STR_DTM AND PPD.BSS_SALSPRC_END_DTM
                               AND ROWNUM     = 1
                           )                                                                                AS DSTRB_STD_PRC                 /*유통판매가격*/
                         , (
                            SELECT PPD.STPRC
                              FROM SSP_APP.TB_PC_PRD_PRC_HST PPD
                             WHERE PPD.CO_CD  = MROPRD.CO_CD
                               AND PPD.PRD_ID = MROPRD.PRD_ID
                               AND #{STR_DTM} BETWEEN PPD.BSS_SALSPRC_STR_DTM AND PPD.BSS_SALSPRC_END_DTM
                               AND ROWNUM     = 1
                           )                                                                                AS STPRC                         /*기준가*/
                           , MROPRD.MTL_GRAVITY	                                                                                             /*물질비중*/
                           , MROPRD.PHASE_SPR_CD	                                                                                         /*성상구분코드*/
                      FROM SSP_APP.TB_PR_MRO_PRD_INFO MROPRD
                      LEFT JOIN SSP_APP.TB_PR_MNFR_INFO MNFR
                        ON MNFR.CO_CD   = MROPRD.CO_CD
                       AND MNFR.MNFR_NO = MROPRD.MNFR_NO
                     INNER JOIN SSP_APP.TB_PR_PRD_INFO PRD
                        ON PRD.CO_CD  = MROPRD.CO_CD
                       AND PRD.PRD_ID = MROPRD.PRD_ID
                      LEFT OUTER JOIN SSP_APP.TB_PR_PRD_CLSF_CHRPSN_INFO PRDPSN
                        ON PRDPSN.CO_CD                  = PRD.CO_CD
                       AND PRDPSN.PRD_CLSF_CHRPSN_SPR_CD = '10'
                       AND PRDPSN.PRD_CLSF_CHRPSN_TP_CD  = '10'
                       AND PRDPSN.PRD_CLSF_CHRPSN_USEYN  = 'Y'
                       AND PRDPSN.MNFR_NO                = '*'
                       AND PRDPSN.PRD_CLCD               = PRD.PRD_CLCD
                       AND ROWNUM                        = 1
                      LEFT OUTER JOIN SSP_APP.TB_PR_PRD_CLSF_CHRPSN_INFO MDPSN
                        ON MDPSN.CO_CD                  = PRD.CO_CD
                       AND MDPSN.PRD_CLSF_CHRPSN_SPR_CD = '10'
                       AND MDPSN.PRD_CLSF_CHRPSN_TP_CD  = '20'
                       AND MDPSN.PRD_CLSF_CHRPSN_USEYN  = 'Y'
                       AND MDPSN.MNFR_NO                = '*'
                       AND MDPSN.PRD_CLCD               = PRD.PRD_CLCD
                       AND ROWNUM                       = 1
                      LEFT OUTER JOIN SSP_APP.VW_IV_PRD_INVN_DTLS PID
                        ON PID.CO_CD  = MROPRD.CO_CD
                       AND PID.PRD_ID = MROPRD.PRD_ID
                      LEFT JOIN SSP_APP.TB_SA_BG_INFO BI
                        ON 1=1
                       AND BI.CO_CD  = PRD.CO_CD
                       AND BI.BG_SEQ = PRD.BG_SEQ
                      LEFT JOIN SSP_APP.TB_PR_DISP_BASIS DB
                        ON 1=1
                       AND DB.CO_CD    = PRD.CO_CD
                       AND DB.PRD_CLCD = PRD.PRD_CLCD
                     WHERE MROPRD.CO_CD  = #{CO_CD}
                       AND MROPRD.PRD_ID = #{PRD_ID}
                       AND MROPRD.MALL_SPR_CD = #{MALL_SPR_CD}
                   ) TB
    </select>
    
    <select id="selectCprtcpReqInfoInq" parameterType="HashMap" resultType="HashMap">
    		/* OnlyPrdPrcMngDao.selectCprtcpReqInfoInq 협력사요청정보 조회 */
    		SELECT A1.CO_CD                                                                  /*회사코드*/
                 , A1.NEW_PRD_REQ_NO                                                         /*신규상품요청번호*/
                 , A1.PRD_ID                                                                 /*상품ID*/
                 , CASE WHEN A1.PRD_ID IS NOT NULL THEN TO_NUMBER(A1.PRD_ID) END AS PRD_ID_VIEW  /*상품ID_VIEW*/
                 , A1.REQ_SBJ_CD                                                             /*요청주체코드*/
                 , A1.UPDPSN_ID                   AS CPRTCP_ID                               /*협력사ID*/
                 , A1.UPDPSN_ID         			                                         /*수정자ID*/
                 , A1.REQ_PRD_NM                                                             /*요청상품명*/
                 , A1.MNFR_NO                                                                /*제조사번호*/
                 , A1.MNFR_NO || '|' || A1.MRO_MNFR_NM  AS  MRO_MNFR_NM                      /*제조사명*/
                 , A1.ORGPLC_CTRY_CD                                                         /*원산지국가코드*/
                 , A1.HPE_SELL_UNIT_QTY                                                      /*희망판매단위수량*/
                 , A1.HPE_BASIS_UNIT_CD                                                      /*희망기본단위코드*/
                 , A1.HPE_SELL_UNIT_CD                                                       /*희망판매단위코드*/
                 , A1.HPE_BASIS_NM                                                           /*주문단위명*/
                 , A1.PRD_CLCD_NM                                                            /*상품군명*/
                 , A1.CHM_MTL_YN                                                             /*화학물질여부*/
                 , A1.MIN_ODR_QTY                                                            /*최소주문수량*/
                 , A1.REQ_RSN                                                                /*요청사유*/
                 , A1.PRD_CLCD                                                               /*상품분류코드*/
                 , A1.DOC_REG_ID                                                             /*문서등록ID*/
                 , '(' || A1.UPDPSN_ID || ') ' || A1.CPRTCP_KOR_NM AS CPRTCP_KOR_NM          /*협력사명*/
                 , A1.ORGPLC_CTRY_CD || '|' || A1.CTRY_NM     AS    CTRY_NM                  /*원산지명*/
                 , A1.NEW_PRD_REQ_PRVL_LIST                                                  /*대표규격*/
                 , A1.TB_PR_NEW_PRD_REQ_PROC_ATTR_INFO_ORDER
                 , A1.MBR_NM                                                                 /*회원명*/
                 , A1.BZPLC_ID                                                               /*사업장ID*/
                 , A1.DEPT_ID                                                                /*부서ID*/
                 , A1.OPR_UNIT_ID                                                            /*운영단위ID*/
                 , CASE WHEN A1.BZPLC_ID IS NOT NULL 
                        THEN '(' ||A1.BZPLC_ID||') ' || A1.BZPLC_NM 
                   END AS BZPLC_NM                                                           /*사업장명*/
                 , CASE WHEN A1.OPR_UNIT_ID IS NOT NULL 
                        THEN '(' || A1.OPR_UNIT_ID||') ' || A1.OPR_UNIT_NM 
                   END  AS OPR_UNIT_NM                                                       /*운영단위명*/
                 , A1.PRD_PRPS_SPR_CD                                                        /*상품제안구분코드*/
                 , A1.PRD_PRPS_SPR_NM                                                        /*상품제안구분명*/
                 , A1.PRD_PRPS_STATS_CD                                                      /*상품제안상태코드*/
                 , A1.PRD_PRPS_STATS_NM                                                      /*상품제안상태명*/
                 , A1.ALT_PRPS_RSN                                                           /*대체상품제안사유*/
                 , A1.CUST_RJT_RSN                                                           /*고객거부사유*/
                 , A1.PUB_ONLY_SPR_CD                                                        /*공용전용구분코드*/
                 , A1.PUB_ONLY_SPR_NM                                                        /*공용전용구분명*/
                 , A1.TRSF_PSN_ID                                                            /*이관담당자ID*/
                 , CASE WHEN A1.TRSF_PSN_ID IS NOT NULL
                        THEN '(' || A1.TRSF_PSN_ID || ') ' || B1.OPRTR_NM
                        ELSE ''
                   END                                               AS TRSF_PSN_NM          /*이관담당자명*/
                 , A1.TRSF_DTM                                                               /*이관일시*/
                 , A1.TRSF_RSN                                                               /*이관사유*/
                 , A1.HPE_SELL_UPRC                                                          /*희망판매단가*/
                 , CASE WHEN A1.REGPSN_ID IS NOT NULL 
                        THEN '('|| A1.REGPSN_ID || ') ' || A1.NEW_PRD_REQPSN_NM
                   END                                             AS NEW_PRD_REQPSN_NM      /*요청자*/ 
                 , A1.NEW_PRD_REQ_DTM                                                        /*요청일*/
              FROM (
                    SELECT A.CO_CD                                                                                                         /*회사코드*/
                         , A.NEW_PRD_REQ_NO                                                                                                /*신규상품요청번호*/
                         , ( SELECT RND_REQ_PRD_ID FROM TB_PR_NEW_PRD_REQ_PROC WHERE CO_CD = A.CO_CD AND NEW_PRD_REQ_NO = A.NEW_PRD_REQ_NO ) AS PRD_ID
                         , A.REQ_SBJ_CD                                                                                                    /*요청주체코드*/
                         , A.UPDPSN_ID                                                                                                     /*수정자ID*/
                         , A.REQ_PRD_NM                                                                                                    /*요청상품명*/
                         , A.MNFR_NO                                                                                                       /*제조사번호*/
                         , A.ORGPLC_CTRY_CD                                                                                                /*원산지국가코드*/
                         , A.HPE_SELL_UNIT_QTY                                                                                             /*희망판매단위수량*/
                         , A.HPE_BASIS_UNIT_CD                                                                                             /*희망기본단위코드*/
                         , CASE WHEN A.HPE_SELL_UNIT_QTY > 1
                                 AND A.HPE_SELL_UNIT_CD IS NOT NULL
                                 AND A.HPE_BASIS_UNIT_CD != A.HPE_SELL_UNIT_CD
                                THEN A.HPE_SELL_UNIT_CD                                     
                           END                                                                   AS HPE_SELL_UNIT_CD                       /*희망판매단위코드*/
                         , TRIM(TO_CHAR(A.HPE_SELL_UNIT_QTY,'999,999,999,999,999'))
                           ||A.HPE_BASIS_UNIT_CD
                           ||CASE WHEN A.HPE_SELL_UNIT_QTY > 1
                                   AND A.HPE_SELL_UNIT_CD IS NOT NULL
                                   AND A.HPE_BASIS_UNIT_CD != A.HPE_SELL_UNIT_CD
                                  THEN '/'||A.HPE_SELL_UNIT_CD
                                  ELSE ''
                           END                                                                   AS HPE_BASIS_NM                           /*주문단위명*/
                         , SSP_APP.FN_PR_FULL_CLSF_NM(A.CO_CD,A.PRD_CLCD)                        AS PRD_CLCD_NM                            /*상품군명*/
                         , A.CHM_MTL_YN                                                                                                    /*화학물질여부*/
                         , A.MIN_ODR_QTY                                                                                                   /*최소주문수량*/
                         , A.REQ_RSN                                                                                                       /*요청사유*/
                         , A.PRD_CLCD                                                                                                      /*상품분류코드*/
                         , A.DOC_REG_ID                                                                                                    /*문서등록ID*/
                         , B.CPRTCP_KOR_NM                                                                                                 /*협력사명*/
                         , C.MRO_MNFR_NM                                                                                                   /*제조사명*/
                         , D.CTRY_NM                                                                                                       /*원산지명*/
                         , LISTAGG(E.NEW_PRD_REQ_PRVL,';') WITHIN GROUP(ORDER BY E.SRT_SO)
                           OVER (PARTITION BY A.CO_CD, A.NEW_PRD_REQ_NO)                         AS NEW_PRD_REQ_PRVL_LIST                  /*대표규격*/
                         , ROW_NUMBER() OVER (PARTITION BY A.CO_CD, A.NEW_PRD_REQ_NO ORDER BY 1) AS TB_PR_NEW_PRD_REQ_PROC_ATTR_INFO_ORDER
                         , F.MBR_NM                                                                                                        /*회원명*/
                         , F.BZPLC_ID                                                                                                      /*사업장ID*/
                         , F.DEPT_ID                                                                                                       /*부서ID*/
                         , G.OPR_UNIT_ID                                                                                                   /*운영단위ID*/
                         , H.BZPLC_NM                                                                                                      /*사업장명*/
                         , I.OPR_UNIT_NM                                                                                                   /*운영단위명*/
                         , J.PRD_PRPS_SPR_CD                                                                                               /*상품제안구분코드*/
                         , K.COM_DTL_CD_NM                                                       AS PRD_PRPS_SPR_NM                        /*상품제안구분명*/
                         , J.PRD_PRPS_STATS_CD                                                                                             /*상품제안상태코드*/
                         , L.COM_DTL_CD_NM                                                       AS PRD_PRPS_STATS_NM                      /*상품제안상태명*/
                         , J.ALT_PRPS_RSN                                                                                                  /*대체상품제안사유*/
                         , J.CUST_RJT_RSN                                                                                                  /*고객거부사유*/
                         , J.PUB_ONLY_SPR_CD                                                                                               /*공용전용구분코드*/
                         , M.COM_DTL_CD_NM                                                       AS PUB_ONLY_SPR_NM                        /*공용전용구분명*/
                         , (
                            SELECT /*+ INDEX_DESC(Z TB_PR_NEW_PRD_REQ_STATS_DTLS_PK) */
                                    Z.UPDPSN_ID
                              FROM SSP_APP.TB_PR_NEW_PRD_REQ_STATS_DTLS Z
                             WHERE Z.CO_CD                = A.CO_CD
                               AND Z.NEW_PRD_REQ_NO       = A.NEW_PRD_REQ_NO
                               AND Z.NEW_PRD_REQ_STATS_CD = '35' /*이관*/
                               AND ROWNUM = 1
                           )                                                                     AS TRSF_PSN_ID                            /*이관담당자ID*/
                         , (
                            SELECT /*+ INDEX_DESC(Z TB_PR_NEW_PRD_REQ_STATS_DTLS_PK) */
                                   TO_CHAR(Z.UPD_DTM,'YYYY.MM.DD HH24:MI:SS')
                              FROM SSP_APP.TB_PR_NEW_PRD_REQ_STATS_DTLS Z
                             WHERE Z.CO_CD                = A.CO_CD
                               AND Z.NEW_PRD_REQ_NO       = A.NEW_PRD_REQ_NO
                               AND Z.NEW_PRD_REQ_STATS_CD = '35' /*이관*/
                               AND ROWNUM = 1
                           )                                                                     AS TRSF_DTM                               /*이관일자*/
                         , J.TRSF_RSN                                                                                                      /*이관사유*/
                         , A.HPE_SELL_UPRC                                                                                                 /*희망판매단가*/
                         , ( SELECT MBR_NM FROM SSP_APP.TB_CC_MBR_BASIS WHERE CO_CD = A.CO_CD AND MBR_ID = A.REGPSN_ID )   AS NEW_PRD_REQPSN_NM
                         , A.REGPSN_ID
                         , TO_CHAR(A.REG_DTM,'YYYY.MM.DD HH24:MI:SS')     AS NEW_PRD_REQ_DTM
                      FROM SSP_APP.TB_PR_NEW_PRD_CUST_REQ_INFO A
                      LEFT JOIN SSP_APP.TB_CP_CPRTCP_BASIS     B
                        ON 0=0
                       AND B.CPRTCP_ID = A.UPDPSN_ID
                      LEFT JOIN SSP_APP.TB_PR_MNFR_INFO C
                        ON 0=0
                       AND C.CO_CD   = A.CO_CD
                       AND C.MNFR_NO = A.MNFR_NO
                      LEFT JOIN SSP_APP.TB_CO_CTRY_INFO D
                        ON 0=0
                       AND D.CO_CD       = A.CO_CD
                       AND D.CTRY_SPR_CD = A.ORGPLC_CTRY_CD
                      LEFT JOIN SSP_APP.TB_PR_NEW_PRD_REQ_PROC_ATTR_INFO E
                        ON 0=0
                       AND E.CO_CD          = A.CO_CD
                       AND E.NEW_PRD_REQ_NO = A.NEW_PRD_REQ_NO
                      LEFT JOIN SSP_APP.TB_CC_MBR_BASIS F
                        ON 0=0
                       AND F.CO_CD  = A.CO_CD
                       AND F.MBR_ID = A.REGPSN_ID
                      LEFT JOIN SSP_APP.TB_CC_DEPT_BASIS G
                        ON 1=1
                       AND G.CO_CD   = F.CO_CD
                       AND G.DEPT_ID = F.DEPT_ID
                      LEFT JOIN SSP_APP.TB_CC_BZPLC_BASIS H
                        ON 1=1
                       AND H.CO_CD    = F.CO_CD
                       AND H.BZPLC_ID = F.BZPLC_ID
                      LEFT JOIN SSP_APP.TB_CC_OPR_UNIT_BASIS I
                        ON 1=1
                       AND I.CO_CD       = G.CO_CD
                       AND I.OPR_UNIT_ID = G.OPR_UNIT_ID
                      LEFT JOIN SSP_APP.TB_PR_NEW_PRD_REQ_PROC J
                        ON 1=1
                       AND J.CO_CD          = A.CO_CD
                       AND J.NEW_PRD_REQ_NO = A.NEW_PRD_REQ_NO
                      LEFT JOIN SSP_APP.TB_CO_COM_CD_DTL K
                        ON 0=0
                       AND K.LANG_CD     = 'KO'
                       AND K.COM_CLSF_CD = 'PRD_PRPS_SPR_CD'
                       AND K.COM_DTL_CD  = J.PRD_PRPS_SPR_CD
                      LEFT JOIN SSP_APP.TB_CO_COM_CD_DTL L
                        ON 0=0
                       AND L.LANG_CD     = 'KO'
                       AND L.COM_CLSF_CD = 'PRD_PRPS_STATS_CD'
                       AND L.COM_DTL_CD  = J.PRD_PRPS_STATS_CD
                      LEFT JOIN SSP_APP.TB_CO_COM_CD_DTL M
                        ON 0=0
                       AND M.LANG_CD     = 'KO'
                       AND M.COM_CLSF_CD = 'PUB_ONLY_SPR_CD'
                       AND M.COM_DTL_CD  = J.PUB_ONLY_SPR_CD
                     WHERE 1=1
                       AND A.CO_CD          = #{CO_CD}
                       AND A.NEW_PRD_REQ_NO IN (
                            SELECT NEW_PRD_REQ_NO
                              FROM SSP_APP.TB_PR_NEW_PRD_REQ_PROC
                             WHERE RND_REQ_PRD_ID = #{PRD_ID}
                       )
                   ) A1
              LEFT JOIN SSP_APP.TB_CO_MBR_OPRTR_INFO B1
                ON 1=1
               AND B1.CO_CD    = A1.CO_CD
               AND B1.OPRTR_ID = A1.TRSF_PSN_ID 
             WHERE 1=1
               AND A1.TB_PR_NEW_PRD_REQ_PROC_ATTR_INFO_ORDER = 1
    </select>
    
    <select id="selectAttcFileDtlsInq" parameterType="HashMap" resultType="HashMap">
        /* OnlyPrdPrcMngDao.selectAttcFileDtlsInq 첨부파일내역 조회 */
        <![CDATA[
        SELECT A.DOC_REG_ID                  /*문서등록ID*/
             , A.DOC_REG_SEQ                 /*문서등록순번*/
             , A.ATFL_NM                     /*첨부파일명*/
             , A.ATFL_LEN                    /*첨부파일길이*/
             , A.ATFL_STOR_PATH              /*첨부파일저장경로*/
             , A.STOR_PLC_SPR_CD             /*저장장소구분코드*/
             , A.ORI_ATFL_NM                 /*원첨부파일명*/
             , A.SAP_DOC_ID                  /*SAP문서ID*/
             , A.RMKS_CTS                    /*비고내용*/
             , A.ETC_FDS_1                   /*기타필드1*/
             , A.ETC_FDS_2                   /*기타필드2*/
             , A.ETC_FDS_3                   /*기타필드3*/
             , A.ETC_FDS_4                   /*기타필드4*/
             , A.ETC_FDS_5                   /*기타필드5*/
             , A.REG_DTM                     /*등록일시*/
             , A.REGPSN_ID                   /*등록자ID*/
             , A.UPD_DTM                     /*수정일시*/
             , A.UPDPSN_ID                   /*수정자ID*/
          FROM SSP_APP.TB_CO_ATFL_DTLS A
         WHERE 1=1
           AND A.DOC_REG_ID = #{DOC_REG_ID}
        ]]>
    </select>
    
    <select id="selectOnlyPrdSalsDsgnSalsprc" parameterType="HashMap" resultType="HashMap">
    	/* OnlyPrdPrcMngDao.selectOnlyPrdSalsDsgnSalsprc 전용상품 영업지정가 상세조회 */
   		SELECT A.CO_CD                                                                           /*회사코드*/
			    ,CASE WHEN C.BZPLC_ID IS NULL 
                       THEN #{BZPLC_ID} 
                      ELSE C.BZPLC_ID
                 END BZPLC_ID                                                                       /*사업장ID*/
                ,CASE WHEN C.BZPLC_ID IS NULL 
                       THEN ( SELECT BZPLC_NM FROM TB_CC_BZPLC_BASIS WHERE BZPLC_ID = #{BZPLC_ID} )
                       ELSE ( SELECT BZPLC_NM FROM TB_CC_BZPLC_BASIS WHERE BZPLC_ID = C.BZPLC_ID )
                 END  BZPLC_NM     /*사업장명*/
			    ,A.PRD_ID                                                                         /*상품ID*/
			    ,TO_NUMBER(A.PRD_ID)               AS  PRD_ID_VIEW                                /*상품ID_VIEW*/
                ,A.PRD_NM                                                                         /*상품명*/
                ,A.MNFR_NO                                                                        /*제조원NO*/
                ,E.MNFR_NM                                                                        /*제조원명*/
                ,A.ORGPLC_CTRY_CD                                                                 /*원산지코드*/
                ,J.CTRY_NM AS CTRY_NM                                                             /*원산지명*/
			    ,C.SALS_DSGN_SALSPRC                                                              /*영업지정판매가*/
			    ,C.SALS_DSGN_SALSPRC_STR_DTM                                                      /*영업지정판매가시작일시*/
			    ,C.SALS_DSGN_SALSPRC_END_DTM                                                      /*영업지정판매가종료일시*/
			    ,C.SALS_DSGN_SALSPRC_STR_DTM        AS OLD_SALS_DSGN_SALSPRC_STR_DTM              /*영업지정판매가시작일시*/
			    ,C.SALS_DSGN_SALSPRC_END_DTM        AS OLD_SALS_DSGN_SALSPRC_END_DTM              /*영업지정판매가종료일시*/
			    ,C.SALSPRC_DSGN_RSN                                                               /*판매가지정사유*/
			    ,C.SALS_SALSPRC_ATFL_ID                                                           /*영업판매가첨부파일ID*/
			    ,C.BSS_SALSPRC_USEYN                                                              /*기준판매가사용여부*/
                ,SSP_APP.FN_PR_ATTR_VAL_LIST(#{CO_CD},A.PRD_ID) ATTR_VAL                          /*대표규격*/
                ,D.ATFL_NM                                                                        /*파일명*/
                ,B.PRD_CLCD                                                                       /*카테고리CD*/
                ,FN_PR_FULL_CLSF_NM(#{CO_CD},B.PRD_CLCD) AS PRD_CLCD_NM                           /*카테고리명*/
                ,TRIM(TO_CHAR(A.BASIS_UNIT_QTY,'999,999,999,999,999'))
                               ||' '
                               ||A.BASIS_UNIT_CD
                               ||CASE WHEN A.BASIS_UNIT_QTY > 1
                                       AND A.SELL_UNIT_CD IS NOT NULL
                                       AND A.BASIS_UNIT_CD != A.SELL_UNIT_CD
                                      THEN '/'||A.SELL_UNIT_CD
                               END                                          AS SELL_UNIT_CD       /*주문단위*/
		        ,H.BSS_PCPRC AS LWST_BUY_PRC                                                      /*최저매입가*/
			    ,ROUND((1-(NVL(H.BSS_PCPRC,0)/(CASE WHEN BSS_SALSPRC_USEYN = 'Y' 
			                                  THEN H.SSP_BSS_SALSPRC 
			                                  ELSE C.SALS_DSGN_SALSPRC 
			                                  END)))*100,2) EXPT_PRFRT                                 /*예상매익률*/    
		        ,H.SSP_BSS_SALSPRC AS  BSS_SALSPRC                                                /*기준판매가*/
		        ,G.DISP_STATS_CHGRSN
		        ,G.RND_USCUST_DISP_STATS_CHGRSN
		        ,CASE WHEN G.PRD_ID IS NULL THEN '10' ELSE '20' END GB
		        ,SSP_APP.FN_PR_GET_SSP_PRD_NM(A.CO_CD, A.PRD_ID) SSP_PRD_NM                       /*SSP상품명*/
FROM TB_PR_MRO_PRD_INFO A
JOIN TB_PR_PRD_INFO B
  ON A.CO_CD = B.CO_CD
 AND A.PRD_ID = B.PRD_ID
 LEFT JOIN (SELECT A.CO_CD
                  ,A.BZPLC_ID
                  ,A.PRD_ID
                  ,A.SEQ
                  ,A.SALS_DSGN_SALSPRC
                  ,A.SALS_DSGN_SALSPRC_STR_DTM
                  ,A.SALS_DSGN_SALSPRC_END_DTM
                  ,A.SALSPRC_DSGN_RSN
                  ,A.SALS_SALSPRC_ATFL_ID
                  ,A.BSS_SALSPRC_USEYN
                  ,A.PRC_TASK_SPR_DESC
                  ,A.FST_HST_YN
                  ,A.REGPSN_ID
                  ,A.REG_DTM
                  ,A.UPDPSN_ID
                  ,A.UPD_DTM
            FROM (
                SELECT A.CO_CD
                      ,A.BZPLC_ID
                      ,A.PRD_ID
                      ,A.SEQ
                      ,A.SALS_DSGN_SALSPRC
                      ,A.SALS_DSGN_SALSPRC_STR_DTM
                      ,A.SALS_DSGN_SALSPRC_END_DTM
                      ,A.SALSPRC_DSGN_RSN
                      ,A.SALS_SALSPRC_ATFL_ID
                      ,A.BSS_SALSPRC_USEYN
                      ,A.PRC_TASK_SPR_DESC
                      ,A.FST_HST_YN
                      ,A.REGPSN_ID
                      ,A.REG_DTM
                      ,A.UPDPSN_ID
                      ,A.UPD_DTM
                      ,ROW_NUMBER() OVER (PARTITION BY A.CO_CD, A.BZPLC_ID, A.PRD_ID ORDER BY A.SEQ DESC) DTL_ORD
                  FROM TB_PC_SALS_DSGN_SALSPRC_HST A
                 WHERE A.CO_CD = #{CO_CD}
                   AND A.BZPLC_ID = #{BZPLC_ID}
                   AND A.PRD_ID = #{PRD_ID}) A
                WHERE DTL_ORD = 1
               ) C
    ON C.CO_CD = A.CO_CD
   AND C.PRD_ID = A.PRD_ID
LEFT JOIN TB_CO_ATFL_DTLS D
              ON D.DOC_REG_ID = C.SALS_SALSPRC_ATFL_ID  
LEFT OUTER JOIN TB_PR_MNFR_INFO E --제조원
			    ON E.CO_CD = A.CO_CD AND E.MNFR_NO = A.MNFR_NO
			LEFT OUTER JOIN (SELECT CO_CD 
                                 ,PRD_ID
                                 ,BZPLC_ID 
                                 ,DISP_STATS_CHGRSN 
                                 ,RND_USCUST_DISP_STATS_CHGRSN
                                 ,OLD_RND_USCUST_DISP_STATS_CHGRSN
                          FROM (
		                          SELECT CO_CD 
		                                 ,PRD_ID
		                                 ,BZPLC_ID 
		                                 ,MIN(DISP_STATS_CHGRSN) AS DISP_STATS_CHGRSN
		                                 ,MIN(RND_USCUST_DISP_STATS_CHGRSN) AS RND_USCUST_DISP_STATS_CHGRSN 
		                                 ,MIN(RND_USCUST_DISP_STATS_CHGRSN) AS OLD_RND_USCUST_DISP_STATS_CHGRSN
		                          FROM SSP_APP.TB_DP_PRD_DISP_STATS_INFO 
		                         WHERE CO_CD = #{CO_CD}
		                           AND BZPLC_ID = #{BZPLC_ID}
		                           AND PRD_ID = #{PRD_ID}
		                           GROUP BY CO_CD 
		                                    ,PRD_ID
		                                    ,BZPLC_ID 
                                 )
                           ) G
                    ON G.CO_CD = C.CO_CD
                   AND G.PRD_ID = C.PRD_ID
                   AND G.BZPLC_ID = C.BZPLC_ID    
            LEFT OUTER JOIN TB_CO_CTRY_INFO J -- 국가
			    ON J.CO_CD = A.CO_CD AND J.CTRY_SPR_CD = A.ORGPLC_CTRY_CD   
             LEFT OUTER JOIN TB_PC_PRD_PRC_HST H --가격정보
			    ON H.CO_CD = A.CO_CD AND H.PRD_ID = A.PRD_ID AND H.BZPLC_ID = '*' AND C.SALS_DSGN_SALSPRC_STR_DTM BETWEEN H.BSS_SALSPRC_STR_DTM AND H.BSS_SALSPRC_END_DTM     
			WHERE A.CO_CD = #{CO_CD}
			  AND A.PRD_ID = #{PRD_ID}
    </select>
    
    <select id="selectOnlyPrdSalsDsgnSalsprcHst" parameterType="HashMap" resultType="HashMap">
    	/* OnlyPrdPrcMngDao.selectOnlyPrdSalsDsgnSalsprcHst 전용상품 영업지정가 이력조회 */
    	WITH BASE_B As
        (
            SELECT
                     B.CO_CD
                    ,B.BZPLC_ID
                    ,B.PRD_ID
                    ,B.SEQ
                    ,B.SALS_DSGN_SALSPRC
                    ,B.SALS_DSGN_SALSPRC_STR_DTM
                    ,B.SALS_DSGN_SALSPRC_END_DTM
                    ,B.BSS_SALSPRC_USEYN
                    ,B.FST_HST_YN
                    ,CASE WHEN B.UPDPSN_ID IS NULL THEN B.REGPSN_ID ELSE B.UPDPSN_ID END AS UPDPSN_ID
                    ,CASE WHEN B.UPD_DTM IS NULL THEN B.REG_DTM ELSE B.UPD_DTM END UPD_DTM
            FROM    TB_PC_SALS_DSGN_SALSPRC_HST B
            WHERE   B.CO_CD = #{CO_CD}
            AND     B.PRD_ID = #{PRD_ID}
            AND     B.BZPLC_ID = #{BZPLC_ID}
        )
        SELECT   T1.CO_CD
                ,T1.BZPLC_ID
                ,T1.PRD_ID
                ,T1.SEQ
                ,T1.RNUM
                ,T1.CAL_STD
                ,T1.CAL_STD_NM
                ,T1.SALS_DSGN_SALSPRC
                ,T1.CURR_UNIT_CD
                ,T1.MIN_BUY_PRC              AS LWST_BUY_PRC
                ,case when T1.SALS_DSGN_SALSPRC = 0 then 0
                  else 100*trunc(1 - T1.MIN_BUY_PRC/T1.SALS_DSGN_SALSPRC,4) end AS EXPT_PRFRT
                ,TO_CHAR(TO_DATE(T1.SALS_DSGN_SALSPRC_STR_DTM,'YYYYMMDDHH24MISS'),'YYYY-MM-DD HH24:MI:SS') AS SALS_DSGN_SALSPRC_STR_DTM
                ,TO_CHAR(TO_DATE(T1.SALS_DSGN_SALSPRC_END_DTM,'YYYYMMDDHH24MISS'),'YYYY-MM-DD HH24:MI:SS') AS SALS_DSGN_SALSPRC_END_DTM
                ,T1.UPDPSN_ID
                ,T1.UPDPSN_NM
                ,T1.UPD_DTM
        FROM    (
                SELECT   T1.CO_CD
                        ,T1.BZPLC_ID
                        ,T1.PRD_ID
                        ,T1.SEQ
                        ,Row_Number() over(order by T1.SALS_DSGN_SALSPRC_STR_DTM) RNUM
                        ,CASE WHEN T1.BSS_SALSPRC_USEYN = 'Y' THEN '1' ELSE '2' END      CAL_STD
                        ,CASE WHEN T1.BSS_SALSPRC_USEYN = 'Y' THEN '기준판매가' ELSE '영업지정판매가' END CAL_STD_NM
                        ,CASE WHEN T1.BSS_SALSPRC_USEYN = 'Y' THEN T2.SSP_BSS_SALSPRC ELSE T1.SALS_DSGN_SALSPRC END SALS_DSGN_SALSPRC
                        ,nvl(T2.BSS_SALSPRC_CURR_UNIT_CD,'KRW') CURR_UNIT_CD
                        ,FN_PC_MIN_BUY_PRC(T1.CO_CD,T1.PRD_ID) MIN_BUY_PRC
                        ,T1.SALS_DSGN_SALSPRC_STR_DTM
                        ,T1.SALS_DSGN_SALSPRC_END_DTM
                        ,T1.BSS_SALSPRC_USEYN
                        ,T1.FST_HST_YN
                        ,T1.UPDPSN_ID
                        ,(SELECT OPRTR_NM FROM SSP_APP.TB_CO_MBR_OPRTR_INFO WHERE OPRTR_ID = T1.UPDPSN_ID ) AS UPDPSN_NM
                        ,T1.UPD_DTM
                FROM    BASE_B              T1
                        LEFT JOIN
                        TB_PC_PRD_PRC_HST   T2
                        ON  T2.CO_CD = #{CO_CD}
                        AND T2.PRD_ID = #{PRD_ID}
                        AND T2.BZPLC_ID = '*'
                        AND T1.SALS_DSGN_SALSPRC_STR_DTM BETWEEN T2.BSS_SALSPRC_STR_DTM AND T2.BSS_SALSPRC_END_DTM
                        AND T1.BSS_SALSPRC_USEYN = 'Y'
                )       T1
        ORDER BY T1.SALS_DSGN_SALSPRC_STR_DTM DESC
    </select>

	<delete id="deleteOnlyPrdSalsDsgnSalsprcMngHst" parameterType="HashMap">
		/* OnlyPrdPrcMngDao.deleteOnlyPrdSalsDsgnSalsprcMngHst | 전용상품 영업지정판매가 일자 변경시 이력삭제 */
		DELETE FROM TB_PC_SALS_DSGN_SALSPRC_HST
		WHERE CO_CD = #{CO_CD}
		AND BZPLC_ID = #{BZPLC_ID}
		AND PRD_ID = #{PRD_ID}
		<![CDATA[
		AND (
		    (
		        SALS_DSGN_SALSPRC_STR_DTM >= #{SALS_DSGN_SALSPRC_STR_DTM}
		        AND '99991231235959' = #{SALS_DSGN_SALSPRC_END_DTM}
		    )
			OR (
			    SALS_DSGN_SALSPRC_STR_DTM >= #{SALS_DSGN_SALSPRC_STR_DTM}
			    AND SALS_DSGN_SALSPRC_END_DTM <= #{SALS_DSGN_SALSPRC_END_DTM}
			)
		)
		]]>
	</delete>

	<update id="updateOnlyPrdSalsDsgnSalsprcMngHst" parameterType="HashMap">
		/* OnlyPrdPrcMngDao.updateOnlyPrdSalsDsgnSalsprcMngHst 전용상품 영업지정판매가 일자 변경시 이력 업데이트 */
    	<![CDATA[
		UPDATE TB_PC_SALS_DSGN_SALSPRC_HST
		SET
			SALS_DSGN_SALSPRC_STR_DTM =
				CASE
					WHEN #{SALS_DSGN_SALSPRC_END_DTM} <> '99991231235959'
						AND #{SALS_DSGN_SALSPRC_STR_DTM} < SALS_DSGN_SALSPRC_STR_DTM
						AND #{SALS_DSGN_SALSPRC_END_DTM} < SALS_DSGN_SALSPRC_END_DTM
					    THEN TO_CHAR(TO_DATE(#{SALS_DSGN_SALSPRC_END_DTM}, 'YYYYMMDDHH24MISS') + 1 / (24 * 60 * 60), 'YYYYMMDDHH24MISS')
					WHEN #{SALS_DSGN_SALSPRC_END_DTM} <> '99991231235959'
						AND #{SALS_DSGN_SALSPRC_STR_DTM} < SALS_DSGN_SALSPRC_STR_DTM
						AND #{SALS_DSGN_SALSPRC_END_DTM} > SALS_DSGN_SALSPRC_END_DTM
						THEN #{SALS_DSGN_SALSPRC_STR_DTM}
					ELSE SALS_DSGN_SALSPRC_STR_DTM
				END
			, SALS_DSGN_SALSPRC_END_DTM =
				CASE
					WHEN #{SALS_DSGN_SALSPRC_END_DTM} = '99991231235959'
					    THEN TO_CHAR(TO_DATE(#{SALS_DSGN_SALSPRC_STR_DTM}, 'YYYYMMDDHH24MISS') - 1 / (24 * 60 * 60), 'YYYYMMDDHH24MISS')
					WHEN #{SALS_DSGN_SALSPRC_END_DTM} <> '99991231235959'
						AND #{SALS_DSGN_SALSPRC_END_DTM} >= SALS_DSGN_SALSPRC_END_DTM
						AND SALS_DSGN_SALSPRC_STR_DTM < #{SALS_DSGN_SALSPRC_STR_DTM}
						THEN TO_CHAR(TO_DATE(#{SALS_DSGN_SALSPRC_STR_DTM}, 'YYYYMMDDHH24MISS') - 1 / (24 * 60 * 60), 'YYYYMMDDHH24MISS')
					WHEN #{SALS_DSGN_SALSPRC_END_DTM} <> '99991231235959'
						AND #{SALS_DSGN_SALSPRC_END_DTM} > SALS_DSGN_SALSPRC_END_DTM
						AND SALS_DSGN_SALSPRC_STR_DTM > #{SALS_DSGN_SALSPRC_STR_DTM}
						THEN #{SALS_DSGN_SALSPRC_END_DTM}
					WHEN #{SALS_DSGN_SALSPRC_END_DTM} <> '99991231235959'
						AND #{SALS_DSGN_SALSPRC_END_DTM} < SALS_DSGN_SALSPRC_END_DTM
						AND SALS_DSGN_SALSPRC_STR_DTM < #{SALS_DSGN_SALSPRC_STR_DTM}
						THEN TO_CHAR(TO_DATE(#{SALS_DSGN_SALSPRC_STR_DTM}, 'YYYYMMDDHH24MISS') - 1 / (24 * 60 * 60), 'YYYYMMDDHH24MISS')
					ELSE SALS_DSGN_SALSPRC_END_DTM
				END
		  , UPD_DTM = SYSDATE
		  , UPDPSN_ID = #{SESSION_OPRTR_ID}
		WHERE CO_CD = #{CO_CD}
		AND BZPLC_ID = #{BZPLC_ID}
		AND PRD_ID = #{PRD_ID}
		AND (
		    SALS_DSGN_SALSPRC_STR_DTM BETWEEN #{SALS_DSGN_SALSPRC_STR_DTM} AND #{SALS_DSGN_SALSPRC_END_DTM}
			OR SALS_DSGN_SALSPRC_END_DTM BETWEEN #{SALS_DSGN_SALSPRC_STR_DTM} AND #{SALS_DSGN_SALSPRC_END_DTM}
			OR (
			    SALS_DSGN_SALSPRC_STR_DTM < #{SALS_DSGN_SALSPRC_STR_DTM}
			    AND SALS_DSGN_SALSPRC_END_DTM > #{SALS_DSGN_SALSPRC_END_DTM}
			)
		)
		]]>
	</update>

	<update id="updateOnlyPrdSalsDsgnSalsprcMngHst2" parameterType="HashMap">
		/* OnlyPrdPrcMngDao.updateOnlyPrdSalsDsgnSalsprcMngHst2 전용상품 영업지정판매가 일자 미변경시 이력 업데이트 */
		UPDATE TB_PC_SALS_DSGN_SALSPRC_HST
		SET
			SALSPRC_DSGN_RSN = #{SALSPRC_DSGN_RSN}
			, SALS_SALSPRC_ATFL_ID = #{SALS_SALSPRC_ATFL_ID}
			<if test='BSS_SALSPRC_USEYN == "N"'>
				, SALS_DSGN_SALSPRC = #{SALS_DSGN_SALSPRC}
			</if>
			, BSS_SALSPRC_USEYN = #{BSS_SALSPRC_USEYN}
			, UPD_DTM = SYSDATE
			, UPDPSN_ID = #{SESSION_OPRTR_ID}
		WHERE CO_CD = #{CO_CD}
		AND BZPLC_ID = #{BZPLC_ID}
		AND PRD_ID = #{PRD_ID}
		AND SALS_DSGN_SALSPRC_STR_DTM = #{SALS_DSGN_SALSPRC_STR_DTM}
		AND SALS_DSGN_SALSPRC_END_DTM = #{SALS_DSGN_SALSPRC_END_DTM}
	</update>
    
    <update id="updateOnlyPrdDispStatsInfo" parameterType="HashMap">
    	/* OnlyPrdPrcMngDao.updateOnlyPrdDispStatsInfo 전용상품가격관리 상세(진열상태) 저장 */ 
    	UPDATE SSP_APP.TB_DP_PRD_DISP_STATS_INFO 
		   SET DISP_STATS_CD = #{DISP_STATS_CD}
		       ,DISP_STATS_CHGRSN = #{DISP_STATS_CHGRSN}
		       ,RND_USCUST_DISP_STATS_CHGRSN = #{RND_USCUST_DISP_STATS_CHGRSN}
		       ,UPD_DTM = SYSDATE
		       ,UPDPSN_ID = #{SESSION_OPRTR_ID}
		 WHERE CO_CD = #{CO_CD}
		   AND PRD_ID = #{PRD_ID}
		   AND BZPLC_ID = #{BZPLC_ID} 
		   AND OPR_UNIT_ID = #{OPR_UNIT_ID}
    </update>
    
    <select id="selectPrcList" parameterType="HashMap" resultType="HashMap">
    	/* OnlyPrdPrcMngDao.selectPrcList 전용상품가격관리 상세(구매정보) 조회  */
    	<![CDATA[
        SELECT CPRTCP_ID --협력사ID
		       ,CPRTCP_ID_VIEW --협력사ID
		       ,CPRTCP_KOR_NM --협력사
		       ,CURR_UNIT_CD --매입통화
		       ,SPL_PSB_YN  --공급가능여부
		       ,SPL_PSB_YN_NM --공급가능여부
		       ,MIN_ODR_QTY --최소주문수량
		       ,PRD_ID --상품ID
		       ,INTG_CPRTCP_YN --통합협력사여부
		       ,VLD_STR_DT--가격유효 시작날짜
		       ,VLD_END_DT--가격유효 마지막날짜
		       ,DATE_YN
		       ,PRD_PRC
		       ,EXCHRT_PRD_PRC 
          FROM (
            SELECT
                C.CPRTCP_ID, --협력사ID
                TO_NUMBER(C.CPRTCP_ID) AS CPRTCP_ID_VIEW, --협력사ID
                C.CPRTCP_KOR_NM, --협력사
                A.CURR_UNIT_CD, --매입통화
                B.SPL_PSB_YN, --공급가능여부
                CASE WHEN B.SPL_PSB_YN IS NULL OR B.SPL_PSB_YN = 'N' THEN '불가' ELSE '가능' END SPL_PSB_YN_NM, --공급가능여부
                B.MIN_ODR_QTY, --최소주문수량
                A.PRD_ID, --상품ID
                'N' AS INTG_CPRTCP_YN, --통합협력사여부
                A.VLD_STR_DT,--가격유효 시작날짜
                A.VLD_END_DT,--가격유효 마지막날짜
                CASE WHEN TO_CHAR(SYSDATE,'YYYYMMDD') > VLD_STR_DT AND TO_CHAR(SYSDATE,'YYYYMMDD') <  = VLD_END_DT THEN 'Y' ELSE 'N' END AS DATE_YN,
                PRD_PRC,
                CASE WHEN A.CURR_UNIT_CD = 'KRW' THEN A.PRD_PRC ELSE FN_PC_DETR_INFO(A.PRD_PRC * NVL(D.CONV_EXCHRT,1) / NVL(D.STR_RT,1)) END  AS EXCHRT_PRD_PRC,
                ROW_NUMBER() OVER (
                                    PARTITION BY A.CO_CD
                                               , A.PRD_ID
                                               , A.CPRTCP_ID
                                        ORDER BY A.PRD_PRC_SEQ DESC
                                   )                               AS TB_PC_CPRTCP_PRD_PRC_INFO_ORDER
            FROM TB_PC_CPRTCP_PRD_PRC_INFO A
            INNER JOIN TB_PC_CPRTCP_PRD_INFO B
            ON A.CO_CD = B.CO_CD
                AND A.CPRTCP_ID = B.CPRTCP_ID
                AND A.PRD_ID = B.PRD_ID
                AND A.CURR_UNIT_CD = B.ORD_CURR_CD
            LEFT OUTER JOIN TB_CP_CPRTCP_BASIS C
                ON C.CO_CD = A.CO_CD
                AND C.CPRTCP_ID = B.CPRTCP_ID
            LEFT OUTER JOIN (
                SELECT CO_CD, BSS_YM, CURR_UNIT_CD, CONV_EXCHRT,STR_RT
                FROM TB_CO_EXCHRT_INFO
                WHERE BSS_YM = (SELECT  MAX(T2.BSS_YM)
                    FROM    TB_CO_EXCHRT_INFO   T2
                    WHERE  T2.CO_CD = #{CO_CD}
                      AND  TO_CHAR(SYSDATE,'YYYYMM') >= BSS_YM)
            )D
                ON D.CO_CD = A.CO_CD
                AND D.CURR_UNIT_CD = A.CURR_UNIT_CD
            WHERE A.CO_CD = #{CO_CD}
            AND A.PRD_ID = #{PRD_ID}
        ]]>
        )
        WHERE TB_PC_CPRTCP_PRD_PRC_INFO_ORDER = 1
        ORDER BY DATE_YN DESC,SPL_PSB_YN DESC,INTG_CPRTCP_YN DESC,EXCHRT_PRD_PRC,MIN_ODR_QTY,VLD_END_DT DESC
    </select>
    
    <select id="selectCatgAttrInfo" parameterType="HashMap" resultType="HashMap">
        /* OnlyPrdPrcMngDao.selectCatgAttrInfo 카테고리속성정보 조회 */
        <![CDATA[
            SELECT A.CO_CD                                AS CO_CD                /*회사코드*/
                 , B.PRD_ID                               AS PRD_ID               /*상품코드*/
                 , A.PRD_CLCD                             AS PRD_CLCD             /*상품분류코드*/
                 , C.PRD_ATTR_CD                          AS PRD_ATTR_CD          /*속성코드*/
                 , C.PRNM                                 AS PRNM                 /*속성명*/
                 , D.PRVL                                 AS PRVL                 /*속성값*/
                 , NVL(A.MAND_YN,'N')                     AS MAND_YN              /*필수항목여부*/
                 , DECODE(A.PRD_CLCD,#{PRD_CLCD},'1','0') AS CHK_YN
                 , NVL(SRT.EXPS_YN, 'Y') EXPS_YN
              FROM SSP_APP.TB_PR_PRD_CLSF_ATTR_MAPP A
              LEFT JOIN SSP_APP.TB_PR_PRD_INFO B
                ON 1=1
               AND B.CO_CD    = A.CO_CD
               AND B.PRD_CLCD = A.PRD_CLCD
               AND B.PRD_ID   = LPAD(#{PRD_ID},18,0)
              LEFT JOIN SSP_APP.TB_PR_PRD_ATTR_INFO C
                ON 1=1
               AND C.CO_CD       = A.CO_CD
               AND C.PRD_ATTR_CD = A.PRD_ATTR_CD
               AND C.USE_YN      = 'Y'
              LEFT JOIN SSP_APP.TB_PR_PRD_INFO_ATTR_MAPP D
                ON 1=1
               AND D.CO_CD       = C.CO_CD
               AND D.PRD_ID      = B.PRD_ID
               AND D.PRD_ATTR_CD = C.PRD_ATTR_CD
              LEFT JOIN SSP_APP.TB_PR_PRD_CLSF_ATTR_SRT_INFO SRT
	            ON 1=1 
	           AND SRT.CO_CD = A.CO_CD 
	           AND SRT.PRD_CLCD = A.PRD_CLCD 
	           AND SRT.INTG_ATTR_CD = A.PRD_ATTR_CD
             WHERE 1=1
               AND A.CO_CD    = #{CO_CD}
               AND A.PRD_CLCD IN(#{OLD_PRD_CLCD},#{PRD_CLCD})
             ORDER BY DECODE(A.PRD_CLCD,#{PRD_CLCD},'1','2')
                    , NVL(SRT.SRT_SO, A.SRT_SO)
        ]]>
    </select>
    <select id="selectOnlyPrdPrcMngDupl" parameterType="HashMap" resultType="Integer">
    	    /* OnlyPrdPrcMngDao.selectOnlyPrdPrcMngDupl 전용상품 기등록 여부 */
    		SELECT COUNT(1) AS CNT
			FROM TB_PC_SALS_DSGN_SALSPRC_HST
			WHERE CO_CD = #{CO_CD}
			  AND BZPLC_ID = #{BZPLC_ID}
			  AND PRD_ID = #{PRD_ID}
    </select>
    
    <insert id="insertPrdPrcHst" parameterType="HashMap" >
    		/* OnlyPrdPrcMngDao.insertPrdPrcHst 전용상품 기준판매가 등록 */
    	INSERT INTO TB_PC_PRD_PRC_HST
               (CO_CD
		       ,BZPLC_ID
		       ,PRD_ID
		       ,SEQ
		       ,BSS_PCPRC
		       ,PLN_PRFRT
		       ,STPRC
		       ,DSTRB_STD_PRC
		       ,MRK_LWST_SALSPRC
		       ,INTL_LWST_SALSPRC
		       ,PURG_DSGN_SALSPRC
		       ,SSP_CURR_BSS_SALSPRC
		       ,BSS_SALSPRC_CURR_UNIT_CD
		       ,EXCHRT_APLY_YM
		       ,SSP_BSS_SALSPRC
		       ,BSS_SALSPRC_STR_DTM
		       ,BSS_SALSPRC_END_DTM
		       ,SALSPRC_CAL_BSS_CD
		       ,REGPSN_ID
		       ,REG_DTM
		       ,UPDPSN_ID 
		       ,UPD_DTM )
		SELECT CO_CD
		       ,BZPLC_ID
		       ,PRD_ID
		       ,FN_PC_HIST_SEQ_CRT('PRD_PRC_HST') AS SEQ
		       ,BSS_PCPRC
		       ,PLN_PRFRT
		       ,STPRC
		       ,DSTRB_STD_PRC
		       ,MRK_LWST_SALSPRC
		       ,INTL_LWST_SALSPRC
		       ,PURG_DSGN_SALSPRC
		       ,SSP_CURR_BSS_SALSPRC
		       ,BSS_SALSPRC_CURR_UNIT_CD
		       ,EXCHRT_APLY_YM
		       ,#{SSP_BSS_SALSPRC}
		       ,SUBSTR(#{BSS_SALSPRC_STR_DTM},1,8) || '000000'
		       ,SUBSTR(#{BSS_SALSPRC_END_DTM},1,8) || '235959'
		       ,SALSPRC_CAL_BSS_CD
		       ,REGPSN_ID
		       ,SYSDATE AS REG_DTM
		       ,UPDPSN_ID 
		       ,SYSDATE AS UPD_DTM
		FROM TB_PC_PRD_PRC_HST
	   WHERE CO_CD = #{CO_CD} 
		 AND PRD_ID = #{PRD_ID}
		 AND BZPLC_ID = #{BZPLC_ID}
		 AND SEQ = #{SEQ}
    </insert>

    <select id="selectNewPrdReqInfo" parameterType="HashMap" resultType="HashMap">
        SELECT CO_CD
              ,NEW_PRD_REQ_NO
              ,ESTM_REQ_NO
          FROM (
              SELECT ROW_NUMBER() OVER (PARTITION BY A.CO_CD, A.NEW_PRD_REQ_NO ORDER BY B.SEQ DESC) RN
                    ,A.CO_CD
                    ,A.NEW_PRD_REQ_NO
                    ,A.ESTM_REQ_NO
                    ,B.NEW_PRD_REQ_STATS_CD
                FROM TB_PR_NEW_PRD_REQ_PROC A
                LEFT JOIN TB_PR_NEW_PRD_REQ_STATS_DTLS B
                 ON( A.CO_CD = B.CO_CD AND A.NEW_PRD_REQ_NO = B.NEW_PRD_REQ_NO )
               WHERE A.MALL_SPR_CD = '20'
                 AND MRO_DUP_PRD_ID IS NULL
                 AND MRO_PRD_ID IS NULL
                 AND PRPS_PRD_ID IS NULL
                 AND A.RND_REQ_PRD_ID = LPAD(#{PRD_ID},18,'0')
          )
         WHERE RN = 1
           AND NEW_PRD_REQ_STATS_CD = '29'
    </select>

	<select id="selectNewPrdReqStatsCount" parameterType="HashMap" resultType="Integer">
		/* OnlyPrdPrcMng.selectNewPrdReqStatsCount | 신규상품요청처리 조회 */
		SELECT COUNT(1)				 
		FROM (	
				SELECT A.NEW_PRD_REQ_NO	 				
						, B.NEW_PRD_REQ_STATS_CD 
						, ROW_NUMBER() OVER (PARTITION BY A.CO_CD, A.NEW_PRD_REQ_NO ORDER BY B.SEQ DESC) AS RN
				FROM TB_PR_NEW_PRD_REQ_PROC A
				INNER JOIN TB_PR_NEW_PRD_REQ_STATS_DTLS B 
				ON B.NEW_PRD_REQ_NO = A.NEW_PRD_REQ_NO 
				WHERE A.CO_CD = #{CO_CD}
				AND A.NEW_PRD_REQ_NO = #{NEW_PRD_REQ_NO}
				AND A.RND_REQ_PRD_ID = LPAD(#{PRD_ID}, 18, '0')
				AND A.PRD_PRPS_SPR_CD IS NULL
				AND A.PRPS_PRD_ID IS NULL
			) Z
		WHERE Z.RN <![CDATA[<]]> 2
		AND Z.NEW_PRD_REQ_STATS_CD = '29'		
	</select>

	<insert id="insertNewPrdReqStats" parameterType="HashMap">
		/* OnlyPrdPrcMng.insertNewPrdReqStats | 신규상품 상태 등록 */
		INSERT INTO TB_PR_NEW_PRD_REQ_STATS_DTLS (
			CO_CD
			, NEW_PRD_REQ_NO
			, SEQ
			, NEW_PRD_REQ_STATS_CD
			, MALL_SPR_CD
			, REGPSN_ID
			, REG_DTM
			, UPDPSN_ID
			, UPD_DTM
		) VALUES (
			#{CO_CD}
			, #{NEW_PRD_REQ_NO}
			, (
				SELECT MAX(SEQ) + 1
				FROM TB_PR_NEW_PRD_REQ_STATS_DTLS
				WHERE CO_CD = #{CO_CD}
				AND NEW_PRD_REQ_NO = #{NEW_PRD_REQ_NO}
			)
			, #{NEW_PRD_REQ_STATS_CD}
			, '20'
			, #{SESSION_OPRTR_ID}
			, SYSDATE
			, #{SESSION_OPRTR_ID}
			, SYSDATE
		)
	</insert>
	
	<!-- <select id = "selectPrdPrpsSprCd" parameterType="HashMap" resultType= "String">
		/* OnlyPrdPrcMng.selectPrdPrpsSprCd | 상품요청구분코드 조회*/
		SELECT PRD_PRPS_SPR_CD 
		FROM TB_PR_NEW_PRD_REQ_PROC 
		WHERE NEW_PRD_REQ_NO =#{NEW_PRD_REQ_NO}
	</select> -->
	
</mapper>
