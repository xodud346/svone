<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="RdCommInit">
   <!--
    ******************************************************************************
    * SELECT    : R&D공통쿼리
    * 작성자    :
    * 작성 일자 : 2022.04.14
    ******************************************************************************
    -->

	<select id="selectCommInitListT" parameterType="HashMap" resultType="HashMap">
		/* RdCommInit.selectCommInitListT 공통코드 조회(전체) */
		<![CDATA[
			SELECT LANG_CD
			     , COM_CLSF_CD
			   	 , COM_DTL_CD
			   	 , COM_DTL_CD_NM
			   	 , COM_USR_DEFN_NM_1
			   	 , COM_USR_DEFN_NM_2
			   	 , COM_USR_DEFN_NM_3
			   	 , COM_USR_DEFN_NM_4
			   	 , COM_USR_DEFN_NM_5
			   	 , SRT_SO
			   	 , USE_YN
			  FROM SSP_APP.TB_CO_COM_CD_DTL
	         WHERE 1=1
		       AND LANG_CD     = #{langCd}
		       AND COM_CLSF_CD = #{code}
		       AND USE_YN      = 'Y'
	    	 UNION ALL
			SELECT #{langCd} AS LANG_CD
			     , ''        AS COM_CLSF_CD
			  	 , ''        AS COM_DTL_CD
			     , '전체'    AS COM_DTL_CD_NM
			     , ''        AS COM_USR_DEFN_NM_1
			     , ''        AS COM_USR_DEFN_NM_2
			     , ''        AS COM_USR_DEFN_NM_3
			     , ''        AS COM_USR_DEFN_NM_4
			     , ''        AS COM_USR_DEFN_NM_5
			     , 0         AS SRT_SO
			     , ''        AS USE_YN
			  FROM DUAL
			 WHERE 1=1
		     ORDER BY SRT_SO
			        , COM_DTL_CD
		]]>
	</select>

	<select id="selectCommInitListS" parameterType="HashMap" resultType="HashMap">
		/* RdCommInit.selectCommInitListS 공통코드 조회(선택) */
		<![CDATA[
			SELECT LANG_CD
			     , COM_CLSF_CD
			   	 , COM_DTL_CD
			   	 , COM_DTL_CD_NM
			   	 , COM_USR_DEFN_NM_1
			   	 , COM_USR_DEFN_NM_2
			   	 , COM_USR_DEFN_NM_3
			   	 , COM_USR_DEFN_NM_4
			   	 , COM_USR_DEFN_NM_5
			   	 , SRT_SO
			   	 , USE_YN
			  FROM SSP_APP.TB_CO_COM_CD_DTL
	         WHERE 1=1
		       AND LANG_CD     = #{langCd}
		       AND COM_CLSF_CD = #{code}
		       AND USE_YN      = 'Y'
	    	 UNION ALL
			SELECT #{langCd} AS LANG_CD
			     , ''        AS COM_CLSF_CD
			  	 , ''        AS COM_DTL_CD
			     , '선택'    AS COM_DTL_CD_NM
			     , ''        AS COM_USR_DEFN_NM_1
			     , ''        AS COM_USR_DEFN_NM_2
			     , ''        AS COM_USR_DEFN_NM_3
			     , ''        AS COM_USR_DEFN_NM_4
			     , ''        AS COM_USR_DEFN_NM_5
			     , 0         AS SRT_SO
			     , ''        AS USE_YN
			  FROM DUAL
			 WHERE 1=1
		     ORDER BY SRT_SO
			        , COM_DTL_CD
		]]>
	</select>

	<select id="selectCommInitListN" parameterType="HashMap" resultType="HashMap">
		/* RdCommInit.selectCommInitListN 공통코드 조회(공백) */
		<![CDATA[
			SELECT LANG_CD
			     , COM_CLSF_CD
			   	 , COM_DTL_CD
			   	 , COM_DTL_CD_NM
			   	 , COM_USR_DEFN_NM_1
			   	 , COM_USR_DEFN_NM_2
			   	 , COM_USR_DEFN_NM_3
			   	 , COM_USR_DEFN_NM_4
			   	 , COM_USR_DEFN_NM_5
			   	 , SRT_SO
			   	 , USE_YN
			  FROM SSP_APP.TB_CO_COM_CD_DTL
	         WHERE 1=1
		       AND LANG_CD     = #{langCd}
		       AND COM_CLSF_CD = #{code}
		       AND USE_YN      = 'Y'
	    	 UNION ALL
			SELECT #{langCd} AS LANG_CD
			     , ''        AS COM_CLSF_CD
			  	 , ''        AS COM_DTL_CD
			     , ''        AS COM_DTL_CD_NM
			     , ''        AS COM_USR_DEFN_NM_1
			     , ''        AS COM_USR_DEFN_NM_2
			     , ''        AS COM_USR_DEFN_NM_3
			     , ''        AS COM_USR_DEFN_NM_4
			     , ''        AS COM_USR_DEFN_NM_5
			     , 0         AS SRT_SO
			     , ''        AS USE_YN
			  FROM DUAL
			 WHERE 1=1
		     ORDER BY SRT_SO
			        , COM_DTL_CD
		]]>
	</select>

	<select id="selectCommInitListX" parameterType="HashMap" resultType="HashMap">
		/* RdCommInit.selectCommInitListX 공통코드 조회(없음) */
		<![CDATA[
			SELECT LANG_CD
			     , COM_CLSF_CD
			   	 , COM_DTL_CD
			   	 , COM_DTL_CD_NM
			   	 , COM_USR_DEFN_NM_1
			   	 , COM_USR_DEFN_NM_2
			   	 , COM_USR_DEFN_NM_3
			   	 , COM_USR_DEFN_NM_4
			   	 , COM_USR_DEFN_NM_5
			   	 , SRT_SO
			   	 , USE_YN
			  FROM SSP_APP.TB_CO_COM_CD_DTL
	         WHERE 1=1
		       AND LANG_CD     = #{langCd}
		       AND COM_CLSF_CD = #{code}
		       AND USE_YN      = 'Y'
		     ORDER BY SRT_SO
			        , COM_DTL_CD
		]]>
	</select>

	<select id="selectRndPrdAuthInq" parameterType="HashMap" resultType="HashMap">
		/* RdCommInit.selectRndPrdAuthInq RND상품권한조회 */
		<![CDATA[
            SELECT MAX(A1.PRD_CLSF_CHRPSN_ID)     AS PRD_CLSF_CHRPSN_ID     /*담당자ID*/
                 , MAX(A1.PRD_CLSF_CHRPSN_TP_CD)  AS PRD_CLSF_CHRPSN_TP_CD  /*상품분류담당자유형코드[10:상품담당자,20:MD담당자,30:RND구매담당자]*/
                 , MAX(A1.PRD_CLSF_CHRPSN_NM)     AS PRD_CLSF_CHRPSN_NM     /*상품분류담당자유형명*/
                 , MAX(A1.PRD_CLSF_CHRPSN_SPR_CD) AS PRD_CLSF_CHRPSN_SPR_CD /*상품분류담당자구분코드[10:정,20:부]*/
                 , MAX(A1.PRD_CLSF_CHRPSN_SPR_NM) AS PRD_CLSF_CHRPSN_SPR_NM /*상품분류담당자구분명*/
                 , MAX(A1.SALS_CHRPSN_YN)         AS SALS_CHRPSN_YN         /*영엽담당자여부*/
              FROM (
                    SELECT A.PRD_CLSF_CHRPSN_ID                              AS PRD_CLSF_CHRPSN_ID
                         , A.PRD_CLSF_CHRPSN_TP_CD                           AS PRD_CLSF_CHRPSN_TP_CD
                         , (
                            SELECT SSP_APP.FN_COM_DTL_CDNM
                                   (
                                     #{LANG_CD}
                                   , 'PRD_CLSF_CHRPSN_TP_CD'
                                   , A.PRD_CLSF_CHRPSN_TP_CD
                                   )
                              FROM DUAL
                           )                                                 AS PRD_CLSF_CHRPSN_NM
                         , A.PRD_CLSF_CHRPSN_SPR_CD                          AS PRD_CLSF_CHRPSN_SPR_CD
                         , (
                            SELECT SSP_APP.FN_COM_DTL_CDNM
                                   (
                                     #{LANG_CD}
                                   , 'PRD_CLSF_CHRPSN_SPR_CD'
                                   , A.PRD_CLSF_CHRPSN_SPR_CD
                                   )
                              FROM DUAL
                           )                                                 AS PRD_CLSF_CHRPSN_SPR_NM
                         , (
                            SELECT CASE WHEN COUNT(1) > 0
                                        THEN 'Y'
                                        ELSE 'N'
                                   END                    AS SALS_CHRPSN_YN
                              FROM SSP_APP.TB_CC_BZPLC_BASIS
                             WHERE SALS_CHRPSN_ID1 = A.PRD_CLSF_CHRPSN_ID
                           )                                                 AS SALS_CHRPSN_YN
                         , ROW_NUMBER() OVER (ORDER BY CASE WHEN A.MNFR_NO != '*' AND A.PRD_CLCD != '*'
                                                            THEN 1
                                                            WHEN A.MNFR_NO != '*'
                                                            THEN 2
                                                            ELSE 3
                                                       END)                  AS TB_PR_PRD_CLSF_CHRPSN_INFO_ORDER
                      FROM SSP_APP.TB_PR_PRD_CLSF_CHRPSN_INFO A
                     WHERE A.CO_CD                  = #{CO_CD}
                       AND A.PRD_CLSF_CHRPSN_ID     = #{EMP_NO}
                       AND A.PRD_CLSF_CHRPSN_TP_CD  IN ('10','30')   /*상품분류담당자유형코드[10:상품담당자,20:MD담당자,30:RND구매담당자]*/
                       AND A.PRD_CLSF_CHRPSN_SPR_CD IN ('10','20')   /*상품분류담당자구분코드[10:정,20:부]*/
                       AND A.PRD_CLSF_CHRPSN_USEYN  = 'Y'            /*상품분류담당자사용여부*/
                       AND A.MALL_SPR_CD            = '20'           /*몰구분코드[10:SSP,20:RND]*/
		]]>
			<if test='(MNFR_NO != null and MNFR_NO != "") or (PRD_CLCD != null and PRD_CLCD != "")'>
			    <![CDATA[
                       AND (   
                               A.MNFR_NO  = NVL(#{MNFR_NO}, '*')
                            OR
                               A.PRD_CLCD = NVL(#{PRD_CLCD},'*')
                           )
                ]]>
			</if>
		<![CDATA[
                     UNION ALL
                    SELECT ''                     AS PRD_CLSF_CHRPSN_ID
                         , ''                     AS PRD_CLSF_CHRPSN_TP_CD
                         , ''                     AS PRD_CLSF_CHRPSN_NM
                         , ''                     AS PRD_CLSF_CHRPSN_SPR_CD
                         , ''                     AS PRD_CLSF_CHRPSN_SPR_NM
                         , CASE WHEN COUNT(1) > 0
                                THEN 'Y'
                                ELSE 'N'
                           END                    AS SALS_CHRPSN_YN
                         , 1                      AS TB_PR_PRD_CLSF_CHRPSN_INFO_ORDER
                      FROM SSP_APP.TB_CC_BZPLC_BASIS A
                     WHERE A.CO_CD           = #{CO_CD}
                       AND A.SALS_CHRPSN_ID1 = #{EMP_NO}
                    ) A1
              WHERE A1.TB_PR_PRD_CLSF_CHRPSN_INFO_ORDER = 1
		]]>
	</select>
</mapper>